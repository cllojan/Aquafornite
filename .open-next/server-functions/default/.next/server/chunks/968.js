"use strict";exports.id=968,exports.ids=[968],exports.modules={147:(a,b,c)=>{function d(a){if(null===a||"object"!=typeof a)return!1;let b=Object.getPrototypeOf(a);return(null===b||b===Object.prototype||null===Object.getPrototypeOf(b))&&!(Symbol.iterator in a)&&(!(Symbol.toStringTag in a)||"[object Module]"===Object.prototype.toString.call(a))}function e(a){return(...b)=>b.reduce((b,c)=>(function a(b,c,e=".",f){if(!d(c))return a(b,{},e,f);let g=Object.assign({},c);for(let c in b){if("__proto__"===c||"constructor"===c)continue;let h=b[c];null!=h&&(f&&f(g,c,h,e)||(Array.isArray(h)&&Array.isArray(g[c])?g[c]=[...h,...g[c]]:d(h)&&d(g[c])?g[c]=a(h,g[c],(e?`${e}.`:"")+c.toString(),f):g[c]=h))}return g})(b,c,"",a),{})}c.d(b,{$Q:()=>f,zG:()=>e});let f=e();e((a,b,c)=>{if(void 0!==a[b]&&"function"==typeof c)return a[b]=c(a[b]),!0}),e((a,b,c)=>{if(Array.isArray(a[b])&&"function"==typeof c)return a[b]=c(a[b]),!0})},2952:(a,b,c)=>{c.d(b,{$O:()=>r,DT:()=>u,NF:()=>s,Ow:()=>w,RY:()=>v,kU:()=>q,q5:()=>t,vd:()=>p});var d=c(44625),e=c(31009),f=c(49374),g=c(69385),h=c(60353),i=c(57105),j=c(81266),k=c(68019),l=c(40659),m=c(38729),n=c(80906),o=c(67183);function p(a){return(0,h.Kg)(a)?t(a):a.toOperationNode()}function q(a){return(0,h.MH)(a)?a.map(a=>r(a)):[r(a)]}function r(a){return(0,i.SS)(a)?(0,i.YK)(a):p(a)}function s(a,b){let c=t(a);if((0,l.Xm)(b))return m.Q.create(c,n.k.create(l.zX.create(b)));let d=b.slice(0,-1);if((0,l.Xm)(d))return m.Q.create(c,o.c.create(l.zX.create(d)));throw Error(`Invalid JSON operator: ${b}`)}function t(a){if(!a.includes("."))return f.q.create(e.Z.create(a));let b=a.split(".").map(x);if(3===b.length){var c=b;let[a,d,h]=c;return f.q.create(e.Z.create(h),g.H.createWithSchema(a,d))}if(2===b.length){var d=b;let[a,c]=d;return f.q.create(e.Z.create(c),g.H.create(a))}throw Error(`invalid column reference ${a}`)}function u(a){let b=" as ";if(!a.includes(b))return t(a);{let[c,e]=a.split(b).map(x);return d.N.create(t(c),j.O.create(e))}}function v(a){return e.Z.create(a)}function w(a){if(!a.includes(" "))return v(a);{let[b,c]=a.split(" ").map(x);if(!(0,k.bE)(c))throw Error(`invalid order direction "${c}" next to "${b}"`);return(0,k.xk)([b,c])[0]}}function x(a){return a.trim()}},3518:(a,b,c)=>{let d,e,f;c.d(b,{li:()=>cH});var g=c(23427),h=c(4174),i=c(96843),j=c(46762),k=c(5761),l=c(8897);c(24340);var m=c(58298),n=c(94324);c(69744),c(5109),c(62767),c(61287);var o=c(92769);function p(a,b){if(b.advanced?.ipAddress?.disableIpTracking)return null;if((0,l.i)()||l.a)return"127.0.0.1";let c="headers"in a?a.headers:a;for(let a of b.advanced?.ipAddress?.ipAddressHeaders||["x-forwarded-for"]){let b="get"in c?c.get(a):c[a];if("string"==typeof b){var d;let a=b.split(",")[0].trim();if(d=a,j.uXy().safeParse(d).success||j.ugL().safeParse(d).success)return a}}return null}var q=c(55220),r=c(64515),s=c(27320),t=c(74823);c(37305),c(33679);var u=c(147);let v=new Map;async function w(a,b){if(!b.rateLimit.enabled)return;let c=new URL(a.url).pathname.replace(b.options.basePath||"/api/auth",""),d=b.rateLimit.window,e=b.rateLimit.max,f=p(a,b.options);if(!f)return;let g=f+c,i=[{pathMatcher:a=>a.startsWith("/sign-in")||a.startsWith("/sign-up")||a.startsWith("/change-password")||a.startsWith("/change-email"),window:10,max:3}].find(a=>a.pathMatcher(c));for(let a of(i&&(d=i.window,e=i.max),b.options.plugins||[]))if(a.rateLimit){let b=a.rateLimit.find(a=>a.pathMatcher(c));if(b){d=b.window,e=b.max;break}}if(b.rateLimit.customRules){let f=Object.keys(b.rateLimit.customRules).find(a=>a.includes("*")?(0,h.w)(a)(c):a===c);if(f){let c=b.rateLimit.customRules[f],g="function"==typeof c?await c(a):c;if(g&&(d=g.window,e=g.max),!1===g)return}}let j=function(a,b){if(a.options.rateLimit?.customStorage)return a.options.rateLimit.customStorage;let c=a.rateLimit.storage;if("secondary-storage"===c)return{get:async b=>{let c=await a.options.secondaryStorage?.get(b);return c?(0,o.s)(c):void 0},set:async(c,d,e)=>{let f=b?.window??a.options.rateLimit?.window??10;await a.options.secondaryStorage?.set?.(c,JSON.stringify(d),f)}};if("memory"===c)return{get:async a=>v.get(a),async set(a,b,c){v.set(a,b)}};let d="rateLimit",e=a.adapter;return{get:async a=>{let b=(await e.findMany({model:d,where:[{field:"key",value:a}]}))[0];return"bigint"==typeof b?.lastRequest&&(b.lastRequest=Number(b.lastRequest)),b},set:async(b,c,f)=>{try{f?await e.updateMany({model:d,where:[{field:"key",value:b}],update:{count:c.count,lastRequest:c.lastRequest}}):await e.create({model:d,data:{key:b,count:c.count,lastRequest:c.lastRequest}})}catch(b){a.logger.error("Error setting rate limit",b)}}}}(b,{window:d}),k=await j.get(g),l=Date.now();if(k){var m,n,q,r;let a=l-k.lastRequest;if(m=e,n=d,q=k,Date.now()-q.lastRequest<1e3*n&&q.count>=m){return r=Math.ceil((k.lastRequest+1e3*d-Date.now())/1e3),new Response(JSON.stringify({message:"Too many requests. Please try again later."}),{status:429,statusText:"Too Many Requests",headers:{"X-Retry-After":r.toString()}})}a>1e3*d?await j.set(g,{...k,count:1,lastRequest:l},!0):await j.set(g,{...k,count:k.count+1,lastRequest:l},!0)}else await j.set(g,{key:g,count:1,lastRequest:l})}function x(a,b){let c=b.plugins?.reduce((a,b)=>({...a,...b.endpoints}),{})??{},d=b.plugins?.map(b=>b.middlewares?.map(b=>{let c=async c=>{let d=await a;return b.middleware({...c,context:{...d,...c.context}})};return c.options=b.middleware.options,{path:b.path,middleware:c}})).filter(a=>void 0!==a).flat()||[],e={...{signInSocial:h.S,callbackOAuth:h.R,getSession:(0,i.b)(),signOut:h.Q,signUpEmail:(0,i.a)("/sign-up/email",{method:"POST",body:j.g1P(j.YjP(),j.bzn()),metadata:{$Infer:{body:{}},openapi:{description:"Sign up a user using email and password",requestBody:{content:{"application/json":{schema:{type:"object",properties:{name:{type:"string",description:"The name of the user"},email:{type:"string",description:"The email of the user"},password:{type:"string",description:"The password of the user"},image:{type:"string",description:"The profile image URL of the user"},callbackURL:{type:"string",description:"The URL to use for email verification callback"},rememberMe:{type:"boolean",description:"If this is false, the session will not be remembered. Default is `true`."}},required:["name","email","password"]}}}},responses:{200:{description:"Successfully created user",content:{"application/json":{schema:{type:"object",properties:{token:{type:"string",nullable:!0,description:"Authentication token for the session"},user:{type:"object",properties:{id:{type:"string",description:"The unique identifier of the user"},email:{type:"string",format:"email",description:"The email address of the user"},name:{type:"string",description:"The name of the user"},image:{type:"string",format:"uri",nullable:!0,description:"The profile image URL of the user"},emailVerified:{type:"boolean",description:"Whether the email has been verified"},createdAt:{type:"string",format:"date-time",description:"When the user was created"},updatedAt:{type:"string",format:"date-time",description:"When the user was last updated"}},required:["id","email","name","emailVerified","createdAt","updatedAt"]}},required:["user"]}}}},422:{description:"Unprocessable Entity. User already exists or failed to create user.",content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}}}}}}},async a=>{let b;if(!a.context.options.emailAndPassword?.enabled||a.context.options.emailAndPassword?.disableSignUp)throw new g.LG("BAD_REQUEST",{message:"Email and password sign up is not enabled"});let c=a.body,{name:d,email:e,password:f,image:n,callbackURL:o,rememberMe:p,...q}=c;if(!j.Rpp().safeParse(e).success)throw new g.LG("BAD_REQUEST",{message:i.B.INVALID_EMAIL});let r=a.context.password.config.minPasswordLength;if(f.length<r)throw a.context.logger.error("Password is too short"),new g.LG("BAD_REQUEST",{message:i.B.PASSWORD_TOO_SHORT});let s=a.context.password.config.maxPasswordLength;if(f.length>s)throw a.context.logger.error("Password is too long"),new g.LG("BAD_REQUEST",{message:i.B.PASSWORD_TOO_LONG});let t=await a.context.internalAdapter.findUserByEmail(e);if(t?.user)throw a.context.logger.info(`Sign-up attempt for existing email: ${e}`),new g.LG("UNPROCESSABLE_ENTITY",{message:i.B.USER_ALREADY_EXISTS_USE_ANOTHER_EMAIL});let u=await a.context.password.hash(f);try{let c=(0,m.d)(a.context.options,q,"create");if(!(b=await a.context.internalAdapter.createUser({email:e.toLowerCase(),name:d,image:n,...c,emailVerified:!1},a)))throw new g.LG("BAD_REQUEST",{message:i.B.FAILED_TO_CREATE_USER})}catch(b){if(l.a&&a.context.logger.error("Failed to create user",b),b instanceof g.LG)throw b;throw a.context.logger?.error("Failed to create user",b),new g.LG("UNPROCESSABLE_ENTITY",{message:i.B.FAILED_TO_CREATE_USER,details:b})}if(!b)throw new g.LG("UNPROCESSABLE_ENTITY",{message:i.B.FAILED_TO_CREATE_USER});if(await a.context.internalAdapter.linkAccount({userId:b.id,providerId:"credential",accountId:b.id,password:u},a),a.context.options.emailVerification?.sendOnSignUp||a.context.options.emailAndPassword.requireEmailVerification){let d=await (0,h.k)(a.context.secret,b.email,void 0,a.context.options.emailVerification?.expiresIn),e=`${a.context.baseURL}/verify-email?token=${d}&callbackURL=${c.callbackURL||"/"}`,f=a.request?[{user:b,url:e,token:d},a.request]:[{user:b,url:e,token:d}];await a.context.options.emailVerification?.sendVerificationEmail?.(...f)}if(!1===a.context.options.emailAndPassword.autoSignIn||a.context.options.emailAndPassword.requireEmailVerification)return a.json({token:null,user:{id:b.id,email:b.email,name:b.name,image:b.image,emailVerified:b.emailVerified,createdAt:b.createdAt,updatedAt:b.updatedAt}});let v=await a.context.internalAdapter.createSession(b.id,a,!1===p);if(!v)throw new g.LG("BAD_REQUEST",{message:i.B.FAILED_TO_CREATE_SESSION});return await (0,k.s)(a,{session:v,user:b},!1===p),a.json({token:v.token,user:{id:b.id,email:b.email,name:b.name,image:b.image,emailVerified:b.emailVerified,createdAt:b.createdAt,updatedAt:b.updatedAt}})}),signInEmail:h.P,forgetPassword:h.O,resetPassword:h.N,verifyEmail:h.M,sendVerificationEmail:h.L,changeEmail:h.K,changePassword:h.J,setPassword:h.I,updateUser:(0,h.u)(),deleteUser:h.G,forgetPasswordCallback:h.F,requestPasswordReset:h.E,requestPasswordResetCallback:h.D,listSessions:(0,i.l)(),revokeSession:i.e,revokeSessions:i.d,revokeOtherSessions:i.r,linkSocialAccount:h.C,listUserAccounts:h.B,deleteUserCallback:h.A,unlinkAccount:h.z,refreshToken:h.y,getAccessToken:h.x,accountInfo:h.q},...c,ok:h.n,error:h.m};return{api:(0,h.t)(e,a),middlewares:d}}var y=c(84916),z=c(51067),A=c(48026),B=c(18804),C=c(81266),D=c(31575);function E(a,b){return D.z.createWithChildren([D.z.createWithSql(`${a} `),C.O.create(b)])}var F=c(23090),G=c(60353),H=c(31700);class I{#a;#b=new K;#c;#d;constructor(a){this.#a=(0,G.CN)({...a})}async init(){this.#c=(0,G.Tn)(this.#a.database)?await this.#a.database():this.#a.database,this.#d=new J(this.#c),this.#a.onCreateConnection&&await this.#a.onCreateConnection(this.#d)}async acquireConnection(){return await this.#b.lock(),this.#d}async beginTransaction(a){await a.executeQuery(F.E.raw("begin"))}async commitTransaction(a){await a.executeQuery(F.E.raw("commit"))}async rollbackTransaction(a){await a.executeQuery(F.E.raw("rollback"))}async savepoint(a,b,c){await a.executeQuery(c(E("savepoint",b),(0,H.a)()))}async rollbackToSavepoint(a,b,c){await a.executeQuery(c(E("rollback to",b),(0,H.a)()))}async releaseSavepoint(a,b,c){await a.executeQuery(c(E("release",b),(0,H.a)()))}async releaseConnection(){this.#b.unlock()}async destroy(){this.#c?.close()}}class J{#c;constructor(a){this.#c=a}executeQuery(a){let{sql:b,parameters:c}=a,d=this.#c.prepare(b);if(d.reader)return Promise.resolve({rows:d.all(c)});let{changes:e,lastInsertRowid:f}=d.run(c);return Promise.resolve({numAffectedRows:null!=e?BigInt(e):void 0,insertId:null!=f?BigInt(f):void 0,rows:[]})}async *streamQuery(a,b){let{sql:c,parameters:d,query:e}=a,f=this.#c.prepare(c);if(B.L.is(e))for(let a of f.iterate(d))yield{rows:[a]};else throw Error("Sqlite driver only supports streaming of select queries")}}class K{#e;#f;async lock(){for(;this.#e;)await this.#e;this.#e=new Promise(a=>{this.#f=a})}unlock(){let a=this.#f;this.#e=void 0,this.#f=void 0,a?.()}}var L=c(68558);let M=/"/g;class N extends L.n{visitOrAction(a){this.append("or "),this.append(a.action)}getCurrentParameterPlaceholder(){return"?"}getLeftExplainOptionsWrapper(){return""}getRightExplainOptionsWrapper(){return""}getLeftIdentifierWrapper(){return'"'}getRightIdentifierWrapper(){return'"'}getAutoIncrement(){return"autoincrement"}sanitizeIdentifier(a){return a.replace(M,'""')}visitDefaultInsertValue(a){this.append("null")}}var O=c(78329),P=c(34220);class Q{#c;constructor(a){this.#c=a}async getSchemas(){return[]}async getTables(a={withInternalKyselyTables:!1}){return await this.#g(a)}async getMetadata(a){return{tables:await this.getTables(a)}}#h(a,b){let c=a.selectFrom("sqlite_master").where("type","in",["table","view"]).where("name","not like","sqlite_%").select(["name","sql","type"]).orderBy("name");return b.withInternalKyselyTables||(c=c.where("name","!=",O.kQ).where("name","!=",O.sy)),c}async #g(a){let b=await this.#h(this.#c,a).execute(),c=await this.#c.with("table_list",b=>this.#h(b,a)).selectFrom(["table_list as tl",(0,P.l)`pragma_table_info(tl.name)`.as("p")]).select(["tl.name as table","p.cid","p.name","p.type","p.notnull","p.dflt_value","p.pk"]).orderBy("tl.name").orderBy("p.cid").execute(),d={};for(let a of c)d[a.table]??=[],d[a.table].push(a);return b.map(({name:a,sql:b,type:c})=>{let e=b?.split(/[\(\),]/)?.find(a=>a.toLowerCase().includes("autoincrement"))?.trimStart()?.split(/\s+/)?.[0]?.replace(/["`]/g,""),f=d[a]??[];if(!e){let a=f.filter(a=>a.pk>0);1===a.length&&"integer"===a[0].type.toLowerCase()&&(e=a[0].name)}return{name:a,isView:"view"===c,columns:f.map(a=>({name:a.name,dataType:a.type,isNullable:!a.notnull,isAutoIncrementing:a.name===e,hasDefaultValue:null!=a.dflt_value,comment:void 0}))}})}}class R{get supportsCreateIfNotExists(){return!0}get supportsTransactionalDdl(){return!1}get supportsReturning(){return!1}get supportsOutput(){return!1}}class S extends R{get supportsTransactionalDdl(){return!1}get supportsReturning(){return!0}async acquireMigrationLock(a,b){}async releaseMigrationLock(a,b){}}class T{#a;constructor(a){this.#a=(0,G.CN)({...a})}createDriver(){return new I(this.#a)}createQueryCompiler(){return new N}createAdapter(){return new S}createIntrospector(a){return new Q(a)}}function U(a,b){var c;if(c=a,(0,G.Gv)(c)&&(0,G.Kg)(c.stack)&&b.stack){let c=b.stack.split("\n").slice(1).join("\n");a.stack+=`
${c}`}return a}let V=Symbol();class W{#a;#i=new WeakMap;#j;constructor(a){this.#a=(0,G.CN)({...a})}async init(){this.#j=(0,G.Tn)(this.#a.pool)?await this.#a.pool():this.#a.pool}async acquireConnection(){let a=await this.#k(),b=this.#i.get(a);return!b&&(b=new X(a),this.#i.set(a,b),this.#a?.onCreateConnection&&await this.#a.onCreateConnection(b)),this.#a?.onReserveConnection&&await this.#a.onReserveConnection(b),b}async #k(){return new Promise((a,b)=>{this.#j.getConnection(async(c,d)=>{c?b(c):a(d)})})}async beginTransaction(a,b){if(b.isolationLevel||b.accessMode){let c=[];b.isolationLevel&&c.push(`isolation level ${b.isolationLevel}`),b.accessMode&&c.push(b.accessMode);let d=`set transaction ${c.join(", ")}`;await a.executeQuery(F.E.raw(d))}await a.executeQuery(F.E.raw("begin"))}async commitTransaction(a){await a.executeQuery(F.E.raw("commit"))}async rollbackTransaction(a){await a.executeQuery(F.E.raw("rollback"))}async savepoint(a,b,c){await a.executeQuery(c(E("savepoint",b),(0,H.a)()))}async rollbackToSavepoint(a,b,c){await a.executeQuery(c(E("rollback to",b),(0,H.a)()))}async releaseSavepoint(a,b,c){await a.executeQuery(c(E("release savepoint",b),(0,H.a)()))}async releaseConnection(a){a[V]()}async destroy(){return new Promise((a,b)=>{this.#j.end(c=>{c?b(c):a()})})}}class X{#l;constructor(a){this.#l=a}async executeQuery(a){try{let b=await this.#m(a);if((0,G.Gv)(b)&&"insertId"in b&&"affectedRows"in b){let{insertId:a,affectedRows:c,changedRows:d}=b;return{insertId:null!=a&&"0"!==a.toString()?BigInt(a):void 0,numAffectedRows:null!=c?BigInt(c):void 0,numChangedRows:null!=d?BigInt(d):void 0,rows:[]}}if(Array.isArray(b))return{rows:b};return{rows:[]}}catch(a){throw U(a,Error())}}#m(a){return new Promise((b,c)=>{this.#l.query(a.sql,a.parameters,(a,d)=>{a?c(a):b(d)})})}async *streamQuery(a,b){let c=this.#l.query(a.sql,a.parameters).stream({objectMode:!0});try{for await(let a of c)yield{rows:[a]}}catch(a){if(a&&"object"==typeof a&&"code"in a&&"ERR_STREAM_PREMATURE_CLOSE"===a.code)return;throw a}}[V](){this.#l.release()}}let Y=/`/g;class Z extends L.n{getCurrentParameterPlaceholder(){return"?"}getLeftExplainOptionsWrapper(){return""}getExplainOptionAssignment(){return"="}getExplainOptionsDelimiter(){return" "}getRightExplainOptionsWrapper(){return""}getLeftIdentifierWrapper(){return"`"}getRightIdentifierWrapper(){return"`"}sanitizeIdentifier(a){return a.replace(Y,"``")}visitCreateIndex(a){this.append("create "),a.unique&&this.append("unique "),this.append("index "),a.ifNotExists&&this.append("if not exists "),this.visitNode(a.name),a.using&&(this.append(" using "),this.visitNode(a.using)),a.table&&(this.append(" on "),this.visitNode(a.table)),a.columns&&(this.append(" ("),this.compileList(a.columns),this.append(")")),a.where&&(this.append(" "),this.visitNode(a.where))}}class ${#c;constructor(a){this.#c=a}async getSchemas(){return(await this.#c.selectFrom("information_schema.schemata").select("schema_name").$castTo().execute()).map(a=>({name:a.SCHEMA_NAME}))}async getTables(a={withInternalKyselyTables:!1}){let b=this.#c.selectFrom("information_schema.columns as columns").innerJoin("information_schema.tables as tables",a=>a.onRef("columns.TABLE_CATALOG","=","tables.TABLE_CATALOG").onRef("columns.TABLE_SCHEMA","=","tables.TABLE_SCHEMA").onRef("columns.TABLE_NAME","=","tables.TABLE_NAME")).select(["columns.COLUMN_NAME","columns.COLUMN_DEFAULT","columns.TABLE_NAME","columns.TABLE_SCHEMA","tables.TABLE_TYPE","columns.IS_NULLABLE","columns.DATA_TYPE","columns.EXTRA","columns.COLUMN_COMMENT"]).where("columns.TABLE_SCHEMA","=",(0,P.l)`database()`).orderBy("columns.TABLE_NAME").orderBy("columns.ORDINAL_POSITION").$castTo();a.withInternalKyselyTables||(b=b.where("columns.TABLE_NAME","!=",O.kQ).where("columns.TABLE_NAME","!=",O.sy));let c=await b.execute();return this.#n(c)}async getMetadata(a){return{tables:await this.getTables(a)}}#n(a){return a.reduce((a,b)=>{let c=a.find(a=>a.name===b.TABLE_NAME);return c||(c=(0,G.CN)({name:b.TABLE_NAME,isView:"VIEW"===b.TABLE_TYPE,schema:b.TABLE_SCHEMA,columns:[]}),a.push(c)),c.columns.push((0,G.CN)({name:b.COLUMN_NAME,dataType:b.DATA_TYPE,isNullable:"YES"===b.IS_NULLABLE,isAutoIncrementing:b.EXTRA.toLowerCase().includes("auto_increment"),hasDefaultValue:null!==b.COLUMN_DEFAULT,comment:""===b.COLUMN_COMMENT?void 0:b.COLUMN_COMMENT})),a},[])}}let _="ea586330-2c93-47c8-908d-981d9d270f9d";class aa extends R{get supportsTransactionalDdl(){return!1}get supportsReturning(){return!1}async acquireMigrationLock(a,b){await (0,P.l)`select get_lock(${P.l.lit(_)}, ${P.l.lit(3600)})`.execute(a)}async releaseMigrationLock(a,b){await (0,P.l)`select release_lock(${P.l.lit(_)})`.execute(a)}}class ab{#a;constructor(a){this.#a=a}createDriver(){return new W(this.#a)}createQueryCompiler(){return new Z}createAdapter(){return new aa}createIntrospector(a){return new $(a)}}let ac=Symbol();class ad{#a;#i=new WeakMap;#j;constructor(a){this.#a=(0,G.CN)({...a})}async init(){this.#j=(0,G.Tn)(this.#a.pool)?await this.#a.pool():this.#a.pool}async acquireConnection(){let a=await this.#j.connect(),b=this.#i.get(a);return!b&&(b=new ae(a,{cursor:this.#a.cursor??null}),this.#i.set(a,b),this.#a.onCreateConnection&&await this.#a.onCreateConnection(b)),this.#a.onReserveConnection&&await this.#a.onReserveConnection(b),b}async beginTransaction(a,b){if(b.isolationLevel||b.accessMode){let c="start transaction";b.isolationLevel&&(c+=` isolation level ${b.isolationLevel}`),b.accessMode&&(c+=` ${b.accessMode}`),await a.executeQuery(F.E.raw(c))}else await a.executeQuery(F.E.raw("begin"))}async commitTransaction(a){await a.executeQuery(F.E.raw("commit"))}async rollbackTransaction(a){await a.executeQuery(F.E.raw("rollback"))}async savepoint(a,b,c){await a.executeQuery(c(E("savepoint",b),(0,H.a)()))}async rollbackToSavepoint(a,b,c){await a.executeQuery(c(E("rollback to",b),(0,H.a)()))}async releaseSavepoint(a,b,c){await a.executeQuery(c(E("release",b),(0,H.a)()))}async releaseConnection(a){a[ac]()}async destroy(){if(this.#j){let a=this.#j;this.#j=void 0,await a.end()}}}class ae{#o;#p;constructor(a,b){this.#o=a,this.#p=b}async executeQuery(a){try{let{command:b,rowCount:c,rows:d}=await this.#o.query(a.sql,[...a.parameters]);return{numAffectedRows:"INSERT"===b||"UPDATE"===b||"DELETE"===b||"MERGE"===b?BigInt(c):void 0,rows:d??[]}}catch(a){throw U(a,Error())}}async *streamQuery(a,b){if(!this.#p.cursor)throw Error("'cursor' is not present in your postgres dialect config. It's required to make streaming work in postgres.");if(!Number.isInteger(b)||b<=0)throw Error("chunkSize must be a positive integer");let c=this.#o.query(new this.#p.cursor(a.sql,a.parameters.slice()));try{for(;;){let a=await c.read(b);if(0===a.length)break;yield{rows:a}}}finally{await c.close()}}[ac](){this.#o.release()}}class af{#c;constructor(a){this.#c=a}async getSchemas(){return(await this.#c.selectFrom("pg_catalog.pg_namespace").select("nspname").$castTo().execute()).map(a=>({name:a.nspname}))}async getTables(a={withInternalKyselyTables:!1}){let b=this.#c.selectFrom("pg_catalog.pg_attribute as a").innerJoin("pg_catalog.pg_class as c","a.attrelid","c.oid").innerJoin("pg_catalog.pg_namespace as ns","c.relnamespace","ns.oid").innerJoin("pg_catalog.pg_type as typ","a.atttypid","typ.oid").innerJoin("pg_catalog.pg_namespace as dtns","typ.typnamespace","dtns.oid").select(["a.attname as column","a.attnotnull as not_null","a.atthasdef as has_default","c.relname as table","c.relkind as table_type","ns.nspname as schema","typ.typname as type","dtns.nspname as type_schema",(0,P.l)`col_description(a.attrelid, a.attnum)`.as("column_description"),(0,P.l)`pg_get_serial_sequence(quote_ident(ns.nspname) || '.' || quote_ident(c.relname), a.attname)`.as("auto_incrementing")]).where("c.relkind","in",["r","v","p"]).where("ns.nspname","!~","^pg_").where("ns.nspname","!=","information_schema").where("ns.nspname","!=","crdb_internal").where("a.attnum",">=",0).where("a.attisdropped","!=",!0).orderBy("ns.nspname").orderBy("c.relname").orderBy("a.attnum").$castTo();a.withInternalKyselyTables||(b=b.where("c.relname","!=",O.kQ).where("c.relname","!=",O.sy));let c=await b.execute();return this.#n(c)}async getMetadata(a){return{tables:await this.getTables(a)}}#n(a){return a.reduce((a,b)=>{let c=a.find(a=>a.name===b.table&&a.schema===b.schema);return c||(c=(0,G.CN)({name:b.table,isView:"v"===b.table_type,schema:b.schema,columns:[]}),a.push(c)),c.columns.push((0,G.CN)({name:b.column,dataType:b.type,dataTypeSchema:b.type_schema,isNullable:!b.not_null,isAutoIncrementing:null!==b.auto_incrementing,hasDefaultValue:b.has_default,comment:b.column_description??void 0})),a},[])}}let ag=/"/g;class ah extends L.n{sanitizeIdentifier(a){return a.replace(ag,'""')}}let ai=BigInt("3853314791062309107");class aj extends R{get supportsTransactionalDdl(){return!0}get supportsReturning(){return!0}async acquireMigrationLock(a,b){await (0,P.l)`select pg_advisory_xact_lock(${P.l.lit(ai)})`.execute(a)}async releaseMigrationLock(a,b){}}class ak{#a;constructor(a){this.#a=a}createDriver(){return new ad(this.#a)}createQueryCompiler(){return new ah}createAdapter(){return new aj}createIntrospector(a){return new af(a)}}class al extends R{get supportsCreateIfNotExists(){return!1}get supportsTransactionalDdl(){return!0}get supportsOutput(){return!0}async acquireMigrationLock(a){await (0,P.l)`exec sp_getapplock @DbPrincipal = ${P.l.lit("dbo")}, @Resource = ${P.l.lit(O.kQ)}, @LockMode = ${P.l.lit("Exclusive")}`.execute(a)}async releaseMigrationLock(){}}var am=c(96931),an=c(37381);let ao=Symbol(),ap=Symbol(),aq=Symbol();class ar{#a;#j;constructor(a){this.#a=(0,G.CN)({...a});let{tarn:b,tedious:c,validateConnections:d}=this.#a,{validateConnections:e,...f}=b.options;this.#j=new b.Pool({...f,create:async()=>{let a=await c.connectionFactory();return await new as(a,c).connect()},destroy:async a=>{await a[ap]()},validate:!1===d||!1===e?void 0:a=>a[aq]()})}async init(){}async acquireConnection(){return await this.#j.acquire().promise}async beginTransaction(a,b){await a.beginTransaction(b)}async commitTransaction(a){await a.commitTransaction()}async rollbackTransaction(a){await a.rollbackTransaction()}async savepoint(a,b){await a.savepoint(b)}async rollbackToSavepoint(a,b){await a.rollbackTransaction(b)}async releaseConnection(a){(this.#a.resetConnectionsOnRelease||this.#a.tedious.resetConnectionOnRelease)&&await a[ao](),this.#j.release(a)}async destroy(){await this.#j.destroy()}}class as{#d;#q;#r;constructor(a,b){this.#d=a,this.#q=!1,this.#r=b}async beginTransaction(a){let{isolationLevel:b}=a;await new Promise((a,c)=>this.#d.beginTransaction(b=>{b?c(b):a(void 0)},b?(0,am.D)(8):void 0,b?this.#s(b):void 0))}async commitTransaction(){await new Promise((a,b)=>this.#d.commitTransaction(c=>{c?b(c):a(void 0)}))}async connect(){let{promise:a,reject:b,resolve:c}=new an.c;function d(){b(Error("The connection ended without ever completing the connection"))}return this.#d.connect(a=>{if(a)return b(a);c()}),this.#d.on("error",a=>{a instanceof Error&&"code"in a&&"ESOCKET"===a.code&&(this.#q=!0),console.error(a),b(a)}),this.#d.once("end",d),await a,this.#d.off("end",d),this}async executeQuery(a){try{let b=new an.c,c=new at({compiledQuery:a,tedious:this.#r,onDone:b});this.#d.execSql(c.request);let{rowCount:d,rows:e}=await b.promise;return{numAffectedRows:void 0!==d?BigInt(d):void 0,rows:e}}catch(a){throw U(a,Error())}}async rollbackTransaction(a){await new Promise((b,c)=>this.#d.rollbackTransaction(a=>{a?c(a):b(void 0)},a))}async savepoint(a){await new Promise((b,c)=>this.#d.saveTransaction(a=>{a?c(a):b(void 0)},a))}async *streamQuery(a,b){if(!Number.isInteger(b)||b<=0)throw Error("chunkSize must be a positive integer");let c=new at({compiledQuery:a,streamChunkSize:b,tedious:this.#r});this.#d.execSql(c.request);try{for(;;){let a=await c.readChunk();if(0===a.length||(yield{rows:a},a.length<b))break}}finally{await this.#t(c)}}#s(a){let{ISOLATION_LEVEL:b}=this.#r,c={"read committed":b.READ_COMMITTED,"read uncommitted":b.READ_UNCOMMITTED,"repeatable read":b.REPEATABLE_READ,serializable:b.SERIALIZABLE,snapshot:b.SNAPSHOT}[a];if(void 0===c)throw Error(`Unknown isolation level: ${a}`);return c}#t(a){return new Promise(b=>{a.request.once("requestCompleted",b),this.#d.cancel()||(a.request.off("requestCompleted",b),b())})}[ap](){return"closed"in this.#d&&this.#d.closed?Promise.resolve():new Promise(a=>{this.#d.once("end",a),this.#d.close()})}async [ao](){await new Promise((a,b)=>{this.#d.reset(c=>{if(c)return b(c);a()})})}async [aq](){if(this.#q||this.#u())return!1;try{let a=new an.c,b=new at({compiledQuery:F.E.raw("select 1"),onDone:a,tedious:this.#r});return this.#d.execSql(b.request),await a.promise,!0}catch{return!1}}#u(){return"closed"in this.#d&&!!this.#d.closed}}class at{#v;#w;#x;#y;#r;#z;constructor(a){let{compiledQuery:b,onDone:c,streamChunkSize:d,tedious:e}=a;if(this.#w=[],this.#x=d,this.#y={},this.#r=e,c){let a="onDone";this.#y[a]=(b,d)=>{if("chunkReady"!==b){if(delete this.#y[a],"error"===b)return c.reject(d);c.resolve({rowCount:this.#z,rows:this.#w})}}}this.#v=new this.#r.Request(b.sql,(a,b)=>{if(a)return Object.values(this.#y).forEach(b=>b("error",a instanceof AggregateError?a.errors:a));this.#z=b}),this.#A(b.parameters),this.#B()}get request(){return this.#v}readChunk(){let a=this.readChunk.name;return new Promise((b,c)=>{this.#y[a]=(d,e)=>{if(delete this.#y[a],"error"===d)return c(e);b(this.#w.splice(0,this.#x))},this.#v.resume()})}#A(a){for(let b=0;b<a.length;b++){let c=a[b];this.#v.addParameter(String(b+1),this.#C(c),c)}}#B(){let a=this.#x?()=>{this.#x<=this.#w.length&&(this.#v.pause(),Object.values(this.#y).forEach(a=>a("chunkReady")))}:()=>{},b=b=>{let c={};for(let a of b)c[a.metadata.colName]=a.value;this.#w.push(c),a()};this.#v.on("row",b),this.#v.once("requestCompleted",()=>{Object.values(this.#y).forEach(a=>a("completed")),this.#v.off("row",b)})}#C(a){if((0,G.kZ)(a)||(0,G.b0)(a)||(0,G.Kg)(a))return this.#r.TYPES.NVarChar;if((0,G.sI)(a)||(0,G.Et)(a)&&a%1==0)if(a<-0x80000000||a>0x7fffffff)return this.#r.TYPES.BigInt;else return this.#r.TYPES.Int;return(0,G.Et)(a)?this.#r.TYPES.Float:(0,G.Lm)(a)?this.#r.TYPES.Bit:(0,G.$P)(a)?this.#r.TYPES.DateTime:(0,G.Pe)(a)?this.#r.TYPES.VarBinary:this.#r.TYPES.NVarChar}}class au{#c;constructor(a){this.#c=a}async getSchemas(){return await this.#c.selectFrom("sys.schemas").select("name").execute()}async getTables(a={withInternalKyselyTables:!1}){let b=await this.#c.selectFrom("sys.tables as tables").leftJoin("sys.schemas as table_schemas","table_schemas.schema_id","tables.schema_id").innerJoin("sys.columns as columns","columns.object_id","tables.object_id").innerJoin("sys.types as types","types.user_type_id","columns.user_type_id").leftJoin("sys.schemas as type_schemas","type_schemas.schema_id","types.schema_id").leftJoin("sys.extended_properties as comments",a=>a.onRef("comments.major_id","=","tables.object_id").onRef("comments.minor_id","=","columns.column_id").on("comments.name","=","MS_Description")).$if(!a.withInternalKyselyTables,a=>a.where("tables.name","!=",O.kQ).where("tables.name","!=",O.sy)).select(["tables.name as table_name",a=>a.ref("tables.type").$castTo().as("table_type"),"table_schemas.name as table_schema_name","columns.default_object_id as column_default_object_id","columns.generated_always_type_desc as column_generated_always_type","columns.is_computed as column_is_computed","columns.is_identity as column_is_identity","columns.is_nullable as column_is_nullable","columns.is_rowguidcol as column_is_rowguidcol","columns.name as column_name","types.is_nullable as type_is_nullable","types.name as type_name","type_schemas.name as type_schema_name","comments.value as column_comment"]).unionAll(this.#c.selectFrom("sys.views as views").leftJoin("sys.schemas as view_schemas","view_schemas.schema_id","views.schema_id").innerJoin("sys.columns as columns","columns.object_id","views.object_id").innerJoin("sys.types as types","types.user_type_id","columns.user_type_id").leftJoin("sys.schemas as type_schemas","type_schemas.schema_id","types.schema_id").leftJoin("sys.extended_properties as comments",a=>a.onRef("comments.major_id","=","views.object_id").onRef("comments.minor_id","=","columns.column_id").on("comments.name","=","MS_Description")).select(["views.name as table_name","views.type as table_type","view_schemas.name as table_schema_name","columns.default_object_id as column_default_object_id","columns.generated_always_type_desc as column_generated_always_type","columns.is_computed as column_is_computed","columns.is_identity as column_is_identity","columns.is_nullable as column_is_nullable","columns.is_rowguidcol as column_is_rowguidcol","columns.name as column_name","types.is_nullable as type_is_nullable","types.name as type_name","type_schemas.name as type_schema_name","comments.value as column_comment"])).orderBy("table_schema_name").orderBy("table_name").orderBy("column_name").execute(),c={};for(let a of b){let b=`${a.table_schema_name}.${a.table_name}`;(c[b]=c[b]||(0,G.CN)({columns:[],isView:"V "===a.table_type,name:a.table_name,schema:a.table_schema_name??void 0})).columns.push((0,G.CN)({dataType:a.type_name,dataTypeSchema:a.type_schema_name??void 0,hasDefaultValue:a.column_default_object_id>0||"NOT_APPLICABLE"!==a.column_generated_always_type||a.column_is_identity||a.column_is_computed||a.column_is_rowguidcol,isAutoIncrementing:a.column_is_identity,isNullable:a.column_is_nullable&&a.type_is_nullable,name:a.column_name,comment:a.column_comment??void 0}))}return Object.values(c)}async getMetadata(a){return{tables:await this.getTables(a)}}}let av=/^[a-z0-9_]$/i;class aw extends L.n{getCurrentParameterPlaceholder(){return`@${this.numParameters}`}visitOffset(a){super.visitOffset(a),this.append(" rows")}compileColumnAlterations(a){let b={};for(let c of a)b[c.kind]||(b[c.kind]=[]),b[c.kind].push(c);let c=!0;b.AddColumnNode&&(this.append("add "),this.compileList(b.AddColumnNode),c=!1),b.AlterColumnNode&&(c||this.append(", "),this.compileList(b.AlterColumnNode)),b.DropColumnNode&&(c||this.append(", "),this.append("drop column "),this.compileList(b.DropColumnNode)),b.ModifyColumnNode&&(c||this.append(", "),this.compileList(b.ModifyColumnNode)),b.RenameColumnNode&&(c||this.append(", "),this.compileList(b.RenameColumnNode))}visitAddColumn(a){this.visitNode(a.column)}visitDropColumn(a){this.visitNode(a.column)}visitMergeQuery(a){super.visitMergeQuery(a),this.append(";")}visitCollate(a){this.append("collate ");let{name:b}=a.collation;for(let a of b)if(!av.test(a))throw Error(`Invalid collation: ${b}`);this.append(b)}announcesNewColumnDataType(){return!1}}class ax{#a;constructor(a){this.#a=a}createDriver(){return new ar(this.#a)}createQueryCompiler(){return new aw}createAdapter(){return new al}createIntrospector(a){return new au(a)}}let ay=(0,G.CN)({is:a=>"AlterTableNode"===a.kind,create:a=>(0,G.CN)({kind:"AlterTableNode",table:a}),cloneWithTableProps:(a,b)=>(0,G.CN)({...a,...b}),cloneWithColumnAlteration:(a,b)=>(0,G.CN)({...a,columnAlterations:a.columnAlterations?[...a.columnAlterations,b]:[b]})}),az=(0,G.CN)({is:a=>"CreateIndexNode"===a.kind,create:a=>(0,G.CN)({kind:"CreateIndexNode",name:C.O.create(a)}),cloneWith:(a,b)=>(0,G.CN)({...a,...b}),cloneWithColumns:(a,b)=>(0,G.CN)({...a,columns:[...a.columns||[],...b]})}),aA=(0,G.CN)({is:a=>"CreateSchemaNode"===a.kind,create:(a,b)=>(0,G.CN)({kind:"CreateSchemaNode",schema:C.O.create(a),...b}),cloneWith:(a,b)=>(0,G.CN)({...a,...b})});var aB=c(93092),aC=c(36923);let aD=(0,G.CN)({is:a=>"DropIndexNode"===a.kind,create:(a,b)=>(0,G.CN)({kind:"DropIndexNode",name:aC.y.create(a),...b}),cloneWith:(a,b)=>(0,G.CN)({...a,...b})}),aE=(0,G.CN)({is:a=>"DropSchemaNode"===a.kind,create:(a,b)=>(0,G.CN)({kind:"DropSchemaNode",schema:C.O.create(a),...b}),cloneWith:(a,b)=>(0,G.CN)({...a,...b})}),aF=(0,G.CN)({is:a=>"DropTableNode"===a.kind,create:(a,b)=>(0,G.CN)({kind:"DropTableNode",table:a,...b}),cloneWith:(a,b)=>(0,G.CN)({...a,...b})});var aG=c(19795);let aH=(0,G.CN)({is:a=>"AddColumnNode"===a.kind,create:a=>(0,G.CN)({kind:"AddColumnNode",column:a})});var aI=c(31009);let aJ=(0,G.CN)({is:a=>"ColumnDefinitionNode"===a.kind,create:(a,b)=>(0,G.CN)({kind:"ColumnDefinitionNode",column:aI.Z.create(a),dataType:b}),cloneWithFrontModifier:(a,b)=>(0,G.CN)({...a,frontModifiers:a.frontModifiers?(0,G.CN)([...a.frontModifiers,b]):[b]}),cloneWithEndModifier:(a,b)=>(0,G.CN)({...a,endModifiers:a.endModifiers?(0,G.CN)([...a.endModifiers,b]):[b]}),cloneWith:(a,b)=>(0,G.CN)({...a,...b})}),aK=(0,G.CN)({is:a=>"DropColumnNode"===a.kind,create:a=>(0,G.CN)({kind:"DropColumnNode",column:aI.Z.create(a)})}),aL=(0,G.CN)({is:a=>"RenameColumnNode"===a.kind,create:(a,b)=>(0,G.CN)({kind:"RenameColumnNode",column:aI.Z.create(a),renameTo:aI.Z.create(b)})}),aM=(0,G.CN)({is:a=>"CheckConstraintNode"===a.kind,create:(a,b)=>(0,G.CN)({kind:"CheckConstraintNode",expression:a,name:b?C.O.create(b):void 0})}),aN=["no action","restrict","cascade","set null","set default"],aO=(0,G.CN)({is:a=>"ReferencesNode"===a.kind,create:(a,b)=>(0,G.CN)({kind:"ReferencesNode",table:a,columns:(0,G.CN)([...b])}),cloneWithOnDelete:(a,b)=>(0,G.CN)({...a,onDelete:b}),cloneWithOnUpdate:(a,b)=>(0,G.CN)({...a,onUpdate:b})});var aP=c(9005),aQ=c(2952),aR=c(39450),aS=c(90350);function aT(a){return(0,aR.N)(a)?a.toOperationNode():aS.q.createImmediate(a)}let aU=(0,G.CN)({is:a=>"GeneratedNode"===a.kind,create:a=>(0,G.CN)({kind:"GeneratedNode",...a}),createWithExpression:a=>(0,G.CN)({kind:"GeneratedNode",always:!0,expression:a}),cloneWith:(a,b)=>(0,G.CN)({...a,...b})}),aV=(0,G.CN)({is:a=>"DefaultValueNode"===a.kind,create:a=>(0,G.CN)({kind:"DefaultValueNode",defaultValue:a})});function aW(a){if(aN.includes(a))return a;throw Error(`invalid OnModifyForeignAction ${a}`)}class aX{#D;constructor(a){this.#D=a}autoIncrement(){return new aX(aJ.cloneWith(this.#D,{autoIncrement:!0}))}identity(){return new aX(aJ.cloneWith(this.#D,{identity:!0}))}primaryKey(){return new aX(aJ.cloneWith(this.#D,{primaryKey:!0}))}references(a){let b=(0,aQ.q5)(a);if(!b.table||aP.U.is(b.column))throw Error(`invalid call references('${a}'). The reference must have format table.column or schema.table.column`);return new aX(aJ.cloneWith(this.#D,{references:aO.create(b.table,[b.column])}))}onDelete(a){if(!this.#D.references)throw Error("on delete constraint can only be added for foreign keys");return new aX(aJ.cloneWith(this.#D,{references:aO.cloneWithOnDelete(this.#D.references,aW(a))}))}onUpdate(a){if(!this.#D.references)throw Error("on update constraint can only be added for foreign keys");return new aX(aJ.cloneWith(this.#D,{references:aO.cloneWithOnUpdate(this.#D.references,aW(a))}))}unique(){return new aX(aJ.cloneWith(this.#D,{unique:!0}))}notNull(){return new aX(aJ.cloneWith(this.#D,{notNull:!0}))}unsigned(){return new aX(aJ.cloneWith(this.#D,{unsigned:!0}))}defaultTo(a){return new aX(aJ.cloneWith(this.#D,{defaultTo:aV.create(aT(a))}))}check(a){return new aX(aJ.cloneWith(this.#D,{check:aM.create(a.toOperationNode())}))}generatedAlwaysAs(a){return new aX(aJ.cloneWith(this.#D,{generated:aU.createWithExpression(a.toOperationNode())}))}generatedAlwaysAsIdentity(){return new aX(aJ.cloneWith(this.#D,{generated:aU.create({identity:!0,always:!0})}))}generatedByDefaultAsIdentity(){return new aX(aJ.cloneWith(this.#D,{generated:aU.create({identity:!0,byDefault:!0})}))}stored(){if(!this.#D.generated)throw Error("stored() can only be called after generatedAlwaysAs");return new aX(aJ.cloneWith(this.#D,{generated:aU.cloneWith(this.#D.generated,{stored:!0})}))}modifyFront(a){return new aX(aJ.cloneWithFrontModifier(this.#D,a.toOperationNode()))}nullsNotDistinct(){return new aX(aJ.cloneWith(this.#D,{nullsNotDistinct:!0}))}ifNotExists(){return new aX(aJ.cloneWith(this.#D,{ifNotExists:!0}))}modifyEnd(a){return new aX(aJ.cloneWithEndModifier(this.#D,a.toOperationNode()))}$call(a){return a(this)}toOperationNode(){return this.#D}}let aY=(0,G.CN)({is:a=>"ModifyColumnNode"===a.kind,create:a=>(0,G.CN)({kind:"ModifyColumnNode",column:a})});var aZ=c(43926);let a$=(0,G.CN)({is:a=>"ForeignKeyConstraintNode"===a.kind,create:(a,b,c,d)=>(0,G.CN)({kind:"ForeignKeyConstraintNode",columns:a,references:aO.create(b,c),name:d?C.O.create(d):void 0}),cloneWith:(a,b)=>(0,G.CN)({...a,...b})});class a_{#D;constructor(a){this.#D=a}onDelete(a){return new a_(a$.cloneWith(this.#D,{onDelete:aW(a)}))}onUpdate(a){return new a_(a$.cloneWith(this.#D,{onUpdate:aW(a)}))}deferrable(){return new a_(a$.cloneWith(this.#D,{deferrable:!0}))}notDeferrable(){return new a_(a$.cloneWith(this.#D,{deferrable:!1}))}initiallyDeferred(){return new a_(a$.cloneWith(this.#D,{initiallyDeferred:!0}))}initiallyImmediate(){return new a_(a$.cloneWith(this.#D,{initiallyDeferred:!1}))}$call(a){return a(this)}toOperationNode(){return this.#D}}let a0=(0,G.CN)({is:a=>"AddConstraintNode"===a.kind,create:a=>(0,G.CN)({kind:"AddConstraintNode",constraint:a})}),a1=(0,G.CN)({is:a=>"UniqueConstraintNode"===a.kind,create:(a,b,c)=>(0,G.CN)({kind:"UniqueConstraintNode",columns:(0,G.CN)(a.map(aI.Z.create)),name:b?C.O.create(b):void 0,nullsNotDistinct:c}),cloneWith:(a,b)=>(0,G.CN)({...a,...b})}),a2=(0,G.CN)({is:a=>"DropConstraintNode"===a.kind,create:a=>(0,G.CN)({kind:"DropConstraintNode",constraintName:C.O.create(a)}),cloneWith:(a,b)=>(0,G.CN)({...a,...b})}),a3=(0,G.CN)({is:a=>"AlterColumnNode"===a.kind,create:(a,b,c)=>(0,G.CN)({kind:"AlterColumnNode",column:aI.Z.create(a),[b]:c})});class a4{#E;constructor(a){this.#E=a}setDataType(a){return new a5(a3.create(this.#E,"dataType",(0,aZ.Q)(a)))}setDefault(a){return new a5(a3.create(this.#E,"setDefault",aT(a)))}dropDefault(){return new a5(a3.create(this.#E,"dropDefault",!0))}setNotNull(){return new a5(a3.create(this.#E,"setNotNull",!0))}dropNotNull(){return new a5(a3.create(this.#E,"dropNotNull",!0))}$call(a){return a(this)}}class a5{#F;constructor(a){this.#F=a}toOperationNode(){return this.#F}}class a6{#G;constructor(a){this.#G=(0,G.CN)(a)}toOperationNode(){return this.#G.executor.transformQuery(this.#G.node,this.#G.queryId)}compile(){return this.#G.executor.compileQuery(this.toOperationNode(),this.#G.queryId)}async execute(){await this.#G.executor.executeQuery(this.compile())}}class a7{#G;constructor(a){this.#G=(0,G.CN)(a)}onDelete(a){return new a7({...this.#G,constraintBuilder:this.#G.constraintBuilder.onDelete(a)})}onUpdate(a){return new a7({...this.#G,constraintBuilder:this.#G.constraintBuilder.onUpdate(a)})}deferrable(){return new a7({...this.#G,constraintBuilder:this.#G.constraintBuilder.deferrable()})}notDeferrable(){return new a7({...this.#G,constraintBuilder:this.#G.constraintBuilder.notDeferrable()})}initiallyDeferred(){return new a7({...this.#G,constraintBuilder:this.#G.constraintBuilder.initiallyDeferred()})}initiallyImmediate(){return new a7({...this.#G,constraintBuilder:this.#G.constraintBuilder.initiallyImmediate()})}$call(a){return a(this)}toOperationNode(){return this.#G.executor.transformQuery(ay.cloneWithTableProps(this.#G.node,{addConstraint:a0.create(this.#G.constraintBuilder.toOperationNode())}),this.#G.queryId)}compile(){return this.#G.executor.compileQuery(this.toOperationNode(),this.#G.queryId)}async execute(){await this.#G.executor.executeQuery(this.compile())}}class a8{#G;constructor(a){this.#G=(0,G.CN)(a)}ifExists(){return new a8({...this.#G,node:ay.cloneWithTableProps(this.#G.node,{dropConstraint:a2.cloneWith(this.#G.node.dropConstraint,{ifExists:!0})})})}cascade(){return new a8({...this.#G,node:ay.cloneWithTableProps(this.#G.node,{dropConstraint:a2.cloneWith(this.#G.node.dropConstraint,{modifier:"cascade"})})})}restrict(){return new a8({...this.#G,node:ay.cloneWithTableProps(this.#G.node,{dropConstraint:a2.cloneWith(this.#G.node.dropConstraint,{modifier:"restrict"})})})}$call(a){return a(this)}toOperationNode(){return this.#G.executor.transformQuery(this.#G.node,this.#G.queryId)}compile(){return this.#G.executor.compileQuery(this.toOperationNode(),this.#G.queryId)}async execute(){await this.#G.executor.executeQuery(this.compile())}}let a9=(0,G.CN)({is:a=>"PrimaryKeyConstraintNode"===a.kind,create:(a,b)=>(0,G.CN)({kind:"PrimaryKeyConstraintNode",columns:(0,G.CN)(a.map(aI.Z.create)),name:b?C.O.create(b):void 0}),cloneWith:(a,b)=>(0,G.CN)({...a,...b})}),ba=(0,G.CN)({is:a=>"AddIndexNode"===a.kind,create:a=>(0,G.CN)({kind:"AddIndexNode",name:C.O.create(a)}),cloneWith:(a,b)=>(0,G.CN)({...a,...b}),cloneWithColumns:(a,b)=>(0,G.CN)({...a,columns:[...a.columns||[],...b]})});class bb{#G;constructor(a){this.#G=(0,G.CN)(a)}unique(){return new bb({...this.#G,node:ay.cloneWithTableProps(this.#G.node,{addIndex:ba.cloneWith(this.#G.node.addIndex,{unique:!0})})})}column(a){return new bb({...this.#G,node:ay.cloneWithTableProps(this.#G.node,{addIndex:ba.cloneWithColumns(this.#G.node.addIndex,[(0,aQ.Ow)(a)])})})}columns(a){return new bb({...this.#G,node:ay.cloneWithTableProps(this.#G.node,{addIndex:ba.cloneWithColumns(this.#G.node.addIndex,a.map(aQ.Ow))})})}expression(a){return new bb({...this.#G,node:ay.cloneWithTableProps(this.#G.node,{addIndex:ba.cloneWithColumns(this.#G.node.addIndex,[a.toOperationNode()])})})}using(a){return new bb({...this.#G,node:ay.cloneWithTableProps(this.#G.node,{addIndex:ba.cloneWith(this.#G.node.addIndex,{using:D.z.createWithSql(a)})})})}$call(a){return a(this)}toOperationNode(){return this.#G.executor.transformQuery(this.#G.node,this.#G.queryId)}compile(){return this.#G.executor.compileQuery(this.toOperationNode(),this.#G.queryId)}async execute(){await this.#G.executor.executeQuery(this.compile())}}class bc{#D;constructor(a){this.#D=a}nullsNotDistinct(){return new bc(a1.cloneWith(this.#D,{nullsNotDistinct:!0}))}deferrable(){return new bc(a1.cloneWith(this.#D,{deferrable:!0}))}notDeferrable(){return new bc(a1.cloneWith(this.#D,{deferrable:!1}))}initiallyDeferred(){return new bc(a1.cloneWith(this.#D,{initiallyDeferred:!0}))}initiallyImmediate(){return new bc(a1.cloneWith(this.#D,{initiallyDeferred:!1}))}$call(a){return a(this)}toOperationNode(){return this.#D}}class bd{#D;constructor(a){this.#D=a}deferrable(){return new bd(a9.cloneWith(this.#D,{deferrable:!0}))}notDeferrable(){return new bd(a9.cloneWith(this.#D,{deferrable:!1}))}initiallyDeferred(){return new bd(a9.cloneWith(this.#D,{initiallyDeferred:!0}))}initiallyImmediate(){return new bd(a9.cloneWith(this.#D,{initiallyDeferred:!1}))}$call(a){return a(this)}toOperationNode(){return this.#D}}class be{#D;constructor(a){this.#D=a}$call(a){return a(this)}toOperationNode(){return this.#D}}let bf=(0,G.CN)({is:a=>"RenameConstraintNode"===a.kind,create:(a,b)=>(0,G.CN)({kind:"RenameConstraintNode",oldName:C.O.create(a),newName:C.O.create(b)})});class bg{#G;constructor(a){this.#G=(0,G.CN)(a)}renameTo(a){return new a6({...this.#G,node:ay.cloneWithTableProps(this.#G.node,{renameTo:(0,aG.M$)(a)})})}setSchema(a){return new a6({...this.#G,node:ay.cloneWithTableProps(this.#G.node,{setSchema:C.O.create(a)})})}alterColumn(a,b){let c=b(new a4(a));return new bh({...this.#G,node:ay.cloneWithColumnAlteration(this.#G.node,c.toOperationNode())})}dropColumn(a){return new bh({...this.#G,node:ay.cloneWithColumnAlteration(this.#G.node,aK.create(a))})}renameColumn(a,b){return new bh({...this.#G,node:ay.cloneWithColumnAlteration(this.#G.node,aL.create(a,b))})}addColumn(a,b,c=G.lQ){let d=c(new aX(aJ.create(a,(0,aZ.Q)(b))));return new bh({...this.#G,node:ay.cloneWithColumnAlteration(this.#G.node,aH.create(d.toOperationNode()))})}modifyColumn(a,b,c=G.lQ){let d=c(new aX(aJ.create(a,(0,aZ.Q)(b))));return new bh({...this.#G,node:ay.cloneWithColumnAlteration(this.#G.node,aY.create(d.toOperationNode()))})}addUniqueConstraint(a,b,c=G.lQ){let d=c(new bc(a1.create(b,a)));return new a6({...this.#G,node:ay.cloneWithTableProps(this.#G.node,{addConstraint:a0.create(d.toOperationNode())})})}addCheckConstraint(a,b,c=G.lQ){let d=c(new be(aM.create(b.toOperationNode(),a)));return new a6({...this.#G,node:ay.cloneWithTableProps(this.#G.node,{addConstraint:a0.create(d.toOperationNode())})})}addForeignKeyConstraint(a,b,c,d,e=G.lQ){let f=e(new a_(a$.create(b.map(aI.Z.create),(0,aG.M$)(c),d.map(aI.Z.create),a)));return new a7({...this.#G,constraintBuilder:f})}addPrimaryKeyConstraint(a,b,c=G.lQ){let d=c(new bd(a9.create(b,a)));return new a6({...this.#G,node:ay.cloneWithTableProps(this.#G.node,{addConstraint:a0.create(d.toOperationNode())})})}dropConstraint(a){return new a8({...this.#G,node:ay.cloneWithTableProps(this.#G.node,{dropConstraint:a2.create(a)})})}renameConstraint(a,b){return new a8({...this.#G,node:ay.cloneWithTableProps(this.#G.node,{renameConstraint:bf.create(a,b)})})}addIndex(a){return new bb({...this.#G,node:ay.cloneWithTableProps(this.#G.node,{addIndex:ba.create(a)})})}dropIndex(a){return new a6({...this.#G,node:ay.cloneWithTableProps(this.#G.node,{dropIndex:aD.create(a)})})}$call(a){return a(this)}}class bh{#G;constructor(a){this.#G=(0,G.CN)(a)}alterColumn(a,b){let c=b(new a4(a));return new bh({...this.#G,node:ay.cloneWithColumnAlteration(this.#G.node,c.toOperationNode())})}dropColumn(a){return new bh({...this.#G,node:ay.cloneWithColumnAlteration(this.#G.node,aK.create(a))})}renameColumn(a,b){return new bh({...this.#G,node:ay.cloneWithColumnAlteration(this.#G.node,aL.create(a,b))})}addColumn(a,b,c=G.lQ){let d=c(new aX(aJ.create(a,(0,aZ.Q)(b))));return new bh({...this.#G,node:ay.cloneWithColumnAlteration(this.#G.node,aH.create(d.toOperationNode()))})}modifyColumn(a,b,c=G.lQ){let d=c(new aX(aJ.create(a,(0,aZ.Q)(b))));return new bh({...this.#G,node:ay.cloneWithColumnAlteration(this.#G.node,aY.create(d.toOperationNode()))})}toOperationNode(){return this.#G.executor.transformQuery(this.#G.node,this.#G.queryId)}compile(){return this.#G.executor.compileQuery(this.toOperationNode(),this.#G.queryId)}async execute(){await this.#G.executor.executeQuery(this.compile())}}var bi=c(53284),bj=c(4315),bk=c(42437),bl=c(93159);class bm extends bk.V{transformPrimitiveValueList(a){return bl.s.create(a.values.map(aS.q.createImmediate))}transformValue(a){return aS.q.createImmediate(a.value)}}class bn{#G;constructor(a){this.#G=(0,G.CN)(a)}ifNotExists(){return new bn({...this.#G,node:az.cloneWith(this.#G.node,{ifNotExists:!0})})}unique(){return new bn({...this.#G,node:az.cloneWith(this.#G.node,{unique:!0})})}nullsNotDistinct(){return new bn({...this.#G,node:az.cloneWith(this.#G.node,{nullsNotDistinct:!0})})}on(a){return new bn({...this.#G,node:az.cloneWith(this.#G.node,{table:(0,aG.M$)(a)})})}column(a){return new bn({...this.#G,node:az.cloneWithColumns(this.#G.node,[(0,aQ.Ow)(a)])})}columns(a){return new bn({...this.#G,node:az.cloneWithColumns(this.#G.node,a.map(aQ.Ow))})}expression(a){return new bn({...this.#G,node:az.cloneWithColumns(this.#G.node,[a.toOperationNode()])})}using(a){return new bn({...this.#G,node:az.cloneWith(this.#G.node,{using:D.z.createWithSql(a)})})}where(...a){let b=new bm;return new bn({...this.#G,node:bj.L.cloneWithWhere(this.#G.node,b.transformNode((0,bi.GB)(a),this.#G.queryId))})}$call(a){return a(this)}toOperationNode(){return this.#G.executor.transformQuery(this.#G.node,this.#G.queryId)}compile(){return this.#G.executor.compileQuery(this.toOperationNode(),this.#G.queryId)}async execute(){await this.#G.executor.executeQuery(this.compile())}}class bo{#G;constructor(a){this.#G=(0,G.CN)(a)}ifNotExists(){return new bo({...this.#G,node:aA.cloneWith(this.#G.node,{ifNotExists:!0})})}$call(a){return a(this)}toOperationNode(){return this.#G.executor.transformQuery(this.#G.node,this.#G.queryId)}compile(){return this.#G.executor.compileQuery(this.toOperationNode(),this.#G.queryId)}async execute(){await this.#G.executor.executeQuery(this.compile())}}var bp=c(57105);class bq{#G;constructor(a){this.#G=(0,G.CN)(a)}temporary(){return new bq({...this.#G,node:aB.B.cloneWith(this.#G.node,{temporary:!0})})}onCommit(a){return new bq({...this.#G,node:aB.B.cloneWith(this.#G.node,{onCommit:function(a){if(aB.o.includes(a))return a;throw Error(`invalid OnCommitAction ${a}`)}(a)})})}ifNotExists(){return new bq({...this.#G,node:aB.B.cloneWith(this.#G.node,{ifNotExists:!0})})}addColumn(a,b,c=G.lQ){let d=c(new aX(aJ.create(a,(0,aZ.Q)(b))));return new bq({...this.#G,node:aB.B.cloneWithColumn(this.#G.node,d.toOperationNode())})}addPrimaryKeyConstraint(a,b,c=G.lQ){let d=c(new bd(a9.create(b,a)));return new bq({...this.#G,node:aB.B.cloneWithConstraint(this.#G.node,d.toOperationNode())})}addUniqueConstraint(a,b,c=G.lQ){let d=c(new bc(a1.create(b,a)));return new bq({...this.#G,node:aB.B.cloneWithConstraint(this.#G.node,d.toOperationNode())})}addCheckConstraint(a,b,c=G.lQ){let d=c(new be(aM.create(b.toOperationNode(),a)));return new bq({...this.#G,node:aB.B.cloneWithConstraint(this.#G.node,d.toOperationNode())})}addForeignKeyConstraint(a,b,c,d,e=G.lQ){let f=e(new a_(a$.create(b.map(aI.Z.create),(0,aG.M$)(c),d.map(aI.Z.create),a)));return new bq({...this.#G,node:aB.B.cloneWithConstraint(this.#G.node,f.toOperationNode())})}modifyFront(a){return new bq({...this.#G,node:aB.B.cloneWithFrontModifier(this.#G.node,a.toOperationNode())})}modifyEnd(a){return new bq({...this.#G,node:aB.B.cloneWithEndModifier(this.#G.node,a.toOperationNode())})}as(a){return new bq({...this.#G,node:aB.B.cloneWith(this.#G.node,{selectQuery:(0,bp.YK)(a)})})}$call(a){return a(this)}toOperationNode(){return this.#G.executor.transformQuery(this.#G.node,this.#G.queryId)}compile(){return this.#G.executor.compileQuery(this.toOperationNode(),this.#G.queryId)}async execute(){await this.#G.executor.executeQuery(this.compile())}}class br{#G;constructor(a){this.#G=(0,G.CN)(a)}on(a){return new br({...this.#G,node:aD.cloneWith(this.#G.node,{table:(0,aG.M$)(a)})})}ifExists(){return new br({...this.#G,node:aD.cloneWith(this.#G.node,{ifExists:!0})})}cascade(){return new br({...this.#G,node:aD.cloneWith(this.#G.node,{cascade:!0})})}$call(a){return a(this)}toOperationNode(){return this.#G.executor.transformQuery(this.#G.node,this.#G.queryId)}compile(){return this.#G.executor.compileQuery(this.toOperationNode(),this.#G.queryId)}async execute(){await this.#G.executor.executeQuery(this.compile())}}class bs{#G;constructor(a){this.#G=(0,G.CN)(a)}ifExists(){return new bs({...this.#G,node:aE.cloneWith(this.#G.node,{ifExists:!0})})}cascade(){return new bs({...this.#G,node:aE.cloneWith(this.#G.node,{cascade:!0})})}$call(a){return a(this)}toOperationNode(){return this.#G.executor.transformQuery(this.#G.node,this.#G.queryId)}compile(){return this.#G.executor.compileQuery(this.toOperationNode(),this.#G.queryId)}async execute(){await this.#G.executor.executeQuery(this.compile())}}class bt{#G;constructor(a){this.#G=(0,G.CN)(a)}ifExists(){return new bt({...this.#G,node:aF.cloneWith(this.#G.node,{ifExists:!0})})}cascade(){return new bt({...this.#G,node:aF.cloneWith(this.#G.node,{cascade:!0})})}$call(a){return a(this)}toOperationNode(){return this.#G.executor.transformQuery(this.#G.node,this.#G.queryId)}compile(){return this.#G.executor.compileQuery(this.toOperationNode(),this.#G.queryId)}async execute(){await this.#G.executor.executeQuery(this.compile())}}var bu=c(19151),bv=c(88487);class bw{#H=new bm;transformQuery(a){return this.#H.transformNode(a.node,a.queryId)}transformResult(a){return Promise.resolve(a.result)}}class bx{#G;constructor(a){this.#G=(0,G.CN)(a)}temporary(){return new bx({...this.#G,node:bv.Y.cloneWith(this.#G.node,{temporary:!0})})}materialized(){return new bx({...this.#G,node:bv.Y.cloneWith(this.#G.node,{materialized:!0})})}ifNotExists(){return new bx({...this.#G,node:bv.Y.cloneWith(this.#G.node,{ifNotExists:!0})})}orReplace(){return new bx({...this.#G,node:bv.Y.cloneWith(this.#G.node,{orReplace:!0})})}columns(a){return new bx({...this.#G,node:bv.Y.cloneWith(this.#G.node,{columns:a.map(aQ.RY)})})}as(a){let b=a.withPlugin(new bw).toOperationNode();return new bx({...this.#G,node:bv.Y.cloneWith(this.#G.node,{as:b})})}$call(a){return a(this)}toOperationNode(){return this.#G.executor.transformQuery(this.#G.node,this.#G.queryId)}compile(){return this.#G.executor.compileQuery(this.toOperationNode(),this.#G.queryId)}async execute(){await this.#G.executor.executeQuery(this.compile())}}let by=(0,G.CN)({is:a=>"DropViewNode"===a.kind,create:a=>(0,G.CN)({kind:"DropViewNode",name:aC.y.create(a)}),cloneWith:(a,b)=>(0,G.CN)({...a,...b})});class bz{#G;constructor(a){this.#G=(0,G.CN)(a)}materialized(){return new bz({...this.#G,node:by.cloneWith(this.#G.node,{materialized:!0})})}ifExists(){return new bz({...this.#G,node:by.cloneWith(this.#G.node,{ifExists:!0})})}cascade(){return new bz({...this.#G,node:by.cloneWith(this.#G.node,{cascade:!0})})}$call(a){return a(this)}toOperationNode(){return this.#G.executor.transformQuery(this.#G.node,this.#G.queryId)}compile(){return this.#G.executor.compileQuery(this.toOperationNode(),this.#G.queryId)}async execute(){await this.#G.executor.executeQuery(this.compile())}}let bA=(0,G.CN)({is:a=>"CreateTypeNode"===a.kind,create:a=>(0,G.CN)({kind:"CreateTypeNode",name:a}),cloneWithEnum:(a,b)=>(0,G.CN)({...a,enum:bl.s.create(b.map(aS.q.createImmediate))})});class bB{#G;constructor(a){this.#G=(0,G.CN)(a)}toOperationNode(){return this.#G.executor.transformQuery(this.#G.node,this.#G.queryId)}asEnum(a){return new bB({...this.#G,node:bA.cloneWithEnum(this.#G.node,a)})}$call(a){return a(this)}compile(){return this.#G.executor.compileQuery(this.toOperationNode(),this.#G.queryId)}async execute(){await this.#G.executor.executeQuery(this.compile())}}let bC=(0,G.CN)({is:a=>"DropTypeNode"===a.kind,create:a=>(0,G.CN)({kind:"DropTypeNode",name:a}),cloneWith:(a,b)=>(0,G.CN)({...a,...b})});class bD{#G;constructor(a){this.#G=(0,G.CN)(a)}ifExists(){return new bD({...this.#G,node:bC.cloneWith(this.#G.node,{ifExists:!0})})}$call(a){return a(this)}toOperationNode(){return this.#G.executor.transformQuery(this.#G.node,this.#G.queryId)}compile(){return this.#G.executor.compileQuery(this.toOperationNode(),this.#G.queryId)}async execute(){await this.#G.executor.executeQuery(this.compile())}}function bE(a){if(!a.includes("."))return aC.y.create(a);{let b=a.split(".").map(bF);if(2===b.length)return aC.y.createWithSchema(b[0],b[1]);throw Error(`invalid schemable identifier ${a}`)}}function bF(a){return a.trim()}let bG=(0,G.CN)({is:a=>"RefreshMaterializedViewNode"===a.kind,create:a=>(0,G.CN)({kind:"RefreshMaterializedViewNode",name:aC.y.create(a)}),cloneWith:(a,b)=>(0,G.CN)({...a,...b})});class bH{#G;constructor(a){this.#G=(0,G.CN)(a)}concurrently(){return new bH({...this.#G,node:bG.cloneWith(this.#G.node,{concurrently:!0,withNoData:!1})})}withData(){return new bH({...this.#G,node:bG.cloneWith(this.#G.node,{withNoData:!1})})}withNoData(){return new bH({...this.#G,node:bG.cloneWith(this.#G.node,{withNoData:!0,concurrently:!1})})}$call(a){return a(this)}toOperationNode(){return this.#G.executor.transformQuery(this.#G.node,this.#G.queryId)}compile(){return this.#G.executor.compileQuery(this.toOperationNode(),this.#G.queryId)}async execute(){await this.#G.executor.executeQuery(this.compile())}}class bI{#I;constructor(a){this.#I=a}createTable(a){return new bq({queryId:(0,H.a)(),executor:this.#I,node:aB.B.create((0,aG.M$)(a))})}dropTable(a){return new bt({queryId:(0,H.a)(),executor:this.#I,node:aF.create((0,aG.M$)(a))})}createIndex(a){return new bn({queryId:(0,H.a)(),executor:this.#I,node:az.create(a)})}dropIndex(a){return new br({queryId:(0,H.a)(),executor:this.#I,node:aD.create(a)})}createSchema(a){return new bo({queryId:(0,H.a)(),executor:this.#I,node:aA.create(a)})}dropSchema(a){return new bs({queryId:(0,H.a)(),executor:this.#I,node:aE.create(a)})}alterTable(a){return new bg({queryId:(0,H.a)(),executor:this.#I,node:ay.create((0,aG.M$)(a))})}createView(a){return new bx({queryId:(0,H.a)(),executor:this.#I,node:bv.Y.create(a)})}refreshMaterializedView(a){return new bH({queryId:(0,H.a)(),executor:this.#I,node:bG.create(a)})}dropView(a){return new bz({queryId:(0,H.a)(),executor:this.#I,node:by.create(a)})}createType(a){return new bB({queryId:(0,H.a)(),executor:this.#I,node:bA.create(bE(a))})}dropType(a){return new bD({queryId:(0,H.a)(),executor:this.#I,node:bC.create(bE(a))})}withPlugin(a){return new bI(this.#I.withPlugin(a))}withoutPlugins(){return new bI(this.#I.withoutPlugins())}withSchema(a){return new bI(this.#I.withPluginAtFront(new bu.B(a)))}}var bJ=c(27646),bK=c(20527);class bL{ref(a){return new bJ.g(a)}table(a){return new bK.bj(a)}}class bM{#J;constructor(a){this.#J=a}async provideConnection(a){let b=await this.#J.acquireConnection();try{return await a(b)}finally{await this.#J.releaseConnection(b)}}}var bN=c(65966),bO=c(12034);class bP extends bO.R{#K;#L;#M;constructor(a,b,c,d=[]){super(d),this.#K=a,this.#L=b,this.#M=c}get adapter(){return this.#L}compileQuery(a,b){return this.#K.compileQuery(a,b)}provideConnection(a){return this.#M.provideConnection(a)}withPlugins(a){return new bP(this.#K,this.#L,this.#M,[...this.plugins,...a])}withPlugin(a){return new bP(this.#K,this.#L,this.#M,[...this.plugins,a])}withPluginAtFront(a){return new bP(this.#K,this.#L,this.#M,[a,...this.plugins])}withConnectionProvider(a){return new bP(this.#K,this.#L,a,[...this.plugins])}withoutPlugins(){return new bP(this.#K,this.#L,this.#M,[])}}function bQ(){return"undefined"!=typeof performance&&(0,G.Tn)(performance.now)?performance.now():Date.now()}class bR{#J;#N;#O;#P;#Q;#i=new WeakSet;constructor(a,b){this.#P=!1,this.#J=a,this.#N=b}async init(){if(this.#Q)throw Error("driver has already been destroyed");this.#O||(this.#O=this.#J.init().then(()=>{this.#P=!0}).catch(a=>(this.#O=void 0,Promise.reject(a)))),await this.#O}async acquireConnection(){if(this.#Q)throw Error("driver has already been destroyed");this.#P||await this.init();let a=await this.#J.acquireConnection();return this.#i.has(a)||(this.#R()&&this.#S(a),this.#i.add(a)),a}async releaseConnection(a){await this.#J.releaseConnection(a)}beginTransaction(a,b){return this.#J.beginTransaction(a,b)}commitTransaction(a){return this.#J.commitTransaction(a)}rollbackTransaction(a){return this.#J.rollbackTransaction(a)}savepoint(a,b,c){if(this.#J.savepoint)return this.#J.savepoint(a,b,c);throw Error("The `savepoint` method is not supported by this driver")}rollbackToSavepoint(a,b,c){if(this.#J.rollbackToSavepoint)return this.#J.rollbackToSavepoint(a,b,c);throw Error("The `rollbackToSavepoint` method is not supported by this driver")}releaseSavepoint(a,b,c){if(this.#J.releaseSavepoint)return this.#J.releaseSavepoint(a,b,c);throw Error("The `releaseSavepoint` method is not supported by this driver")}async destroy(){this.#O&&(await this.#O,this.#Q||(this.#Q=this.#J.destroy().catch(a=>(this.#Q=void 0,Promise.reject(a)))),await this.#Q)}#R(){return this.#N.isLevelEnabled("query")||this.#N.isLevelEnabled("error")}#S(a){let b=a.executeQuery,c=a.streamQuery,d=this;a.executeQuery=async c=>{let e,f=bQ();try{return await b.call(a,c)}catch(a){throw e=a,await d.#T(a,c,f),a}finally{e||await d.#U(c,f)}},a.streamQuery=async function*(b,e){let f,g=bQ();try{for await(let d of c.call(a,b,e))yield d}catch(a){throw f=a,await d.#T(a,b,g),a}finally{f||await d.#U(b,g,!0)}}}async #T(a,b,c){await this.#N.error(()=>({level:"error",error:a,query:b,queryDurationMillis:this.#V(c)}))}async #U(a,b,c=!1){await this.#N.query(()=>({level:"query",isStream:c,query:a,queryDurationMillis:this.#V(b)}))}#V(a){return bQ()-a}}let bS=()=>{};class bT{#d;#W;constructor(a){this.#d=a}async provideConnection(a){for(;this.#W;)await this.#W.catch(bS);return this.#W=this.#X(a).finally(()=>{this.#W=void 0}),this.#W}async #X(a){return await a(this.#d)}}let bU=["read only","read write"],bV=["read uncommitted","read committed","repeatable read","serializable","snapshot"];function bW(a){if(a.accessMode&&!bU.includes(a.accessMode))throw Error(`invalid transaction access mode ${a.accessMode}`);if(a.isolationLevel&&!bV.includes(a.isolationLevel))throw Error(`invalid transaction isolation level ${a.isolationLevel}`)}var bX=c(71644);(0,G.CN)(["query","error"]);class bY{#Y;#Z;constructor(a){(0,G.Tn)(a)?(this.#Z=a,this.#Y=(0,G.CN)({query:!0,error:!0})):(this.#Z=bZ,this.#Y=(0,G.CN)({query:a.includes("query"),error:a.includes("error")}))}isLevelEnabled(a){return this.#Y[a]}async query(a){this.#Y.query&&await this.#Z(a())}async error(a){this.#Y.error&&await this.#Z(a())}}function bZ(a){if("query"===a.level){let b=`kysely:query:${a.isStream?"stream:":""}`;console.log(`${b} ${a.query.sql}`),console.log(`${b} duration: ${a.queryDurationMillis.toFixed(1)}ms`)}else"error"===a.level&&(a.error instanceof Error?console.error(`kysely:error: ${a.error.stack??a.error.message}`):console.error(`kysely:error: ${JSON.stringify({error:a.error,query:a.query.sql,queryDurationMillis:a.queryDurationMillis})}`))}var b$=c(61238),b_=c(69079),b0=c(48137),b1=c(80234);Symbol.asyncDispose??=Symbol("Symbol.asyncDispose");class b2 extends bN.n{#G;constructor(a){let b,c;if(function(a){return(0,G.Gv)(a)&&(0,G.Gv)(a.config)&&(0,G.Gv)(a.driver)&&(0,G.Gv)(a.executor)&&(0,G.Gv)(a.dialect)}(a))b={executor:a.executor},c={...a};else{let d=a.dialect,e=d.createDriver(),f=d.createQueryCompiler(),g=d.createAdapter(),h=new bR(e,new bY(a.log??[])),i=new bP(f,g,new bM(h),a.plugins??[]);b={executor:i},c={config:a,executor:i,dialect:d,driver:h}}super(b),this.#G=(0,G.CN)(c)}get schema(){return new bI(this.#G.executor)}get dynamic(){return new bL}get introspection(){return this.#G.dialect.createIntrospector(this.withoutPlugins())}case(a){return new b$.OU({node:b_.P.create((0,G.b0)(a)?void 0:(0,bp.YK)(a))})}get fn(){return(0,bX.t)()}transaction(){return new b5({...this.#G})}startTransaction(){return new b6({...this.#G})}connection(){return new b4({...this.#G})}withPlugin(a){return new b2({...this.#G,executor:this.#G.executor.withPlugin(a)})}withoutPlugins(){return new b2({...this.#G,executor:this.#G.executor.withoutPlugins()})}withSchema(a){return new b2({...this.#G,executor:this.#G.executor.withPluginAtFront(new bu.B(a))})}withTables(){return new b2({...this.#G})}async destroy(){await this.#G.driver.destroy()}get isTransaction(){return!1}getExecutor(){return this.#G.executor}executeQuery(a,b){void 0!==b&&(0,b1.u)("Passing `queryId` in `db.executeQuery` is deprecated and will result in a compile-time error in the future.");let c=(0,G.Gv)(a)&&(0,G.Tn)(a.compile)?a.compile():a;return this.getExecutor().executeQuery(c)}async [Symbol.asyncDispose](){await this.destroy()}}class b3 extends b2{#G;constructor(a){super(a),this.#G=a}get isTransaction(){return!0}transaction(){throw Error("calling the transaction method for a Transaction is not supported")}connection(){throw Error("calling the connection method for a Transaction is not supported")}async destroy(){throw Error("calling the destroy method for a Transaction is not supported")}withPlugin(a){return new b3({...this.#G,executor:this.#G.executor.withPlugin(a)})}withoutPlugins(){return new b3({...this.#G,executor:this.#G.executor.withoutPlugins()})}withSchema(a){return new b3({...this.#G,executor:this.#G.executor.withPluginAtFront(new bu.B(a))})}withTables(){return new b3({...this.#G})}}class b4{#G;constructor(a){this.#G=(0,G.CN)(a)}async execute(a){return this.#G.executor.provideConnection(async b=>{let c=this.#G.executor.withConnectionProvider(new bT(b)),d=new b2({...this.#G,executor:c});return await a(d)})}}class b5{#G;constructor(a){this.#G=(0,G.CN)(a)}setAccessMode(a){return new b5({...this.#G,accessMode:a})}setIsolationLevel(a){return new b5({...this.#G,isolationLevel:a})}async execute(a){let{isolationLevel:b,accessMode:c,...d}=this.#G,e={isolationLevel:b,accessMode:c};return bW(e),this.#G.executor.provideConnection(async b=>{let c=this.#G.executor.withConnectionProvider(new bT(b)),f=new b3({...d,executor:c}),g=!1;try{await this.#G.driver.beginTransaction(b,e),g=!0;let c=await a(f);return await this.#G.driver.commitTransaction(b),c}catch(a){throw g&&await this.#G.driver.rollbackTransaction(b),a}})}}class b6{#G;constructor(a){this.#G=(0,G.CN)(a)}setAccessMode(a){return new b6({...this.#G,accessMode:a})}setIsolationLevel(a){return new b6({...this.#G,isolationLevel:a})}async execute(){let{isolationLevel:a,accessMode:b,...c}=this.#G,d={isolationLevel:a,accessMode:b};bW(d);let e=await (0,b0.G)(this.#G.executor);return await this.#G.driver.beginTransaction(e.connection,d),new b7({...c,connection:e,executor:this.#G.executor.withConnectionProvider(new bT(e.connection))})}}class b7 extends b3{#G;#$;#_;constructor(a){let b={isCommitted:!1,isRolledBack:!1},{connection:c,...d}=a={...a,executor:new ca(a.executor,b)};super(d),this.#G=(0,G.CN)(a),this.#_=b;let e=(0,H.a)();this.#$=b=>a.executor.compileQuery(b,e)}get isCommitted(){return this.#_.isCommitted}get isRolledBack(){return this.#_.isRolledBack}commit(){return b9(this.#_),new b8(async()=>{await this.#G.driver.commitTransaction(this.#G.connection.connection),this.#_.isCommitted=!0,this.#G.connection.release()})}rollback(){return b9(this.#_),new b8(async()=>{await this.#G.driver.rollbackTransaction(this.#G.connection.connection),this.#_.isRolledBack=!0,this.#G.connection.release()})}savepoint(a){return b9(this.#_),new b8(async()=>(await this.#G.driver.savepoint?.(this.#G.connection.connection,a,this.#$),new b7({...this.#G})))}rollbackToSavepoint(a){return b9(this.#_),new b8(async()=>(await this.#G.driver.rollbackToSavepoint?.(this.#G.connection.connection,a,this.#$),new b7({...this.#G})))}releaseSavepoint(a){return b9(this.#_),new b8(async()=>(await this.#G.driver.releaseSavepoint?.(this.#G.connection.connection,a,this.#$),new b7({...this.#G})))}withPlugin(a){return new b7({...this.#G,executor:this.#G.executor.withPlugin(a)})}withoutPlugins(){return new b7({...this.#G,executor:this.#G.executor.withoutPlugins()})}withSchema(a){return new b7({...this.#G,executor:this.#G.executor.withPluginAtFront(new bu.B(a))})}withTables(){return new b7({...this.#G})}}class b8{#aa;constructor(a){this.#aa=a}async execute(){return await this.#aa()}}function b9(a){if(a.isCommitted)throw Error("Transaction is already committed");if(a.isRolledBack)throw Error("Transaction is already rolled back")}class ca{#I;#_;constructor(a,b){a instanceof ca?this.#I=a.#I:this.#I=a,this.#_=b}get adapter(){return this.#I.adapter}get plugins(){return this.#I.plugins}transformQuery(a,b){return this.#I.transformQuery(a,b)}compileQuery(a,b){return this.#I.compileQuery(a,b)}provideConnection(a){return this.#I.provideConnection(a)}executeQuery(a){return b9(this.#_),this.#I.executeQuery(a)}stream(a,b){return b9(this.#_),this.#I.stream(a,b)}withConnectionProvider(a){return new ca(this.#I.withConnectionProvider(a),this.#_)}withPlugin(a){return new ca(this.#I.withPlugin(a),this.#_)}withPlugins(a){return new ca(this.#I.withPlugins(a),this.#_)}withPluginAtFront(a){return new ca(this.#I.withPluginAtFront(a),this.#_)}withoutPlugins(){return new ca(this.#I.withoutPlugins(),this.#_)}}var cb=c(70837);function cc(a){if(!a)return null;if("dialect"in a)return cc(a.dialect);if("createDriver"in a){if(a instanceof T)return"sqlite";if(a instanceof ab)return"mysql";if(a instanceof ak)return"postgres";if(a instanceof ax)return"mssql"}return"aggregate"in a?"sqlite":"getConnection"in a?"mysql":"connect"in a?"postgres":"fileControl"in a||"open"in a&&"close"in a&&"prepare"in a?"sqlite":null}let cd=async a=>{let b,d=a.database;if(!d)return{kysely:null,databaseType:null,transaction:void 0};if("db"in d)return{kysely:d.db,databaseType:d.type,transaction:d.transaction};if("dialect"in d)return{kysely:new b2({dialect:d.dialect}),databaseType:d.type,transaction:d.transaction};let e=cc(d);if("createDriver"in d&&(b=d),"aggregate"in d&&!("createSession"in d)&&(b=new T({database:d})),"getConnection"in d&&(b=new ab(d)),"connect"in d&&(b=new ak({pool:d})),"fileControl"in d){let{BunSqliteDialect:a}=await c.e(684).then(c.bind(c,31684));b=new a({database:d})}if("createSession"in d&&"undefined"==typeof window){let a;try{({DatabaseSync:a}=await import("node:sqlite"))}catch(a){if(null!==a&&"object"==typeof a&&"code"in a&&"ERR_UNKNOWN_BUILTIN_MODULE"!==a.code)throw a}if(a&&d instanceof a){let{NodeSqliteDialect:a}=await c.e(991).then(c.bind(c,62991));b=new a({database:d})}}return{kysely:b?new b2({dialect:b}):null,databaseType:e,transaction:void 0}},ce=(a,b)=>{let c=b.logger,d=b.options,e=d.secondaryStorage,f=d.session?.expiresIn||604800,{createWithHooks:g,updateWithHooks:h,updateManyWithHooks:i}=function(a,b){let c=b.hooks;return{createWithHooks:async function(b,d,e,f,g){let h=b;for(let a of c||[]){let b=a[d]?.create?.before;if(b){let a=await b(h,f);if(!1===a)return null;"object"==typeof a&&"data"in a&&(h={...h,...a.data})}}let i=e?await e.fn(h):null,j=!e||e.executeMainFn?await (g||a).create({model:d,data:h,forceAllowId:!0}):i;for(let a of c||[]){let b=a[d]?.create?.after;b&&await b(j,f)}return j},updateWithHooks:async function(b,d,e,f,g,h){let i=b;for(let a of c||[]){let c=a[e]?.update?.before;if(c){let a=await c(b,g);if(!1===a)return null;i="object"==typeof a?a.data:a}}let j=f?await f.fn(i):null,k=!f||f.executeMainFn?await (h||a).update({model:e,update:i,where:d}):j;for(let a of c||[]){let b=a[e]?.update?.after;b&&await b(k,g)}return k},updateManyWithHooks:async function(b,d,e,f,g,h){let i=b;for(let a of c||[]){let c=a[e]?.update?.before;if(c){let a=await c(b,g);if(!1===a)return null;i="object"==typeof a?a.data:a}}let j=f?await f.fn(i):null,k=!f||f.executeMainFn?await (h||a).updateMany({model:e,update:i,where:d}):j;for(let a of c||[]){let b=a[e]?.update?.after;b&&await b(k,g)}return k}}}(a,b);async function j(a){if(!e)return;let b=await e.get(`active-sessions-${a.id}`);if(!b)return;let c=Date.now(),d=((0,o.s)(b)||[]).filter(a=>a.expiresAt>c);await Promise.all(d.map(async({token:b})=>{let d=await e.get(b);if(!d)return;let f=(0,o.s)(d);if(!f)return;let g=Math.max(Math.floor(new Date(f.session.expiresAt).getTime()-c)/1e3,0);await e.set(b,JSON.stringify({session:f.session,user:a}),Math.floor(g))}))}return{createOAuthUser:async(b,c,d)=>a.transaction(async a=>{let e=await g({createdAt:new Date,updatedAt:new Date,...b},"user",void 0,d,a),f=await g({...c,userId:e.id,createdAt:new Date,updatedAt:new Date},"account",void 0,d,a);return{user:e,account:f}}),createUser:async(a,b,c)=>await g({createdAt:new Date,updatedAt:new Date,...a,email:a.email?.toLowerCase()},"user",void 0,b,c),createAccount:async(a,b,c)=>await g({createdAt:new Date,updatedAt:new Date,...a},"account",void 0,b,c),listSessions:async(c,d)=>{if(e){let a=await e.get(`active-sessions-${c}`);if(!a)return[];let d=(0,o.s)(a)||[],f=Date.now(),g=d.filter(a=>a.expiresAt>f),h=[];for(let a of g){let c=await e.get(a.token);if(c){let a=(0,o.s)(c);if(!a)return[];let d=(0,m.b)(b.options,{...a.session,expiresAt:new Date(a.session.expiresAt)});h.push(d)}}return h}return await (d||a).findMany({model:"session",where:[{field:"userId",value:c}]})},listUsers:async(b,c,d,e,f)=>await (f||a).findMany({model:"user",limit:b,offset:c,sortBy:d,where:e}),countTotalUsers:async(b,c)=>{let d=await (c||a).count({model:"user",where:b});return"string"==typeof d?parseInt(d):d},deleteUser:async(b,c)=>{e&&await e.delete(`active-sessions-${b}`),(!e||d.session?.storeSessionInDatabase)&&await (c||a).deleteMany({model:"session",where:[{field:"userId",value:b}]}),await (c||a).deleteMany({model:"account",where:[{field:"userId",value:b}]}),await (c||a).delete({model:"user",where:[{field:"id",value:b}]})},createSession:async(b,c,h,i,j,k)=>{let l=c.headers||c.request?.headers,{id:m,...n}=i||{},q={ipAddress:(c.request||c.headers)&&p(c.request||c.headers,c.context.options)||"",userAgent:l?.get("user-agent")||"",...n,expiresAt:h?(0,y.g)(86400,"sec"):(0,y.g)(f,"sec"),userId:b,token:(0,z.g)(32),createdAt:new Date,updatedAt:new Date,...j?n:{}};return await g(q,"session",e?{fn:async c=>{let d=await e.get(`active-sessions-${b}`),f=[],g=Date.now();d&&(f=(f=(0,o.s)(d)||[]).filter(a=>a.expiresAt>g));let h=f.sort((a,b)=>a.expiresAt-b.expiresAt),i=h.at(-1)?.expiresAt;h.push({token:q.token,expiresAt:q.expiresAt.getTime()}),(!i||i<q.expiresAt.getTime())&&(i=q.expiresAt.getTime());let j=Math.max(Math.floor((i-g)/1e3),0);j>0&&await e.set(`active-sessions-${b}`,JSON.stringify(h),j);let k=await a.findOne({model:"user",where:[{field:"id",value:b}]}),l=Math.max(Math.floor((q.expiresAt.getTime()-g)/1e3),0);return l>0&&await e.set(q.token,JSON.stringify({session:c,user:k}),l),c},executeMainFn:d.session?.storeSessionInDatabase}:void 0,c,k)},findSession:async(c,f)=>{if(e){let a=await e.get(c);if(!a&&!d.session?.storeSessionInDatabase)return null;if(a){let c=(0,o.s)(a);return c?{session:(0,m.b)(b.options,{...c.session,expiresAt:new Date(c.session.expiresAt),createdAt:new Date(c.session.createdAt),updatedAt:new Date(c.session.updatedAt)}),user:(0,m.p)(b.options,{...c.user,createdAt:new Date(c.user.createdAt),updatedAt:new Date(c.user.updatedAt)})}:null}}let g=await (f||a).findOne({model:"session",where:[{value:c,field:"token"}]});if(!g)return null;let h=await (f||a).findOne({model:"user",where:[{value:g.userId,field:"id"}]});return h?{session:(0,m.b)(b.options,g),user:(0,m.p)(b.options,h)}:null},findSessions:async(b,c)=>{if(e){let a=[];for(let c of b){let b=await e.get(c);if(b){let c=(0,o.s)(b);if(!c)return[];let d={session:{...c.session,expiresAt:new Date(c.session.expiresAt)},user:{...c.user,createdAt:new Date(c.user.createdAt),updatedAt:new Date(c.user.updatedAt)}};a.push(d)}}return a}let d=await (c||a).findMany({model:"session",where:[{field:"token",value:b,operator:"in"}]}),f=d.map(a=>a.userId);if(!f.length)return[];let g=await (c||a).findMany({model:"user",where:[{field:"id",value:f,operator:"in"}]});return d.map(a=>{let b=g.find(b=>b.id===a.userId);return b?{session:a,user:b}:null})},updateSession:async(a,b,c,f)=>await h(b,[{field:"token",value:a}],"session",e?{async fn(b){let c=await e.get(a);if(!c)return null;{let a=(0,o.s)(c);return a?{...a.session,...b}:null}},executeMainFn:d.session?.storeSessionInDatabase}:void 0,c,f),deleteSession:async(f,g)=>{if(e){let a=await e.get(f);if(a){let{session:b}=(0,o.s)(a)??{};if(!b)return void c.error("Session not found in secondary storage");let d=b.userId,g=await e.get(`active-sessions-${d}`);if(g){let a=(0,o.s)(g)||[],b=Date.now(),c=a.filter(a=>a.expiresAt>b&&a.token!==f),h=c.sort((a,b)=>a.expiresAt-b.expiresAt),i=h.at(-1)?.expiresAt;c.length>0&&i&&i>Date.now()?await e.set(`active-sessions-${d}`,JSON.stringify(c),Math.floor((i-b)/1e3)):await e.delete(`active-sessions-${d}`)}else c.error("Active sessions list not found in secondary storage")}if(await e.delete(f),!d.session?.storeSessionInDatabase||b.options.session?.preserveSessionInDatabase)return}await (g||a).delete({model:"session",where:[{field:"token",value:f}]})},deleteAccounts:async(b,c)=>{await (c||a).deleteMany({model:"account",where:[{field:"userId",value:b}]})},deleteAccount:async(b,c)=>{await (c||a).delete({model:"account",where:[{field:"id",value:b}]})},deleteSessions:async(c,f)=>{if(e){if("string"==typeof c){let a=await e.get(`active-sessions-${c}`),b=a?(0,o.s)(a):[];if(!b)return;for(let a of b)await e.delete(a.token)}else for(let a of c)await e.get(a)&&await e.delete(a);if(!d.session?.storeSessionInDatabase||b.options.session?.preserveSessionInDatabase)return}await (f||a).deleteMany({model:"session",where:[{field:Array.isArray(c)?"token":"userId",value:c,operator:Array.isArray(c)?"in":void 0}]})},findOAuthUser:async(b,c,d,e)=>{let f=await (e||a).findMany({model:"account",where:[{value:c,field:"accountId"}]}).then(a=>a.find(a=>a.providerId===d));if(f){let c=await (e||a).findOne({model:"user",where:[{value:f.userId,field:"id"}]});if(c)return{user:c,accounts:[f]};{let c=await (e||a).findOne({model:"user",where:[{value:b.toLowerCase(),field:"email"}]});return c?{user:c,accounts:[f]}:null}}{let c=await (e||a).findOne({model:"user",where:[{value:b.toLowerCase(),field:"email"}]});if(!c)return null;{let b=await (e||a).findMany({model:"account",where:[{value:c.id,field:"userId"}]});return{user:c,accounts:b||[]}}}},findUserByEmail:async(b,c,d)=>{let e=await (d||a).findOne({model:"user",where:[{value:b.toLowerCase(),field:"email"}]});if(!e)return null;if(c?.includeAccounts){let b=await (d||a).findMany({model:"account",where:[{value:e.id,field:"userId"}]});return{user:e,accounts:b}}return{user:e,accounts:[]}},findUserById:async(b,c)=>await (c||a).findOne({model:"user",where:[{field:"id",value:b}]}),linkAccount:async(a,b,c)=>await g({createdAt:new Date,updatedAt:new Date,...a},"account",void 0,b,c),updateUser:async(a,b,c,d)=>{let e=await h(b,[{field:"id",value:a}],"user",void 0,c,d);return await j(e),await j(e),e},updateUserByEmail:async(a,b,c,d)=>{let e=await h(b,[{field:"email",value:a.toLowerCase()}],"user",void 0,c,d);return await j(e),await j(e),e},updatePassword:async(a,b,c,d)=>{await i({password:b},[{field:"userId",value:a},{field:"providerId",value:"credential"}],"account",void 0,c,d)},findAccounts:async(b,c)=>await (c||a).findMany({model:"account",where:[{field:"userId",value:b}]}),findAccount:async(b,c)=>await (c||a).findOne({model:"account",where:[{field:"accountId",value:b}]}),findAccountByProviderId:async(b,c,d)=>await (d||a).findOne({model:"account",where:[{field:"accountId",value:b},{field:"providerId",value:c}]}),findAccountByUserId:async(b,c)=>await (c||a).findMany({model:"account",where:[{field:"userId",value:b}]}),updateAccount:async(a,b,c,d)=>await h(b,[{field:"id",value:a}],"account",void 0,c,d),createVerificationValue:async(a,b,c)=>await g({createdAt:new Date,updatedAt:new Date,...a},"verification",void 0,b,c),findVerificationValue:async(b,c)=>{let e=await (c||a).findMany({model:"verification",where:[{field:"identifier",value:b}],sortBy:{field:"createdAt",direction:"desc"},limit:1});return d.verification?.disableCleanup||await (c||a).deleteMany({model:"verification",where:[{field:"expiresAt",value:new Date,operator:"lt"}]}),e[0]},deleteVerificationValue:async(b,c)=>{await (c||a).delete({model:"verification",where:[{field:"id",value:b}]})},deleteVerificationByIdentifier:async(b,c)=>{await (c||a).delete({model:"verification",where:[{field:"identifier",value:b}]})},updateVerificationValue:async(a,b,c,d)=>await h(b,[{field:"id",value:a}],"verification",void 0,c,d)}};async function cf(a){if(!a.database){var b;let c,d,e=Object.keys((0,A.g)(a)).reduce((a,b)=>(a[b]=[],a),{});return n.a.warn("No database configuration provided. Using memory adapter in development"),(c=null,d=(0,cb.c)({config:{adapterId:"memory",adapterName:"Memory Adapter",usePlural:!1,debugLogs:b?.debugLogs||!1,customTransformInput:a=>a.options.advanced?.database?.useNumberId&&"id"===a.field&&"create"===a.action?e[a.model].length+1:a.data,transaction:async a=>{let b=structuredClone(e);try{return await a(d(c))}catch(a){throw Object.keys(e).forEach(a=>{e[a]=b[a]}),a}}},adapter:({getFieldName:a,options:b,debugLog:c})=>{function d(a,b){let c=e[b];if(!c)throw n.a.error(`[MemoryAdapter] Model ${b} not found in the DB`,Object.keys(e)),Error(`Model ${b} not found`);let d=(a,b)=>{let{field:c,value:d,operator:e}=b;switch(e){case"in":if(!Array.isArray(d))throw Error("Value must be an array");return d.includes(a[c]);case"not_in":if(!Array.isArray(d))throw Error("Value must be an array");return!d.includes(a[c]);case"contains":return a[c].includes(d);case"starts_with":return a[c].startsWith(d);case"ends_with":return a[c].endsWith(d);case"ne":return a[c]!==d;case"gt":return null!=d&&a[c]>d;case"gte":return null!=d&&a[c]>=d;case"lt":return null!=d&&a[c]<d;case"lte":return null!=d&&a[c]<=d;default:return a[c]===d}};return c.filter(b=>{if(!a.length||0===a.length)return!0;let c=d(b,a[0]);for(let e of a){let a=d(b,e);c="OR"===e.connector?c||a:c&&a}return c})}return{create:async({model:a,data:c})=>(b.advanced?.database?.useNumberId&&(c.id=e[a].length+1),e[a]||(e[a]=[]),e[a].push(c),c),findOne:async({model:a,where:b})=>d(b,a)[0]||null,findMany:async({model:b,where:c,sortBy:f,limit:g,offset:h})=>{let i=e[b];return c&&(i=d(c,b)),f&&(i=i.sort((c,d)=>{let e=a({model:b,field:f.field}),g=c[e],h=d[e],i=0;return i=null==g&&null==h?0:null==g?-1:null==h?1:"string"==typeof g&&"string"==typeof h?g.localeCompare(h):g instanceof Date&&h instanceof Date?g.getTime()-h.getTime():"number"==typeof g&&"number"==typeof h?g-h:"boolean"==typeof g&&"boolean"==typeof h?g===h?0:g?1:-1:String(g).localeCompare(String(h)),"asc"===f.direction?i:-i})),void 0!==h&&(i=i.slice(h)),void 0!==g&&(i=i.slice(0,g)),i||[]},count:async({model:a,where:b})=>b?d(b,a).length:e[a].length,update:async({model:a,where:b,update:c})=>{let e=d(b,a);return e.forEach(a=>{Object.assign(a,c)}),e[0]||null},delete:async({model:a,where:b})=>{let c=e[a],f=d(b,a);e[a]=c.filter(a=>!f.includes(a))},deleteMany:async({model:a,where:b})=>{let c=e[a],f=d(b,a),g=0;return e[a]=c.filter(a=>f.includes(a)?(g++,!1):!f.includes(a)),g},updateMany({model:a,where:b,update:c}){let e=d(b,a);return e.forEach(a=>{Object.assign(a,c)}),e[0]||null}}}}),a=>(c=a,d(a)))(a)}if("function"==typeof a.database)return a.database(a);let{kysely:c,databaseType:d,transaction:e}=await cd(a);if(!c)throw new r.B("Failed to initialize database adapter");return((a,b)=>{let c=null,d=a=>({getFieldName:c,schema:d,getDefaultModelName:e})=>{let f=async(d,e,f,g)=>{if(b?.type==="mysql"){await e.execute();let b=d.id?"id":g.length>0&&g[0]?.field?g[0].field:"id";if(!d.id&&0===g.length)return await a.selectFrom(f).selectAll().orderBy(c({model:f,field:b}),"desc").limit(1).executeTakeFirst();let h=d[b]||g[0]?.value;return await a.selectFrom(f).selectAll().orderBy(c({model:f,field:b}),"desc").where(c({model:f,field:b}),"=",h).limit(1).executeTakeFirst()}return b?.type==="mssql"?await e.outputAll("inserted").executeTakeFirst():await e.returningAll().executeTakeFirst()};function g(a){function c(a){for(let d in a){if(!Object.prototype.hasOwnProperty.call(a,d))continue;let e=a[d];e instanceof Date&&b?.type==="mysql"||"object"==typeof e&&null!==e&&c(e)}}if(Array.isArray(a))for(let b=0;b<a.length;b++){let d=a[b];"object"==typeof d&&null!==d&&c(d)}else"object"==typeof a&&null!==a&&c(a);return a}function h(a,e){if(!e)return{and:null,or:null};let f=[],g=[];return e.forEach(e=>{let{field:h,value:i,operator:j="=",connector:k="AND"}=e,l=c({model:a,field:h});i=function(a,c,e){if("id"===e)return a;let{type:f="sqlite"}=b||{},g=d[c]?.fields[e];return(g||(g=Object.values(d).find(a=>a.modelName===c)),"boolean"===g.type&&("sqlite"===f||"mssql"===f)&&null!=a)?+!!a:"date"===g.type&&a&&a instanceof Date&&"sqlite"===f?a.toISOString():a}(i,a,h);let m=a=>"in"===j.toLowerCase()?a(l,"in",Array.isArray(i)?i:[i]):"not_in"===j.toLowerCase()?a(l,"not in",Array.isArray(i)?i:[i]):"contains"===j?a(l,"like",`%${i}%`):"starts_with"===j?a(l,"like",`${i}%`):"ends_with"===j?a(l,"like",`%${i}`):a(l,"eq"===j?"=":"ne"===j?"<>":"gt"===j?">":"gte"===j?">=":"lt"===j?"<":"lte"===j?"<=":j,i);"OR"===k?g.push(m):f.push(m)}),{and:f.length?f:null,or:g.length?g:null}}return{async create({data:b,model:c}){let d=a.insertInto(c).values(b);return g(await f(b,d,c,[]))},async findOne({model:b,where:c,select:d}){let{and:e,or:f}=h(b,c),i=a.selectFrom(b).selectAll();e&&(i=i.where(a=>a.and(e.map(b=>b(a))))),f&&(i=i.where(a=>a.or(f.map(b=>b(a)))));let j=await i.executeTakeFirst();return j?g(j):null},async findMany({model:d,where:e,limit:f,offset:i,sortBy:j}){let{and:k,or:l}=h(d,e),m=a.selectFrom(d);k&&(m=m.where(a=>a.and(k.map(b=>b(a))))),l&&(m=m.where(a=>a.or(l.map(b=>b(a))))),b?.type==="mssql"?i||(m=m.top(f||100)):m=m.limit(f||100),j&&(m=m.orderBy(c({model:d,field:j.field}),j.direction)),i&&(b?.type==="mssql"?(j||(m=m.orderBy(c({model:d,field:"id"}))),m=m.offset(i).fetch(f||100)):m=m.offset(i));let n=await m.selectAll().execute();return n?g(n):[]},async update({model:b,where:c,update:d}){let{and:e,or:i}=h(b,c),j=a.updateTable(b).set(d);return e&&(j=j.where(a=>a.and(e.map(b=>b(a))))),i&&(j=j.where(a=>a.or(i.map(b=>b(a))))),g(await f(d,j,b,c))},async updateMany({model:b,where:c,update:d}){let{and:e,or:f}=h(b,c),g=a.updateTable(b).set(d);return e&&(g=g.where(a=>a.and(e.map(b=>b(a))))),f&&(g=g.where(a=>a.or(f.map(b=>b(a))))),(await g.execute()).length},async count({model:b,where:c}){let{and:d,or:e}=h(b,c),f=a.selectFrom(b).select(a.fn.count("id").as("count"));d&&(f=f.where(a=>a.and(d.map(b=>b(a))))),e&&(f=f.where(a=>a.or(e.map(b=>b(a)))));let g=await f.execute();return"number"==typeof g[0].count?g[0].count:"bigint"==typeof g[0].count?Number(g[0].count):parseInt(g[0].count)},async delete({model:b,where:c}){let{and:d,or:e}=h(b,c),f=a.deleteFrom(b);d&&(f=f.where(a=>a.and(d.map(b=>b(a))))),e&&(f=f.where(a=>a.or(e.map(b=>b(a))))),await f.execute()},async deleteMany({model:b,where:c}){let{and:d,or:e}=h(b,c),f=a.deleteFrom(b);return d&&(f=f.where(a=>a.and(d.map(b=>b(a))))),e&&(f=f.where(a=>a.or(e.map(b=>b(a))))),(await f.execute()).length},options:b}},e=null;e={config:{adapterId:"kysely",adapterName:"Kysely Adapter",usePlural:b?.usePlural,debugLogs:b?.debugLogs,supportsBooleans:b?.type!=="sqlite"&&b?.type!=="mssql"&&b?.type!=="mysql"&&!!b?.type,supportsDates:b?.type!=="sqlite"&&b?.type!=="mssql"&&!!b?.type,supportsJSON:!1,transaction:!!b?.transaction&&(b=>a.transaction().execute(a=>b((0,cb.c)({config:e.config,adapter:d(a)})(c))))},adapter:d(a)};let f=(0,cb.c)(e);return a=>(c=a,f(a))})(c,{type:d||"sqlite",debugLogs:"debugLogs"in a.database&&a.database.debugLogs,transaction:e})(a)}let cg={postgres:{string:["character varying","varchar","text"],number:["int4","integer","bigint","smallint","numeric","real","double precision"],boolean:["bool","boolean"],date:["timestamptz","timestamp","date"],json:["json","jsonb"]},mysql:{string:["varchar","text"],number:["integer","int","bigint","smallint","decimal","float","double"],boolean:["boolean","tinyint"],date:["timestamp","datetime","date"],json:["json"]},sqlite:{string:["TEXT"],number:["INTEGER","REAL"],boolean:["INTEGER","BOOLEAN"],date:["DATE","INTEGER"],json:["TEXT"]},mssql:{string:["varchar","nvarchar"],number:["int","bigint","smallint","decimal","float","double"],boolean:["bit","smallint"],date:["datetime2","date","datetime"],json:["varchar","nvarchar"]}};async function ch(a){let b=function(a){let b=(0,A.g)(a),c={};for(let a in b){let d=b[a],e=d.fields,f={};if(Object.entries(e).forEach(([a,c])=>{if(f[c.fieldName||a]=c,c.references){let d=b[c.references.model];d&&(f[c.fieldName||a].references={...c.references,model:d.modelName,field:c.references.field})}}),c[d.modelName]){c[d.modelName].fields={...c[d.modelName].fields,...f};continue}c[d.modelName]={fields:f,order:d.order||1/0}}return c}(a),c=(0,n.c)(a.logger),{kysely:d,databaseType:e}=await cd(a);e||(c.warn("Could not determine database type, defaulting to sqlite. Please provide a type in the database options to avoid this."),e="sqlite"),d||(c.error("Only kysely adapter is supported for migrations. You can use `generate` command to generate the schema, if you're using a different adapter."),process.exit(1));let f=await d.introspection.getTables(),g=[],h=[];for(let[a,d]of Object.entries(b)){let b=f.find(b=>b.name===a);if(!b){let b=g.findIndex(b=>b.table===a),c={table:a,fields:d.fields,order:d.order||1/0},e=g.findIndex(a=>(a.order||1/0)>c.order);-1===e?-1===b?g.push(c):g[b].fields={...g[b].fields,...d.fields}:g.splice(e,0,c);continue}let i={};for(let[f,g]of Object.entries(d.fields)){let d=b.columns.find(a=>a.name===f);if(!d){i[f]=g;continue}!function(a,b,c){if("string[]"===b||"number[]"===b)return a.toLowerCase().includes("json");let d=cg[c];return(Array.isArray(b)?d.string.map(a=>a.toLowerCase()):d[b].map(a=>a.toLowerCase())).includes(a.toLowerCase().split("(")[0].trim())}(d.dataType,g.type,e)&&c.warn(`Field ${f} in table ${a} has a different type in the database. Expected ${g.type} but got ${d.dataType}.`)}Object.keys(i).length>0&&h.push({table:a,fields:i,order:d.order||1/0})}let i=[];function j(b,c){let d=b.type,f={string:{sqlite:"text",postgres:"text",mysql:b.unique?"varchar(255)":b.references?"varchar(36)":"text",mssql:b.unique||b.sortable?"varchar(255)":b.references?"varchar(36)":"varchar(8000)"},boolean:{sqlite:"integer",postgres:"boolean",mysql:"boolean",mssql:"smallint"},number:{sqlite:b.bigint?"bigint":"integer",postgres:b.bigint?"bigint":"integer",mysql:b.bigint?"bigint":"integer",mssql:b.bigint?"bigint":"integer"},date:{sqlite:"date",postgres:"timestamptz",mysql:"timestamp(3)",mssql:(0,P.l)`datetime2(3)`},json:{sqlite:"text",postgres:"jsonb",mysql:"json",mssql:"varchar(8000)"},id:{postgres:a.advanced?.database?.useNumberId?"serial":"text",mysql:a.advanced?.database?.useNumberId?"integer":"varchar(36)",mssql:a.advanced?.database?.useNumberId?"integer":"varchar(36)",sqlite:a.advanced?.database?.useNumberId?"integer":"text"},foreignKeyId:{postgres:a.advanced?.database?.useNumberId?"integer":"text",mysql:a.advanced?.database?.useNumberId?"integer":"varchar(36)",mssql:a.advanced?.database?.useNumberId?"integer":"varchar(36)",sqlite:a.advanced?.database?.useNumberId?"integer":"text"}};return"id"===c||b.references?.field==="id"?"id"===c?f.id[e]:f.foreignKeyId[e]:"sqlite"===e&&("string[]"===d||"number[]"===d)?"text":"string[]"===d||"number[]"===d?"jsonb":Array.isArray(d)?"text":f[d][e||"sqlite"]}if(h.length)for(let a of h)for(let[b,c]of Object.entries(a.fields)){let f=j(c,b),g=d.schema.alterTable(a.table).addColumn(b,f,a=>(a=!1!==c.required?a.notNull():a,c.references&&(a=a.references(`${c.references.model}.${c.references.field}`).onDelete(c.references.onDelete||"cascade")),c.unique&&(a=a.unique()),"date"===c.type&&"function"==typeof c.defaultValue&&("postgres"===e||"mysql"===e||"mssql"===e)&&(a="mysql"===e?a.defaultTo((0,P.l)`CURRENT_TIMESTAMP(3)`):a.defaultTo((0,P.l)`CURRENT_TIMESTAMP`)),a));i.push(g)}if(g.length)for(let b of g){let c=d.schema.createTable(b.table).addColumn("id",a.advanced?.database?.useNumberId?"postgres"===e?"serial":"integer":"mysql"===e||"mssql"===e?"varchar(36)":"text",b=>a.advanced?.database?.useNumberId?"postgres"===e||"sqlite"===e?b.primaryKey().notNull():"mssql"===e?b.identity().primaryKey().notNull():b.autoIncrement().primaryKey().notNull():b.primaryKey().notNull());for(let[a,d]of Object.entries(b.fields)){let b=j(d,a);c=c.addColumn(a,b,a=>(a=!1!==d.required?a.notNull():a,d.references&&(a=a.references(`${d.references.model}.${d.references.field}`).onDelete(d.references.onDelete||"cascade")),d.unique&&(a=a.unique()),"date"===d.type&&"function"==typeof d.defaultValue&&("postgres"===e||"mysql"===e||"mssql"===e)&&(a="mysql"===e?a.defaultTo((0,P.l)`CURRENT_TIMESTAMP(3)`):a.defaultTo((0,P.l)`CURRENT_TIMESTAMP`)),a))}i.push(c)}return{toBeCreated:g,toBeAdded:h,runMigrations:async function(){for(let a of i)await a.execute()},compileMigrations:async function(){return i.map(a=>a.compile().sql).join(";\n\n")+";"}}}async function ci(a,b){let c=await b.context.internalAdapter.findAccounts(a),d=c?.find(a=>"credential"===a.providerId),e=d?.password;if(!d||!e||!b.body.password)throw new g.LG("BAD_REQUEST",{message:"No password credential found"});if(!await b.context.password.verify({hash:e,password:b.body.password}))throw new g.LG("BAD_REQUEST",{message:"Invalid password"});return!0}let cj="better-auth-secret-123456789";async function ck(){if(d)return d;try{let a="undefined"!=typeof process&&"function"==typeof process.cwd?process.cwd():"";if(!a)return;let b=a=>Function("mm","return import(mm)")(a),[{default:c},{default:e}]=await Promise.all([b("fs/promises"),b("path")]),f=await c.readFile(e.join(a,"package.json"),"utf-8");return d=JSON.parse(f)}catch{}}async function cl(a){if(d)return d.dependencies?.[a]||d.devDependencies?.[a]||d.peerDependencies?.[a];try{let b="undefined"!=typeof process&&"function"==typeof process.cwd?process.cwd():"";if(!b)throw Error("no-cwd");let c=a=>Function("mm","return import(mm)")(a),[{default:d},{default:e}]=await Promise.all([c("fs/promises"),c("path")]),f=e.join(b,"node_modules",a,"package.json"),g=await d.readFile(f,"utf-8");return JSON.parse(g).version||await cm(a)||void 0}catch{}return await cm(a)}async function cm(a){let b=await ck();if(b)return({...b.dependencies,...b.devDependencies,...b.peerDependencies})[a]}async function cn(){let a=await ck();return a?.name}let co=null;async function cp(a){if(co)return co;let b=await cn();return co=b?await (0,q.VH)(a?a+b:b):a?await (0,q.VH)(a):(0,z.g)(32)}let cq=a=>Function("mm","return import(mm)")(a);function cr(){let a=(...a)=>a.some(a=>!!l.e[a]);return a("CF_PAGES","CF_PAGES_URL","CF_ACCOUNT_ID")||"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent?"cloudflare":a("VERCEL","VERCEL_URL","VERCEL_ENV")?"vercel":a("NETLIFY","NETLIFY_URL")?"netlify":a("RENDER","RENDER_URL","RENDER_INTERNAL_HOSTNAME","RENDER_SERVICE_ID")?"render":a("AWS_LAMBDA_FUNCTION_NAME","AWS_EXECUTION_ENV","LAMBDA_TASK_ROOT")?"aws":a("GOOGLE_CLOUD_FUNCTION_NAME","GOOGLE_CLOUD_PROJECT","GCP_PROJECT","K_SERVICE")?"gcp":a("AZURE_FUNCTION_NAME","FUNCTIONS_WORKER_RUNTIME","WEBSITE_INSTANCE_ID","WEBSITE_SITE_NAME")?"azure":a("DENO_DEPLOYMENT_ID","DENO_REGION")?"deno-deploy":a("FLY_APP_NAME","FLY_REGION","FLY_ALLOC_ID")?"fly-io":a("RAILWAY_STATIC_URL","RAILWAY_ENVIRONMENT_NAME")?"railway":a("DYNO","HEROKU_APP_NAME")?"heroku":a("DO_DEPLOYMENT_ID","DO_APP_NAME","DIGITALOCEAN")?"digitalocean":a("KOYEB","KOYEB_DEPLOYMENT_ID","KOYEB_APP_NAME")?"koyeb":null}async function cs(){try{if("cloudflare"===cr())return"cloudflare";let a=await cq("os"),b=a.cpus();return{deploymentVendor:cr(),systemPlatform:a.platform(),systemRelease:a.release(),systemArchitecture:a.arch(),cpuCount:b.length,cpuModel:b.length?b[0].model:null,cpuSpeed:b.length?b[0].speed:null,memory:a.totalmem(),isWSL:await cw(),isDocker:await cv(),isTTY:"undefined"!=typeof process&&process.stdout?process.stdout.isTTY:null}}catch(a){return{systemPlatform:null,systemRelease:null,systemArchitecture:null,cpuCount:null,cpuModel:null,cpuSpeed:null,memory:null,isWSL:null,isDocker:null,isTTY:null}}}async function ct(){if("cloudflare"===cr())return!1;try{return(await cq("fs")).statSync("/.dockerenv"),!0}catch{return!1}}async function cu(){if("cloudflare"===cr())return!1;try{return(await cq("fs")).readFileSync("/proc/self/cgroup","utf8").includes("docker")}catch{return!1}}async function cv(){return"cloudflare"!==cr()&&(void 0===e&&(e=await ct()||await cu()),e)}async function cw(){try{if("cloudflare"===cr()||"undefined"==typeof process||process?.platform!=="linux")return!1;let a=await cq("fs");if((await cq("os")).release().toLowerCase().includes("microsoft")){if(await cy())return!1;return!0}return!!a.readFileSync("/proc/version","utf8").toLowerCase().includes("microsoft")&&!await cy()}catch{return!1}}let cx=async()=>{if("cloudflare"===cr())return!1;try{return(await cq("fs")).statSync("/run/.containerenv"),!0}catch{return!1}};async function cy(){return void 0===f&&(f=await cx()||await cv()),f}let cz={pg:"postgresql",mysql:"mysql",mariadb:"mariadb",sqlite3:"sqlite","better-sqlite3":"sqlite","@prisma/client":"prisma",mongoose:"mongodb",mongodb:"mongodb","drizzle-orm":"drizzle"};async function cA(){for(let[a,b]of Object.entries(cz)){let c=await cl(a);if(c)return{name:b,version:c}}}let cB={next:"next",nuxt:"nuxt","@remix-run/server-runtime":"remix",astro:"astro","@sveltejs/kit":"sveltekit","solid-start":"solid-start","tanstack-start":"tanstack-start",hono:"hono",express:"express",elysia:"elysia",expo:"expo"};async function cC(){for(let[a,b]of Object.entries(cB)){let c=await cl(a);if(c)return{name:b,version:c}}}async function cD(a,b){let c,d=a.telemetry?.debug||(0,l.c)("BETTER_AUTH_TELEMETRY_DEBUG",!1),e=l.E.BETTER_AUTH_TELEMETRY_ENDPOINT,f=async a=>{try{b?.customTrack?await b.customTrack(a):d?await Promise.resolve(n.a.info("telemetry event",JSON.stringify(a,null,2))):await (0,s.zZ)(e,{method:"POST",body:a})}catch{}},g=async()=>{let c=a.telemetry?.enabled!==void 0&&a.telemetry.enabled;return((0,l.c)("BETTER_AUTH_TELEMETRY",!1)||c)&&(b?.skipTestCheck||!(0,l.i)())},h=await g();if(h){var i;c=await cp(a.baseURL),f({type:"init",payload:{config:{database:void 0,adapter:i?.adapter,emailVerification:{sendVerificationEmail:!!a.emailVerification?.sendVerificationEmail,sendOnSignUp:!!a.emailVerification?.sendOnSignUp,sendOnSignIn:!!a.emailVerification?.sendOnSignIn,autoSignInAfterVerification:!!a.emailVerification?.autoSignInAfterVerification,expiresIn:a.emailVerification?.expiresIn,onEmailVerification:!!a.emailVerification?.onEmailVerification,afterEmailVerification:!!a.emailVerification?.afterEmailVerification},emailAndPassword:{enabled:!!a.emailAndPassword?.enabled,disableSignUp:!!a.emailAndPassword?.disableSignUp,requireEmailVerification:!!a.emailAndPassword?.requireEmailVerification,maxPasswordLength:a.emailAndPassword?.maxPasswordLength,minPasswordLength:a.emailAndPassword?.minPasswordLength,sendResetPassword:!!a.emailAndPassword?.sendResetPassword,resetPasswordTokenExpiresIn:a.emailAndPassword?.resetPasswordTokenExpiresIn,onPasswordReset:!!a.emailAndPassword?.onPasswordReset,password:{hash:!!a.emailAndPassword?.password?.hash,verify:!!a.emailAndPassword?.password?.verify},autoSignIn:!!a.emailAndPassword?.autoSignIn,revokeSessionsOnPasswordReset:!!a.emailAndPassword?.revokeSessionsOnPasswordReset},socialProviders:Object.keys(a.socialProviders||{}).map(b=>{let c=a.socialProviders?.[b];return c?{id:b,mapProfileToUser:!!c.mapProfileToUser,disableDefaultScope:!!c.disableDefaultScope,disableIdTokenSignIn:!!c.disableIdTokenSignIn,disableImplicitSignUp:c.disableImplicitSignUp,disableSignUp:c.disableSignUp,getUserInfo:!!c.getUserInfo,overrideUserInfoOnSignIn:!!c.overrideUserInfoOnSignIn,prompt:c.prompt,verifyIdToken:!!c.verifyIdToken,scope:c.scope,refreshAccessToken:!!c.refreshAccessToken}:{}}),plugins:a.plugins?.map(a=>a.id.toString()),user:{modelName:a.user?.modelName,fields:a.user?.fields,additionalFields:a.user?.additionalFields,changeEmail:{enabled:a.user?.changeEmail?.enabled,sendChangeEmailVerification:!!a.user?.changeEmail?.sendChangeEmailVerification}},verification:{modelName:a.verification?.modelName,disableCleanup:a.verification?.disableCleanup,fields:a.verification?.fields},session:{modelName:a.session?.modelName,additionalFields:a.session?.additionalFields,cookieCache:{enabled:a.session?.cookieCache?.enabled,maxAge:a.session?.cookieCache?.maxAge},disableSessionRefresh:a.session?.disableSessionRefresh,expiresIn:a.session?.expiresIn,fields:a.session?.fields,freshAge:a.session?.freshAge,preserveSessionInDatabase:a.session?.preserveSessionInDatabase,storeSessionInDatabase:a.session?.storeSessionInDatabase,updateAge:a.session?.updateAge},account:{modelName:a.account?.modelName,fields:a.account?.fields,encryptOAuthTokens:a.account?.encryptOAuthTokens,updateAccountOnSignIn:a.account?.updateAccountOnSignIn,accountLinking:{enabled:a.account?.accountLinking?.enabled,trustedProviders:a.account?.accountLinking?.trustedProviders,updateUserInfoOnLink:a.account?.accountLinking?.updateUserInfoOnLink,allowUnlinkingAll:a.account?.accountLinking?.allowUnlinkingAll}},hooks:{after:!!a.hooks?.after,before:!!a.hooks?.before},secondaryStorage:!!a.secondaryStorage,advanced:{cookiePrefix:!!a.advanced?.cookiePrefix,cookies:!!a.advanced?.cookies,crossSubDomainCookies:{domain:!!a.advanced?.crossSubDomainCookies?.domain,enabled:a.advanced?.crossSubDomainCookies?.enabled,additionalCookies:a.advanced?.crossSubDomainCookies?.additionalCookies},database:{useNumberId:!!a.advanced?.database?.useNumberId,generateId:a.advanced?.database?.generateId,defaultFindManyLimit:a.advanced?.database?.defaultFindManyLimit},useSecureCookies:a.advanced?.useSecureCookies,ipAddress:{disableIpTracking:a.advanced?.ipAddress?.disableIpTracking,ipAddressHeaders:a.advanced?.ipAddress?.ipAddressHeaders},disableCSRFCheck:a.advanced?.disableCSRFCheck,cookieAttributes:{expires:a.advanced?.defaultCookieAttributes?.expires,secure:a.advanced?.defaultCookieAttributes?.secure,sameSite:a.advanced?.defaultCookieAttributes?.sameSite,domain:!!a.advanced?.defaultCookieAttributes?.domain,path:a.advanced?.defaultCookieAttributes?.path,httpOnly:a.advanced?.defaultCookieAttributes?.httpOnly}},trustedOrigins:a.trustedOrigins?.length,rateLimit:{storage:a.rateLimit?.storage,modelName:a.rateLimit?.modelName,window:a.rateLimit?.window,customStorage:!!a.rateLimit?.customStorage,enabled:a.rateLimit?.enabled,max:a.rateLimit?.max},onAPIError:{errorURL:a.onAPIError?.errorURL,onError:!!a.onAPIError?.onError,throw:a.onAPIError?.throw},logger:{disabled:a.logger?.disabled,level:a.logger?.level,log:!!a.logger?.log},databaseHooks:{user:{create:{after:!!a.databaseHooks?.user?.create?.after,before:!!a.databaseHooks?.user?.create?.before},update:{after:!!a.databaseHooks?.user?.update?.after,before:!!a.databaseHooks?.user?.update?.before}},session:{create:{after:!!a.databaseHooks?.session?.create?.after,before:!!a.databaseHooks?.session?.create?.before},update:{after:!!a.databaseHooks?.session?.update?.after,before:!!a.databaseHooks?.session?.update?.before}},account:{create:{after:!!a.databaseHooks?.account?.create?.after,before:!!a.databaseHooks?.account?.create?.before},update:{after:!!a.databaseHooks?.account?.update?.after,before:!!a.databaseHooks?.account?.update?.before}},verification:{create:{after:!!a.databaseHooks?.verification?.create?.after,before:!!a.databaseHooks?.verification?.create?.before},update:{after:!!a.databaseHooks?.verification?.update?.after,before:!!a.databaseHooks?.verification?.update?.before}}}},runtime:"undefined"!=typeof Deno?{name:"deno",version:Deno?.version?.deno??null}:"undefined"!=typeof Bun?{name:"bun",version:Bun?.version??null}:"undefined"!=typeof process&&process?.versions?.node?{name:"node",version:process.versions.node??null}:{name:"edge",version:null},database:await cA(),framework:await cC(),environment:"production"===(0,l.g)("NODE_ENV")?"production":"false"!==l.e.CI&&("BUILD_ID"in l.e||"BUILD_NUMBER"in l.e||"CI"in l.e||"CI_APP_ID"in l.e||"CI_BUILD_ID"in l.e||"CI_BUILD_NUMBER"in l.e||"CI_NAME"in l.e||"CONTINUOUS_INTEGRATION"in l.e||"RUN_ID"in l.e)?"ci":(0,l.i)()?"test":"development",systemInfo:await cs(),packageManager:function(){let a=l.e.npm_config_user_agent;if(!a)return;let b=a.split(" ")[0],c=b.lastIndexOf("/"),d=b.substring(0,c);return{name:"npminstall"===d?"cnpm":d,version:b.substring(c+1)}}()},anonymousId:c})}return{publish:async b=>{h&&(c||(c=await cp(a.baseURL)),await f({type:b.type,payload:b.payload,anonymousId:c}))}}}function cE(a){return!!a&&("object"==typeof a||"function"==typeof a)&&"function"==typeof a.then}let cF=async a=>{var b;let c,d=await cf(a),e=a.plugins||[],f=(b=a,b.advanced?.crossSubDomainCookies?.enabled,[]),g=(0,n.c)(a.logger),i=(0,t.a)(a.baseURL,a.basePath),j=a.secret||l.e.BETTER_AUTH_SECRET||l.e.AUTH_SECRET||cj;j===cj&&l.b&&g.error("You are using the default secret. Please set `BETTER_AUTH_SECRET` in your environment variables or pass `secret` in your auth config."),function(a,b){let c=new Map;a.plugins?.forEach(a=>{if(a.endpoints){for(let[b,d]of Object.entries(a.endpoints))if(d&&"path"in d){let e=d.path,f=[];d.options&&"method"in d.options&&(Array.isArray(d.options.method)?f=d.options.method:"string"==typeof d.options.method&&(f=[d.options.method])),0===f.length&&(f=["*"]),c.has(e)||c.set(e,[]),c.get(e).push({pluginId:a.id,endpointKey:b,methods:f})}}});let d=[];for(let[a,b]of c.entries())if(b.length>1){let c=new Map,e=!1;for(let a of b)for(let d of a.methods)c.has(d)||c.set(d,[]),c.get(d).push(a.pluginId),c.get(d).length>1&&(e=!0),"*"===d&&b.length>1?e=!0:"*"!==d&&c.has("*")&&(e=!0);if(e){let e=[...new Set(b.map(a=>a.pluginId))],f=[];for(let[a,d]of c.entries())(d.length>1||"*"===a&&b.length>1||"*"!==a&&c.has("*"))&&f.push(a);d.push({path:a,plugins:e,conflictingMethods:f})}}if(d.length>0){let a=d.map(a=>`  - "${a.path}" [${a.conflictingMethods.join(", ")}] used by plugins: ${a.plugins.join(", ")}`).join("\n");b.error(`Endpoint path conflicts detected! Multiple plugins are trying to use the same endpoint paths with conflicting HTTP methods:
${a}

To resolve this, you can:
	1. Use only one of the conflicting plugins
	2. Configure the plugins to use different paths (if supported)
	3. Ensure plugins use different HTTP methods for the same path
`)}}(a={...a,secret:j,baseURL:i?new URL(i).origin:"",basePath:a.basePath||"/api/auth",plugins:e.concat(f)},g);let m=(0,k.g)(a),o=(0,A.g)(a),p=Object.entries(a.socialProviders||{}).map(([a,b])=>{if(null==b||!1===b.enabled)return null;b.clientId||g.warn(`Social provider ${a} is missing clientId or clientSecret`);let c=h.U[a](b);return c.disableImplicitSignUp=b.disableImplicitSignUp,c}).filter(a=>null!==a),{publish:s}=await cD(a,{adapter:d.id,database:"function"==typeof a.database?"adapter":cc(a.database)||"unknown"}),u={appName:a.appName||"Better Auth",socialProviders:p,options:a,tables:o,trustedOrigins:function(a){let b=(0,t.a)(a.baseURL,a.basePath);if(!b)return[];let c=[new URL(b).origin];a.trustedOrigins&&Array.isArray(a.trustedOrigins)&&c.push(...a.trustedOrigins);let d=l.e.BETTER_AUTH_TRUSTED_ORIGINS;if(d&&c.push(...d.split(",")),c.filter(a=>!a).length)throw new r.B("A provided trusted origin is invalid, make sure your trusted origins list is properly defined.");return c}(a),baseURL:i||"",sessionConfig:{updateAge:a.session?.updateAge!==void 0?a.session.updateAge:86400,expiresIn:a.session?.expiresIn||604800,freshAge:a.session?.freshAge===void 0?86400:a.session.freshAge},secret:j,rateLimit:{...a.rateLimit,enabled:a.rateLimit?.enabled??l.b,window:a.rateLimit?.window||10,max:a.rateLimit?.max||100,storage:a.rateLimit?.storage||(a.secondaryStorage?"secondary-storage":"memory")},authCookies:m,logger:g,generateId:({model:b,size:c})=>"function"==typeof a.advanced?.generateId?a.advanced.generateId({model:b,size:c}):"function"==typeof a?.advanced?.database?.generateId?a.advanced.database.generateId({model:b,size:c}):(0,z.g)(c),session:null,secondaryStorage:a.secondaryStorage,password:{hash:a.emailAndPassword?.password?.hash||q.Er,verify:a.emailAndPassword?.password?.verify||q.BE,config:{minPasswordLength:a.emailAndPassword?.minPasswordLength||8,maxPasswordLength:a.emailAndPassword?.maxPasswordLength||128},checkPassword:ci},setNewSession(a){this.newSession=a},newSession:null,adapter:d,internalAdapter:ce(d,{options:a,logger:g,hooks:a.databaseHooks?[a.databaseHooks]:[]}),createAuthCookie:(0,k.c)(a),async runMigrations(){if(!a.database||"updateMany"in a.database)throw new r.B("Database is not provided or it's an adapter. Migrations are only supported with a database instance.");let{runMigrations:b}=await ch(a);await b()},publishTelemetry:s},v=cG(u);return cE(v)?{context:c}=await v:{context:c}=v,c};async function cG(a){let b=a.options,c=b.plugins||[],d=a,e=[];for(let a of c)if(a.init){let c,f=a.init(d);if("object"==typeof(c=cE(f)?await f:f)){if(c.options){let{databaseHooks:a,...d}=c.options;a&&e.push(a),b=(0,u.$Q)(b,d)}c.context&&(d={...d,...c.context})}}return e.push(b.databaseHooks),d.internalAdapter=ce(a.adapter,{options:b,logger:a.logger,hooks:e.filter(a=>void 0!==a),generateId:a.generateId}),d.options=b,{context:d}}let cH=a=>{let b=cF(a),{api:c}=x(b,a),d=a.plugins?.reduce((a,b)=>b.$ERROR_CODES?{...a,...b.$ERROR_CODES}:a,{});return{handler:async c=>{let d=await b,e=d.options.basePath||"/api/auth";if(!d.options.baseURL){let a=(0,t.a)(void 0,e,c);if(a)d.baseURL=a,d.options.baseURL=(0,t.g)(d.baseURL)||void 0;else throw new r.B("Could not get base URL from request. Please provide a valid base URL.")}d.trustedOrigins=[...a.trustedOrigins?Array.isArray(a.trustedOrigins)?a.trustedOrigins:await a.trustedOrigins(c):[],d.options.baseURL];let{handler:f}=((a,b)=>{let{api:c,middlewares:d}=x(a,b),e=new URL(a.baseURL).pathname;return(0,g.aE)(c,{routerContext:a,openapi:{disabled:!0},basePath:e,routerMiddleware:[{path:"/**",middleware:h.l},...d],async onRequest(b){let c=a.options.disabledPaths||[],d=new URL(b.url).pathname.replace(e,"");if(c.includes(d))return new Response("Not Found",{status:404});for(let c of a.options.plugins||[])if(c.onRequest){let d=await c.onRequest(b,a);if(d&&"response"in d)return d.response}return w(b,a)},async onResponse(b){for(let c of a.options.plugins||[])if(c.onResponse){let d=await c.onResponse(b,a);if(d)return d.response}return b},onError(c){if(c instanceof g.LG&&"FOUND"===c.status)return;if(b.onAPIError?.throw)throw c;if(b.onAPIError?.onError)return void b.onAPIError.onError(c,a);let d=b.logger?.level,e="error"===d||"warn"===d||"debug"===d?n.a:void 0;if(b.logger?.disabled!==!0){if(c&&"object"==typeof c&&"message"in c&&"string"==typeof c.message&&(c.message.includes("no column")||c.message.includes("column")||c.message.includes("relation")||c.message.includes("table")||c.message.includes("does not exist")))return void a.logger?.error(c.message);c instanceof g.LG?("INTERNAL_SERVER_ERROR"===c.status&&a.logger.error(c.status,c),e?.error(c.message)):a.logger?.error(c&&"object"==typeof c&&"name"in c?c.name:"",c)}}})})(d,a);return f(c)},api:c,options:a,$context:b,$Infer:{},$ERROR_CODES:{...d,...i.B}}}},4174:(a,b,c)=>{let d;c.d(b,{A:()=>aJ,B:()=>aN,C:()=>aO,D:()=>aC,E:()=>aA,F:()=>aD,G:()=>aI,I:()=>aH,J:()=>aG,K:()=>aK,L:()=>ac,M:()=>ad,N:()=>aE,O:()=>aB,P:()=>av,Q:()=>ay,R:()=>ax,S:()=>au,U:()=>ar,k:()=>aa,l:()=>$,m:()=>aL,n:()=>aM,q:()=>aS,t:()=>aU,u:()=>aF,w:()=>Z,x:()=>aQ,y:()=>aR,z:()=>aP});var e=c(46762),f=c(96843),g=c(23427),h=c(84916),i=c(69744),j=c(5109),k=c(55220),l=c(27320),m=c(52628),n=c(89961),o=c(93226),p=c(5091);let q=async(a,b,c,d)=>{let e=await (0,p.A)(a,b,"verify");(0,o.A)(a,e);let f=(0,n.A)(a,e.algorithm);try{return await crypto.subtle.verify(f,e,c,d)}catch{return!1}};var r=c(90009),s=c(81671),t=c(96370),u=c(65145),v=c(83514),w=c(52436),x=c(84108);async function y(a,b,c){let d,e;if(!(0,u.A)(a))throw new r.Ye("Flattened JWS must be an object");if(void 0===a.protected&&void 0===a.header)throw new r.Ye('Flattened JWS must have either of the "protected" or "header" members');if(void 0!==a.protected&&"string"!=typeof a.protected)throw new r.Ye("JWS Protected Header incorrect type");if(void 0===a.payload)throw new r.Ye("JWS Payload missing");if("string"!=typeof a.signature)throw new r.Ye("JWS Signature missing or incorrect type");if(void 0!==a.header&&!(0,u.A)(a.header))throw new r.Ye("JWS Unprotected Header incorrect type");let f={};if(a.protected)try{let b=(0,m.D)(a.protected);f=JSON.parse(s.D0.decode(b))}catch{throw new r.Ye("JWS Protected Header is invalid")}if(!(0,t.A)(f,a.header))throw new r.Ye("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let g={...f,...a.header},h=(0,w.A)(r.Ye,new Map([["b64",!0]]),c?.crit,f,g),i=!0;if(h.has("b64")&&"boolean"!=typeof(i=f.b64))throw new r.Ye('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:j}=g;if("string"!=typeof j||!j)throw new r.Ye('JWS "alg" (Algorithm) Header Parameter missing or invalid');let k=c&&((a,b)=>{if(void 0!==b&&(!Array.isArray(b)||b.some(a=>"string"!=typeof a)))throw TypeError(`"${a}" option must be an array of strings`);if(b)return new Set(b)})("algorithms",c.algorithms);if(k&&!k.has(j))throw new r.Rb('"alg" (Algorithm) Header Parameter value not allowed');if(i){if("string"!=typeof a.payload)throw new r.Ye("JWS Payload must be a string")}else if("string"!=typeof a.payload&&!(a.payload instanceof Uint8Array))throw new r.Ye("JWS Payload must be a string or an Uint8Array instance");let l=!1;"function"==typeof b&&(b=await b(f,a),l=!0),(0,v.A)(j,b,"verify");let n=(0,s.xW)(s.Rd.encode(a.protected??""),s.Rd.encode("."),"string"==typeof a.payload?s.Rd.encode(a.payload):a.payload);try{d=(0,m.D)(a.signature)}catch{throw new r.Ye("Failed to base64url decode the signature")}let o=await (0,x.A)(b,j);if(!await q(j,o,d,n))throw new r.h2;if(i)try{e=(0,m.D)(a.payload)}catch{throw new r.Ye("Failed to base64url decode the payload")}else e="string"==typeof a.payload?s.Rd.encode(a.payload):a.payload;let p={payload:e};return(void 0!==a.protected&&(p.protectedHeader=f),void 0!==a.header&&(p.unprotectedHeader=a.header),l)?{...p,key:o}:p}async function z(a,b,c){if(a instanceof Uint8Array&&(a=s.D0.decode(a)),"string"!=typeof a)throw new r.Ye("Compact JWS must be a string or Uint8Array");let{0:d,1:e,2:f,length:g}=a.split(".");if(3!==g)throw new r.Ye("Invalid Compact JWS");let h=await y({payload:e,protected:d,signature:f},b,c),i={payload:h.payload,protectedHeader:h.protectedHeader};return"function"==typeof b?{...i,key:h.key}:i}var A=c(85256);async function B(a,b,c){let d=await z(a,b,c);if(d.protectedHeader.crit?.includes("b64")&&!1===d.protectedHeader.b64)throw new r.Dp("JWTs MUST NOT use unencoded payload");let e={payload:(0,A.k)(d.protectedHeader,d.payload,c),protectedHeader:d.protectedHeader};return"function"==typeof b?{...e,key:d.key}:e}function C(a){let b;if("string"==typeof a){let c=a.split(".");(3===c.length||5===c.length)&&([b]=c)}else if("object"==typeof a&&a)if("protected"in a)b=a.protected;else throw TypeError("Token does not contain a Protected Header");try{if("string"!=typeof b||!b)throw Error();let a=JSON.parse(s.D0.decode((0,m.D)(b)));if(!(0,u.A)(a))throw Error();return a}catch{throw TypeError("Invalid Token or Protected Header formatting")}}function D(a){let b,c;if("string"!=typeof a)throw new r.Dp("JWTs must use Compact JWS serialization, JWT must be a string");let{1:d,length:e}=a.split(".");if(5===e)throw new r.Dp("Only JWTs using Compact JWS serialization can be decoded");if(3!==e)throw new r.Dp("Invalid JWT");if(!d)throw new r.Dp("JWTs must contain a payload");try{b=(0,m.D)(d)}catch{throw new r.Dp("Failed to base64url decode the payload")}try{c=JSON.parse(s.D0.decode(b))}catch{throw new r.Dp("Failed to parse the decoded payload as JSON")}if(!(0,u.A)(c))throw new r.Dp("Invalid JWT Claims Set");return c}var E=c(48623);async function F(a,b,c){let d;if(!(0,u.A)(a))throw TypeError("JWK must be an object");switch(b??=a.alg,d??=c?.extractable??a.ext,a.kty){case"oct":if("string"!=typeof a.k||!a.k)throw TypeError('missing "k" (Key Value) Parameter value');return(0,m.D)(a.k);case"RSA":if("oth"in a&&void 0!==a.oth)throw new r.T0('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');return(0,E.A)({...a,alg:b,ext:d});case"AKP":if("string"!=typeof a.alg||!a.alg)throw TypeError('missing "alg" (Algorithm) Parameter value');if(void 0!==b&&b!==a.alg)throw TypeError("JWK alg and alg option value mismatch");return(0,E.A)({...a,ext:d});case"EC":case"OKP":return(0,E.A)({...a,alg:b,ext:d});default:throw new r.T0('Unsupported "kty" (Key Type) Parameter value')}}function G(a){return(0,u.A)(a)}class H{#ab;#ac=new WeakMap;constructor(a){if(!function(a){return a&&"object"==typeof a&&Array.isArray(a.keys)&&a.keys.every(G)}(a))throw new r.Dm("JSON Web Key Set malformed");this.#ab=structuredClone(a)}jwks(){return this.#ab}async getKey(a,b){let{alg:c,kid:d}={...a,...b?.header},e=function(a){switch("string"==typeof a&&a.slice(0,2)){case"RS":case"PS":return"RSA";case"ES":return"EC";case"Ed":return"OKP";case"ML":return"AKP";default:throw new r.T0('Unsupported "alg" value for a JSON Web Key Set')}}(c),f=this.#ab.keys.filter(a=>{let b=e===a.kty;if(b&&"string"==typeof d&&(b=d===a.kid),b&&("string"==typeof a.alg||"AKP"===e)&&(b=c===a.alg),b&&"string"==typeof a.use&&(b="sig"===a.use),b&&Array.isArray(a.key_ops)&&(b=a.key_ops.includes("verify")),b)switch(c){case"ES256":b="P-256"===a.crv;break;case"ES384":b="P-384"===a.crv;break;case"ES512":b="P-521"===a.crv;break;case"Ed25519":case"EdDSA":b="Ed25519"===a.crv}return b}),{0:g,length:h}=f;if(0===h)throw new r.BT;if(1!==h){let a=new r.$4,b=this.#ac;throw a[Symbol.asyncIterator]=async function*(){for(let a of f)try{yield await I(b,a,c)}catch{}},a}return I(this.#ac,g,c)}}async function I(a,b,c){let d=a.get(b)||a.set(b,{}).get(b);if(void 0===d[c]){let a=await F({...b,ext:!0},c);if(a instanceof Uint8Array||"public"!==a.type)throw new r.Dm("JSON Web Key Set members must be public keys");d[c]=a}return d[c]}function J(a){let b=new H(a),c=async(a,c)=>b.getKey(a,c);return Object.defineProperties(c,{jwks:{value:()=>structuredClone(b.jwks()),enumerable:!1,configurable:!1,writable:!1}}),c}"undefined"!=typeof navigator&&navigator.userAgent?.startsWith?.("Mozilla/5.0 ")||(d="jose/v6.1.0");let K=Symbol();async function L(a,b,c,d=fetch){let e=await d(a,{method:"GET",signal:c,redirect:"manual",headers:b}).catch(a=>{if("TimeoutError"===a.name)throw new r.xb;throw a});if(200!==e.status)throw new r.i4("Expected 200 OK from the JSON Web Key Set HTTP response");try{return await e.json()}catch{throw new r.i4("Failed to parse the JSON Web Key Set HTTP response as JSON")}}let M=Symbol();class N{#ad;#ae;#af;#ag;#ah;#ai;#aj;#ak;#al;#am;constructor(a,b){if(!(a instanceof URL))throw TypeError("url must be an instance of URL");this.#ad=new URL(a.href),this.#ae="number"==typeof b?.timeoutDuration?b?.timeoutDuration:5e3,this.#af="number"==typeof b?.cooldownDuration?b?.cooldownDuration:3e4,this.#ag="number"==typeof b?.cacheMaxAge?b?.cacheMaxAge:6e5,this.#aj=new Headers(b?.headers),d&&!this.#aj.has("User-Agent")&&this.#aj.set("User-Agent",d),this.#aj.has("accept")||(this.#aj.set("accept","application/json"),this.#aj.append("accept","application/jwk-set+json")),this.#ak=b?.[K],b?.[M]!==void 0&&(this.#am=b?.[M],function(a,b){return!("object"!=typeof a||null===a||!("uat"in a)||"number"!=typeof a.uat||Date.now()-a.uat>=b)&&"jwks"in a&&!!(0,u.A)(a.jwks)&&!!Array.isArray(a.jwks.keys)&&!!Array.prototype.every.call(a.jwks.keys,u.A)}(b?.[M],this.#ag)&&(this.#ah=this.#am.uat,this.#al=J(this.#am.jwks)))}pendingFetch(){return!!this.#ai}coolingDown(){return"number"==typeof this.#ah&&Date.now()<this.#ah+this.#af}fresh(){return"number"==typeof this.#ah&&Date.now()<this.#ah+this.#ag}jwks(){return this.#al?.jwks()}async getKey(a,b){this.#al&&this.fresh()||await this.reload();try{return await this.#al(a,b)}catch(c){if(c instanceof r.BT&&!1===this.coolingDown())return await this.reload(),this.#al(a,b);throw c}}async reload(){this.#ai&&("undefined"!=typeof WebSocketPair||"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||"undefined"!=typeof EdgeRuntime&&"vercel"===EdgeRuntime)&&(this.#ai=void 0),this.#ai||=L(this.#ad.href,this.#aj,AbortSignal.timeout(this.#ae),this.#ak).then(a=>{this.#al=J(a),this.#am&&(this.#am.uat=Date.now(),this.#am.jwks=a),this.#ah=Date.now(),this.#ai=void 0}).catch(a=>{throw this.#ai=void 0,a}),await this.#ai}}c(62767);var O=c(61287),P=c(74823),Q=c(5761),R=c(94324),S=c(92769),T=c(51067),U=c(8897);c(37305),c(33679),c(24340);var V=c(147),W=c(64515);function X(a){return"-"===a||"^"===a||"$"===a||"+"===a||"."===a||"("===a||")"===a||"|"===a||"["===a||"]"===a||"{"===a||"}"===a||"*"===a||"?"===a||"\\"===a?`\\${a}`:a}function Y(a,b){if("string"!=typeof b)throw TypeError(`Sample must be a string, but ${typeof b} given`);return a.test(b)}function Z(a,b){if("string"!=typeof a&&!Array.isArray(a))throw TypeError(`The first argument must be a single pattern string or an array of patterns, but ${typeof a} given`);if(("string"==typeof b||"boolean"==typeof b)&&(b={separator:b}),2==arguments.length&&!(void 0===b||"object"==typeof b&&null!==b&&!Array.isArray(b)))throw TypeError(`The second argument must be an options object or a string/boolean separator, but ${typeof b} given`);if("\\"===(b=b||{}).separator)throw Error("\\ is not a valid separator because it is used for escaping. Try setting the separator to `true` instead");let c=function a(b,c=!0){if(Array.isArray(b)){let d=b.map(b=>`^${a(b,c)}$`);return`(?:${d.join("|")})`}let d="",e="",f=".";!0===c?(d="/",e="[/\\\\]",f="[^/\\\\]"):c&&((e=function(a){let b="";for(let c=0;c<a.length;c++)b+=X(a[c]);return b}(d=c)).length>1?(e=`(?:${e})`,f=`((?!${e}).)`):f=`[^${e}]`);let g=c?`${e}+?`:"",h=c?`${e}*?`:"",i=c?b.split(d):[b],j="";for(let a=0;a<i.length;a++){let b=i[a],d=i[a+1],e="";if(b||!(a>0)){if(c&&(e=a===i.length-1?h:"**"!==d?g:""),c&&"**"===b){e&&(j+=0===a?"":e,j+=`(?:${f}*?${e})*?`);continue}for(let a=0;a<b.length;a++){let c=b[a];"\\"===c?a<b.length-1&&(j+=X(b[a+1]),a++):"?"===c?j+=f:"*"===c?j+=`${f}*?`:j+=X(c)}j+=e}}return j}(a,b.separator),d=RegExp(`^${c}$`,b.flags),e=Y.bind(null,d);return e.options=b,e.pattern=a,e.regexp=d,e}let $=(0,f.c)(async a=>{if(a.request?.method!=="POST"||!a.request)return;let{body:b,query:c,context:d}=a,e=a.headers?.get("origin")||a.headers?.get("referer")||"",f=b?.callbackURL||c?.callbackURL,h=b?.redirectTo,i=b?.errorCallbackURL,j=b?.newUserCallbackURL,k=Array.isArray(d.options.trustedOrigins)?d.trustedOrigins:[...d.trustedOrigins,...await d.options.trustedOrigins?.(a.request)||[]],l=a.headers?.has("cookie"),m=(b,c)=>{if(b&&!k.some(a=>((a,b)=>{if(a.startsWith("/"))return!1;if(b.includes("*"))return b.includes("://")?Z(b)((0,P.g)(a)||a):Z(b)((0,P.b)(a));let c=(0,P.c)(a);return"http:"!==c&&"https:"!==c&&c?a.startsWith(b):b===(0,P.g)(a)})(b,a)||b?.startsWith("/")&&"origin"!==c&&/^\/(?!\/|\\|%2f|%5c)[\w\-.\+/@]*(?:\?[\w\-.\+/=&%@]*)?$/.test(b)))throw a.context.logger.error(`Invalid ${c}: ${b}`),a.context.logger.info(`If it's a valid URL, please add ${b} to trustedOrigins in your auth config
`,`Current list of trustedOrigins: ${k}`),new g.LG("FORBIDDEN",{message:`Invalid ${c}`})};l&&!a.context.options.advanced?.disableCSRFCheck&&m(e,"origin"),f&&m(f,"callbackURL"),h&&m(h,"redirectURL"),i&&m(i,"errorCallbackURL"),j&&m(j,"newUserCallbackURL")}),_=a=>(0,f.c)(async b=>{if(!b.request)return;let{context:c}=b,d=a(b),e=Array.isArray(c.options.trustedOrigins)?c.trustedOrigins:[...c.trustedOrigins,...await c.options.trustedOrigins?.(b.request)||[]],f=(a,c)=>{if(a&&!e.some(b=>((a,b)=>{if(a.startsWith("/"))return!1;if(b.includes("*"))return b.includes("://")?Z(b)((0,P.g)(a)||a):Z(b)((0,P.b)(a));let c=(0,P.c)(a);return"http:"!==c&&"https:"!==c&&c?a.startsWith(b):b===(0,P.g)(a)})(a,b)||a?.startsWith("/")&&"origin"!==c&&/^\/(?!\/|\\|%2f|%5c)[\w\-.\+/@]*(?:\?[\w\-.\+/=&%@]*)?$/.test(a)))throw b.context.logger.error(`Invalid ${c}: ${a}`),b.context.logger.info(`If it's a valid URL, please add ${a} to trustedOrigins in your auth config
`,`Current list of trustedOrigins: ${e}`),new g.LG("FORBIDDEN",{message:`Invalid ${c}`})};for(let a of Array.isArray(d)?d:[d])f(a,"callbackURL")});async function aa(a,b,c,d=3600){return await (0,k.FA)({email:b.toLowerCase(),updateTo:c},a,d)}async function ab(a,b){if(!a.context.options.emailVerification?.sendVerificationEmail)throw a.context.logger.error("Verification email isn't enabled."),new g.LG("BAD_REQUEST",{message:"Verification email isn't enabled"});let c=await aa(a.context.secret,b.email,void 0,a.context.options.emailVerification?.expiresIn),d=`${a.context.baseURL}/verify-email?token=${c}&callbackURL=${a.body.callbackURL||"/"}`;await a.context.options.emailVerification.sendVerificationEmail({user:b,url:d,token:c},a.request)}let ac=(0,f.a)("/send-verification-email",{method:"POST",body:e.Ikc({email:e.Rpp().meta({description:"The email to send the verification email to"}),callbackURL:e.YjP().meta({description:"The URL to use for email verification callback"}).optional()}),metadata:{openapi:{description:"Send a verification email to the user",requestBody:{content:{"application/json":{schema:{type:"object",properties:{email:{type:"string",description:"The email to send the verification email to",example:"user@example.com"},callbackURL:{type:"string",description:"The URL to use for email verification callback",example:"https://example.com/callback",nullable:!0}},required:["email"]}}}},responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if the email was sent successfully",example:!0}}}}}},400:{description:"Bad Request",content:{"application/json":{schema:{type:"object",properties:{message:{type:"string",description:"Error message",example:"Verification email isn't enabled"}}}}}}}}}},async a=>{if(!a.context.options.emailVerification?.sendVerificationEmail)throw a.context.logger.error("Verification email isn't enabled."),new g.LG("BAD_REQUEST",{message:"Verification email isn't enabled"});let{email:b}=a.body,c=await (0,f.g)(a);if(!c){let c=await a.context.internalAdapter.findUserByEmail(b);return c&&await ab(a,c.user),a.json({status:!0})}if(c?.user.emailVerified)throw new g.LG("BAD_REQUEST",{message:"You can only send a verification email to an unverified email"});if(c?.user.email!==b)throw new g.LG("BAD_REQUEST",{message:"You can only send a verification email to your own email"});return await ab(a,c.user),a.json({status:!0})}),ad=(0,f.a)("/verify-email",{method:"GET",query:e.Ikc({token:e.YjP().meta({description:"The token to verify the email"}),callbackURL:e.YjP().meta({description:"The URL to redirect to after email verification"}).optional()}),use:[_(a=>a.query.callbackURL)],metadata:{openapi:{description:"Verify the email of the user",parameters:[{name:"token",in:"query",description:"The token to verify the email",required:!0,schema:{type:"string"}},{name:"callbackURL",in:"query",description:"The URL to redirect to after email verification",required:!1,schema:{type:"string"}}],responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{user:{type:"object",properties:{id:{type:"string",description:"User ID"},email:{type:"string",description:"User email"},name:{type:"string",description:"User name"},image:{type:"string",description:"User image URL"},emailVerified:{type:"boolean",description:"Indicates if the user email is verified"},createdAt:{type:"string",description:"User creation date"},updatedAt:{type:"string",description:"User update date"}},required:["id","email","name","image","emailVerified","createdAt","updatedAt"]},status:{type:"boolean",description:"Indicates if the email was verified successfully"}},required:["user","status"]}}}}}}}},async a=>{let b;function c(b){if(a.query.callbackURL){if(a.query.callbackURL.includes("?"))throw a.redirect(`${a.query.callbackURL}&error=${b}`);throw a.redirect(`${a.query.callbackURL}?error=${b}`)}throw new g.LG("UNAUTHORIZED",{message:b})}let{token:d}=a.query;try{b=await B(d,new TextEncoder().encode(a.context.secret),{algorithms:["HS256"]})}catch(a){if(a instanceof r.n)return c("token_expired");return c("invalid_token")}let h=e.Ikc({email:e.YjP().email(),updateTo:e.YjP().optional()}).parse(b.payload),i=await a.context.internalAdapter.findUserByEmail(h.email);if(!i)return c("user_not_found");if(h.updateTo){let b=await (0,f.g)(a);if(!b||b.user.email!==h.email){if(a.query.callbackURL)throw a.redirect(`${a.query.callbackURL}?error=unauthorized`);return c("unauthorized")}let d=await a.context.internalAdapter.updateUserByEmail(h.email,{email:h.updateTo,emailVerified:!1},a),e=await aa(a.context.secret,h.updateTo);if(await a.context.options.emailVerification?.sendVerificationEmail?.({user:d,url:`${a.context.baseURL}/verify-email?token=${e}&callbackURL=${a.query.callbackURL||"/"}`,token:e},a.request),await (0,Q.s)(a,{session:b.session,user:{...b.user,email:h.updateTo,emailVerified:!1}}),a.query.callbackURL)throw a.redirect(a.query.callbackURL);return a.json({status:!0,user:{id:d.id,email:d.email,name:d.name,image:d.image,emailVerified:d.emailVerified,createdAt:d.createdAt,updatedAt:d.updatedAt}})}a.context.options.emailVerification?.onEmailVerification&&await a.context.options.emailVerification.onEmailVerification(i.user,a.request);let j=await a.context.internalAdapter.updateUserByEmail(h.email,{emailVerified:!0},a);if(a.context.options.emailVerification?.afterEmailVerification&&await a.context.options.emailVerification.afterEmailVerification(j,a.request),a.context.options.emailVerification?.autoSignInAfterVerification){let b=await (0,f.g)(a);if(b&&b.user.email===h.email)await (0,Q.s)(a,{session:b.session,user:{...b.user,emailVerified:!0}});else{let b=await a.context.internalAdapter.createSession(i.user.id,a);if(!b)throw new g.LG("INTERNAL_SERVER_ERROR",{message:"Failed to create session"});await (0,Q.s)(a,{session:b,user:{...i.user,emailVerified:!0}})}}if(a.query.callbackURL)throw a.redirect(a.query.callbackURL);return a.json({status:!0,user:null})}),ae={isAction:!1};async function af(a,b){let c=a.body?.callbackURL||a.context.options.baseURL;if(!c)throw new g.LG("BAD_REQUEST",{message:"callbackURL is required"});let d=(0,O.g)(128),e=(0,O.g)(32),f=a.context.createAuthCookie("state",{maxAge:3e5});await a.setSignedCookie(f.name,e,a.context.secret,f.attributes);let h=JSON.stringify({callbackURL:c,codeVerifier:d,errorURL:a.body?.errorCallbackURL,newUserURL:a.body?.newUserCallbackURL,link:b,expiresAt:Date.now()+6e5,requestSignUp:a.body?.requestSignUp}),i=new Date;i.setMinutes(i.getMinutes()+10);let j=await a.context.internalAdapter.createVerificationValue({value:h,identifier:e,expiresAt:i},a);if(!j)throw a.context.logger.error("Unable to create verification. Make sure the database adapter is properly working and there is a verification table in the database"),new g.LG("INTERNAL_SERVER_ERROR",{message:"Unable to create verification"});return{state:j.identifier,codeVerifier:d}}async function ag(a){let b=a.query.state||a.body.state,c=await a.context.internalAdapter.findVerificationValue(b);if(!c){a.context.logger.error("State Mismatch. Verification not found",{state:b});let c=a.context.options.onAPIError?.errorURL||`${a.context.baseURL}/error`;throw a.redirect(`${c}?error=please_restart_the_process`)}let d=e.Ikc({callbackURL:e.YjP(),codeVerifier:e.YjP(),errorURL:e.YjP().optional(),newUserURL:e.YjP().optional(),expiresAt:e.aig(),link:e.Ikc({email:e.YjP(),userId:e.auy.string()}).optional(),requestSignUp:e.zMY().optional()}).parse(JSON.parse(c.value));d.errorURL||(d.errorURL=`${a.context.baseURL}/error`);let f=a.context.createAuthCookie("state"),g=await a.getSignedCookie(f.name,a.context.secret);if(!a.context.oauthConfig?.skipStateCookieCheck&&(!g||g!==b)){let b=a.context.options.onAPIError?.errorURL||`${a.context.baseURL}/error`;throw a.redirect(`${b}?error=state_mismatch`)}if(a.setCookie(f.name,"",{maxAge:0}),d.expiresAt<Date.now()){await a.context.internalAdapter.deleteVerificationValue(c.id);let b=a.context.options.onAPIError?.errorURL||`${a.context.baseURL}/error`;throw a.redirect(`${b}?error=please_restart_the_process`)}return await a.context.internalAdapter.deleteVerificationValue(c.id),d}async function ah(a){let b=await (0,i.n)("SHA-256").digest(a);return j.z.encode(new Uint8Array(b),{padding:!1})}function ai(a){return{tokenType:a.token_type,accessToken:a.access_token,refreshToken:a.refresh_token,accessTokenExpiresAt:a.expires_in?(0,h.g)(a.expires_in,"sec"):void 0,refreshTokenExpiresAt:a.refresh_token_expires_in?(0,h.g)(a.refresh_token_expires_in,"sec"):void 0,scopes:a?.scope?"string"==typeof a.scope?a.scope.split(" "):a.scope:[],idToken:a.id_token}}function aj(a,b){return b.options.account?.encryptOAuthTokens&&a?(0,k.vX)({key:b.secret,data:a}):a}async function ak(a,{userInfo:b,account:c,callbackURL:d,disableSignUp:e,overrideUserInfo:f}){let h=await a.context.internalAdapter.findOAuthUser(b.email.toLowerCase(),c.accountId,c.providerId).catch(b=>{R.a.error("Better auth was unable to query your database.\nError: ",b);let c=a.context.options.onAPIError?.errorURL||`${a.context.baseURL}/error`;throw a.redirect(`${c}?error=internal_server_error`)}),i=h?.user,j=!i;if(h){let d=h.accounts.find(a=>a.providerId===c.providerId&&a.accountId===c.accountId);if(d){if(a.context.options.account?.updateAccountOnSignIn!==!1){let b=Object.fromEntries(Object.entries({idToken:c.idToken,accessToken:await aj(c.accessToken,a.context),refreshToken:await aj(c.refreshToken,a.context),accessTokenExpiresAt:c.accessTokenExpiresAt,refreshTokenExpiresAt:c.refreshTokenExpiresAt,scope:c.scope}).filter(([a,b])=>void 0!==b));Object.keys(b).length>0&&await a.context.internalAdapter.updateAccount(d.id,b,a)}b.emailVerified&&!h.user.emailVerified&&b.email.toLowerCase()===h.user.email&&await a.context.internalAdapter.updateUser(h.user.id,{emailVerified:!0})}else{let d=a.context.options.account?.accountLinking?.trustedProviders;if(!d?.includes(c.providerId)&&!b.emailVerified||a.context.options.account?.accountLinking?.enabled===!1)return U.a&&R.a.warn(`User already exist but account isn't linked to ${c.providerId}. To read more about how account linking works in Better Auth see https://www.better-auth.com/docs/concepts/users-accounts#account-linking.`),{error:"account not linked",data:null};try{await a.context.internalAdapter.linkAccount({providerId:c.providerId,accountId:b.id.toString(),userId:h.user.id,accessToken:await aj(c.accessToken,a.context),refreshToken:await aj(c.refreshToken,a.context),idToken:c.idToken,accessTokenExpiresAt:c.accessTokenExpiresAt,refreshTokenExpiresAt:c.refreshTokenExpiresAt,scope:c.scope},a)}catch(a){return R.a.error("Unable to link account",a),{error:"unable to link account",data:null}}b.emailVerified&&!h.user.emailVerified&&b.email.toLowerCase()===h.user.email&&await a.context.internalAdapter.updateUser(h.user.id,{emailVerified:!0})}if(f){let{id:c,...d}=b;await a.context.internalAdapter.updateUser(h.user.id,{...d,email:b.email.toLowerCase(),emailVerified:b.email.toLowerCase()===h.user.email&&h.user.emailVerified||b.emailVerified})}}else{if(e)return{error:"signup disabled",data:null,isRegister:!1};try{let{id:e,...f}=b;if(i=await a.context.internalAdapter.createOAuthUser({...f,email:b.email.toLowerCase()},{accessToken:await aj(c.accessToken,a.context),refreshToken:await aj(c.refreshToken,a.context),idToken:c.idToken,accessTokenExpiresAt:c.accessTokenExpiresAt,refreshTokenExpiresAt:c.refreshTokenExpiresAt,scope:c.scope,providerId:c.providerId,accountId:b.id.toString()},a).then(a=>a?.user),!b.emailVerified&&i&&a.context.options.emailVerification?.sendOnSignUp){let b=await aa(a.context.secret,i.email,void 0,a.context.options.emailVerification?.expiresIn),c=`${a.context.baseURL}/verify-email?token=${b}&callbackURL=${d}`;await a.context.options.emailVerification?.sendVerificationEmail?.({user:i,url:c,token:b},a.request)}}catch(a){if(R.a.error(a),a instanceof g.LG)return{error:a.message,data:null,isRegister:!1};return{error:"unable to create user",data:null,isRegister:!1}}}if(!i)return{error:"unable to create user",data:null,isRegister:!1};let k=await a.context.internalAdapter.createSession(i.id,a);return k?{data:{session:k,user:i},error:null,isRegister:j}:{error:"unable to create session",data:null,isRegister:!1}}async function al({id:a,options:b,authorizationEndpoint:c,state:d,codeVerifier:e,scopes:f,claims:g,redirectURI:h,duration:i,prompt:j,accessType:k,responseType:l,display:m,loginHint:n,hd:o,responseMode:p,additionalParams:q,scopeJoiner:r}){let s=new URL(c);s.searchParams.set("response_type",l||"code");let t=Array.isArray(b.clientId)?b.clientId[0]:b.clientId;if(s.searchParams.set("client_id",t),s.searchParams.set("state",d),s.searchParams.set("scope",f.join(r||" ")),s.searchParams.set("redirect_uri",b.redirectURI||h),i&&s.searchParams.set("duration",i),m&&s.searchParams.set("display",m),n&&s.searchParams.set("login_hint",n),j&&s.searchParams.set("prompt",j),o&&s.searchParams.set("hd",o),k&&s.searchParams.set("access_type",k),p&&s.searchParams.set("response_mode",p),e){let a=await ah(e);s.searchParams.set("code_challenge_method","S256"),s.searchParams.set("code_challenge",a)}if(g){let a=g.reduce((a,b)=>(a[b]=null,a),{});s.searchParams.set("claims",JSON.stringify({id_token:{email:null,email_verified:null,...a}}))}return q&&Object.entries(q).forEach(([a,b])=>{s.searchParams.set(a,b)}),s}async function am({code:a,codeVerifier:b,redirectURI:c,options:d,tokenEndpoint:e,authentication:f,deviceId:g,headers:h,additionalParams:i={},resource:k}){let{body:m,headers:n}=function({code:a,codeVerifier:b,redirectURI:c,options:d,authentication:e,deviceId:f,headers:g,additionalParams:h={},resource:i}){let k=new URLSearchParams,l={"content-type":"application/x-www-form-urlencoded",accept:"application/json","user-agent":"better-auth",...g};if(k.set("grant_type","authorization_code"),k.set("code",a),b&&k.set("code_verifier",b),d.clientKey&&k.set("client_key",d.clientKey),f&&k.set("device_id",f),k.set("redirect_uri",d.redirectURI||c),i)if("string"==typeof i)k.append("resource",i);else for(let a of i)k.append("resource",a);if("basic"===e){let a=Array.isArray(d.clientId)?d.clientId[0]:d.clientId,b=j.K.encode(`${a}:${d.clientSecret??""}`);l.authorization=`Basic ${b}`}else{let a=Array.isArray(d.clientId)?d.clientId[0]:d.clientId;k.set("client_id",a),d.clientSecret&&k.set("client_secret",d.clientSecret)}for(let[a,b]of Object.entries(h))k.has(a)||k.append(a,b);return{body:k,headers:l}}({code:a,codeVerifier:b,redirectURI:c,options:d,authentication:f,deviceId:g,headers:h,additionalParams:i,resource:k}),{data:o,error:p}=await (0,l.zZ)(e,{method:"POST",body:m,headers:n});if(p)throw p;return ai(o)}async function an({refreshToken:a,options:b,tokenEndpoint:c,authentication:d,extraParams:e}){let{body:f,headers:g}=function({refreshToken:a,options:b,authentication:c,extraParams:d,resource:e}){let f=new URLSearchParams,g={"content-type":"application/x-www-form-urlencoded",accept:"application/json"};if(f.set("grant_type","refresh_token"),f.set("refresh_token",a),"basic"===c){let a=Array.isArray(b.clientId)?b.clientId[0]:b.clientId;a?g.authorization="Basic "+j.K.encode(`${a}:${b.clientSecret??""}`):g.authorization="Basic "+j.K.encode(`:${b.clientSecret??""}`)}else{let a=Array.isArray(b.clientId)?b.clientId[0]:b.clientId;f.set("client_id",a),b.clientSecret&&f.set("client_secret",b.clientSecret)}if(e)if("string"==typeof e)f.append("resource",e);else for(let a of e)f.append("resource",a);if(d)for(let[a,b]of Object.entries(d))f.set(a,b);return{body:f,headers:g}}({refreshToken:a,options:b,authentication:d,extraParams:e}),{data:h,error:i}=await (0,l.zZ)(c,{method:"POST",body:f,headers:g});if(i)throw i;let k={accessToken:h.access_token,refreshToken:h.refresh_token,tokenType:h.token_type,scopes:h.scope?.split(" "),idToken:h.id_token};return h.expires_in&&(k.accessTokenExpiresAt=new Date(new Date().getTime()+1e3*h.expires_in)),k}let ao=async a=>{let{data:b}=await (0,l.zZ)("https://appleid.apple.com/auth/keys");if(!b?.keys)throw new g.LG("BAD_REQUEST",{message:"Keys not found"});let c=b.keys.find(b=>b.kid===a);if(!c)throw Error(`JWK with kid ${a} not found`);return await F(c,c.alg)},ap=async(a,b,c)=>{let d=`https://cognito-idp.${b}.amazonaws.com/${c}/.well-known/jwks.json`;try{let{data:b}=await (0,l.zZ)(d);if(!b?.keys)throw new g.LG("BAD_REQUEST",{message:"Keys not found"});let c=b.keys.find(b=>b.kid===a);if(!c)throw Error(`JWK with kid ${a} not found`);return await F(c,c.alg)}catch(a){throw R.a.error("Failed to fetch Cognito public key:",a),a}},aq=(a="")=>a.split("://").map(a=>a.replace(/\/{2,}/g,"/")).join("://"),ar={apple:a=>({id:"apple",name:"Apple",async createAuthorizationURL({state:b,scopes:c,redirectURI:d}){let e=a.disableDefaultScope?[]:["email","name"];return a.scope&&e.push(...a.scope),c&&e.push(...c),await al({id:"apple",options:a,authorizationEndpoint:"https://appleid.apple.com/auth/authorize",scopes:e,state:b,redirectURI:d,responseMode:"form_post",responseType:"code id_token"})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d})=>am({code:b,codeVerifier:c,redirectURI:d,options:a,tokenEndpoint:"https://appleid.apple.com/auth/token"}),async verifyIdToken(b,c){if(a.disableIdTokenSignIn)return!1;if(a.verifyIdToken)return a.verifyIdToken(b,c);let{kid:d,alg:e}=C(b);if(!d||!e)return!1;let f=await ao(d),{payload:g}=await B(b,f,{algorithms:[e],issuer:"https://appleid.apple.com",audience:a.audience&&a.audience.length?a.audience:a.appBundleIdentifier?a.appBundleIdentifier:a.clientId,maxTokenAge:"1h"});return["email_verified","is_private_email"].forEach(a=>{void 0!==g[a]&&(g[a]=!!g[a])}),(!c||g.nonce===c)&&!!g},refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>an({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://appleid.apple.com/auth/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);if(!b.idToken)return null;let c=D(b.idToken);if(!c)return null;let d=b.user?`${b.user.name?.firstName} ${b.user.name?.lastName}`:c.name||c.email,e="boolean"==typeof c.email_verified?c.email_verified:"true"===c.email_verified,f={...c,name:d},g=await a.mapProfileToUser?.(f);return{user:{id:c.sub,name:f.name,emailVerified:e,email:c.email,...g},data:f}},options:a}),atlassian:a=>({id:"atlassian",name:"Atlassian",async createAuthorizationURL({state:b,scopes:c,codeVerifier:d,redirectURI:e}){if(!a.clientId||!a.clientSecret)throw R.a.error("Client Id and Secret are required for Atlassian"),new W.B("CLIENT_ID_AND_SECRET_REQUIRED");if(!d)throw new W.B("codeVerifier is required for Atlassian");let f=a.disableDefaultScope?[]:["read:jira-user","offline_access"];return a.scope&&f.push(...a.scope),c&&f.push(...c),al({id:"atlassian",options:a,authorizationEndpoint:"https://auth.atlassian.com/authorize",scopes:f,state:b,codeVerifier:d,redirectURI:e,additionalParams:{audience:"api.atlassian.com"},prompt:a.prompt})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d})=>am({code:b,codeVerifier:c,redirectURI:d,options:a,tokenEndpoint:"https://auth.atlassian.com/oauth/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>an({refreshToken:b,options:{clientId:a.clientId,clientSecret:a.clientSecret},tokenEndpoint:"https://auth.atlassian.com/oauth/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);if(!b.accessToken)return null;try{let{data:c}=await (0,l.zZ)("https://api.atlassian.com/me",{headers:{Authorization:`Bearer ${b.accessToken}`}});if(!c)return null;let d=await a.mapProfileToUser?.(c);return{user:{id:c.account_id,name:c.name,email:c.email,image:c.picture,emailVerified:!1,...d},data:c}}catch(a){return R.a.error("Failed to fetch user info from Figma:",a),null}},options:a}),cognito:a=>{if(!a.domain||!a.region||!a.userPoolId)throw R.a.error("Domain, region and userPoolId are required for Amazon Cognito. Make sure to provide them in the options."),new W.B("DOMAIN_AND_REGION_REQUIRED");let b=a.domain.replace(/^https?:\/\//,""),c=`https://${b}/oauth2/authorize`,d=`https://${b}/oauth2/token`,e=`https://${b}/oauth2/userinfo`;return{id:"cognito",name:"Cognito",async createAuthorizationURL({state:b,scopes:d,codeVerifier:e,redirectURI:f}){if(!a.clientId)throw R.a.error("ClientId is required for Amazon Cognito. Make sure to provide them in the options."),new W.B("CLIENT_ID_AND_SECRET_REQUIRED");if(a.requireClientSecret&&!a.clientSecret)throw R.a.error("Client Secret is required when requireClientSecret is true. Make sure to provide it in the options."),new W.B("CLIENT_SECRET_REQUIRED");let g=a.disableDefaultScope?[]:["openid","profile","email"];return a.scope&&g.push(...a.scope),d&&g.push(...d),await al({id:"cognito",options:{...a},authorizationEndpoint:c,scopes:g,state:b,codeVerifier:e,redirectURI:f,prompt:a.prompt})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:e})=>am({code:b,codeVerifier:c,redirectURI:e,options:a,tokenEndpoint:d}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>an({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:d}),async verifyIdToken(b,c){if(a.disableIdTokenSignIn)return!1;if(a.verifyIdToken)return a.verifyIdToken(b,c);try{let{kid:d,alg:e}=C(b);if(!d||!e)return!1;let f=await ap(d,a.region,a.userPoolId),g=`https://cognito-idp.${a.region}.amazonaws.com/${a.userPoolId}`,{payload:h}=await B(b,f,{algorithms:[e],issuer:g,audience:a.clientId,maxTokenAge:"1h"});if(c&&h.nonce!==c)return!1;return!0}catch(a){return R.a.error("Failed to verify ID token:",a),!1}},async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);if(b.idToken)try{let c=D(b.idToken);if(!c)return null;let d=c.name||c.given_name||c.username||c.email,e={...c,name:d},f=await a.mapProfileToUser?.(e);return{user:{id:c.sub,name:e.name,email:c.email,image:c.picture,emailVerified:c.email_verified,...f},data:e}}catch(a){R.a.error("Failed to decode ID token:",a)}if(b.accessToken)try{let{data:c}=await (0,l.zZ)(e,{headers:{Authorization:`Bearer ${b.accessToken}`}});if(c){let b=await a.mapProfileToUser?.(c);return{user:{id:c.sub,name:c.name||c.given_name||c.username,email:c.email,image:c.picture,emailVerified:c.email_verified,...b},data:c}}}catch(a){R.a.error("Failed to fetch user info from Cognito:",a)}return null},options:a}},discord:a=>({id:"discord",name:"Discord",createAuthorizationURL({state:b,scopes:c,redirectURI:d}){let e=a.disableDefaultScope?[]:["identify","email"];c&&e.push(...c),a.scope&&e.push(...a.scope);let f=e.includes("bot")&&void 0!==a.permissions?`&permissions=${a.permissions}`:"";return new URL(`https://discord.com/api/oauth2/authorize?scope=${e.join("+")}&response_type=code&client_id=${a.clientId}&redirect_uri=${encodeURIComponent(a.redirectURI||d)}&state=${b}&prompt=${a.prompt||"none"}${f}`)},validateAuthorizationCode:async({code:b,redirectURI:c})=>am({code:b,redirectURI:c,options:a,tokenEndpoint:"https://discord.com/api/oauth2/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>an({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://discord.com/api/oauth2/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await (0,l.zZ)("https://discord.com/api/users/@me",{headers:{authorization:`Bearer ${b.accessToken}`}});if(d)return null;if(null===c.avatar){let a="0"===c.discriminator?Number(BigInt(c.id)>>BigInt(22))%6:parseInt(c.discriminator)%5;c.image_url=`https://cdn.discordapp.com/embed/avatars/${a}.png`}else{let a=c.avatar.startsWith("a_")?"gif":"png";c.image_url=`https://cdn.discordapp.com/avatars/${c.id}/${c.avatar}.${a}`}let e=await a.mapProfileToUser?.(c);return{user:{id:c.id,name:c.global_name||c.username||"",email:c.email,emailVerified:c.verified,image:c.image_url,...e},data:c}},options:a}),facebook:a=>({id:"facebook",name:"Facebook",async createAuthorizationURL({state:b,scopes:c,redirectURI:d,loginHint:e}){let f=a.disableDefaultScope?[]:["email","public_profile"];return a.scope&&f.push(...a.scope),c&&f.push(...c),await al({id:"facebook",options:a,authorizationEndpoint:"https://www.facebook.com/v21.0/dialog/oauth",scopes:f,state:b,redirectURI:d,loginHint:e,additionalParams:a.configId?{config_id:a.configId}:{}})},validateAuthorizationCode:async({code:b,redirectURI:c})=>am({code:b,redirectURI:c,options:a,tokenEndpoint:"https://graph.facebook.com/oauth/access_token"}),async verifyIdToken(b,c){if(a.disableIdTokenSignIn)return!1;if(a.verifyIdToken)return a.verifyIdToken(b,c);if(3===b.split(".").length)try{let{payload:d}=await B(b,function(a,b){let c=new N(a,void 0),d=async(a,b)=>c.getKey(a,b);return Object.defineProperties(d,{coolingDown:{get:()=>c.coolingDown(),enumerable:!0,configurable:!1},fresh:{get:()=>c.fresh(),enumerable:!0,configurable:!1},reload:{value:()=>c.reload(),enumerable:!0,configurable:!1,writable:!1},reloading:{get:()=>c.pendingFetch(),enumerable:!0,configurable:!1},jwks:{value:()=>c.jwks(),enumerable:!0,configurable:!1,writable:!1}}),d}(new URL("https://limited.facebook.com/.well-known/oauth/openid/jwks/")),{algorithms:["RS256"],audience:a.clientId,issuer:"https://www.facebook.com"});if(c&&d.nonce!==c)return!1;return!!d}catch(a){return!1}return!0},refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>an({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://graph.facebook.com/v18.0/oauth/access_token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);if(b.idToken&&3===b.idToken.split(".").length){let c=D(b.idToken),d={id:c.sub,name:c.name,email:c.email,picture:{data:{url:c.picture,height:100,width:100,is_silhouette:!1}}},e=await a.mapProfileToUser?.({...d,email_verified:!0});return{user:{...d,emailVerified:!0,...e},data:c}}let c=["id","name","email","picture",...a?.fields||[]],{data:d,error:e}=await (0,l.zZ)("https://graph.facebook.com/me?fields="+c.join(","),{auth:{type:"Bearer",token:b.accessToken}});if(e)return null;let f=await a.mapProfileToUser?.(d);return{user:{id:d.id,name:d.name,email:d.email,image:d.picture.data.url,emailVerified:d.email_verified,...f},data:d}},options:a}),figma:a=>({id:"figma",name:"Figma",async createAuthorizationURL({state:b,scopes:c,codeVerifier:d,redirectURI:e}){if(!a.clientId||!a.clientSecret)throw R.a.error("Client Id and Client Secret are required for Figma. Make sure to provide them in the options."),new W.B("CLIENT_ID_AND_SECRET_REQUIRED");if(!d)throw new W.B("codeVerifier is required for Figma");let f=a.disableDefaultScope?[]:["file_read"];return a.scope&&f.push(...a.scope),c&&f.push(...c),await al({id:"figma",options:a,authorizationEndpoint:"https://www.figma.com/oauth",scopes:f,state:b,codeVerifier:d,redirectURI:e})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d})=>am({code:b,codeVerifier:c,redirectURI:d,options:a,tokenEndpoint:"https://www.figma.com/api/oauth/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>an({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://www.figma.com/api/oauth/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);try{let{data:c}=await (0,l.zZ)("https://api.figma.com/v1/me",{headers:{Authorization:`Bearer ${b.accessToken}`}});if(!c)return R.a.error("Failed to fetch user from Figma"),null;let d=await a.mapProfileToUser?.(c);return{user:{id:c.id,name:c.handle,email:c.email,image:c.img_url,emailVerified:!!c.email,...d},data:c}}catch(a){return R.a.error("Failed to fetch user info from Figma:",a),null}},options:a}),github:a=>({id:"github",name:"GitHub",createAuthorizationURL({state:b,scopes:c,loginHint:d,redirectURI:e}){let f=a.disableDefaultScope?[]:["read:user","user:email"];return a.scope&&f.push(...a.scope),c&&f.push(...c),al({id:"github",options:a,authorizationEndpoint:"https://github.com/login/oauth/authorize",scopes:f,state:b,redirectURI:e,loginHint:d,prompt:a.prompt})},validateAuthorizationCode:async({code:b,redirectURI:c})=>am({code:b,redirectURI:c,options:a,tokenEndpoint:"https://github.com/login/oauth/access_token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>an({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://github.com/login/oauth/access_token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await (0,l.zZ)("https://api.github.com/user",{headers:{"User-Agent":"better-auth",authorization:`Bearer ${b.accessToken}`}});if(d)return null;let{data:e}=await (0,l.zZ)("https://api.github.com/user/emails",{headers:{Authorization:`Bearer ${b.accessToken}`,"User-Agent":"better-auth"}});!c.email&&e&&(c.email=(e.find(a=>a.primary)??e[0])?.email);let f=e?.find(a=>a.email===c.email)?.verified??!1,g=await a.mapProfileToUser?.(c);return{user:{id:c.id,name:c.name||c.login,email:c.email,image:c.avatar_url,emailVerified:f,...g},data:c}},options:a}),microsoft:a=>{let b=a.tenantId||"common",c=a.authority||"https://login.microsoftonline.com",d=`${c}/${b}/oauth2/v2.0/authorize`,e=`${c}/${b}/oauth2/v2.0/token`;return{id:"microsoft",name:"Microsoft EntraID",createAuthorizationURL(b){let c=a.disableDefaultScope?[]:["openid","profile","email","User.Read","offline_access"];return a.scope&&c.push(...a.scope),b.scopes&&c.push(...b.scopes),al({id:"microsoft",options:a,authorizationEndpoint:d,state:b.state,codeVerifier:b.codeVerifier,scopes:c,redirectURI:b.redirectURI,prompt:a.prompt,loginHint:b.loginHint})},validateAuthorizationCode:({code:b,codeVerifier:c,redirectURI:d})=>am({code:b,codeVerifier:c,redirectURI:d,options:a,tokenEndpoint:e}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);if(!b.idToken)return null;let c=D(b.idToken),d=a.profilePhotoSize||48;await (0,l.zZ)(`https://graph.microsoft.com/v1.0/me/photos/${d}x${d}/$value`,{headers:{Authorization:`Bearer ${b.accessToken}`},async onResponse(b){if(!a.disableProfilePhoto&&b.response.ok)try{let a=b.response.clone(),d=await a.arrayBuffer(),e=j.K.encode(d);c.picture=`data:image/jpeg;base64, ${e}`}catch(a){R.a.error(a&&"object"==typeof a&&"name"in a?a.name:"",a)}}});let e=await a.mapProfileToUser?.(c);return{user:{id:c.sub,name:c.name,email:c.email,image:c.picture,emailVerified:!0,...e},data:c}},refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>{let c=a.disableDefaultScope?[]:["openid","profile","email","User.Read","offline_access"];return a.scope&&c.push(...a.scope),an({refreshToken:b,options:{clientId:a.clientId,clientSecret:a.clientSecret},extraParams:{scope:c.join(" ")},tokenEndpoint:e})},options:a}},google:a=>({id:"google",name:"Google",async createAuthorizationURL({state:b,scopes:c,codeVerifier:d,redirectURI:e,loginHint:f,display:g}){if(!a.clientId||!a.clientSecret)throw R.a.error("Client Id and Client Secret is required for Google. Make sure to provide them in the options."),new W.B("CLIENT_ID_AND_SECRET_REQUIRED");if(!d)throw new W.B("codeVerifier is required for Google");let h=a.disableDefaultScope?[]:["email","profile","openid"];return a.scope&&h.push(...a.scope),c&&h.push(...c),await al({id:"google",options:a,authorizationEndpoint:"https://accounts.google.com/o/oauth2/auth",scopes:h,state:b,codeVerifier:d,redirectURI:e,prompt:a.prompt,accessType:a.accessType,display:g||a.display,loginHint:f,hd:a.hd,additionalParams:{include_granted_scopes:"true"}})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d})=>am({code:b,codeVerifier:c,redirectURI:d,options:a,tokenEndpoint:"https://oauth2.googleapis.com/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>an({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://www.googleapis.com/oauth2/v4/token"}),async verifyIdToken(b,c){if(a.disableIdTokenSignIn)return!1;if(a.verifyIdToken)return a.verifyIdToken(b,c);let d=`https://www.googleapis.com/oauth2/v3/tokeninfo?id_token=${b}`,{data:e}=await (0,l.zZ)(d);return!!e&&e.aud===a.clientId&&("https://accounts.google.com"===e.iss||"accounts.google.com"===e.iss)},async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);if(!b.idToken)return null;let c=D(b.idToken),d=await a.mapProfileToUser?.(c);return{user:{id:c.sub,name:c.name,email:c.email,image:c.picture,emailVerified:c.email_verified,...d},data:c}},options:a}),huggingface:a=>({id:"huggingface",name:"Hugging Face",createAuthorizationURL({state:b,scopes:c,codeVerifier:d,redirectURI:e}){let f=a.disableDefaultScope?[]:["openid","profile","email"];return a.scope&&f.push(...a.scope),c&&f.push(...c),al({id:"huggingface",options:a,authorizationEndpoint:"https://huggingface.co/oauth/authorize",scopes:f,state:b,codeVerifier:d,redirectURI:e})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d})=>am({code:b,codeVerifier:c,redirectURI:d,options:a,tokenEndpoint:"https://huggingface.co/oauth/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>an({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://huggingface.co/oauth/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await (0,l.zZ)("https://huggingface.co/oauth/userinfo",{method:"GET",headers:{Authorization:`Bearer ${b.accessToken}`}});if(d)return null;let e=await a.mapProfileToUser?.(c);return{user:{id:c.sub,name:c.name||c.preferred_username,email:c.email,image:c.picture,emailVerified:c.email_verified??!1,...e},data:c}},options:a}),slack:a=>({id:"slack",name:"Slack",createAuthorizationURL({state:b,scopes:c,redirectURI:d}){let e=a.disableDefaultScope?[]:["openid","profile","email"];c&&e.push(...c),a.scope&&e.push(...a.scope);let f=new URL("https://slack.com/openid/connect/authorize");return f.searchParams.set("scope",e.join(" ")),f.searchParams.set("response_type","code"),f.searchParams.set("client_id",a.clientId),f.searchParams.set("redirect_uri",a.redirectURI||d),f.searchParams.set("state",b),f},validateAuthorizationCode:async({code:b,redirectURI:c})=>am({code:b,redirectURI:c,options:a,tokenEndpoint:"https://slack.com/api/openid.connect.token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>an({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://slack.com/api/openid.connect.token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await (0,l.zZ)("https://slack.com/api/openid.connect.userInfo",{headers:{authorization:`Bearer ${b.accessToken}`}});if(d)return null;let e=await a.mapProfileToUser?.(c);return{user:{id:c["https://slack.com/user_id"],name:c.name||"",email:c.email,emailVerified:c.email_verified,image:c.picture||c["https://slack.com/user_image_512"],...e},data:c}},options:a}),spotify:a=>({id:"spotify",name:"Spotify",createAuthorizationURL({state:b,scopes:c,codeVerifier:d,redirectURI:e}){let f=a.disableDefaultScope?[]:["user-read-email"];return a.scope&&f.push(...a.scope),c&&f.push(...c),al({id:"spotify",options:a,authorizationEndpoint:"https://accounts.spotify.com/authorize",scopes:f,state:b,codeVerifier:d,redirectURI:e})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d})=>am({code:b,codeVerifier:c,redirectURI:d,options:a,tokenEndpoint:"https://accounts.spotify.com/api/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>an({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://accounts.spotify.com/api/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await (0,l.zZ)("https://api.spotify.com/v1/me",{method:"GET",headers:{Authorization:`Bearer ${b.accessToken}`}});if(d)return null;let e=await a.mapProfileToUser?.(c);return{user:{id:c.id,name:c.display_name,email:c.email,image:c.images[0]?.url,emailVerified:!1,...e},data:c}},options:a}),twitch:a=>({id:"twitch",name:"Twitch",createAuthorizationURL({state:b,scopes:c,redirectURI:d}){let e=a.disableDefaultScope?[]:["user:read:email","openid"];return a.scope&&e.push(...a.scope),c&&e.push(...c),al({id:"twitch",redirectURI:d,options:a,authorizationEndpoint:"https://id.twitch.tv/oauth2/authorize",scopes:e,state:b,claims:a.claims||["email","email_verified","preferred_username","picture"]})},validateAuthorizationCode:async({code:b,redirectURI:c})=>am({code:b,redirectURI:c,options:a,tokenEndpoint:"https://id.twitch.tv/oauth2/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>an({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://id.twitch.tv/oauth2/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let c=b.idToken;if(!c)return R.a.error("No idToken found in token"),null;let d=D(c),e=await a.mapProfileToUser?.(d);return{user:{id:d.sub,name:d.preferred_username,email:d.email,image:d.picture,emailVerified:d.email_verified,...e},data:d}},options:a}),twitter:a=>({id:"twitter",name:"Twitter",createAuthorizationURL(b){let c=a.disableDefaultScope?[]:["users.read","tweet.read","offline.access","users.email"];return a.scope&&c.push(...a.scope),b.scopes&&c.push(...b.scopes),al({id:"twitter",options:a,authorizationEndpoint:"https://x.com/i/oauth2/authorize",scopes:c,state:b.state,codeVerifier:b.codeVerifier,redirectURI:b.redirectURI})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d})=>am({code:b,codeVerifier:c,authentication:"basic",redirectURI:d,options:a,tokenEndpoint:"https://api.x.com/2/oauth2/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>an({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},authentication:"basic",tokenEndpoint:"https://api.x.com/2/oauth2/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await (0,l.zZ)("https://api.x.com/2/users/me?user.fields=profile_image_url",{method:"GET",headers:{Authorization:`Bearer ${b.accessToken}`}});if(d)return null;let{data:e,error:f}=await (0,l.zZ)("https://api.x.com/2/users/me?user.fields=confirmed_email",{method:"GET",headers:{Authorization:`Bearer ${b.accessToken}`}}),g=!1;!f&&e?.data?.confirmed_email&&(c.data.email=e.data.confirmed_email,g=!0);let h=await a.mapProfileToUser?.(c);return{user:{id:c.data.id,name:c.data.name,email:c.data.email||c.data.username||null,image:c.data.profile_image_url,emailVerified:g,...h},data:c}},options:a}),dropbox:a=>({id:"dropbox",name:"Dropbox",createAuthorizationURL:async({state:b,scopes:c,codeVerifier:d,redirectURI:e})=>{let f=a.disableDefaultScope?[]:["account_info.read"];a.scope&&f.push(...a.scope),c&&f.push(...c);let g={};return a.accessType&&(g.token_access_type=a.accessType),await al({id:"dropbox",options:a,authorizationEndpoint:"https://www.dropbox.com/oauth2/authorize",scopes:f,state:b,redirectURI:e,codeVerifier:d,additionalParams:g})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d})=>await am({code:b,codeVerifier:c,redirectURI:d,options:a,tokenEndpoint:"https://api.dropboxapi.com/oauth2/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>an({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://api.dropbox.com/oauth2/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await (0,l.zZ)("https://api.dropboxapi.com/2/users/get_current_account",{method:"POST",headers:{Authorization:`Bearer ${b.accessToken}`}});if(d)return null;let e=await a.mapProfileToUser?.(c);return{user:{id:c.account_id,name:c.name?.display_name,email:c.email,emailVerified:c.email_verified||!1,image:c.profile_photo_url,...e},data:c}},options:a}),kick:a=>({id:"kick",name:"Kick",createAuthorizationURL({state:b,scopes:c,redirectURI:d,codeVerifier:e}){let f=a.disableDefaultScope?[]:["user:read"];return a.scope&&f.push(...a.scope),c&&f.push(...c),al({id:"kick",redirectURI:d,options:a,authorizationEndpoint:"https://id.kick.com/oauth/authorize",scopes:f,codeVerifier:e,state:b})},validateAuthorizationCode:async({code:b,redirectURI:c,codeVerifier:d})=>am({code:b,redirectURI:c,options:a,tokenEndpoint:"https://id.kick.com/oauth/token",codeVerifier:d}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await (0,l.zZ)("https://api.kick.com/public/v1/users",{method:"GET",headers:{Authorization:`Bearer ${b.accessToken}`}});if(d)return null;let e=c.data[0],f=await a.mapProfileToUser?.(e);return{user:{id:e.user_id,name:e.name,email:e.email,image:e.profile_picture,emailVerified:!0,...f},data:e}},options:a}),linear:a=>{let b="https://api.linear.app/oauth/token";return{id:"linear",name:"Linear",createAuthorizationURL({state:b,scopes:c,loginHint:d,redirectURI:e}){let f=a.disableDefaultScope?[]:["read"];return a.scope&&f.push(...a.scope),c&&f.push(...c),al({id:"linear",options:a,authorizationEndpoint:"https://linear.app/oauth/authorize",scopes:f,state:b,redirectURI:e,loginHint:d})},validateAuthorizationCode:async({code:c,redirectURI:d})=>am({code:c,redirectURI:d,options:a,tokenEndpoint:b}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async c=>an({refreshToken:c,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:b}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await (0,l.zZ)("https://api.linear.app/graphql",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b.accessToken}`},body:JSON.stringify({query:`
							query {
								viewer {
									id
									name
									email
									avatarUrl
									active
									createdAt
									updatedAt
								}
							}
						`})});if(d||!c?.data?.viewer)return null;let e=c.data.viewer,f=await a.mapProfileToUser?.(e);return{user:{id:c.data.viewer.id,name:c.data.viewer.name,email:c.data.viewer.email,image:c.data.viewer.avatarUrl,emailVerified:!0,...f},data:e}},options:a}},linkedin:a=>{let b="https://www.linkedin.com/oauth/v2/accessToken";return{id:"linkedin",name:"Linkedin",createAuthorizationURL:async({state:b,scopes:c,redirectURI:d,loginHint:e})=>{let f=a.disableDefaultScope?[]:["profile","email","openid"];return a.scope&&f.push(...a.scope),c&&f.push(...c),await al({id:"linkedin",options:a,authorizationEndpoint:"https://www.linkedin.com/oauth/v2/authorization",scopes:f,state:b,loginHint:e,redirectURI:d})},validateAuthorizationCode:async({code:c,redirectURI:d})=>await am({code:c,redirectURI:d,options:a,tokenEndpoint:b}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async c=>an({refreshToken:c,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:b}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await (0,l.zZ)("https://api.linkedin.com/v2/userinfo",{method:"GET",headers:{Authorization:`Bearer ${b.accessToken}`}});if(d)return null;let e=await a.mapProfileToUser?.(c);return{user:{id:c.sub,name:c.name,email:c.email,emailVerified:c.email_verified||!1,image:c.picture,...e},data:c}},options:a}},gitlab:a=>{let{authorizationEndpoint:b,tokenEndpoint:c,userinfoEndpoint:d}=(a=>{let b=a||"https://gitlab.com";return{authorizationEndpoint:aq(`${b}/oauth/authorize`),tokenEndpoint:aq(`${b}/oauth/token`),userinfoEndpoint:aq(`${b}/api/v4/user`)}})(a.issuer),e="gitlab";return{id:e,name:"Gitlab",createAuthorizationURL:async({state:c,scopes:d,codeVerifier:f,loginHint:g,redirectURI:h})=>{let i=a.disableDefaultScope?[]:["read_user"];return a.scope&&i.push(...a.scope),d&&i.push(...d),await al({id:e,options:a,authorizationEndpoint:b,scopes:i,state:c,redirectURI:h,codeVerifier:f,loginHint:g})},validateAuthorizationCode:async({code:b,redirectURI:d,codeVerifier:e})=>am({code:b,redirectURI:d,options:a,codeVerifier:e,tokenEndpoint:c}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>an({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://gitlab.com/oauth/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:e}=await (0,l.zZ)(d,{headers:{authorization:`Bearer ${b.accessToken}`}});if(e||"active"!==c.state||c.locked)return null;let f=await a.mapProfileToUser?.(c);return{user:{id:c.id,name:c.name??c.username,email:c.email,image:c.avatar_url,emailVerified:!0,...f},data:c}},options:a}},tiktok:a=>({id:"tiktok",name:"TikTok",createAuthorizationURL({state:b,scopes:c,redirectURI:d}){let e=a.disableDefaultScope?[]:["user.info.profile"];return a.scope&&e.push(...a.scope),c&&e.push(...c),new URL(`https://www.tiktok.com/v2/auth/authorize?scope=${e.join(",")}&response_type=code&client_key=${a.clientKey}&redirect_uri=${encodeURIComponent(a.redirectURI||d)}&state=${b}`)},validateAuthorizationCode:async({code:b,redirectURI:c})=>am({code:b,redirectURI:a.redirectURI||c,options:{clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://open.tiktokapis.com/v2/oauth/token/"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>an({refreshToken:b,options:{clientSecret:a.clientSecret},tokenEndpoint:"https://open.tiktokapis.com/v2/oauth/token/",authentication:"post",extraParams:{client_key:a.clientKey}}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await (0,l.zZ)("https://open.tiktokapis.com/v2/user/info/?fields=open_id,avatar_large_url,display_name,username",{headers:{authorization:`Bearer ${b.accessToken}`}});return d?null:{user:{email:c.data.user.email||c.data.user.username,id:c.data.user.open_id,name:c.data.user.display_name||c.data.user.username,image:c.data.user.avatar_large_url,emailVerified:!!c.data.user.email},data:c}},options:a}),reddit:a=>({id:"reddit",name:"Reddit",createAuthorizationURL({state:b,scopes:c,redirectURI:d}){let e=a.disableDefaultScope?[]:["identity"];return a.scope&&e.push(...a.scope),c&&e.push(...c),al({id:"reddit",options:a,authorizationEndpoint:"https://www.reddit.com/api/v1/authorize",scopes:e,state:b,redirectURI:d,duration:a.duration})},validateAuthorizationCode:async({code:b,redirectURI:c})=>{let d=new URLSearchParams({grant_type:"authorization_code",code:b,redirect_uri:a.redirectURI||c}),e={"content-type":"application/x-www-form-urlencoded",accept:"text/plain","user-agent":"better-auth",Authorization:`Basic ${j.K.encode(`${a.clientId}:${a.clientSecret}`)}`},{data:f,error:g}=await (0,l.zZ)("https://www.reddit.com/api/v1/access_token",{method:"POST",headers:e,body:d.toString()});if(g)throw g;return ai(f)},refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>an({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},authentication:"basic",tokenEndpoint:"https://www.reddit.com/api/v1/access_token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await (0,l.zZ)("https://oauth.reddit.com/api/v1/me",{headers:{Authorization:`Bearer ${b.accessToken}`,"User-Agent":"better-auth"}});if(d)return null;let e=await a.mapProfileToUser?.(c);return{user:{id:c.id,name:c.name,email:c.oauth_client_id,emailVerified:c.has_verified_email,image:c.icon_img?.split("?")[0],...e},data:c}},options:a}),roblox:a=>({id:"roblox",name:"Roblox",createAuthorizationURL({state:b,scopes:c,redirectURI:d}){let e=a.disableDefaultScope?[]:["openid","profile"];return a.scope&&e.push(...a.scope),c&&e.push(...c),new URL(`https://apis.roblox.com/oauth/v1/authorize?scope=${e.join("+")}&response_type=code&client_id=${a.clientId}&redirect_uri=${encodeURIComponent(a.redirectURI||d)}&state=${b}&prompt=${a.prompt||"select_account consent"}`)},validateAuthorizationCode:async({code:b,redirectURI:c})=>am({code:b,redirectURI:a.redirectURI||c,options:a,tokenEndpoint:"https://apis.roblox.com/oauth/v1/token",authentication:"post"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>an({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://apis.roblox.com/oauth/v1/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await (0,l.zZ)("https://apis.roblox.com/oauth/v1/userinfo",{headers:{authorization:`Bearer ${b.accessToken}`}});if(d)return null;let e=await a.mapProfileToUser?.(c);return{user:{id:c.sub,name:c.nickname||c.preferred_username||"",image:c.picture,email:c.preferred_username||null,emailVerified:!0,...e},data:{...c}}},options:a}),salesforce:a=>{let b="sandbox"===(a.environment??"production"),c=a.loginUrl?`https://${a.loginUrl}/services/oauth2/authorize`:b?"https://test.salesforce.com/services/oauth2/authorize":"https://login.salesforce.com/services/oauth2/authorize",d=a.loginUrl?`https://${a.loginUrl}/services/oauth2/token`:b?"https://test.salesforce.com/services/oauth2/token":"https://login.salesforce.com/services/oauth2/token",e=a.loginUrl?`https://${a.loginUrl}/services/oauth2/userinfo`:b?"https://test.salesforce.com/services/oauth2/userinfo":"https://login.salesforce.com/services/oauth2/userinfo";return{id:"salesforce",name:"Salesforce",async createAuthorizationURL({state:b,scopes:d,codeVerifier:e,redirectURI:f}){if(!a.clientId||!a.clientSecret)throw R.a.error("Client Id and Client Secret are required for Salesforce. Make sure to provide them in the options."),new W.B("CLIENT_ID_AND_SECRET_REQUIRED");if(!e)throw new W.B("codeVerifier is required for Salesforce");let g=a.disableDefaultScope?[]:["openid","email","profile"];return a.scope&&g.push(...a.scope),d&&g.push(...d),al({id:"salesforce",options:a,authorizationEndpoint:c,scopes:g,state:b,codeVerifier:e,redirectURI:a.redirectURI||f})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:e})=>am({code:b,codeVerifier:c,redirectURI:a.redirectURI||e,options:a,tokenEndpoint:d}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>an({refreshToken:b,options:{clientId:a.clientId,clientSecret:a.clientSecret},tokenEndpoint:d}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);try{let{data:c}=await (0,l.zZ)(e,{headers:{Authorization:`Bearer ${b.accessToken}`}});if(!c)return R.a.error("Failed to fetch user info from Salesforce"),null;let d=await a.mapProfileToUser?.(c);return{user:{id:c.user_id,name:c.name,email:c.email,image:c.photos?.picture||c.photos?.thumbnail,emailVerified:c.email_verified??!1,...d},data:c}}catch(a){return R.a.error("Failed to fetch user info from Salesforce:",a),null}},options:a}},vk:a=>({id:"vk",name:"VK",async createAuthorizationURL({state:b,scopes:c,codeVerifier:d,redirectURI:e}){let f=a.disableDefaultScope?[]:["email","phone"];return a.scope&&f.push(...a.scope),c&&f.push(...c),al({id:"vk",options:a,authorizationEndpoint:"https://id.vk.com/authorize",scopes:f,state:b,redirectURI:e,codeVerifier:d})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d,deviceId:e})=>am({code:b,codeVerifier:c,redirectURI:a.redirectURI||d,options:a,deviceId:e,tokenEndpoint:"https://id.vk.com/oauth2/auth"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>an({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://id.vk.com/oauth2/auth"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);if(!b.accessToken)return null;let c=new URLSearchParams({access_token:b.accessToken,client_id:a.clientId}).toString(),{data:d,error:e}=await (0,l.zZ)("https://id.vk.com/oauth2/user_info",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:c});if(e||!d.user.email)return null;let f=await a.mapProfileToUser?.(d);return{user:{id:d.user.user_id,first_name:d.user.first_name,last_name:d.user.last_name,email:d.user.email,image:d.user.avatar,emailVerified:!!d.user.email,birthday:d.user.birthday,sex:d.user.sex,name:`${d.user.first_name} ${d.user.last_name}`,...f},data:d}},options:a}),zoom:a=>{let b={pkce:!0,...a};return{id:"zoom",name:"Zoom",createAuthorizationURL:async({state:a,redirectURI:c,codeVerifier:d})=>{let e=new URLSearchParams({response_type:"code",redirect_uri:b.redirectURI?b.redirectURI:c,client_id:b.clientId,state:a});if(b.pkce){let a=await ah(d);e.set("code_challenge_method","S256"),e.set("code_challenge",a)}let f=new URL("https://zoom.us/oauth/authorize");return f.search=e.toString(),f},validateAuthorizationCode:async({code:a,redirectURI:c,codeVerifier:d})=>am({code:a,redirectURI:b.redirectURI||c,codeVerifier:d,options:b,tokenEndpoint:"https://zoom.us/oauth/token",authentication:"post"}),async getUserInfo(a){if(b.getUserInfo)return b.getUserInfo(a);let{data:c,error:d}=await (0,l.zZ)("https://api.zoom.us/v2/users/me",{headers:{authorization:`Bearer ${a.accessToken}`}});if(d)return null;let e=await b.mapProfileToUser?.(c);return{user:{id:c.id,name:c.display_name,image:c.pic_url,email:c.email,emailVerified:!!c.verified,...e},data:{...c}}}}},notion:a=>{let b="https://api.notion.com/v1/oauth/token";return{id:"notion",name:"Notion",createAuthorizationURL({state:b,scopes:c,loginHint:d,redirectURI:e}){let f=(a.disableDefaultScope,[]);return a.scope&&f.push(...a.scope),c&&f.push(...c),al({id:"notion",options:a,authorizationEndpoint:"https://api.notion.com/v1/oauth/authorize",scopes:f,state:b,redirectURI:e,loginHint:d,additionalParams:{owner:"user"}})},validateAuthorizationCode:async({code:c,redirectURI:d})=>am({code:c,redirectURI:d,options:a,tokenEndpoint:b,authentication:"basic"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async c=>an({refreshToken:c,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:b}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await (0,l.zZ)("https://api.notion.com/v1/users/me",{headers:{Authorization:`Bearer ${b.accessToken}`,"Notion-Version":"2022-06-28"}});if(d||!c)return null;let e=c.bot?.owner?.user;if(!e)return null;let f=await a.mapProfileToUser?.(e);return{user:{id:e.id,name:e.name||"Notion User",email:e.person?.email||null,image:e.avatar_url,emailVerified:!!e.person?.email,...f},data:e}},options:a}},kakao:a=>({id:"kakao",name:"Kakao",createAuthorizationURL({state:b,scopes:c,redirectURI:d}){let e=a.disableDefaultScope?[]:["account_email","profile_image","profile_nickname"];return a.scope&&e.push(...a.scope),c&&e.push(...c),al({id:"kakao",options:a,authorizationEndpoint:"https://kauth.kakao.com/oauth/authorize",scopes:e,state:b,redirectURI:d})},validateAuthorizationCode:async({code:b,redirectURI:c})=>am({code:b,redirectURI:c,options:a,tokenEndpoint:"https://kauth.kakao.com/oauth/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>an({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://kauth.kakao.com/oauth/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await (0,l.zZ)("https://kapi.kakao.com/v2/user/me",{headers:{Authorization:`Bearer ${b.accessToken}`}});if(d||!c)return null;let e=await a.mapProfileToUser?.(c),f=c.kakao_account||{},g=f.profile||{};return{user:{id:String(c.id),name:g.nickname||f.name||void 0,email:f.email,image:g.profile_image_url||g.thumbnail_image_url,emailVerified:!!f.is_email_valid&&!!f.is_email_verified,...e},data:c}},options:a}),naver:a=>({id:"naver",name:"Naver",createAuthorizationURL({state:b,scopes:c,redirectURI:d}){let e=a.disableDefaultScope?[]:["profile","email"];return a.scope&&e.push(...a.scope),c&&e.push(...c),al({id:"naver",options:a,authorizationEndpoint:"https://nid.naver.com/oauth2.0/authorize",scopes:e,state:b,redirectURI:d})},validateAuthorizationCode:async({code:b,redirectURI:c})=>am({code:b,redirectURI:c,options:a,tokenEndpoint:"https://nid.naver.com/oauth2.0/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>an({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://nid.naver.com/oauth2.0/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await (0,l.zZ)("https://openapi.naver.com/v1/nid/me",{headers:{Authorization:`Bearer ${b.accessToken}`}});if(d||!c||"00"!==c.resultcode)return null;let e=await a.mapProfileToUser?.(c),f=c.response||{};return{user:{id:f.id,name:f.name||f.nickname,email:f.email,image:f.profile_image,emailVerified:!1,...e},data:c}},options:a}),line:a=>{let b="https://api.line.me/oauth2/v2.1/token";return{id:"line",name:"LINE",async createAuthorizationURL({state:b,scopes:c,codeVerifier:d,redirectURI:e,loginHint:f}){let g=a.disableDefaultScope?[]:["openid","profile","email"];return a.scope&&g.push(...a.scope),c&&g.push(...c),await al({id:"line",options:a,authorizationEndpoint:"https://access.line.me/oauth2/v2.1/authorize",scopes:g,state:b,codeVerifier:d,redirectURI:e,loginHint:f})},validateAuthorizationCode:async({code:c,codeVerifier:d,redirectURI:e})=>am({code:c,codeVerifier:d,redirectURI:e,options:a,tokenEndpoint:b}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async c=>an({refreshToken:c,options:{clientId:a.clientId,clientSecret:a.clientSecret},tokenEndpoint:b}),async verifyIdToken(b,c){if(a.disableIdTokenSignIn)return!1;if(a.verifyIdToken)return a.verifyIdToken(b,c);let d=new URLSearchParams;d.set("id_token",b),d.set("client_id",a.clientId),c&&d.set("nonce",c);let{data:e,error:f}=await (0,l.zZ)("https://api.line.me/oauth2/v2.1/verify",{method:"POST",headers:{"content-type":"application/x-www-form-urlencoded"},body:d});return!f&&!!e&&e.aud===a.clientId&&(!c||!e.nonce||e.nonce===c)},async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let c=null;if(b.idToken)try{c=D(b.idToken)}catch{}if(!c){let{data:a}=await (0,l.zZ)("https://api.line.me/oauth2/v2.1/userinfo",{headers:{authorization:`Bearer ${b.accessToken}`}});c=a||null}if(!c)return null;let d=await a.mapProfileToUser?.(c),e=c.sub||c.userId,f=c.name||c.displayName,g=c.picture||c.pictureUrl||void 0;return{user:{id:e,name:f,email:c.email,image:g,emailVerified:!1,...d},data:c}},options:a}},paypal:a=>{let b="sandbox"===(a.environment||"sandbox"),c=b?"https://www.sandbox.paypal.com/signin/authorize":"https://www.paypal.com/signin/authorize",d=b?"https://api-m.sandbox.paypal.com/v1/oauth2/token":"https://api-m.paypal.com/v1/oauth2/token",e=b?"https://api-m.sandbox.paypal.com/v1/identity/oauth2/userinfo":"https://api-m.paypal.com/v1/identity/oauth2/userinfo";return{id:"paypal",name:"PayPal",async createAuthorizationURL({state:b,codeVerifier:d,redirectURI:e}){if(!a.clientId||!a.clientSecret)throw R.a.error("Client Id and Client Secret is required for PayPal. Make sure to provide them in the options."),new W.B("CLIENT_ID_AND_SECRET_REQUIRED");return await al({id:"paypal",options:a,authorizationEndpoint:c,scopes:[],state:b,codeVerifier:d,redirectURI:e,prompt:a.prompt})},validateAuthorizationCode:async({code:b,redirectURI:c})=>{let e=j.K.encode(`${a.clientId}:${a.clientSecret}`);try{let a=await (0,l.zZ)(d,{method:"POST",headers:{Authorization:`Basic ${e}`,Accept:"application/json","Accept-Language":"en_US","Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({grant_type:"authorization_code",code:b,redirect_uri:c}).toString()});if(!a.data)throw new W.B("FAILED_TO_GET_ACCESS_TOKEN");let f=a.data;return{accessToken:f.access_token,refreshToken:f.refresh_token,accessTokenExpiresAt:f.expires_in?new Date(Date.now()+1e3*f.expires_in):void 0,idToken:f.id_token}}catch(a){throw R.a.error("PayPal token exchange failed:",a),new W.B("FAILED_TO_GET_ACCESS_TOKEN")}},refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>{let c=j.K.encode(`${a.clientId}:${a.clientSecret}`);try{let a=await (0,l.zZ)(d,{method:"POST",headers:{Authorization:`Basic ${c}`,Accept:"application/json","Accept-Language":"en_US","Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({grant_type:"refresh_token",refresh_token:b}).toString()});if(!a.data)throw new W.B("FAILED_TO_REFRESH_ACCESS_TOKEN");let e=a.data;return{accessToken:e.access_token,refreshToken:e.refresh_token,accessTokenExpiresAt:e.expires_in?new Date(Date.now()+1e3*e.expires_in):void 0}}catch(a){throw R.a.error("PayPal token refresh failed:",a),new W.B("FAILED_TO_REFRESH_ACCESS_TOKEN")}},async verifyIdToken(b,c){if(a.disableIdTokenSignIn)return!1;if(a.verifyIdToken)return a.verifyIdToken(b,c);try{return!!D(b).sub}catch(a){return R.a.error("Failed to verify PayPal ID token:",a),!1}},async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);if(!b.accessToken)return R.a.error("Access token is required to fetch PayPal user info"),null;try{let c=await (0,l.zZ)(`${e}?schema=paypalv1.1`,{headers:{Authorization:`Bearer ${b.accessToken}`,Accept:"application/json"}});if(!c.data)return R.a.error("Failed to fetch user info from PayPal"),null;let d=c.data,f=await a.mapProfileToUser?.(d);return{user:{id:d.user_id,name:d.name,email:d.email,image:d.picture,emailVerified:d.email_verified,...f},data:d}}catch(a){return R.a.error("Failed to fetch user info from PayPal:",a),null}},options:a}}},as=Object.keys(ar),at=e.k5n(as).or(e.YjP()),au=(0,f.a)("/sign-in/social",{method:"POST",body:e.Ikc({callbackURL:e.YjP().meta({description:"Callback URL to redirect to after the user has signed in"}).optional(),newUserCallbackURL:e.YjP().optional(),errorCallbackURL:e.YjP().meta({description:"Callback URL to redirect to if an error happens"}).optional(),provider:at,disableRedirect:e.zMY().meta({description:"Disable automatic redirection to the provider. Useful for handling the redirection yourself"}).optional(),idToken:e.lqM(e.Ikc({token:e.YjP().meta({description:"ID token from the provider"}),nonce:e.YjP().meta({description:"Nonce used to generate the token"}).optional(),accessToken:e.YjP().meta({description:"Access token from the provider"}).optional(),refreshToken:e.YjP().meta({description:"Refresh token from the provider"}).optional(),expiresAt:e.aig().meta({description:"Expiry date of the token"}).optional()})),scopes:e.YOg(e.YjP()).meta({description:"Array of scopes to request from the provider. This will override the default scopes passed."}).optional(),requestSignUp:e.zMY().meta({description:"Explicitly request sign-up. Useful when disableImplicitSignUp is true for this provider"}).optional(),loginHint:e.YjP().meta({description:"The login hint to use for the authorization code request"}).optional()}),metadata:{openapi:{description:"Sign in with a social provider",operationId:"socialSignIn",responses:{200:{description:"Success - Returns either session details or redirect URL",content:{"application/json":{schema:{type:"object",description:"Session response when idToken is provided",properties:{redirect:{type:"boolean",enum:[!1]},token:{type:"string",description:"Session token",url:{type:"null",nullable:!0},user:{type:"object",properties:{id:{type:"string"},email:{type:"string"},name:{type:"string",nullable:!0},image:{type:"string",nullable:!0},emailVerified:{type:"boolean"},createdAt:{type:"string",format:"date-time"},updatedAt:{type:"string",format:"date-time"}},required:["id","email","emailVerified","createdAt","updatedAt"]}}},required:["redirect","token","user"]}}}}}}}},async a=>{let b=a.context.socialProviders.find(b=>b.id===a.body.provider);if(!b)throw a.context.logger.error("Provider not found. Make sure to add the provider in your auth config",{provider:a.body.provider}),new g.LG("NOT_FOUND",{message:f.B.PROVIDER_NOT_FOUND});if(a.body.idToken){if(!b.verifyIdToken)throw a.context.logger.error("Provider does not support id token verification",{provider:a.body.provider}),new g.LG("NOT_FOUND",{message:f.B.ID_TOKEN_NOT_SUPPORTED});let{token:c,nonce:d}=a.body.idToken;if(!await b.verifyIdToken(c,d))throw a.context.logger.error("Invalid id token",{provider:a.body.provider}),new g.LG("UNAUTHORIZED",{message:f.B.INVALID_TOKEN});let e=await b.getUserInfo({idToken:c,accessToken:a.body.idToken.accessToken,refreshToken:a.body.idToken.refreshToken});if(!e||!e?.user)throw a.context.logger.error("Failed to get user info",{provider:a.body.provider}),new g.LG("UNAUTHORIZED",{message:f.B.FAILED_TO_GET_USER_INFO});if(!e.user.email)throw a.context.logger.error("User email not found",{provider:a.body.provider}),new g.LG("UNAUTHORIZED",{message:f.B.USER_EMAIL_NOT_FOUND});let h=await ak(a,{userInfo:{...e.user,email:e.user.email,id:String(e.user.id),name:e.user.name||"",image:e.user.image,emailVerified:e.user.emailVerified||!1},account:{providerId:b.id,accountId:String(e.user.id),accessToken:a.body.idToken.accessToken},callbackURL:a.body.callbackURL,disableSignUp:b.disableImplicitSignUp&&!a.body.requestSignUp||b.disableSignUp});if(h.error)throw new g.LG("UNAUTHORIZED",{message:h.error});return await (0,Q.s)(a,h.data),a.json({redirect:!1,token:h.data.session.token,url:void 0,user:{id:h.data.user.id,email:h.data.user.email,name:h.data.user.name,image:h.data.user.image,emailVerified:h.data.user.emailVerified,createdAt:h.data.user.createdAt,updatedAt:h.data.user.updatedAt}})}let{codeVerifier:c,state:d}=await af(a),e=await b.createAuthorizationURL({state:d,codeVerifier:c,redirectURI:`${a.context.baseURL}/callback/${b.id}`,scopes:a.body.scopes,loginHint:a.body.loginHint});return a.json({url:e.toString(),redirect:!a.body.disableRedirect})}),av=(0,f.a)("/sign-in/email",{method:"POST",body:e.Ikc({email:e.YjP().meta({description:"Email of the user"}),password:e.YjP().meta({description:"Password of the user"}),callbackURL:e.YjP().meta({description:"Callback URL to use as a redirect for email verification"}).optional(),rememberMe:e.zMY().meta({description:"If this is false, the session will not be remembered. Default is `true`."}).default(!0).optional()}),metadata:{openapi:{description:"Sign in with email and password",responses:{200:{description:"Success - Returns either session details or redirect URL",content:{"application/json":{schema:{type:"object",description:"Session response when idToken is provided",properties:{redirect:{type:"boolean",enum:[!1]},token:{type:"string",description:"Session token"},url:{type:"null",nullable:!0},user:{type:"object",properties:{id:{type:"string"},email:{type:"string"},name:{type:"string",nullable:!0},image:{type:"string",nullable:!0},emailVerified:{type:"boolean"},createdAt:{type:"string",format:"date-time"},updatedAt:{type:"string",format:"date-time"}},required:["id","email","emailVerified","createdAt","updatedAt"]}},required:["redirect","token","user"]}}}}}}}},async a=>{if(!a.context.options?.emailAndPassword?.enabled)throw a.context.logger.error("Email and password is not enabled. Make sure to enable it in the options on you `auth.ts` file. Check `https://better-auth.com/docs/authentication/email-password` for more!"),new g.LG("BAD_REQUEST",{message:"Email and password is not enabled"});let{email:b,password:c}=a.body;if(!e.YjP().email().safeParse(b).success)throw new g.LG("BAD_REQUEST",{message:f.B.INVALID_EMAIL});let d=await a.context.internalAdapter.findUserByEmail(b,{includeAccounts:!0});if(!d)throw await a.context.password.hash(c),a.context.logger.error("User not found",{email:b}),new g.LG("UNAUTHORIZED",{message:f.B.INVALID_EMAIL_OR_PASSWORD});let h=d.accounts.find(a=>"credential"===a.providerId);if(!h)throw a.context.logger.error("Credential account not found",{email:b}),new g.LG("UNAUTHORIZED",{message:f.B.INVALID_EMAIL_OR_PASSWORD});let i=h?.password;if(!i)throw a.context.logger.error("Password not found",{email:b}),new g.LG("UNAUTHORIZED",{message:f.B.INVALID_EMAIL_OR_PASSWORD});if(!await a.context.password.verify({hash:i,password:c}))throw a.context.logger.error("Invalid password"),new g.LG("UNAUTHORIZED",{message:f.B.INVALID_EMAIL_OR_PASSWORD});if(a.context.options?.emailAndPassword?.requireEmailVerification&&!d.user.emailVerified){if(!a.context.options?.emailVerification?.sendVerificationEmail)throw new g.LG("FORBIDDEN",{message:f.B.EMAIL_NOT_VERIFIED});if(a.context.options?.emailVerification?.sendOnSignIn){let b=await aa(a.context.secret,d.user.email,void 0,a.context.options.emailVerification?.expiresIn),c=`${a.context.baseURL}/verify-email?token=${b}&callbackURL=${a.body.callbackURL||"/"}`;await a.context.options.emailVerification.sendVerificationEmail({user:d.user,url:c,token:b},a.request)}throw new g.LG("FORBIDDEN",{message:f.B.EMAIL_NOT_VERIFIED})}let j=await a.context.internalAdapter.createSession(d.user.id,a,!1===a.body.rememberMe);if(!j)throw a.context.logger.error("Failed to create session"),new g.LG("UNAUTHORIZED",{message:f.B.FAILED_TO_CREATE_SESSION});return await (0,Q.s)(a,{session:j,user:d.user},!1===a.body.rememberMe),a.json({redirect:!!a.body.callbackURL,token:j.token,url:a.body.callbackURL,user:{id:d.user.id,email:d.user.email,name:d.user.name,image:d.user.image,emailVerified:d.user.emailVerified,createdAt:d.user.createdAt,updatedAt:d.user.updatedAt}})}),aw=e.Ikc({code:e.YjP().optional(),error:e.YjP().optional(),device_id:e.YjP().optional(),error_description:e.YjP().optional(),state:e.YjP().optional(),user:e.YjP().optional()}),ax=(0,f.a)("/callback/:id",{method:["GET","POST"],body:aw.optional(),query:aw.optional(),metadata:ae},async a=>{let b,c,d,e=a.context.options.onAPIError?.errorURL||`${a.context.baseURL}/error`;try{if("GET"===a.method)b=aw.parse(a.query);else if("POST"===a.method)b=aw.parse(a.body);else throw Error("Unsupported method")}catch(b){throw a.context.logger.error("INVALID_CALLBACK_REQUEST",b),a.redirect(`${e}?error=invalid_callback_request`)}let{code:f,error:g,state:h,error_description:i,device_id:j}=b;if(!h){a.context.logger.error("State not found",g);let b=e.includes("?")?"&":"?",c=`${e}${b}state=state_not_found`;throw a.redirect(c)}let{codeVerifier:k,callbackURL:l,link:m,errorURL:n,newUserURL:o,requestSignUp:p}=await ag(a);function q(b,c){let d=n??e,f=new URLSearchParams({error:b});c&&f.set("error_description",c);let g=d.includes("?")?"&":"?",h=`${d}${g}${f.toString()}`;throw a.redirect(h)}if(g&&q(g,i),!f)throw a.context.logger.error("Code not found"),q("no_code");let r=a.context.socialProviders.find(b=>b.id===a.params.id);if(!r)throw a.context.logger.error("Oauth provider with id",a.params.id,"not found"),q("oauth_provider_not_found");try{c=await r.validateAuthorizationCode({code:f,codeVerifier:k,deviceId:j,redirectURI:`${a.context.baseURL}/callback/${r.id}`})}catch(b){throw a.context.logger.error("",b),q("invalid_code")}let s=await r.getUserInfo({...c,user:a.body?.user?(0,S.s)(a.body.user):void 0}).then(a=>a?.user);if(!s)return a.context.logger.error("Unable to get user info"),q("unable_to_get_user_info");if(!l)throw a.context.logger.error("No callback URL found"),q("no_callback_url");if(m){let b,d=a.context.options.account?.accountLinking?.trustedProviders;if(!d?.includes(r.id)&&!s.emailVerified||a.context.options.account?.accountLinking?.enabled===!1)return a.context.logger.error("Unable to link account - untrusted provider"),q("unable_to_link_account");if(s.email!==m.email&&a.context.options.account?.accountLinking?.allowDifferentEmails!==!0)return q("email_doesn't_match");let e=await a.context.internalAdapter.findAccount(String(s.id));if(e){if(e.userId.toString()!==m.userId.toString())return q("account_already_linked_to_different_user");let b=Object.fromEntries(Object.entries({accessToken:await aj(c.accessToken,a.context),refreshToken:await aj(c.refreshToken,a.context),idToken:c.idToken,accessTokenExpiresAt:c.accessTokenExpiresAt,refreshTokenExpiresAt:c.refreshTokenExpiresAt,scope:c.scopes?.join(",")}).filter(([a,b])=>void 0!==b));await a.context.internalAdapter.updateAccount(e.id,b)}else if(!await a.context.internalAdapter.createAccount({userId:m.userId,providerId:r.id,accountId:String(s.id),...c,accessToken:await aj(c.accessToken,a.context),refreshToken:await aj(c.refreshToken,a.context),scope:c.scopes?.join(",")},a))return q("unable_to_link_account");try{b=l.toString()}catch{b=l}throw a.redirect(b)}if(!s.email)return a.context.logger.error("Provider did not return email. This could be due to misconfiguration in the provider settings."),q("email_not_found");let t=await ak(a,{userInfo:{...s,id:String(s.id),email:s.email,name:s.name||s.email},account:{providerId:r.id,accountId:String(s.id),...c,scope:c.scopes?.join(",")},callbackURL:l,disableSignUp:r.disableImplicitSignUp&&!p||r.options?.disableSignUp,overrideUserInfo:r.options?.overrideUserInfoOnSignIn});if(t.error)return a.context.logger.error(t.error.split(" ").join("_")),q(t.error.split(" ").join("_"));let{session:u,user:v}=t.data;await (0,Q.s)(a,{session:u,user:v});try{d=(t.isRegister&&o||l).toString()}catch{d=t.isRegister&&o||l}throw a.redirect(d)}),ay=(0,f.a)("/sign-out",{method:"POST",requireHeaders:!0,metadata:{openapi:{description:"Sign out the current user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{success:{type:"boolean"}}}}}}}}}},async a=>{let b=await a.getSignedCookie(a.context.authCookies.sessionToken.name,a.context.secret);if(!b)throw(0,Q.d)(a),new g.LG("BAD_REQUEST",{message:f.B.FAILED_TO_GET_SESSION});return await a.context.internalAdapter.deleteSession(b),(0,Q.d)(a),a.json({success:!0})});function az(a,b,c){let d=b?new URL(b,a.baseURL):new URL(`${a.baseURL}/error`);return c&&Object.entries(c).forEach(([a,b])=>d.searchParams.set(a,b)),d.href}let aA=(0,f.a)("/request-password-reset",{method:"POST",body:e.Ikc({email:e.Rpp().meta({description:"The email address of the user to send a password reset email to"}),redirectTo:e.YjP().meta({description:"The URL to redirect the user to reset their password. If the token isn't valid or expired, it'll be redirected with a query parameter `?error=INVALID_TOKEN`. If the token is valid, it'll be redirected with a query parameter `?token=VALID_TOKEN"}).optional()}),metadata:{openapi:{description:"Send a password reset email to the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"},message:{type:"string"}}}}}}}}}},async a=>{if(!a.context.options.emailAndPassword?.sendResetPassword)throw a.context.logger.error("Reset password isn't enabled.Please pass an emailAndPassword.sendResetPassword function in your auth config!"),new g.LG("BAD_REQUEST",{message:"Reset password isn't enabled"});let{email:b,redirectTo:c}=a.body,d=await a.context.internalAdapter.findUserByEmail(b,{includeAccounts:!0});if(!d)return a.context.logger.error("Reset Password: User not found",{email:b}),a.json({status:!0,message:"If this email exists in our system, check your email for the reset link"});let e=(0,h.g)(a.context.options.emailAndPassword.resetPasswordTokenExpiresIn||3600,"sec"),f=(0,T.g)(24);await a.context.internalAdapter.createVerificationValue({value:d.user.id,identifier:`reset-password:${f}`,expiresAt:e},a);let i=c?encodeURIComponent(c):"",j=`${a.context.baseURL}/reset-password/${f}?callbackURL=${i}`;return await a.context.options.emailAndPassword.sendResetPassword({user:d.user,url:j,token:f},a.request),a.json({status:!0,message:"If this email exists in our system, check your email for the reset link"})}),aB=(0,f.a)("/forget-password",{method:"POST",body:e.Ikc({email:e.YjP().email().meta({description:"The email address of the user to send a password reset email to"}),redirectTo:e.YjP().meta({description:"The URL to redirect the user to reset their password. If the token isn't valid or expired, it'll be redirected with a query parameter `?error=INVALID_TOKEN`. If the token is valid, it'll be redirected with a query parameter `?token=VALID_TOKEN"}).optional()}),metadata:{openapi:{description:"Send a password reset email to the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"},message:{type:"string"}}}}}}}}}},async a=>{if(!a.context.options.emailAndPassword?.sendResetPassword)throw a.context.logger.error("Reset password isn't enabled.Please pass an emailAndPassword.sendResetPassword function in your auth config!"),new g.LG("BAD_REQUEST",{message:"Reset password isn't enabled"});let{email:b,redirectTo:c}=a.body,d=await a.context.internalAdapter.findUserByEmail(b,{includeAccounts:!0});if(!d)return a.context.logger.error("Reset Password: User not found",{email:b}),a.json({status:!0,message:"If this email exists in our system, check your email for the reset link"});let e=(0,h.g)(a.context.options.emailAndPassword.resetPasswordTokenExpiresIn||3600,"sec"),f=(0,T.g)(24);await a.context.internalAdapter.createVerificationValue({value:d.user.id,identifier:`reset-password:${f}`,expiresAt:e},a);let i=c?encodeURIComponent(c):"",j=`${a.context.baseURL}/reset-password/${f}?callbackURL=${i}`;return await a.context.options.emailAndPassword.sendResetPassword({user:d.user,url:j,token:f},a.request),a.json({status:!0})}),aC=(0,f.a)("/reset-password/:token",{method:"GET",query:e.Ikc({callbackURL:e.YjP().meta({description:"The URL to redirect the user to reset their password"})}),use:[_(a=>a.query.callbackURL)],metadata:{openapi:{description:"Redirects the user to the callback URL with the token",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{token:{type:"string"}}}}}}}}}},async a=>{let{token:b}=a.params,{callbackURL:c}=a.query;if(!b||!c)throw a.redirect(az(a.context,c,{error:"INVALID_TOKEN"}));let d=await a.context.internalAdapter.findVerificationValue(`reset-password:${b}`);if(!d||d.expiresAt<new Date)throw a.redirect(az(a.context,c,{error:"INVALID_TOKEN"}));throw a.redirect(function(a,b,c){let d=new URL(b,a.baseURL);return c&&Object.entries(c).forEach(([a,b])=>d.searchParams.set(a,b)),d.href}(a.context,c,{token:b}))}),aD=aC,aE=(0,f.a)("/reset-password",{method:"POST",query:e.Ikc({token:e.YjP().optional()}).optional(),body:e.Ikc({newPassword:e.YjP().meta({description:"The new password to set"}),token:e.YjP().meta({description:"The token to reset the password"}).optional()}),metadata:{openapi:{description:"Reset the password for a user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"}}}}}}}}}},async a=>{let b=a.body.token||a.query?.token;if(!b)throw new g.LG("BAD_REQUEST",{message:f.B.INVALID_TOKEN});let{newPassword:c}=a.body,d=a.context.password?.config.minPasswordLength,e=a.context.password?.config.maxPasswordLength;if(c.length<d)throw new g.LG("BAD_REQUEST",{message:f.B.PASSWORD_TOO_SHORT});if(c.length>e)throw new g.LG("BAD_REQUEST",{message:f.B.PASSWORD_TOO_LONG});let h=`reset-password:${b}`,i=await a.context.internalAdapter.findVerificationValue(h);if(!i||i.expiresAt<new Date)throw new g.LG("BAD_REQUEST",{message:f.B.INVALID_TOKEN});let j=i.value,k=await a.context.password.hash(c);if((await a.context.internalAdapter.findAccounts(j)).find(a=>"credential"===a.providerId)?await a.context.internalAdapter.updatePassword(j,k,a):await a.context.internalAdapter.createAccount({userId:j,providerId:"credential",password:k,accountId:j},a),await a.context.internalAdapter.deleteVerificationValue(i.id),a.context.options.emailAndPassword?.onPasswordReset){let b=await a.context.internalAdapter.findUserById(j);b&&await a.context.options.emailAndPassword.onPasswordReset({user:b},a.request)}return a.context.options.emailAndPassword?.revokeSessionsOnPasswordReset&&await a.context.internalAdapter.deleteSessions(j),a.json({status:!0})}),aF=()=>(0,f.a)("/update-user",{method:"POST",body:e.g1P(e.YjP().meta({description:"Field name must be a string"}),e.bzn()),use:[f.s],metadata:{$Infer:{body:{}},openapi:{description:"Update the current user",requestBody:{content:{"application/json":{schema:{type:"object",properties:{name:{type:"string",description:"The name of the user"},image:{type:"string",description:"The image of the user"}}}}}},responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if the update was successful"}}}}}}}}}},async a=>{let b=a.body;if(b.email)throw new g.LG("BAD_REQUEST",{message:f.B.EMAIL_CAN_NOT_BE_UPDATED});let{name:c,image:d,...e}=b,h=a.context.session;if(void 0===d&&void 0===c&&0===Object.keys(e).length)return a.json({status:!0});let i=await a.context.internalAdapter.updateUser(h.user.id,{name:c,image:d,...e},a);return await (0,Q.s)(a,{session:h.session,user:i}),a.json({status:!0})}),aG=(0,f.a)("/change-password",{method:"POST",body:e.Ikc({newPassword:e.YjP().meta({description:"The new password to set"}),currentPassword:e.YjP().meta({description:"The current password is required"}),revokeOtherSessions:e.zMY().meta({description:"Must be a boolean value"}).optional()}),use:[f.i],metadata:{openapi:{description:"Change the password of the user",responses:{200:{description:"Password successfully changed",content:{"application/json":{schema:{type:"object",properties:{token:{type:"string",nullable:!0,description:"New session token if other sessions were revoked"},user:{type:"object",properties:{id:{type:"string",description:"The unique identifier of the user"},email:{type:"string",format:"email",description:"The email address of the user"},name:{type:"string",description:"The name of the user"},image:{type:"string",format:"uri",nullable:!0,description:"The profile image URL of the user"},emailVerified:{type:"boolean",description:"Whether the email has been verified"},createdAt:{type:"string",format:"date-time",description:"When the user was created"},updatedAt:{type:"string",format:"date-time",description:"When the user was last updated"}},required:["id","email","name","emailVerified","createdAt","updatedAt"]}},required:["user"]}}}}}}}},async a=>{let{newPassword:b,currentPassword:c,revokeOtherSessions:d}=a.body,e=a.context.session,h=a.context.password.config.minPasswordLength;if(b.length<h)throw a.context.logger.error("Password is too short"),new g.LG("BAD_REQUEST",{message:f.B.PASSWORD_TOO_SHORT});let i=a.context.password.config.maxPasswordLength;if(b.length>i)throw a.context.logger.error("Password is too long"),new g.LG("BAD_REQUEST",{message:f.B.PASSWORD_TOO_LONG});let j=(await a.context.internalAdapter.findAccounts(e.user.id)).find(a=>"credential"===a.providerId&&a.password);if(!j||!j.password)throw new g.LG("BAD_REQUEST",{message:f.B.CREDENTIAL_ACCOUNT_NOT_FOUND});let k=await a.context.password.hash(b);if(!await a.context.password.verify({hash:j.password,password:c}))throw new g.LG("BAD_REQUEST",{message:f.B.INVALID_PASSWORD});await a.context.internalAdapter.updateAccount(j.id,{password:k});let l=null;if(d){await a.context.internalAdapter.deleteSessions(e.user.id);let b=await a.context.internalAdapter.createSession(e.user.id,a);if(!b)throw new g.LG("INTERNAL_SERVER_ERROR",{message:f.B.FAILED_TO_GET_SESSION});await (0,Q.s)(a,{session:b,user:e.user}),l=b.token}return a.json({token:l,user:{id:e.user.id,email:e.user.email,name:e.user.name,image:e.user.image,emailVerified:e.user.emailVerified,createdAt:e.user.createdAt,updatedAt:e.user.updatedAt}})}),aH=(0,f.a)("/set-password",{method:"POST",body:e.Ikc({newPassword:e.YjP().meta({description:"The new password to set is required"})}),metadata:{SERVER_ONLY:!0},use:[f.i]},async a=>{let{newPassword:b}=a.body,c=a.context.session,d=a.context.password.config.minPasswordLength;if(b.length<d)throw a.context.logger.error("Password is too short"),new g.LG("BAD_REQUEST",{message:f.B.PASSWORD_TOO_SHORT});let e=a.context.password.config.maxPasswordLength;if(b.length>e)throw a.context.logger.error("Password is too long"),new g.LG("BAD_REQUEST",{message:f.B.PASSWORD_TOO_LONG});let h=(await a.context.internalAdapter.findAccounts(c.user.id)).find(a=>"credential"===a.providerId&&a.password),i=await a.context.password.hash(b);if(!h)return await a.context.internalAdapter.linkAccount({userId:c.user.id,providerId:"credential",accountId:c.user.id,password:i},a),a.json({status:!0});throw new g.LG("BAD_REQUEST",{message:"user already has a password"})}),aI=(0,f.a)("/delete-user",{method:"POST",use:[f.i],body:e.Ikc({callbackURL:e.YjP().meta({description:"The callback URL to redirect to after the user is deleted"}).optional(),password:e.YjP().meta({description:"The password of the user is required to delete the user"}).optional(),token:e.YjP().meta({description:"The token to delete the user is required"}).optional()}),metadata:{openapi:{description:"Delete the user",responses:{200:{description:"User deletion processed successfully",content:{"application/json":{schema:{type:"object",properties:{success:{type:"boolean",description:"Indicates if the operation was successful"},message:{type:"string",enum:["User deleted","Verification email sent"],description:"Status message of the deletion process"}},required:["success","message"]}}}}}}}},async a=>{if(!a.context.options.user?.deleteUser?.enabled)throw a.context.logger.error("Delete user is disabled. Enable it in the options",{session:a.context.session}),new g.LG("NOT_FOUND");let b=a.context.session;if(a.body.password){let c=(await a.context.internalAdapter.findAccounts(b.user.id)).find(a=>"credential"===a.providerId&&a.password);if(!c||!c.password)throw new g.LG("BAD_REQUEST",{message:f.B.CREDENTIAL_ACCOUNT_NOT_FOUND});if(!await a.context.password.verify({hash:c.password,password:a.body.password}))throw new g.LG("BAD_REQUEST",{message:f.B.INVALID_PASSWORD})}if(a.body.token)return await aJ({...a,query:{token:a.body.token}}),a.json({success:!0,message:"User deleted"});if(a.context.options.user.deleteUser?.sendDeleteAccountVerification){let c=(0,O.g)(32,"0-9","a-z");await a.context.internalAdapter.createVerificationValue({value:b.user.id,identifier:`delete-account-${c}`,expiresAt:new Date(Date.now()+1e3*(a.context.options.user.deleteUser?.deleteTokenExpiresIn||86400))},a);let d=`${a.context.baseURL}/delete-user/callback?token=${c}&callbackURL=${a.body.callbackURL||"/"}`;return await a.context.options.user.deleteUser.sendDeleteAccountVerification({user:b.user,url:d,token:c},a.request),a.json({success:!0,message:"Verification email sent"})}if(!a.body.password&&0!==a.context.sessionConfig.freshAge){let c=new Date(b.session.createdAt).getTime(),d=1e3*a.context.sessionConfig.freshAge;if(Date.now()-c>1e3*d)throw new g.LG("BAD_REQUEST",{message:f.B.SESSION_EXPIRED})}let c=a.context.options.user.deleteUser?.beforeDelete;c&&await c(b.user,a.request),await a.context.internalAdapter.deleteUser(b.user.id),await a.context.internalAdapter.deleteSessions(b.user.id),await a.context.internalAdapter.deleteAccounts(b.user.id),(0,Q.d)(a);let d=a.context.options.user.deleteUser?.afterDelete;return d&&await d(b.user,a.request),a.json({success:!0,message:"User deleted"})}),aJ=(0,f.a)("/delete-user/callback",{method:"GET",query:e.Ikc({token:e.YjP().meta({description:"The token to verify the deletion request"}),callbackURL:e.YjP().meta({description:"The URL to redirect to after deletion"}).optional()}),use:[_(a=>a.query.callbackURL)],metadata:{openapi:{description:"Callback to complete user deletion with verification token",responses:{200:{description:"User successfully deleted",content:{"application/json":{schema:{type:"object",properties:{success:{type:"boolean",description:"Indicates if the deletion was successful"},message:{type:"string",enum:["User deleted"],description:"Confirmation message"}},required:["success","message"]}}}}}}}},async a=>{if(!a.context.options.user?.deleteUser?.enabled)throw a.context.logger.error("Delete user is disabled. Enable it in the options"),new g.LG("NOT_FOUND");let b=await (0,f.g)(a);if(!b)throw new g.LG("NOT_FOUND",{message:f.B.FAILED_TO_GET_USER_INFO});let c=await a.context.internalAdapter.findVerificationValue(`delete-account-${a.query.token}`);if(!c||c.expiresAt<new Date||c.value!==b.user.id)throw new g.LG("NOT_FOUND",{message:f.B.INVALID_TOKEN});let d=a.context.options.user.deleteUser?.beforeDelete;d&&await d(b.user,a.request),await a.context.internalAdapter.deleteUser(b.user.id),await a.context.internalAdapter.deleteSessions(b.user.id),await a.context.internalAdapter.deleteAccounts(b.user.id),await a.context.internalAdapter.deleteVerificationValue(c.id),(0,Q.d)(a);let e=a.context.options.user.deleteUser?.afterDelete;if(e&&await e(b.user,a.request),a.query.callbackURL)throw a.redirect(a.query.callbackURL||"/");return a.json({success:!0,message:"User deleted"})}),aK=(0,f.a)("/change-email",{method:"POST",body:e.Ikc({newEmail:e.Rpp().meta({description:"The new email address to set must be a valid email address"}),callbackURL:e.YjP().meta({description:"The URL to redirect to after email verification"}).optional()}),use:[f.i],metadata:{openapi:{responses:{200:{description:"Email change request processed successfully",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if the request was successful"},message:{type:"string",enum:["Email updated","Verification email sent"],description:"Status message of the email change process",nullable:!0}},required:["status"]}}}},422:{description:"Unprocessable Entity. Email already exists",content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}}}}}}},async a=>{if(!a.context.options.user?.changeEmail?.enabled)throw a.context.logger.error("Change email is disabled."),new g.LG("BAD_REQUEST",{message:"Change email is disabled"});let b=a.body.newEmail.toLowerCase();if(b===a.context.session.user.email)throw a.context.logger.error("Email is the same"),new g.LG("BAD_REQUEST",{message:"Email is the same"});if(await a.context.internalAdapter.findUserByEmail(b))throw a.context.logger.error("Email already exists"),new g.LG("BAD_REQUEST",{message:"Couldn't update your email"});if(!0!==a.context.session.user.emailVerified){if(await a.context.internalAdapter.findUserByEmail(b))throw new g.LG("UNPROCESSABLE_ENTITY",{message:f.B.USER_ALREADY_EXISTS_USE_ANOTHER_EMAIL});if(await a.context.internalAdapter.updateUserByEmail(a.context.session.user.email,{email:b},a),await (0,Q.s)(a,{session:a.context.session.session,user:{...a.context.session.user,email:b}}),a.context.options.emailVerification?.sendVerificationEmail){let c=await aa(a.context.secret,b,void 0,a.context.options.emailVerification?.expiresIn),d=`${a.context.baseURL}/verify-email?token=${c}&callbackURL=${a.body.callbackURL||"/"}`;await a.context.options.emailVerification.sendVerificationEmail({user:{...a.context.session.user,email:b},url:d,token:c},a.request)}return a.json({status:!0})}if(!a.context.options.user.changeEmail.sendChangeEmailVerification)throw a.context.logger.error("Verification email isn't enabled."),new g.LG("BAD_REQUEST",{message:"Verification email isn't enabled"});let c=await aa(a.context.secret,a.context.session.user.email,b,a.context.options.emailVerification?.expiresIn),d=`${a.context.baseURL}/verify-email?token=${c}&callbackURL=${a.body.callbackURL||"/"}`;return await a.context.options.user.changeEmail.sendChangeEmailVerification({user:a.context.session.user,newEmail:b,url:d,token:c},a.request),a.json({status:!0})}),aL=(0,f.a)("/error",{method:"GET",metadata:{...ae,openapi:{description:"Displays an error page",responses:{200:{description:"Success",content:{"text/html":{schema:{type:"string",description:"The HTML content of the error page"}}}}}}}},async a=>new Response(((a="Unknown")=>`<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Authentication Error</title>
    <style>
        :root {
            --bg-color: #f8f9fa;
            --text-color: #212529;
            --accent-color: #000000;
            --error-color: #dc3545;
            --border-color: #e9ecef;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            line-height: 1.5;
        }
        .error-container {
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            padding: 2.5rem;
            text-align: center;
            max-width: 90%;
            width: 400px;
        }
        h1 {
            color: var(--error-color);
            font-size: 1.75rem;
            margin-bottom: 1rem;
            font-weight: 600;
        }
        p {
            margin-bottom: 1.5rem;
            color: #495057;
        }
        .btn {
            background-color: var(--accent-color);
            color: #ffffff;
            text-decoration: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            transition: all 0.3s ease;
            display: inline-block;
            font-weight: 500;
            border: 2px solid var(--accent-color);
        }
        .btn:hover {
            background-color: #131721;
        }
        .error-code {
            font-size: 0.875rem;
            color: #6c757d;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--border-color);
        }
        .icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>
    <div class="error-container">
        <div class="icon">\u26A0\uFE0F</div>
        <h1>Better Auth Error</h1>
        <p>We encountered an issue while processing your request. Please try again or contact the application owner if the problem persists.</p>
        <a href="/" id="returnLink" class="btn">Return to Application</a>
        <div class="error-code">Error Code: <span id="errorCode">${a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}</span></div>
    </div>
</body>
</html>`)(new URL(a.request?.url||"").searchParams.get("error")||"Unknown"),{headers:{"Content-Type":"text/html"}})),aM=(0,f.a)("/ok",{method:"GET",metadata:{...ae,openapi:{description:"Check if the API is working",responses:{200:{description:"API is working",content:{"application/json":{schema:{type:"object",properties:{ok:{type:"boolean",description:"Indicates if the API is working"}},required:["ok"]}}}}}}}},async a=>a.json({ok:!0})),aN=(0,f.a)("/list-accounts",{method:"GET",use:[f.s],metadata:{openapi:{description:"List all accounts linked to the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"array",items:{type:"object",properties:{id:{type:"string"},providerId:{type:"string"},createdAt:{type:"string",format:"date-time"},updatedAt:{type:"string",format:"date-time"},accountId:{type:"string"},scopes:{type:"array",items:{type:"string"}}},required:["id","providerId","createdAt","updatedAt","accountId","scopes"]}}}}}}}}},async a=>{let b=a.context.session,c=await a.context.internalAdapter.findAccounts(b.user.id);return a.json(c.map(a=>({id:a.id,providerId:a.providerId,createdAt:a.createdAt,updatedAt:a.updatedAt,accountId:a.accountId,scopes:a.scope?.split(",")||[]})))}),aO=(0,f.a)("/link-social",{method:"POST",requireHeaders:!0,body:e.Ikc({callbackURL:e.YjP().meta({description:"The URL to redirect to after the user has signed in"}).optional(),provider:at,idToken:e.Ikc({token:e.YjP(),nonce:e.YjP().optional(),accessToken:e.YjP().optional(),refreshToken:e.YjP().optional(),scopes:e.YOg(e.YjP()).optional()}).optional(),requestSignUp:e.zMY().optional(),scopes:e.YOg(e.YjP()).meta({description:"Additional scopes to request from the provider"}).optional(),errorCallbackURL:e.YjP().meta({description:"The URL to redirect to if there is an error during the link process"}).optional(),disableRedirect:e.zMY().meta({description:"Disable automatic redirection to the provider. Useful for handling the redirection yourself"}).optional()}),use:[f.s],metadata:{openapi:{description:"Link a social account to the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{url:{type:"string",description:"The authorization URL to redirect the user to"},redirect:{type:"boolean",description:"Indicates if the user should be redirected to the authorization URL"},status:{type:"boolean"}},required:["redirect"]}}}}}}}},async a=>{let b=a.context.session,c=a.context.socialProviders.find(b=>b.id===a.body.provider);if(!c)throw a.context.logger.error("Provider not found. Make sure to add the provider in your auth config",{provider:a.body.provider}),new g.LG("NOT_FOUND",{message:f.B.PROVIDER_NOT_FOUND});if(a.body.idToken){if(!c.verifyIdToken)throw a.context.logger.error("Provider does not support id token verification",{provider:a.body.provider}),new g.LG("NOT_FOUND",{message:f.B.ID_TOKEN_NOT_SUPPORTED});let{token:d,nonce:e}=a.body.idToken;if(!await c.verifyIdToken(d,e))throw a.context.logger.error("Invalid id token",{provider:a.body.provider}),new g.LG("UNAUTHORIZED",{message:f.B.INVALID_TOKEN});let h=await c.getUserInfo({idToken:d,accessToken:a.body.idToken.accessToken,refreshToken:a.body.idToken.refreshToken});if(!h||!h?.user)throw a.context.logger.error("Failed to get user info",{provider:a.body.provider}),new g.LG("UNAUTHORIZED",{message:f.B.FAILED_TO_GET_USER_INFO});let i=String(h.user.id);if(!h.user.email)throw a.context.logger.error("User email not found",{provider:a.body.provider}),new g.LG("UNAUTHORIZED",{message:f.B.USER_EMAIL_NOT_FOUND});if((await a.context.internalAdapter.findAccounts(b.user.id)).find(a=>a.providerId===c.id&&a.accountId===i))return a.json({url:"",status:!0,redirect:!1});let j=a.context.options.account?.accountLinking?.trustedProviders;if(!j?.includes(c.id)&&!h.user.emailVerified||a.context.options.account?.accountLinking?.enabled===!1)throw new g.LG("UNAUTHORIZED",{message:"Account not linked - linking not allowed"});if(h.user.email!==b.user.email&&a.context.options.account?.accountLinking?.allowDifferentEmails!==!0)throw new g.LG("UNAUTHORIZED",{message:"Account not linked - different emails not allowed"});try{await a.context.internalAdapter.createAccount({userId:b.user.id,providerId:c.id,accountId:i,accessToken:a.body.idToken.accessToken,idToken:d,refreshToken:a.body.idToken.refreshToken,scope:a.body.idToken.scopes?.join(",")},a)}catch(a){throw new g.LG("EXPECTATION_FAILED",{message:"Account not linked - unable to create account"})}if(a.context.options.account?.accountLinking?.updateUserInfoOnLink===!0)try{await a.context.internalAdapter.updateUser(b.user.id,{name:h.user?.name,image:h.user?.image})}catch(a){console.warn("Could not update user - "+a.toString())}return a.json({url:"",status:!0,redirect:!1})}let d=await af(a,{userId:b.user.id,email:b.user.email}),e=await c.createAuthorizationURL({state:d.state,codeVerifier:d.codeVerifier,redirectURI:`${a.context.baseURL}/callback/${c.id}`,scopes:a.body.scopes});return a.json({url:e.toString(),redirect:!a.body.disableRedirect})}),aP=(0,f.a)("/unlink-account",{method:"POST",body:e.Ikc({providerId:e.YjP(),accountId:e.YjP().optional()}),use:[f.f],metadata:{openapi:{description:"Unlink an account",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"}}}}}}}}}},async a=>{let{providerId:b,accountId:c}=a.body,d=await a.context.internalAdapter.findAccounts(a.context.session.user.id);if(1===d.length&&!a.context.options.account?.accountLinking?.allowUnlinkingAll)throw new g.LG("BAD_REQUEST",{message:f.B.FAILED_TO_UNLINK_LAST_ACCOUNT});let e=d.find(a=>c?a.accountId===c&&a.providerId===b:a.providerId===b);if(!e)throw new g.LG("BAD_REQUEST",{message:f.B.ACCOUNT_NOT_FOUND});return await a.context.internalAdapter.deleteAccount(e.id),a.json({status:!0})}),aQ=(0,f.a)("/get-access-token",{method:"POST",body:e.Ikc({providerId:e.YjP().meta({description:"The provider ID for the OAuth provider"}),accountId:e.YjP().meta({description:"The account ID associated with the refresh token"}).optional(),userId:e.YjP().meta({description:"The user ID associated with the account"}).optional()}),metadata:{openapi:{description:"Get a valid access token, doing a refresh if needed",responses:{200:{description:"A Valid access token",content:{"application/json":{schema:{type:"object",properties:{tokenType:{type:"string"},idToken:{type:"string"},accessToken:{type:"string"},refreshToken:{type:"string"},accessTokenExpiresAt:{type:"string",format:"date-time"},refreshTokenExpiresAt:{type:"string",format:"date-time"}}}}}},400:{description:"Invalid refresh token or provider configuration"}}}}},async a=>{let{providerId:b,accountId:c,userId:d}=a.body,e=a.request,h=await (0,f.g)(a);if(e&&!h)throw a.error("UNAUTHORIZED");let i=h?.user?.id||d;if(!i)throw new g.LG("BAD_REQUEST",{message:"Either userId or session is required"});if(!a.context.socialProviders.find(a=>a.id===b))throw new g.LG("BAD_REQUEST",{message:`Provider ${b} is not supported.`});let j=(await a.context.internalAdapter.findAccounts(i)).find(a=>c?a.id===c&&a.providerId===b:a.providerId===b);if(!j)throw new g.LG("BAD_REQUEST",{message:"Account not found"});let l=a.context.socialProviders.find(a=>a.id===b);if(!l)throw new g.LG("BAD_REQUEST",{message:`Provider ${b} not found.`});try{let b=null,c=j.accessTokenExpiresAt&&new Date(j.accessTokenExpiresAt).getTime()-Date.now()<5e3;j.refreshToken&&c&&l.refreshAccessToken&&(b=await l.refreshAccessToken(j.refreshToken),await a.context.internalAdapter.updateAccount(j.id,{accessToken:await aj(b.accessToken,a.context),accessTokenExpiresAt:b.accessTokenExpiresAt,refreshToken:await aj(b.refreshToken,a.context),refreshTokenExpiresAt:b.refreshTokenExpiresAt}));let d={accessToken:await function(a,b){return a&&b.options.account?.encryptOAuthTokens?(0,k.zp)({key:b.secret,data:a}):a}(b?.accessToken??j.accessToken??"",a.context),accessTokenExpiresAt:b?.accessTokenExpiresAt??j.accessTokenExpiresAt??void 0,scopes:j.scope?.split(",")??[],idToken:b?.idToken??j.idToken??void 0};return a.json(d)}catch(a){throw new g.LG("BAD_REQUEST",{message:"Failed to get a valid access token",cause:a})}}),aR=(0,f.a)("/refresh-token",{method:"POST",body:e.Ikc({providerId:e.YjP().meta({description:"The provider ID for the OAuth provider"}),accountId:e.YjP().meta({description:"The account ID associated with the refresh token"}).optional(),userId:e.YjP().meta({description:"The user ID associated with the account"}).optional()}),metadata:{openapi:{description:"Refresh the access token using a refresh token",responses:{200:{description:"Access token refreshed successfully",content:{"application/json":{schema:{type:"object",properties:{tokenType:{type:"string"},idToken:{type:"string"},accessToken:{type:"string"},refreshToken:{type:"string"},accessTokenExpiresAt:{type:"string",format:"date-time"},refreshTokenExpiresAt:{type:"string",format:"date-time"}}}}}},400:{description:"Invalid refresh token or provider configuration"}}}}},async a=>{let{providerId:b,accountId:c,userId:d}=a.body,e=a.request,h=await (0,f.g)(a);if(e&&!h)throw a.error("UNAUTHORIZED");let i=h?.user?.id||d;if(!i)throw new g.LG("BAD_REQUEST",{message:"Either userId or session is required"});let j=(await a.context.internalAdapter.findAccounts(i)).find(a=>c?a.id===c&&a.providerId===b:a.providerId===b);if(!j)throw new g.LG("BAD_REQUEST",{message:"Account not found"});let k=a.context.socialProviders.find(a=>a.id===b);if(!k)throw new g.LG("BAD_REQUEST",{message:`Provider ${b} not found.`});if(!k.refreshAccessToken)throw new g.LG("BAD_REQUEST",{message:`Provider ${b} does not support token refreshing.`});try{let b=await k.refreshAccessToken(j.refreshToken);return await a.context.internalAdapter.updateAccount(j.id,{accessToken:await aj(b.accessToken,a.context),refreshToken:await aj(b.refreshToken,a.context),accessTokenExpiresAt:b.accessTokenExpiresAt,refreshTokenExpiresAt:b.refreshTokenExpiresAt}),a.json(b)}catch(a){throw new g.LG("BAD_REQUEST",{message:"Failed to refresh access token",cause:a})}}),aS=(0,f.a)("/account-info",{method:"POST",use:[f.s],metadata:{openapi:{description:"Get the account info provided by the provider",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{user:{type:"object",properties:{id:{type:"string"},name:{type:"string"},email:{type:"string"},image:{type:"string"},emailVerified:{type:"boolean"}},required:["id","emailVerified"]},data:{type:"object",properties:{},additionalProperties:!0}},required:["user","data"],additionalProperties:!1}}}}}}},body:e.Ikc({accountId:e.YjP().meta({description:"The provider given account id for which to get the account info"})})},async a=>{let b=await a.context.internalAdapter.findAccount(a.body.accountId);if(!b||b.userId!==a.context.session.user.id)throw new g.LG("BAD_REQUEST",{message:"Account not found"});let c=a.context.socialProviders.find(a=>a.id===b.providerId);if(!c)throw new g.LG("INTERNAL_SERVER_ERROR",{message:`Provider account provider is ${b.providerId} but it is not configured`});let d=await aQ({...a,body:{accountId:b.id,providerId:b.providerId},returnHeaders:!1});if(!d.accessToken)throw new g.LG("BAD_REQUEST",{message:"Access token not found"});let e=await c.getUserInfo({...d,accessToken:d.accessToken});return a.json(e)}),aT=(0,V.zG)((a,b,c)=>{if(Array.isArray(a[b])&&Array.isArray(c))return a[b]=c,!0});function aU(a,b){let c={};for(let[d,e]of Object.entries(a))c[d]=async a=>{let c=await b,d={...a,context:{...c,returned:void 0,responseHeaders:void 0,session:null},path:e.path,headers:a?.headers?new Headers(a?.headers):void 0},{beforeHooks:f,afterHooks:h}=function(a){let b=a.options.plugins||[],c=[],d=[];a.options.hooks?.before&&c.push({matcher:()=>!0,handler:a.options.hooks.before}),a.options.hooks?.after&&d.push({matcher:()=>!0,handler:a.options.hooks.after});let e=b.map(a=>{if(a.hooks?.before)return a.hooks.before}).filter(a=>void 0!==a).flat(),f=b.map(a=>{if(a.hooks?.after)return a.hooks.after}).filter(a=>void 0!==a).flat();return e.length&&c.push(...e),f.length&&d.push(...f),{beforeHooks:c,afterHooks:d}}(c),i=await aV(d,f);if("context"in i&&i.context&&"object"==typeof i.context){let{headers:a,...b}=i.context;a&&a.forEach((a,b)=>{d.headers.set(b,a)}),d=aT(b,d)}else if(i)return a?.asResponse?(0,g.Zr)(i,{headers:a?.headers}):a?.returnHeaders?{headers:a?.headers,response:i}:i;d.asResponse=!1,d.returnHeaders=!0;let j=await e(d).catch(a=>{if(a instanceof g.LG)return{response:a,headers:a.headers?new Headers(a.headers):null};throw a});if(j&&j instanceof Response)return j;d.context.returned=j.response,d.context.responseHeaders=j.headers;let k=await aW(d,h);if(k.response&&(j.response=k.response),j.response instanceof g.LG&&(0,R.s)(c.logger.level,"debug")&&(j.response.stack=j.response.errorStack),j.response instanceof g.LG&&!a?.asResponse)throw j.response;return a?.asResponse?(0,g.Zr)(j.response,{headers:j.headers}):a?.returnHeaders?{headers:j.headers,response:j.response}:j.response},c[d].path=e.path,c[d].options=e.options;return c}async function aV(a,b){let c={};for(let d of b)if(d.matcher(a)){let b=await d.handler({...a,returnHeaders:!1}).catch(b=>{throw b instanceof g.LG&&(0,R.s)(a.context.logger.level,"debug")&&(b.stack=b.errorStack),b});if(b&&"object"==typeof b){if("context"in b&&"object"==typeof b.context){let{headers:a,...d}=b.context;a instanceof Headers&&(c.headers?a.forEach((a,b)=>{c.headers?.set(b,a)}):c.headers=a),c=aT(d,c);continue}return b}}return{context:c}}async function aW(a,b){for(let c of b)if(c.matcher(a)){let b=await c.handler(a).catch(b=>{if(b instanceof g.LG)return(0,R.s)(a.context.logger.level,"debug")&&(b.stack=b.errorStack),{response:b,headers:b.headers?new Headers(b.headers):null};throw b});b.headers&&b.headers.forEach((b,c)=>{a.context.responseHeaders?"set-cookie"===c.toLowerCase()?a.context.responseHeaders.append(c,b):a.context.responseHeaders.set(c,b):a.context.responseHeaders=new Headers({[c]:b})}),b.response&&(a.context.returned=b.response)}return{response:a.context.returned,headers:a.context.responseHeaders}}},4315:(a,b,c)=>{c.d(b,{L:()=>o});var d=c(47467),e=c(18804),f=c(93087),g=c(68228),h=c(54744),i=c(60353);let j=(0,i.CN)({is:a=>"ReturningNode"===a.kind,create:a=>(0,i.CN)({kind:"ReturningNode",selections:(0,i.CN)(a)}),cloneWithSelections:(a,b)=>(0,i.CN)({...a,selections:a.selections?(0,i.CN)([...a.selections,...b]):(0,i.CN)(b)})}),k=(0,i.CN)({is:a=>"ExplainNode"===a.kind,create:(a,b)=>(0,i.CN)({kind:"ExplainNode",format:a,options:b})});var l=c(24118);let m=(0,i.CN)({is:a=>"OutputNode"===a.kind,create:a=>(0,i.CN)({kind:"OutputNode",selections:(0,i.CN)(a)}),cloneWithSelections:(a,b)=>(0,i.CN)({...a,selections:a.selections?(0,i.CN)([...a.selections,...b]):(0,i.CN)(b)})});var n=c(47777);let o=(0,i.CN)({is:a=>e.L.is(a)||d.o.is(a)||f.U.is(a)||g.e.is(a)||l.r.is(a),cloneWithEndModifier:(a,b)=>(0,i.CN)({...a,endModifiers:a.endModifiers?(0,i.CN)([...a.endModifiers,b]):(0,i.CN)([b])}),cloneWithWhere:(a,b)=>(0,i.CN)({...a,where:a.where?h.o.cloneWithOperation(a.where,"And",b):h.o.create(b)}),cloneWithJoin:(a,b)=>(0,i.CN)({...a,joins:a.joins?(0,i.CN)([...a.joins,b]):(0,i.CN)([b])}),cloneWithReturning:(a,b)=>(0,i.CN)({...a,returning:a.returning?j.cloneWithSelections(a.returning,b):j.create(b)}),cloneWithoutReturning:a=>(0,i.CN)({...a,returning:void 0}),cloneWithoutWhere:a=>(0,i.CN)({...a,where:void 0}),cloneWithExplain:(a,b,c)=>(0,i.CN)({...a,explain:k.create(b,c?.toOperationNode())}),cloneWithTop:(a,b)=>(0,i.CN)({...a,top:b}),cloneWithOutput:(a,b)=>(0,i.CN)({...a,output:a.output?m.cloneWithSelections(a.output,b):m.create(b)}),cloneWithOrderByItems:(a,b)=>(0,i.CN)({...a,orderBy:a.orderBy?n.O.cloneWithItems(a.orderBy,b):n.O.create(b)}),cloneWithoutOrderBy:a=>(0,i.CN)({...a,orderBy:void 0})})},4424:(a,b,c)=>{c.d(b,{_:()=>f});var d=c(64515),e=c(70837);c(92769),c(94324),c(8897),c(23427),c(69744),c(5109),c(62767),c(61287);let f=(a,b)=>{let c=null,f=a=>({getFieldName:c})=>{let e=(a,b)=>{if(a&&b)return a.reduce((a,d)=>({...a,[c({model:b,field:d})]:!0}),{})};function f(a){switch(a){case"starts_with":return"startsWith";case"ends_with":return"endsWith";case"ne":return"not";case"not_in":return"notIn";default:return a}}let g=(a,b)=>{if(!b||!b.length)return{};if(1===b.length){let d=b[0];if(!d)return;return{[c({model:a,field:d.field})]:"eq"!==d.operator&&d.operator?{[f(d.operator)]:d.value}:d.value}}let d=b.filter(a=>"AND"===a.connector||!a.connector),e=b.filter(a=>"OR"===a.connector),g=d.map(b=>({[c({model:a,field:b.field})]:"eq"!==b.operator&&b.operator?{[f(b.operator)]:b.value}:b.value})),h=e.map(b=>({[c({model:a,field:b.field})]:"eq"!==b.operator&&b.operator?{[f(b.operator)]:b.value}:b.value}));return{...g.length?{AND:g}:{},...h.length?{OR:h}:{}}};return{async create({model:b,data:c,select:f}){if(!a[b])throw new d.B(`Model ${b} does not exist in the database. If you haven't generated the Prisma client, you need to run 'npx prisma generate'`);return await a[b].create({data:c,select:e(f,b)})},async findOne({model:b,where:c,select:f}){let h=g(b,c);if(!a[b])throw new d.B(`Model ${b} does not exist in the database. If you haven't generated the Prisma client, you need to run 'npx prisma generate'`);return await a[b].findFirst({where:h,select:e(f,b)})},async findMany({model:b,where:e,limit:f,offset:h,sortBy:i}){let j=g(b,e);if(!a[b])throw new d.B(`Model ${b} does not exist in the database. If you haven't generated the Prisma client, you need to run 'npx prisma generate'`);return await a[b].findMany({where:j,take:f||100,skip:h||0,...i?.field?{orderBy:{[c({model:b,field:i.field})]:"desc"===i.direction?"desc":"asc"}}:{}})},async count({model:b,where:c}){let e=g(b,c);if(!a[b])throw new d.B(`Model ${b} does not exist in the database. If you haven't generated the Prisma client, you need to run 'npx prisma generate'`);return await a[b].count({where:e})},async update({model:b,where:c,update:e}){if(!a[b])throw new d.B(`Model ${b} does not exist in the database. If you haven't generated the Prisma client, you need to run 'npx prisma generate'`);let f=g(b,c);return await a[b].update({where:f,data:e})},async updateMany({model:b,where:c,update:d}){let e=g(b,c),f=await a[b].updateMany({where:e,data:d});return f?f.count:0},async delete({model:b,where:c}){let d=g(b,c);try{await a[b].delete({where:d})}catch(a){}},async deleteMany({model:b,where:c}){let d=g(b,c),e=await a[b].deleteMany({where:d});return e?e.count:0},options:b}},g=null;g={config:{adapterId:"prisma",adapterName:"Prisma Adapter",usePlural:b.usePlural??!1,debugLogs:b.debugLogs??!1,transaction:!!b.transaction&&(b=>a.$transaction(a=>b((0,e.c)({config:g.config,adapter:f(a)})(c))))},adapter:f(a)};let h=(0,e.c)(g);return a=>(c=a,h(a))}},5091:(a,b,c)=>{function d(a,b="algorithm.name"){return TypeError(`CryptoKey does not support this operation, its ${b} must be ${a}`)}function e(a,b){return a.name===b}function f(a){return parseInt(a.name.slice(4),10)}c.d(b,{A:()=>h});var g=c(46639);let h=async(a,b,c)=>{if(b instanceof Uint8Array){if(!a.startsWith("HS"))throw TypeError((0,g.A)(b,"CryptoKey","KeyObject","JSON Web Key"));return crypto.subtle.importKey("raw",b,{hash:`SHA-${a.slice(-3)}`,name:"HMAC"},!1,[c])}return!function(a,b,c){switch(b){case"HS256":case"HS384":case"HS512":{if(!e(a.algorithm,"HMAC"))throw d("HMAC");let c=parseInt(b.slice(2),10);if(f(a.algorithm.hash)!==c)throw d(`SHA-${c}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!e(a.algorithm,"RSASSA-PKCS1-v1_5"))throw d("RSASSA-PKCS1-v1_5");let c=parseInt(b.slice(2),10);if(f(a.algorithm.hash)!==c)throw d(`SHA-${c}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!e(a.algorithm,"RSA-PSS"))throw d("RSA-PSS");let c=parseInt(b.slice(2),10);if(f(a.algorithm.hash)!==c)throw d(`SHA-${c}`,"algorithm.hash");break}case"Ed25519":case"EdDSA":if(!e(a.algorithm,"Ed25519"))throw d("Ed25519");break;case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":if(!e(a.algorithm,b))throw d(b);break;case"ES256":case"ES384":case"ES512":{if(!e(a.algorithm,"ECDSA"))throw d("ECDSA");let c=function(a){switch(a){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw Error("unreachable")}}(b);if(a.algorithm.namedCurve!==c)throw d(c,"algorithm.namedCurve");break}default:throw TypeError("CryptoKey does not support this operation")}if(c&&!a.usages.includes(c))throw TypeError(`CryptoKey does not support this operation, its usages must include ${c}.`)}(b,a,c),b}},5109:(a,b,c)=>{function d(a){return a?"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"}function e(a,b,c){let d="",e=0,f=0;for(let c of a)for(e=e<<8|c,f+=8;f>=6;)f-=6,d+=b[e>>f&63];if(f>0&&(d+=b[e<<6-f&63]),c){let a=(4-d.length%4)%4;d+="=".repeat(a)}return d}function f(a,b){let c=new Map;for(let a=0;a<b.length;a++)c.set(b[a],a);let d=[],e=0,f=0;for(let b of a){if("="===b)break;let a=c.get(b);if(void 0===a)throw Error(`Invalid Base64 character: ${b}`);e=e<<6|a,(f+=6)>=8&&(f-=8,d.push(e>>f&255))}return Uint8Array.from(d)}c.d(b,{K:()=>g,z:()=>h});let g={encode(a,b={}){let c=d(!1);return e("string"==typeof a?new TextEncoder().encode(a):new Uint8Array(a),c,b.padding??!0)},decode(a){"string"!=typeof a&&(a=new TextDecoder().decode(a));let b=d(a.includes("-")||a.includes("_"));return f(a,b)}},h={encode(a,b={}){let c=d(!0);return e("string"==typeof a?new TextEncoder().encode(a):new Uint8Array(a),c,b.padding??!0)},decode(a){let b=d(a.includes("-")||a.includes("_"));return f(a,b)}}},5761:(a,b,c)=>{c.d(b,{b:()=>m,c:()=>k,d:()=>o,g:()=>l,m:()=>i,p:()=>j,s:()=>n});var d=c(64515),e=c(84916),f=c(8897),g=c(5109),h=c(37305);c(92769),c(74823),c(33679);function i(a,b){if("string"==typeof a){var c=a;if("string"!=typeof c||0===c.length||c.length>100)throw Error(`Value provided to ms.parse() must be a string with length between 1 and 99. value=${JSON.stringify(c)}`);let b=/^(?<value>-?\d*\.?\d+) *(?<unit>milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|months?|mo|years?|yrs?|y)?$/i.exec(c);if(!b?.groups)return NaN;let{value:d,unit:e="ms"}=b.groups,f=parseFloat(d),g=e.toLowerCase();switch(g){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*f;case"months":case"month":case"mo":return 26298e5*f;case"weeks":case"week":case"w":return 6048e5*f;case"days":case"day":case"d":return 864e5*f;case"hours":case"hour":case"hrs":case"hr":case"h":return 36e5*f;case"minutes":case"minute":case"mins":case"min":case"m":return 6e4*f;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*f;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return f;default:throw Error(`Unknown unit "${g}" provided to ms.parse(). value=${JSON.stringify(c)}`)}}if("number"==typeof a){var d=a;if("number"!=typeof d||!Number.isFinite(d))throw Error("Value provided to ms.format() must be of type number.");let b=Math.abs(d);return b>=315576e5?`${Math.round(d/315576e5)}y`:b>=26298e5?`${Math.round(d/26298e5)}mo`:b>=6048e5?`${Math.round(d/6048e5)}w`:b>=864e5?`${Math.round(d/864e5)}d`:b>=36e5?`${Math.round(d/36e5)}h`:b>=6e4?`${Math.round(d/6e4)}m`:b>=1e3?`${Math.round(d/1e3)}s`:`${d}ms`}throw Error(`Value provided to ms() must be a string or number. value=${JSON.stringify(a)}`)}function j(a){let b=new Map;return a.split(", ").forEach(a=>{let[c,...d]=a.split(";").map(a=>a.trim()),[e,...f]=(c||"").split("="),g=f.join("=");if(!e||void 0===g)return;let h={value:g};d.forEach(a=>{let[b,...c]=a.split("="),d=c.join("="),e=b.trim().toLowerCase();switch(e){case"max-age":h["max-age"]=d?parseInt(d.trim(),10):void 0;break;case"expires":h.expires=d?new Date(d.trim()):void 0;break;case"domain":h.domain=d?d.trim():void 0;break;case"path":h.path=d?d.trim():void 0;break;case"secure":h.secure=!0;break;case"httponly":h.httponly=!0;break;case"samesite":h.samesite=d?d.trim().toLowerCase():void 0;break;default:h[e]=!d||d.trim()}}),b.set(e,h)}),b}function k(a){let b=(a.advanced?.useSecureCookies!==void 0?a.advanced?.useSecureCookies:void 0!==a.baseURL?!!a.baseURL.startsWith("https://"):f.b)?"__Secure-":"",c=!!a.advanced?.crossSubDomainCookies?.enabled,e=c?a.advanced?.crossSubDomainCookies?.domain||(a.baseURL?new URL(a.baseURL).hostname:void 0):void 0;if(c&&!e)throw new d.B("baseURL is required when crossSubdomainCookies are enabled");return function(d,f={}){let g=a.advanced?.cookiePrefix||"better-auth",h=a.advanced?.cookies?.[d]?.name||`${g}.${d}`,i=a.advanced?.cookies?.[d]?.attributes;return{name:`${b}${h}`,attributes:{secure:!!b,sameSite:"lax",path:"/",httpOnly:!0,...c?{domain:e}:{},...a.advanced?.defaultCookieAttributes,...f,...i}}}}function l(a){let b=k(a),c=b("session_token",{maxAge:a.session?.expiresIn||i("7d")/1e3}),d=b("session_data",{maxAge:a.session?.cookieCache?.maxAge||300}),e=b("dont_remember");return{sessionToken:{name:c.name,options:c.attributes},sessionData:{name:d.name,options:d.attributes},dontRememberToken:{name:e.name,options:e.attributes}}}async function m(a,b,c){if(a.context.options.session?.cookieCache?.enabled){let d={session:Object.entries(b.session).reduce((b,[c,d])=>{let e=a.context.options.session?.additionalFields?.[c];return e&&!1===e.returned||(b[c]=d),b},{}),user:b.user},f={...a.context.authCookies.sessionData.options,maxAge:c?void 0:a.context.authCookies.sessionData.options.maxAge},i=(0,e.g)(f.maxAge||60,"sec").getTime(),j=g.z.encode(JSON.stringify({session:d,expiresAt:i,signature:await (0,h.s)("SHA-256","base64urlnopad").sign(a.context.secret,JSON.stringify({...d,expiresAt:i}))}),{padding:!1});if(j.length>4093)return void a.context?.logger?.error(`Session data exceeds cookie size limit (${j.length} bytes > 4093 bytes). Consider reducing session data size or disabling cookie cache. Session will not be cached in cookie.`);a.setCookie(a.context.authCookies.sessionData.name,j,f)}}async function n(a,b,c,d){let e=await a.getSignedCookie(a.context.authCookies.dontRememberToken.name,a.context.secret);c=void 0!==c?c:!!e;let f=a.context.authCookies.sessionToken.options,g=c?void 0:a.context.sessionConfig.expiresIn;await a.setSignedCookie(a.context.authCookies.sessionToken.name,b.session.token,a.context.secret,{...f,maxAge:g,...d}),c&&await a.setSignedCookie(a.context.authCookies.dontRememberToken.name,"true",a.context.secret,a.context.authCookies.dontRememberToken.options),await m(a,b,c),a.context.setNewSession(b),a.context.options.secondaryStorage&&await a.context.secondaryStorage?.set(b.session.token,JSON.stringify({user:b.user,session:b.session}),Math.floor((new Date(b.session.expiresAt).getTime()-Date.now())/1e3))}function o(a,b){a.setCookie(a.context.authCookies.sessionToken.name,"",{...a.context.authCookies.sessionToken.options,maxAge:0}),a.setCookie(a.context.authCookies.sessionData.name,"",{...a.context.authCookies.sessionData.options,maxAge:0}),b||a.setCookie(a.context.authCookies.dontRememberToken.name,"",{...a.context.authCookies.dontRememberToken.options,maxAge:0})}},8897:(a,b,c)=>{c.d(b,{E:()=>m,a:()=>i,b:()=>h,c:()=>l,e:()=>f,g:()=>k,i:()=>j});let d=Object.create(null),e=a=>globalThis.process?.env||globalThis.Deno?.env.toObject()||globalThis.__env__||(a?d:globalThis),f=new Proxy(d,{get:(a,b)=>e()[b]??d[b],has:(a,b)=>b in e()||b in d,set:(a,b,c)=>(e(!0)[b]=c,!0),deleteProperty(a,b){if(!b)return!1;let c=e(!0);return delete c[b],!0},ownKeys:()=>Object.keys(e(!0))}),g="undefined"!=typeof process&&process.env&&"production"||"",h="production"===g,i="dev"===g||"development"===g,j=()=>"test"===g||function(a){return!!a&&"false"!==a}(f.TEST);function k(a,b){return"undefined"!=typeof process&&process.env?process.env[a]??b:"undefined"!=typeof Deno?Deno.env.get(a)??b:"undefined"!=typeof Bun?Bun.env[a]??b:b}function l(a,b=!0){let c=k(a);return c?"0"!==c&&"false"!==c.toLowerCase()&&""!==c:b}let m={get BETTER_AUTH_TELEMETRY_ENDPOINT(){return k("BETTER_AUTH_TELEMETRY_ENDPOINT","https://telemetry.better-auth.com/v1/track")}}},9005:(a,b,c)=>{c.d(b,{U:()=>e});var d=c(60353);let e=(0,d.CN)({is:a=>"SelectAllNode"===a.kind,create:()=>(0,d.CN)({kind:"SelectAllNode"})})},10106:(a,b,c)=>{c.d(b,{F:()=>d,x:()=>e});class d extends Error{node;constructor(a){super("no result"),this.node=a}}function e(a){return Object.prototype.hasOwnProperty.call(a,"prototype")}},12034:(a,b,c)=>{c.d(b,{R:()=>h});var d=c(60353),e=c(48137),f=c(80234);let g=(0,d.CN)([]);class h{#an;constructor(a=g){this.#an=a}get plugins(){return this.#an}transformQuery(a,b){for(let c of this.#an){let d=c.transformQuery({node:a,queryId:b});if(d.kind===a.kind)a=d;else throw Error(`KyselyPlugin.transformQuery must return a node of the same kind that was given to it. The plugin was given a ${a.kind} but it returned a ${d.kind}`)}return a}async executeQuery(a){return await this.provideConnection(async b=>{let c=await b.executeQuery(a);return"numUpdatedOrDeletedRows"in c&&(0,f.u)("kysely:warning: outdated driver/plugin detected! `QueryResult.numUpdatedOrDeletedRows` has been replaced with `QueryResult.numAffectedRows`."),await this.#ao(c,a.queryId)})}async *stream(a,b){let{connection:c,release:d}=await (0,e.G)(this);try{for await(let d of c.streamQuery(a,b))yield await this.#ao(d,a.queryId)}finally{d()}}async #ao(a,b){for(let c of this.#an)a=await c.transformResult({result:a,queryId:b});return a}}},17793:(a,b,c)=>{c.d(b,{b:()=>h});var d=c(60353),e=c(55914),f=c(28244);let g=(0,d.CN)({is:a=>"OnNode"===a.kind,create:a=>(0,d.CN)({kind:"OnNode",on:a}),cloneWithOperation:(a,b,c)=>(0,d.CN)({...a,on:"And"===b?e.s.create(a.on,c):f.K.create(a.on,c)})}),h=(0,d.CN)({is:a=>"JoinNode"===a.kind,create:(a,b)=>(0,d.CN)({kind:"JoinNode",joinType:a,table:b,on:void 0}),createWithOn:(a,b,c)=>(0,d.CN)({kind:"JoinNode",joinType:a,table:b,on:g.create(c)}),cloneWithOn:(a,b)=>(0,d.CN)({...a,on:a.on?g.cloneWithOperation(a.on,"And",b):g.create(b)})})},18804:(a,b,c)=>{c.d(b,{L:()=>k});var d=c(60353),e=c(75227);let f=(0,d.CN)({is:a=>"GroupByNode"===a.kind,create:a=>(0,d.CN)({kind:"GroupByNode",items:(0,d.CN)(a)}),cloneWithItems:(a,b)=>(0,d.CN)({...a,items:(0,d.CN)([...a.items,...b])})});var g=c(55914),h=c(28244);let i=(0,d.CN)({is:a=>"HavingNode"===a.kind,create:a=>(0,d.CN)({kind:"HavingNode",having:a}),cloneWithOperation:(a,b,c)=>(0,d.CN)({...a,having:"And"===b?g.s.create(a.having,c):h.K.create(a.having,c)})});var j=c(4315);let k=(0,d.CN)({is:a=>"SelectQueryNode"===a.kind,create:a=>(0,d.CN)({kind:"SelectQueryNode",...a&&{with:a}}),createFrom:(a,b)=>(0,d.CN)({kind:"SelectQueryNode",from:e.N.create(a),...b&&{with:b}}),cloneWithSelections:(a,b)=>(0,d.CN)({...a,selections:a.selections?(0,d.CN)([...a.selections,...b]):(0,d.CN)(b)}),cloneWithDistinctOn:(a,b)=>(0,d.CN)({...a,distinctOn:a.distinctOn?(0,d.CN)([...a.distinctOn,...b]):(0,d.CN)(b)}),cloneWithFrontModifier:(a,b)=>(0,d.CN)({...a,frontModifiers:a.frontModifiers?(0,d.CN)([...a.frontModifiers,b]):(0,d.CN)([b])}),cloneWithOrderByItems:(a,b)=>j.L.cloneWithOrderByItems(a,b),cloneWithGroupByItems:(a,b)=>(0,d.CN)({...a,groupBy:a.groupBy?f.cloneWithItems(a.groupBy,b):f.create(b)}),cloneWithLimit:(a,b)=>(0,d.CN)({...a,limit:b}),cloneWithOffset:(a,b)=>(0,d.CN)({...a,offset:b}),cloneWithFetch:(a,b)=>(0,d.CN)({...a,fetch:b}),cloneWithHaving:(a,b)=>(0,d.CN)({...a,having:a.having?i.cloneWithOperation(a.having,"And",b):i.create(b)}),cloneWithSetOperations:(a,b)=>(0,d.CN)({...a,setOperations:a.setOperations?(0,d.CN)([...a.setOperations,...b]):(0,d.CN)([...b])}),cloneWithoutSelections:a=>(0,d.CN)({...a,selections:[]}),cloneWithoutLimit:a=>(0,d.CN)({...a,limit:void 0}),cloneWithoutOffset:a=>(0,d.CN)({...a,offset:void 0}),cloneWithoutOrderBy:a=>j.L.cloneWithoutOrderBy(a),cloneWithoutGroupBy:a=>(0,d.CN)({...a,groupBy:void 0})})},19151:(a,b,c)=>{c.d(b,{B:()=>n});var d=c(44625),e=c(81266),f=c(17793),g=c(97831),h=c(42437),i=c(36923),j=c(69385);let k=(0,c(60353).CN)({AlterTableNode:!0,CreateIndexNode:!0,CreateSchemaNode:!0,CreateTableNode:!0,CreateTypeNode:!0,CreateViewNode:!0,RefreshMaterializedViewNode:!0,DeleteQueryNode:!0,DropIndexNode:!0,DropSchemaNode:!0,DropTableNode:!0,DropTypeNode:!0,DropViewNode:!0,InsertQueryNode:!0,RawNode:!0,SelectQueryNode:!0,UpdateQueryNode:!0,MergeQueryNode:!0}),l={json_agg:!0,to_json:!0};class m extends h.V{#ap;#aq=new Set;#ar=new Set;constructor(a){super(),this.#ap=a}transformNodeImpl(a,b){if(!this.#as(a))return super.transformNodeImpl(a,b);let c=this.#at(a);for(let a of c)this.#ar.add(a);let d=this.#au(a);for(let a of d)this.#aq.add(a);let e=super.transformNodeImpl(a,b);for(let a of d)this.#aq.delete(a);for(let a of c)this.#ar.delete(a);return e}transformSchemableIdentifier(a,b){let c=super.transformSchemableIdentifier(a,b);return c.schema||!this.#aq.has(a.identifier.name)?c:{...c,schema:e.O.create(this.#ap)}}transformReferences(a,b){let c=super.transformReferences(a,b);return c.table.table.schema?c:{...c,table:j.H.createWithSchema(this.#ap,c.table.table.identifier.name)}}transformAggregateFunction(a,b){return{...super.transformAggregateFunction({...a,aggregated:[]},b),aggregated:this.#av(a,b,"aggregated")}}transformFunction(a,b){return{...super.transformFunction({...a,arguments:[]},b),arguments:this.#av(a,b,"arguments")}}#av(a,b,c){return l[a.func]?a[c].map(a=>!j.H.is(a)||a.table.schema?this.transformNode(a,b):{...a,table:this.transformIdentifier(a.table.identifier,b)}):this.transformNodeList(a[c],b)}#as(a){return a.kind in k}#au(a){let b=new Set;if("name"in a&&a.name&&i.y.is(a.name)&&this.#aw(a.name,b),"from"in a&&a.from)for(let c of a.from.froms)this.#ax(c,b);if("into"in a&&a.into&&this.#ax(a.into,b),"table"in a&&a.table&&this.#ax(a.table,b),"joins"in a&&a.joins)for(let c of a.joins)this.#ax(c.table,b);return"using"in a&&a.using&&(f.b.is(a.using)?this.#ax(a.using.table,b):this.#ax(a.using,b)),b}#at(a){let b=new Set;return"with"in a&&a.with&&this.#ay(a.with,b),b}#ax(a,b){if(j.H.is(a))this.#aw(a.table,b);else if(d.N.is(a)&&j.H.is(a.node))this.#aw(a.node.table,b);else if(g.v.is(a))for(let c of a.items)this.#ax(c,b)}#aw(a,b){let c=a.identifier.name;this.#aq.has(c)||this.#ar.has(c)||b.add(c)}#ay(a,b){for(let c of a.expressions){let a=c.name.table.table.identifier.name;this.#ar.has(a)||b.add(a)}}}class n{#H;constructor(a){this.#H=new m(a)}transformQuery(a){return this.#H.transformNode(a.node,a.queryId)}async transformResult(a){return a.result}}},19795:(a,b,c)=>{c.d(b,{JB:()=>j,M$:()=>m,Xm:()=>l,uJ:()=>k});var d=c(60353),e=c(44625),f=c(69385),g=c(57105),h=c(81266),i=c(20527);function j(a){return(0,d.MH)(a)?a.map(a=>k(a)):[k(a)]}function k(a){return(0,d.Kg)(a)?l(a):(0,i.uc)(a)?a.toOperationNode():(0,g.v0)(a)}function l(a){let b=" as ";if(!a.includes(b))return m(a);{let[c,d]=a.split(b).map(n);return e.N.create(m(c),h.O.create(d))}}function m(a){if(!a.includes("."))return f.H.create(a);{let[b,c]=a.split(".").map(n);return f.H.createWithSchema(b,c)}}function n(a){return a.trim()}},20527:(a,b,c)=>{c.d(b,{bj:()=>i,uc:()=>k});var d=c(44625),e=c(81266),f=c(39450),g=c(19795),h=c(60353);class i{#az;get table(){return this.#az}constructor(a){this.#az=a}as(a){return new j(this.#az,a)}}class j{#az;#aA;get table(){return this.#az}get alias(){return this.#aA}constructor(a,b){this.#az=a,this.#aA=b}toOperationNode(){return d.N.create((0,g.M$)(this.#az),e.O.create(this.#aA))}}function k(a){return(0,h.Gv)(a)&&(0,f.N)(a)&&(0,h.Kg)(a.table)&&(0,h.Kg)(a.alias)}},22795:(a,b,c)=>{c.d(b,{W:()=>f});var d=c(12034);class e extends d.R{get adapter(){throw Error("this query cannot be compiled to SQL")}compileQuery(){throw Error("this query cannot be compiled to SQL")}provideConnection(){throw Error("this query cannot be executed")}withConnectionProvider(){throw Error("this query cannot have a connection provider")}withPlugin(a){return new e([...this.plugins,a])}withPlugins(a){return new e([...this.plugins,...a])}withPluginAtFront(a){return new e([a,...this.plugins])}withoutPlugins(){return new e([])}}let f=new e},23090:(a,b,c)=>{c.d(b,{E:()=>g});var d=c(31575),e=c(60353),f=c(31700);let g=(0,e.CN)({raw:(a,b=[])=>(0,e.CN)({sql:a,query:d.z.createWithSql(a),parameters:(0,e.CN)(b),queryId:(0,f.a)()})})},23427:(a,b,c)=>{c.d(b,{LG:()=>l,UD:()=>B,Ny:()=>A,aE:()=>bP,Zr:()=>o});var d=c(40016);let e=(()=>{let a=function(){};return a.prototype=Object.create(null),a})();function f(){return{root:{key:""},static:new e}}function g(a){return a.split("/").filter(Boolean)}function h(a,b){let c=new e;for(let[d,e]of b){let b=d<0?a.slice(-1*d).join("/"):a[d];if("string"==typeof e)c[e]=b;else{let a=b.match(e);if(a)for(let b in a.groups)c[b]=a.groups[b]}}return c}function i(a,b="",c,d){let f=g(c),h=a.root,j=0,k=[];for(let a=0;a<f.length;a++){let b=f[a];if(b.startsWith("**")){h.wildcard||(h.wildcard={key:"**"}),h=h.wildcard,k.push([-a,b.split(":")[1]||"_",2===b.length]);break}if("*"===b||b.includes(":")){h.param||(h.param={key:"*"}),h=h.param;let c="*"===b;k.push([a,c?`_${j++}`:function(a){if(!a.includes(":",1))return a.slice(1);let b=a.replace(/:(\w+)/g,(a,b)=>`(?<${b}>\\w+)`);return RegExp(`^${b}$`)}(b),c]);continue}let c=h.static?.[b];if(c)h=c;else{let a={key:b};h.static||(h.static=new e),h.static[b]=a,h=a}}let l=k.length>0;h.methods||(h.methods=new e),h.methods[b]||(h.methods[b]=[]),h.methods[b].push({data:d||null,paramsMap:l?k:void 0}),l||(a.static[c]=h)}var j=Object.defineProperty,k={OK:200,CREATED:201,ACCEPTED:202,NO_CONTENT:204,MULTIPLE_CHOICES:300,MOVED_PERMANENTLY:301,FOUND:302,SEE_OTHER:303,NOT_MODIFIED:304,TEMPORARY_REDIRECT:307,BAD_REQUEST:400,UNAUTHORIZED:401,PAYMENT_REQUIRED:402,FORBIDDEN:403,NOT_FOUND:404,METHOD_NOT_ALLOWED:405,NOT_ACCEPTABLE:406,PROXY_AUTHENTICATION_REQUIRED:407,REQUEST_TIMEOUT:408,CONFLICT:409,GONE:410,LENGTH_REQUIRED:411,PRECONDITION_FAILED:412,PAYLOAD_TOO_LARGE:413,URI_TOO_LONG:414,UNSUPPORTED_MEDIA_TYPE:415,RANGE_NOT_SATISFIABLE:416,EXPECTATION_FAILED:417,"I'M_A_TEAPOT":418,MISDIRECTED_REQUEST:421,UNPROCESSABLE_ENTITY:422,LOCKED:423,FAILED_DEPENDENCY:424,TOO_EARLY:425,UPGRADE_REQUIRED:426,PRECONDITION_REQUIRED:428,TOO_MANY_REQUESTS:429,REQUEST_HEADER_FIELDS_TOO_LARGE:431,UNAVAILABLE_FOR_LEGAL_REASONS:451,INTERNAL_SERVER_ERROR:500,NOT_IMPLEMENTED:501,BAD_GATEWAY:502,SERVICE_UNAVAILABLE:503,GATEWAY_TIMEOUT:504,HTTP_VERSION_NOT_SUPPORTED:505,VARIANT_ALSO_NEGOTIATES:506,INSUFFICIENT_STORAGE:507,LOOP_DETECTED:508,NOT_EXTENDED:510,NETWORK_AUTHENTICATION_REQUIRED:511},l=function(a,b){class c extends a{#aB;constructor(...a){if(function(){let a=Object.getOwnPropertyDescriptor(Error,"stackTraceLimit");return void 0===a?Object.isExtensible(Error):Object.prototype.hasOwnProperty.call(a,"writable")?a.writable:void 0!==a.set}()){let b=Error.stackTraceLimit;Error.stackTraceLimit=0,super(...a),Error.stackTraceLimit=b}else super(...a);let b=Error().stack;b&&(this.#aB=function(a){let b=a.split("\n    at ");return b.length<=1?a:(b.splice(1,1),b.join("\n    at "))}(b.replace(/^Error/,this.name)))}get errorStack(){return this.#aB}}return Object.defineProperty(c.prototype,"constructor",{get:()=>b,enumerable:!1,configurable:!0}),c}(class extends Error{constructor(a="INTERNAL_SERVER_ERROR",b,c={},d="number"==typeof a?a:k[a]){super(b?.message,b?.cause?{cause:b.cause}:void 0),this.status=a,this.body=b,this.headers=c,this.statusCode=d,this.name="APIError",this.status=a,this.headers=c,this.statusCode=d,this.body=b?{code:b?.message?.toUpperCase().replace(/ /g,"_").replace(/[^A-Z0-9_]/g,""),...b}:void 0}},Error);async function m(a){let b=a.headers.get("content-type")||"";if(a.body){if(b.includes("application/json"))return await a.json();if(b.includes("application/x-www-form-urlencoded")){let b=await a.formData(),c={};return b.forEach((a,b)=>{c[b]=a.toString()}),c}if(b.includes("multipart/form-data")){let b=await a.formData(),c={};return b.forEach((a,b)=>{c[b]=a}),c}return b.includes("text/plain")?await a.text():b.includes("application/octet-stream")?await a.arrayBuffer():b.includes("application/pdf")||b.includes("image/")||b.includes("video/")?await a.blob():b.includes("application/stream")||a.body instanceof ReadableStream?a.body:await a.text()}}function n(a){return a instanceof l||a?.name==="APIError"}function o(a,b){if(a instanceof Response)return b?.headers instanceof Headers&&b.headers.forEach((b,c)=>{a.headers.set(c,b)}),a;if(a&&"object"==typeof a&&"_flag"in a&&"json"===a._flag){let c=a.body,d=a.routerResponse;if(d instanceof Response)return d;let e=new Headers({...d?.headers,...a.headers,...b?.headers,"Content-Type":"application/json"});return new Response(JSON.stringify(c),{...d,headers:e,status:a.status??b?.status??d?.status,statusText:b?.statusText??d?.statusText})}if(n(a))return o(a.body,{status:b?.status??a.statusCode,statusText:a.status.toString(),headers:b?.headers||a.headers});let c=a,d=new Headers(b?.headers);return a?"string"==typeof a?(c=a,d.set("Content-Type","text/plain")):a instanceof ArrayBuffer||ArrayBuffer.isView(a)?(c=a,d.set("Content-Type","application/octet-stream")):a instanceof Blob?(c=a,d.set("Content-Type",a.type||"application/octet-stream")):a instanceof FormData?c=a:a instanceof URLSearchParams?(c=a,d.set("Content-Type","application/x-www-form-urlencoded")):a instanceof ReadableStream?(c=a,d.set("Content-Type","application/octet-stream")):function(a){if(void 0===a)return!1;let b=typeof a;return"string"===b||"number"===b||"boolean"===b||null===b||"object"===b&&(!!Array.isArray(a)||!a.buffer&&(a.constructor&&"Object"===a.constructor.name||"function"==typeof a.toJSON))}(a)&&(c=function(a,b,c){let d=0,e=new WeakMap;return JSON.stringify(a,(a,b)=>{if("bigint"==typeof b)return b.toString();if("object"==typeof b&&null!==b){if(e.has(b))return`[Circular ref-${e.get(b)}]`;e.set(b,d++)}return b},void 0)}(a),d.set("Content-Type","application/json")):(null===a&&(c=JSON.stringify(null)),d.set("content-type","application/json")),new Response(c,{...b,headers:d})}async function p(a,b={}){let c={body:b.body,query:b.query};if(a.body){let d=await a.body["~standard"].validate(b.body);if(d.issues)return{data:null,error:q(d.issues,"body")};c.body=d.value}if(a.query){let d=await a.query["~standard"].validate(b.query);if(d.issues)return{data:null,error:q(d.issues,"query")};c.query=d.value}return a.requireHeaders&&!b.headers?{data:null,error:{message:"Headers is required"}}:a.requireRequest&&!b.request?{data:null,error:{message:"Request is required"}}:{data:c,error:null}}function q(a,b){let c=[];for(let b of a){let a=b.message;c.push(a)}return{message:`Invalid ${b} parameters`}}var r={name:"HMAC",hash:"SHA-256"},s=async a=>{let b="string"==typeof a?new TextEncoder().encode(a):a;return await (0,d.N)().importKey("raw",b,r,!1,["sign","verify"])},t=async(a,b,c)=>{try{let e=atob(a),f=new Uint8Array(e.length);for(let a=0,b=e.length;a<b;a++)f[a]=e.charCodeAt(a);return await (0,d.N)().verify(r,c,f,new TextEncoder().encode(b))}catch(a){return!1}},u=async(a,b)=>{let c=await s(b);return btoa(String.fromCharCode(...new Uint8Array(await (0,d.N)().sign(r.name,c,new TextEncoder().encode(a)))))},v=async(a,b)=>{let c=await u(a,b);return encodeURIComponent(a=`${a}.${c}`)},w=(a,b)=>{let c=a;if(b)if("secure"===b)c="__Secure-"+a;else{if("host"!==b)return;c="__Host-"+a}return c},x=(a,b,c={})=>{let d;if(d=c?.prefix==="secure"?`__Secure-${a}=${b}`:c?.prefix==="host"?`__Host-${a}=${b}`:`${a}=${b}`,a.startsWith("__Secure-")&&!c.secure&&(c.secure=!0),a.startsWith("__Host-")&&(c.secure||(c.secure=!0),"/"!==c.path&&(c.path="/"),c.domain&&(c.domain=void 0)),c&&"number"==typeof c.maxAge&&c.maxAge>=0){if(c.maxAge>3456e4)throw Error("Cookies Max-Age SHOULD NOT be greater than 400 days (34560000 seconds) in duration.");d+=`; Max-Age=${Math.floor(c.maxAge)}`}if(c.domain&&"host"!==c.prefix&&(d+=`; Domain=${c.domain}`),c.path&&(d+=`; Path=${c.path}`),c.expires){if(c.expires.getTime()-Date.now()>3456e7)throw Error("Cookies Expires SHOULD NOT be greater than 400 days (34560000 seconds) in the future.");d+=`; Expires=${c.expires.toUTCString()}`}return c.httpOnly&&(d+="; HttpOnly"),c.secure&&(d+="; Secure"),c.sameSite&&(d+=`; SameSite=${c.sameSite.charAt(0).toUpperCase()+c.sameSite.slice(1)}`),c.partitioned&&(c.secure||(c.secure=!0),d+="; Partitioned"),d},y=async(a,b,c,d)=>x(a,b=await v(b,c),d),z=async(a,{options:b,path:c})=>{let d=new Headers,{data:e,error:f}=await p(b,a);if(f)throw new l(400,{message:f.message,code:"VALIDATION_ERROR"});let g="headers"in a?a.headers instanceof Headers?a.headers:new Headers(a.headers):"request"in a&&a.request instanceof Request?a.request.headers:null,h=g?.get("cookie"),i=h?function(a){if("string"!=typeof a)throw TypeError("argument str must be a string");let b=new Map,c=0;for(;c<a.length;){let d=a.indexOf("=",c);if(-1===d)break;let e=a.indexOf(";",c);if(-1===e)e=a.length;else if(e<d){c=a.lastIndexOf(";",d-1)+1;continue}let f=a.slice(c,d).trim();if(!b.has(f)){let c=a.slice(d+1,e).trim();34===c.codePointAt(0)&&(c=c.slice(1,-1)),b.set(f,function(a){try{return a.includes("%")?decodeURIComponent(a):a}catch{return a}}(c))}c=e+1}return b}(h):void 0,j={...a,body:e.body,query:e.query,path:a.path||c,context:"context"in a&&a.context?a.context:{},returned:void 0,headers:a?.headers,request:a?.request,params:"params"in a?a.params:void 0,method:a.method,setHeader:(a,b)=>{d.set(a,b)},getHeader:a=>g?g.get(a):null,getCookie:(a,b)=>{let c=w(a,b);return c&&i?.get(c)||null},getSignedCookie:async(a,b,c)=>{let d=w(a,c);if(!d)return null;let e=i?.get(d);if(!e)return null;let f=e.lastIndexOf(".");if(f<1)return null;let g=e.substring(0,f),h=e.substring(f+1);if(44!==h.length||!h.endsWith("="))return null;let j=await s(b);return!!await t(h,g,j)&&g},setCookie:(a,b,c)=>{let e=((a,b,c)=>x(a,b=encodeURIComponent(b),c))(a,b,c);return d.append("set-cookie",e),e},setSignedCookie:async(a,b,c,e)=>{let f=await y(a,b,c,e);return d.append("set-cookie",f),f},redirect:a=>(d.set("location",a),new l("FOUND",void 0,d)),error:(a,b,c)=>new l(a,b,c),json:(b,c)=>a.asResponse?{body:c?.body||b,routerResponse:c,_flag:"json"}:b,responseHeaders:d};for(let a of b.use||[]){let b=await a({...j,returnHeaders:!0,asResponse:!1});b.response&&Object.assign(j.context,b.response),b.headers&&b.headers.forEach((a,b)=>{j.responseHeaders.set(b,a)})}return j};function A(a,b){let c=async c=>{let d="function"==typeof a?a:b,e=await z(c,{options:"function"==typeof a?{}:a,path:"/"});if(!d)throw Error("handler must be defined");let f=await d(e),g=e.responseHeaders;return c.returnHeaders?{headers:g,response:f}:f};return c.options="function"==typeof a?{}:a,c}A.create=a=>function(b,c){if("function"==typeof b)return A({use:a?.use},b);if(!c)throw Error("Middleware handler is required");return A({...b,method:"*",use:[...a?.use||[],...b.use||[]]},c)};var B=(a,b,c)=>{let d=async(...d)=>{let e=d[0]||{},f=await z(e,{options:b,path:a}),g=await c(f).catch(async a=>{if(n(a)){let c=b.onAPIError;if(c&&await c(a),e.asResponse)return a}throw a}),h=f.responseHeaders;return e.asResponse?o(g,{headers:h}):e.returnHeaders?{headers:h,response:g}:g};return d.options=b,d.path=a,d};function C(a,b,c){function d(c,d){var e;for(let f in Object.defineProperty(c,"_zod",{value:c._zod??{},enumerable:!1}),(e=c._zod).traits??(e.traits=new Set),c._zod.traits.add(a),b(c,d),g.prototype)f in c||Object.defineProperty(c,f,{value:g.prototype[f].bind(c)});c._zod.constr=g,c._zod.def=d}let e=c?.Parent??Object;class f extends e{}function g(a){var b;let e=c?.Parent?new f:this;for(let c of(d(e,a),(b=e._zod).deferred??(b.deferred=[]),e._zod.deferred))c();return e}return Object.defineProperty(f,"name",{value:a}),Object.defineProperty(g,"init",{value:d}),Object.defineProperty(g,Symbol.hasInstance,{value:b=>!!c?.Parent&&b instanceof c.Parent||b?._zod?.traits?.has(a)}),Object.defineProperty(g,"name",{value:a}),g}B.create=a=>(b,c,d)=>B(b,{...c,use:[...c?.use||[],...a?.use||[]]},d),Object.freeze({status:"aborted"}),Symbol("zod_brand");var D=class extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}},E={};function F(a){return a&&Object.assign(E,a),E}var G={};function H(a){return a}function I(a){return a}function J(a){}function K(a){throw Error()}function L(a){}function M(a){let b=Object.values(a).filter(a=>"number"==typeof a);return Object.entries(a).filter(([a,c])=>-1===b.indexOf(+a)).map(([a,b])=>b)}function N(a,b="|"){return a.map(a=>aj(a)).join(b)}function O(a,b){return"bigint"==typeof b?b.toString():b}function P(a){return{get value(){{let b=a();return Object.defineProperty(this,"value",{value:b}),b}}}}function Q(a){return null==a}function R(a){let b=+!!a.startsWith("^"),c=a.endsWith("$")?a.length-1:a.length;return a.slice(b,c)}function S(a,b){let c=(a.toString().split(".")[1]||"").length,d=(b.toString().split(".")[1]||"").length,e=c>d?c:d;return Number.parseInt(a.toFixed(e).replace(".",""))%Number.parseInt(b.toFixed(e).replace(".",""))/10**e}function T(a,b,c){Object.defineProperty(a,b,{get(){{let d=c();return a[b]=d,d}},set(c){Object.defineProperty(a,b,{value:c})},configurable:!0})}function U(a,b,c){Object.defineProperty(a,b,{value:c,writable:!0,enumerable:!0,configurable:!0})}function V(a,b){return b?b.reduce((a,b)=>a?.[b],a):a}function W(a){let b=Object.keys(a);return Promise.all(b.map(b=>a[b])).then(a=>{let c={};for(let d=0;d<b.length;d++)c[b[d]]=a[d];return c})}function X(a=10){let b="abcdefghijklmnopqrstuvwxyz",c="";for(let d=0;d<a;d++)c+=b[Math.floor(Math.random()*b.length)];return c}function Y(a){return JSON.stringify(a)}((a,b)=>{for(var c in b)j(a,c,{get:b[c],enumerable:!0})})(G,{BIGINT_FORMAT_RANGES:()=>am,Class:()=>aB,NUMBER_FORMAT_RANGES:()=>al,aborted:()=>at,allowsEval:()=>_,assert:()=>L,assertEqual:()=>H,assertIs:()=>J,assertNever:()=>K,assertNotEqual:()=>I,assignProp:()=>U,cached:()=>P,captureStackTrace:()=>Z,cleanEnum:()=>aA,cleanRegex:()=>R,clone:()=>ag,createTransparentProxy:()=>ai,defineLazy:()=>T,esc:()=>Y,escapeRegex:()=>af,extend:()=>ap,finalizeIssue:()=>aw,floatSafeRemainder:()=>S,getElementAtPath:()=>V,getEnumValues:()=>M,getLengthableOrigin:()=>ay,getParsedType:()=>ac,getSizableOrigin:()=>ax,isObject:()=>$,isPlainObject:()=>aa,issue:()=>az,joinValues:()=>N,jsonStringifyReplacer:()=>O,merge:()=>aq,normalizeParams:()=>ah,nullish:()=>Q,numKeys:()=>ab,omit:()=>ao,optionalKeys:()=>ak,partial:()=>ar,pick:()=>an,prefixIssues:()=>au,primitiveTypes:()=>ae,promiseAllObject:()=>W,propertyKeyTypes:()=>ad,randomString:()=>X,required:()=>as,stringifyPrimitive:()=>aj,unwrapMessage:()=>av});var Z=Error.captureStackTrace?Error.captureStackTrace:(...a)=>{};function $(a){return"object"==typeof a&&null!==a&&!Array.isArray(a)}var _=P(()=>{if("undefined"!=typeof navigator&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{return Function(""),!0}catch(a){return!1}});function aa(a){if(!1===$(a))return!1;let b=a.constructor;if(void 0===b)return!0;let c=b.prototype;return!1!==$(c)&&!1!==Object.prototype.hasOwnProperty.call(c,"isPrototypeOf")}function ab(a){let b=0;for(let c in a)Object.prototype.hasOwnProperty.call(a,c)&&b++;return b}var ac=a=>{let b=typeof a;switch(b){case"undefined":return"undefined";case"string":return"string";case"number":return Number.isNaN(a)?"nan":"number";case"boolean":return"boolean";case"function":return"function";case"bigint":return"bigint";case"symbol":return"symbol";case"object":if(Array.isArray(a))return"array";if(null===a)return"null";if(a.then&&"function"==typeof a.then&&a.catch&&"function"==typeof a.catch)return"promise";if("undefined"!=typeof Map&&a instanceof Map)return"map";if("undefined"!=typeof Set&&a instanceof Set)return"set";if("undefined"!=typeof Date&&a instanceof Date)return"date";if("undefined"!=typeof File&&a instanceof File)return"file";return"object";default:throw Error(`Unknown data type: ${b}`)}},ad=new Set(["string","number","symbol"]),ae=new Set(["string","number","bigint","boolean","symbol","undefined"]);function af(a){return a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function ag(a,b,c){let d=new a._zod.constr(b??a._zod.def);return(!b||c?.parent)&&(d._zod.parent=a),d}function ah(a){if(!a)return{};if("string"==typeof a)return{error:()=>a};if(a?.message!==void 0){if(a?.error!==void 0)throw Error("Cannot specify both `message` and `error` params");a.error=a.message}return(delete a.message,"string"==typeof a.error)?{...a,error:()=>a.error}:a}function ai(a){let b;return new Proxy({},{get:(c,d,e)=>(b??(b=a()),Reflect.get(b,d,e)),set:(c,d,e,f)=>(b??(b=a()),Reflect.set(b,d,e,f)),has:(c,d)=>(b??(b=a()),Reflect.has(b,d)),deleteProperty:(c,d)=>(b??(b=a()),Reflect.deleteProperty(b,d)),ownKeys:c=>(b??(b=a()),Reflect.ownKeys(b)),getOwnPropertyDescriptor:(c,d)=>(b??(b=a()),Reflect.getOwnPropertyDescriptor(b,d)),defineProperty:(c,d,e)=>(b??(b=a()),Reflect.defineProperty(b,d,e))})}function aj(a){return"bigint"==typeof a?a.toString()+"n":"string"==typeof a?`"${a}"`:`${a}`}function ak(a){return Object.keys(a).filter(b=>"optional"===a[b]._zod.optin&&"optional"===a[b]._zod.optout)}var al={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-0x80000000,0x7fffffff],uint32:[0,0xffffffff],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]},am={int64:[BigInt("-9223372036854775808"),BigInt("9223372036854775807")],uint64:[BigInt(0),BigInt("18446744073709551615")]};function an(a,b){let c={},d=a._zod.def;for(let a in b){if(!(a in d.shape))throw Error(`Unrecognized key: "${a}"`);b[a]&&(c[a]=d.shape[a])}return ag(a,{...a._zod.def,shape:c,checks:[]})}function ao(a,b){let c={...a._zod.def.shape},d=a._zod.def;for(let a in b){if(!(a in d.shape))throw Error(`Unrecognized key: "${a}"`);b[a]&&delete c[a]}return ag(a,{...a._zod.def,shape:c,checks:[]})}function ap(a,b){if(!aa(b))throw Error("Invalid input to extend: expected a plain object");let c={...a._zod.def,get shape(){let c={...a._zod.def.shape,...b};return U(this,"shape",c),c},checks:[]};return ag(a,c)}function aq(a,b){return ag(a,{...a._zod.def,get shape(){let c={...a._zod.def.shape,...b._zod.def.shape};return U(this,"shape",c),c},catchall:b._zod.def.catchall,checks:[]})}function ar(a,b,c){let d=b._zod.def.shape,e={...d};if(c)for(let b in c){if(!(b in d))throw Error(`Unrecognized key: "${b}"`);c[b]&&(e[b]=a?new a({type:"optional",innerType:d[b]}):d[b])}else for(let b in d)e[b]=a?new a({type:"optional",innerType:d[b]}):d[b];return ag(b,{...b._zod.def,shape:e,checks:[]})}function as(a,b,c){let d=b._zod.def.shape,e={...d};if(c)for(let b in c){if(!(b in e))throw Error(`Unrecognized key: "${b}"`);c[b]&&(e[b]=new a({type:"nonoptional",innerType:d[b]}))}else for(let b in d)e[b]=new a({type:"nonoptional",innerType:d[b]});return ag(b,{...b._zod.def,shape:e,checks:[]})}function at(a,b=0){for(let c=b;c<a.issues.length;c++)if(a.issues[c]?.continue!==!0)return!0;return!1}function au(a,b){return b.map(b=>(b.path??(b.path=[]),b.path.unshift(a),b))}function av(a){return"string"==typeof a?a:a?.message}function aw(a,b,c){let d={...a,path:a.path??[]};return a.message||(d.message=av(a.inst?._zod.def?.error?.(a))??av(b?.error?.(a))??av(c.customError?.(a))??av(c.localeError?.(a))??"Invalid input"),delete d.inst,delete d.continue,b?.reportInput||delete d.input,d}function ax(a){return a instanceof Set?"set":a instanceof Map?"map":a instanceof File?"file":"unknown"}function ay(a){return Array.isArray(a)?"array":"string"==typeof a?"string":"unknown"}function az(...a){let[b,c,d]=a;return"string"==typeof b?{message:b,code:"custom",input:c,inst:d}:{...b}}function aA(a){return Object.entries(a).filter(([a,b])=>Number.isNaN(Number.parseInt(a,10))).map(a=>a[1])}var aB=class{constructor(...a){}},aC=(a,b)=>{a.name="$ZodError",Object.defineProperty(a,"_zod",{value:a._zod,enumerable:!1}),Object.defineProperty(a,"issues",{value:b,enumerable:!1}),Object.defineProperty(a,"message",{get:()=>JSON.stringify(b,O,2),enumerable:!0}),Object.defineProperty(a,"toString",{value:()=>a.message,enumerable:!1})},aD=C("$ZodError",aC),aE=C("$ZodError",aC,{Parent:Error}),aF=a=>(b,c,d)=>{let e=d?{...d,async:!1}:{async:!1},f=b._zod.run({value:c,issues:[]},e);if(f instanceof Promise)throw new D;return f.issues.length?{success:!1,error:new(a??aD)(f.issues.map(a=>aw(a,e,F())))}:{success:!0,data:f.value}},aG=aF(aE),aH=a=>async(b,c,d)=>{let e=d?Object.assign(d,{async:!0}):{async:!0},f=b._zod.run({value:c,issues:[]},e);return f instanceof Promise&&(f=await f),f.issues.length?{success:!1,error:new a(f.issues.map(a=>aw(a,e,F())))}:{success:!0,data:f.value}},aI=aH(aE),aJ=C("$ZodCheck",(a,b)=>{var c;a._zod??(a._zod={}),a._zod.def=b,(c=a._zod).onattach??(c.onattach=[])}),aK=C("$ZodCheckMaxLength",(a,b)=>{var c;aJ.init(a,b),(c=a._zod.def).when??(c.when=a=>{let b=a.value;return!Q(b)&&void 0!==b.length}),a._zod.onattach.push(a=>{let c=a._zod.bag.maximum??1/0;b.maximum<c&&(a._zod.bag.maximum=b.maximum)}),a._zod.check=c=>{let d=c.value;if(d.length<=b.maximum)return;let e=ay(d);c.issues.push({origin:e,code:"too_big",maximum:b.maximum,inclusive:!0,input:d,inst:a,continue:!b.abort})}}),aL=C("$ZodCheckMinLength",(a,b)=>{var c;aJ.init(a,b),(c=a._zod.def).when??(c.when=a=>{let b=a.value;return!Q(b)&&void 0!==b.length}),a._zod.onattach.push(a=>{let c=a._zod.bag.minimum??-1/0;b.minimum>c&&(a._zod.bag.minimum=b.minimum)}),a._zod.check=c=>{let d=c.value;if(d.length>=b.minimum)return;let e=ay(d);c.issues.push({origin:e,code:"too_small",minimum:b.minimum,inclusive:!0,input:d,inst:a,continue:!b.abort})}}),aM=C("$ZodCheckLengthEquals",(a,b)=>{var c;aJ.init(a,b),(c=a._zod.def).when??(c.when=a=>{let b=a.value;return!Q(b)&&void 0!==b.length}),a._zod.onattach.push(a=>{let c=a._zod.bag;c.minimum=b.length,c.maximum=b.length,c.length=b.length}),a._zod.check=c=>{let d=c.value,e=d.length;if(e===b.length)return;let f=ay(d),g=e>b.length;c.issues.push({origin:f,...g?{code:"too_big",maximum:b.length}:{code:"too_small",minimum:b.length},inclusive:!0,exact:!0,input:c.value,inst:a,continue:!b.abort})}}),aN=C("$ZodCheckOverwrite",(a,b)=>{aJ.init(a,b),a._zod.check=a=>{a.value=b.tx(a.value)}}),aO=class{constructor(a=[]){this.content=[],this.indent=0,this&&(this.args=a)}indented(a){this.indent+=1,a(this),this.indent-=1}write(a){if("function"==typeof a){a(this,{execution:"sync"}),a(this,{execution:"async"});return}let b=a.split("\n").filter(a=>a),c=Math.min(...b.map(a=>a.length-a.trimStart().length));for(let a of b.map(a=>a.slice(c)).map(a=>" ".repeat(2*this.indent)+a))this.content.push(a)}compile(){return Function(...this?.args,[...(this?.content??[""]).map(a=>`  ${a}`)].join("\n"))}},aP={major:4,minor:0,patch:0},aQ=C("$ZodType",(a,b)=>{var c;a??(a={}),a._zod.def=b,a._zod.bag=a._zod.bag||{},a._zod.version=aP;let d=[...a._zod.def.checks??[]];for(let b of(a._zod.traits.has("$ZodCheck")&&d.unshift(a),d))for(let c of b._zod.onattach)c(a);if(0===d.length)(c=a._zod).deferred??(c.deferred=[]),a._zod.deferred?.push(()=>{a._zod.run=a._zod.parse});else{let b=(a,b,c)=>{let d,e=at(a);for(let f of b){if(f._zod.def.when){if(!f._zod.def.when(a))continue}else if(e)continue;let b=a.issues.length,g=f._zod.check(a);if(g instanceof Promise&&c?.async===!1)throw new D;if(d||g instanceof Promise)d=(d??Promise.resolve()).then(async()=>{await g,a.issues.length!==b&&(e||(e=at(a,b)))});else{if(a.issues.length===b)continue;e||(e=at(a,b))}}return d?d.then(()=>a):a};a._zod.run=(c,e)=>{let f=a._zod.parse(c,e);if(f instanceof Promise){if(!1===e.async)throw new D;return f.then(a=>b(a,d,e))}return b(f,d,e)}}a["~standard"]={validate:b=>{try{let c=aG(a,b);return c.success?{value:c.data}:{issues:c.error?.issues}}catch(c){return aI(a,b).then(a=>a.success?{value:a.data}:{issues:a.error?.issues})}},vendor:"zod",version:1}}),aR=C("$ZodUnknown",(a,b)=>{aQ.init(a,b),a._zod.parse=a=>a}),aS=C("$ZodNever",(a,b)=>{aQ.init(a,b),a._zod.parse=(b,c)=>(b.issues.push({expected:"never",code:"invalid_type",input:b.value,inst:a}),b)});function aT(a,b,c){a.issues.length&&b.issues.push(...au(c,a.issues)),b.value[c]=a.value}var aU=C("$ZodArray",(a,b)=>{aQ.init(a,b),a._zod.parse=(c,d)=>{let e=c.value;if(!Array.isArray(e))return c.issues.push({expected:"array",code:"invalid_type",input:e,inst:a}),c;c.value=Array(e.length);let f=[];for(let a=0;a<e.length;a++){let g=e[a],h=b.element._zod.run({value:g,issues:[]},d);h instanceof Promise?f.push(h.then(b=>aT(b,c,a))):aT(h,c,a)}return f.length?Promise.all(f).then(()=>c):c}});function aV(a,b,c){a.issues.length&&b.issues.push(...au(c,a.issues)),b.value[c]=a.value}function aW(a,b,c,d){a.issues.length?void 0===d[c]?c in d?b.value[c]=void 0:b.value[c]=a.value:b.issues.push(...au(c,a.issues)):void 0===a.value?c in d&&(b.value[c]=void 0):b.value[c]=a.value}var aX=C("$ZodObject",(a,b)=>{let c,d;aQ.init(a,b);let e=P(()=>{let a=Object.keys(b.shape);for(let c of a)if(!(b.shape[c]instanceof aQ))throw Error(`Invalid element at key "${c}": expected a Zod schema`);let c=ak(b.shape);return{shape:b.shape,keys:a,keySet:new Set(a),numKeys:a.length,optionalKeys:new Set(c)}});T(a._zod,"propValues",()=>{let a=b.shape,c={};for(let b in a){let d=a[b]._zod;if(d.values)for(let a of(c[b]??(c[b]=new Set),d.values))c[b].add(a)}return c});let f=!E.jitless,g=f&&_.value,h=b.catchall;a._zod.parse=(i,j)=>{d??(d=e.value);let k=i.value;if(!$(k))return i.issues.push({expected:"object",code:"invalid_type",input:k,inst:a}),i;let l=[];if(f&&g&&j?.async===!1&&!0!==j.jitless)c||(c=(a=>{let b=new aO(["shape","payload","ctx"]),c=e.value,d=a=>{let b=Y(a);return`shape[${b}]._zod.run({ value: input[${b}], issues: [] }, ctx)`};b.write("const input = payload.value;");let f=Object.create(null),g=0;for(let a of c.keys)f[a]=`key_${g++}`;for(let a of(b.write("const newResult = {}"),c.keys))if(c.optionalKeys.has(a)){let c=f[a];b.write(`const ${c} = ${d(a)};`);let e=Y(a);b.write(`
        if (${c}.issues.length) {
          if (input[${e}] === undefined) {
            if (${e} in input) {
              newResult[${e}] = undefined;
            }
          } else {
            payload.issues = payload.issues.concat(
              ${c}.issues.map((iss) => ({
                ...iss,
                path: iss.path ? [${e}, ...iss.path] : [${e}],
              }))
            );
          }
        } else if (${c}.value === undefined) {
          if (${e} in input) newResult[${e}] = undefined;
        } else {
          newResult[${e}] = ${c}.value;
        }
        `)}else{let c=f[a];b.write(`const ${c} = ${d(a)};`),b.write(`
          if (${c}.issues.length) payload.issues = payload.issues.concat(${c}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${Y(a)}, ...iss.path] : [${Y(a)}]
          })));`),b.write(`newResult[${Y(a)}] = ${c}.value`)}b.write("payload.value = newResult;"),b.write("return payload;");let h=b.compile();return(b,c)=>h(a,b,c)})(b.shape)),i=c(i,j);else{i.value={};let a=d.shape;for(let b of d.keys){let c=a[b],d=c._zod.run({value:k[b],issues:[]},j),e="optional"===c._zod.optin&&"optional"===c._zod.optout;d instanceof Promise?l.push(d.then(a=>e?aW(a,i,b,k):aV(a,i,b))):e?aW(d,i,b,k):aV(d,i,b)}}if(!h)return l.length?Promise.all(l).then(()=>i):i;let m=[],n=d.keySet,o=h._zod,p=o.def.type;for(let a of Object.keys(k)){if(n.has(a))continue;if("never"===p){m.push(a);continue}let b=o.run({value:k[a],issues:[]},j);b instanceof Promise?l.push(b.then(b=>aV(b,i,a))):aV(b,i,a)}return(m.length&&i.issues.push({code:"unrecognized_keys",keys:m,input:k,inst:a}),l.length)?Promise.all(l).then(()=>i):i}});function aY(a,b,c,d){for(let c of a)if(0===c.issues.length)return b.value=c.value,b;return b.issues.push({code:"invalid_union",input:b.value,inst:c,errors:a.map(a=>a.issues.map(a=>aw(a,d,F())))}),b}var aZ=C("$ZodUnion",(a,b)=>{aQ.init(a,b),T(a._zod,"optin",()=>b.options.some(a=>"optional"===a._zod.optin)?"optional":void 0),T(a._zod,"optout",()=>b.options.some(a=>"optional"===a._zod.optout)?"optional":void 0),T(a._zod,"values",()=>{if(b.options.every(a=>a._zod.values))return new Set(b.options.flatMap(a=>Array.from(a._zod.values)))}),T(a._zod,"pattern",()=>{if(b.options.every(a=>a._zod.pattern)){let a=b.options.map(a=>a._zod.pattern);return RegExp(`^(${a.map(a=>R(a.source)).join("|")})$`)}}),a._zod.parse=(c,d)=>{let e=!1,f=[];for(let a of b.options){let b=a._zod.run({value:c.value,issues:[]},d);if(b instanceof Promise)f.push(b),e=!0;else{if(0===b.issues.length)return b;f.push(b)}}return e?Promise.all(f).then(b=>aY(b,c,a,d)):aY(f,c,a,d)}}),a$=C("$ZodIntersection",(a,b)=>{aQ.init(a,b),a._zod.parse=(a,c)=>{let d=a.value,e=b.left._zod.run({value:d,issues:[]},c),f=b.right._zod.run({value:d,issues:[]},c);return e instanceof Promise||f instanceof Promise?Promise.all([e,f]).then(([b,c])=>a_(a,b,c)):a_(a,e,f)}});function a_(a,b,c){if(b.issues.length&&a.issues.push(...b.issues),c.issues.length&&a.issues.push(...c.issues),at(a))return a;let d=function a(b,c){if(b===c||b instanceof Date&&c instanceof Date&&+b==+c)return{valid:!0,data:b};if(aa(b)&&aa(c)){let d=Object.keys(c),e=Object.keys(b).filter(a=>-1!==d.indexOf(a)),f={...b,...c};for(let d of e){let e=a(b[d],c[d]);if(!e.valid)return{valid:!1,mergeErrorPath:[d,...e.mergeErrorPath]};f[d]=e.data}return{valid:!0,data:f}}if(Array.isArray(b)&&Array.isArray(c)){if(b.length!==c.length)return{valid:!1,mergeErrorPath:[]};let d=[];for(let e=0;e<b.length;e++){let f=a(b[e],c[e]);if(!f.valid)return{valid:!1,mergeErrorPath:[e,...f.mergeErrorPath]};d.push(f.data)}return{valid:!0,data:d}}return{valid:!1,mergeErrorPath:[]}}(b.value,c.value);if(!d.valid)throw Error(`Unmergable intersection. Error path: ${JSON.stringify(d.mergeErrorPath)}`);return a.value=d.data,a}var a0=C("$ZodEnum",(a,b)=>{aQ.init(a,b);let c=M(b.entries);a._zod.values=new Set(c),a._zod.pattern=RegExp(`^(${c.filter(a=>ad.has(typeof a)).map(a=>"string"==typeof a?af(a):a.toString()).join("|")})$`),a._zod.parse=(b,d)=>{let e=b.value;return a._zod.values.has(e)||b.issues.push({code:"invalid_value",values:c,input:e,inst:a}),b}}),a1=C("$ZodTransform",(a,b)=>{aQ.init(a,b),a._zod.parse=(a,c)=>{let d=b.transform(a.value,a);if(c.async)return(d instanceof Promise?d:Promise.resolve(d)).then(b=>(a.value=b,a));if(d instanceof Promise)throw new D;return a.value=d,a}}),a2=C("$ZodOptional",(a,b)=>{aQ.init(a,b),a._zod.optin="optional",a._zod.optout="optional",T(a._zod,"values",()=>b.innerType._zod.values?new Set([...b.innerType._zod.values,void 0]):void 0),T(a._zod,"pattern",()=>{let a=b.innerType._zod.pattern;return a?RegExp(`^(${R(a.source)})?$`):void 0}),a._zod.parse=(a,c)=>"optional"===b.innerType._zod.optin?b.innerType._zod.run(a,c):void 0===a.value?a:b.innerType._zod.run(a,c)}),a3=C("$ZodNullable",(a,b)=>{aQ.init(a,b),T(a._zod,"optin",()=>b.innerType._zod.optin),T(a._zod,"optout",()=>b.innerType._zod.optout),T(a._zod,"pattern",()=>{let a=b.innerType._zod.pattern;return a?RegExp(`^(${R(a.source)}|null)$`):void 0}),T(a._zod,"values",()=>b.innerType._zod.values?new Set([...b.innerType._zod.values,null]):void 0),a._zod.parse=(a,c)=>null===a.value?a:b.innerType._zod.run(a,c)}),a4=C("$ZodDefault",(a,b)=>{aQ.init(a,b),a._zod.optin="optional",T(a._zod,"values",()=>b.innerType._zod.values),a._zod.parse=(a,c)=>{if(void 0===a.value)return a.value=b.defaultValue,a;let d=b.innerType._zod.run(a,c);return d instanceof Promise?d.then(a=>a5(a,b)):a5(d,b)}});function a5(a,b){return void 0===a.value&&(a.value=b.defaultValue),a}var a6=C("$ZodPrefault",(a,b)=>{aQ.init(a,b),a._zod.optin="optional",T(a._zod,"values",()=>b.innerType._zod.values),a._zod.parse=(a,c)=>(void 0===a.value&&(a.value=b.defaultValue),b.innerType._zod.run(a,c))}),a7=C("$ZodNonOptional",(a,b)=>{aQ.init(a,b),T(a._zod,"values",()=>{let a=b.innerType._zod.values;return a?new Set([...a].filter(a=>void 0!==a)):void 0}),a._zod.parse=(c,d)=>{let e=b.innerType._zod.run(c,d);return e instanceof Promise?e.then(b=>a8(b,a)):a8(e,a)}});function a8(a,b){return a.issues.length||void 0!==a.value||a.issues.push({code:"invalid_type",expected:"nonoptional",input:a.value,inst:b}),a}var a9=C("$ZodCatch",(a,b)=>{aQ.init(a,b),a._zod.optin="optional",T(a._zod,"optout",()=>b.innerType._zod.optout),T(a._zod,"values",()=>b.innerType._zod.values),a._zod.parse=(a,c)=>{let d=b.innerType._zod.run(a,c);return d instanceof Promise?d.then(d=>(a.value=d.value,d.issues.length&&(a.value=b.catchValue({...a,error:{issues:d.issues.map(a=>aw(a,c,F()))},input:a.value}),a.issues=[]),a)):(a.value=d.value,d.issues.length&&(a.value=b.catchValue({...a,error:{issues:d.issues.map(a=>aw(a,c,F()))},input:a.value}),a.issues=[]),a)}}),ba=C("$ZodPipe",(a,b)=>{aQ.init(a,b),T(a._zod,"values",()=>b.in._zod.values),T(a._zod,"optin",()=>b.in._zod.optin),T(a._zod,"optout",()=>b.out._zod.optout),a._zod.parse=(a,c)=>{let d=b.in._zod.run(a,c);return d instanceof Promise?d.then(a=>bb(a,b,c)):bb(d,b,c)}});function bb(a,b,c){return at(a)?a:b.out._zod.run({value:a.value,issues:a.issues},c)}var bc=C("$ZodReadonly",(a,b)=>{aQ.init(a,b),T(a._zod,"propValues",()=>b.innerType._zod.propValues),T(a._zod,"values",()=>b.innerType._zod.values),T(a._zod,"optin",()=>b.innerType._zod.optin),T(a._zod,"optout",()=>b.innerType._zod.optout),a._zod.parse=(a,c)=>{let d=b.innerType._zod.run(a,c);return d instanceof Promise?d.then(bd):bd(d)}});function bd(a){return a.value=Object.freeze(a.value),a}var be=C("$ZodCustom",(a,b)=>{aJ.init(a,b),aQ.init(a,b),a._zod.parse=(a,b)=>a,a._zod.check=c=>{let d=c.value,e=b.fn(d);if(e instanceof Promise)return e.then(b=>bf(b,c,d,a));bf(e,c,d,a)}});function bf(a,b,c,d){if(!a){let a={code:"custom",input:c,inst:d,path:[...d._zod.def.path??[]],continue:!d._zod.def.abort};d._zod.def.params&&(a.params=d._zod.def.params),b.issues.push(az(a))}}Symbol("ZodOutput"),Symbol("ZodInput");var bg=new class{constructor(){this._map=new Map,this._idmap=new Map}add(a,...b){let c=b[0];if(this._map.set(a,c),c&&"object"==typeof c&&"id"in c){if(this._idmap.has(c.id))throw Error(`ID ${c.id} already exists in the registry`);this._idmap.set(c.id,a)}return this}clear(){return this._map=new Map,this._idmap=new Map,this}remove(a){let b=this._map.get(a);return b&&"object"==typeof b&&"id"in b&&this._idmap.delete(b.id),this._map.delete(a),this}get(a){let b=a._zod.parent;if(b){let c={...this.get(b)??{}};return delete c.id,{...c,...this._map.get(a)}}return this._map.get(a)}has(a){return this._map.has(a)}};function bh(a,b){return new aL({check:"min_length",...ah(b),minimum:a})}var bi=(a,b)=>{aD.init(a,b),a.name="ZodError",Object.defineProperties(a,{format:{value:b=>(function(a,b){let c=b||function(a){return a.message},d={_errors:[]},e=a=>{for(let b of a.issues)if("invalid_union"===b.code&&b.errors.length)b.errors.map(a=>e({issues:a}));else if("invalid_key"===b.code)e({issues:b.issues});else if("invalid_element"===b.code)e({issues:b.issues});else if(0===b.path.length)d._errors.push(c(b));else{let a=d,e=0;for(;e<b.path.length;){let d=b.path[e];e===b.path.length-1?(a[d]=a[d]||{_errors:[]},a[d]._errors.push(c(b))):a[d]=a[d]||{_errors:[]},a=a[d],e++}}};return e(a),d})(a,b)},flatten:{value:b=>(function(a,b=a=>a.message){let c={},d=[];for(let e of a.issues)e.path.length>0?(c[e.path[0]]=c[e.path[0]]||[],c[e.path[0]].push(b(e))):d.push(b(e));return{formErrors:d,fieldErrors:c}})(a,b)},addIssue:{value:b=>a.issues.push(b)},addIssues:{value:b=>a.issues.push(...b)},isEmpty:{get:()=>0===a.issues.length}})};C("ZodError",bi);var bj=C("ZodError",bi,{Parent:Error}),bk=(a,b,c,d)=>{let e=c?Object.assign(c,{async:!1}):{async:!1},f=a._zod.run({value:b,issues:[]},e);if(f instanceof Promise)throw new D;if(f.issues.length){let a=new(d?.Err??bj)(f.issues.map(a=>aw(a,e,F())));throw Z(a,d?.callee),a}return f.value},bl=async(a,b,c,d)=>{let e=c?Object.assign(c,{async:!0}):{async:!0},f=a._zod.run({value:b,issues:[]},e);if(f instanceof Promise&&(f=await f),f.issues.length){let a=new(d?.Err??bj)(f.issues.map(a=>aw(a,e,F())));throw Z(a,d?.callee),a}return f.value},bm=aF(bj),bn=aH(bj),bo=C("ZodType",(a,b)=>(aQ.init(a,b),a.def=b,Object.defineProperty(a,"_def",{value:b}),a.check=(...c)=>a.clone({...b,checks:[...b.checks??[],...c.map(a=>"function"==typeof a?{_zod:{check:a,def:{check:"custom"},onattach:[]}}:a)]}),a.clone=(b,c)=>ag(a,b,c),a.brand=()=>a,a.register=(b,c)=>(b.add(a,c),a),a.parse=(b,c)=>bk(a,b,c,{callee:a.parse}),a.safeParse=(b,c)=>bm(a,b,c),a.parseAsync=async(b,c)=>bl(a,b,c,{callee:a.parseAsync}),a.safeParseAsync=async(b,c)=>bn(a,b,c),a.spa=a.safeParseAsync,a.refine=(b,c)=>a.check(function(a,b={}){return new bJ({type:"custom",check:"custom",fn:a,...ah(b)})}(b,c)),a.superRefine=b=>a.check(function(a){let b=function(a){let b=new aJ({check:"custom"});return b._zod.check=a,b}(c=>(c.addIssue=a=>{"string"==typeof a?c.issues.push(G.issue(a,c.value,b._zod.def)):(a.fatal&&(a.continue=!1),a.code??(a.code="custom"),a.input??(a.input=c.value),a.inst??(a.inst=b),a.continue??(a.continue=!b._zod.def.abort),c.issues.push(G.issue(a)))},a(c.value,c)));return b}(b)),a.overwrite=b=>a.check(new aN({check:"overwrite",tx:b})),a.optional=()=>bz(a),a.nullable=()=>bB(a),a.nullish=()=>bz(bB(a)),a.nonoptional=b=>{var c,d;return c=a,d=b,new bE({type:"nonoptional",innerType:c,...G.normalizeParams(d)})},a.array=()=>(function(a,b){return new bs({type:"array",element:a,...ah(void 0)})})(a),a.or=b=>new bu({type:"union",options:[a,b],...G.normalizeParams(void 0)}),a.and=b=>{var c;return c=a,new bv({type:"intersection",left:c,right:b})},a.transform=b=>bH(a,new bx({type:"transform",transform:b})),a.default=b=>(function(a,b){return new bC({type:"default",innerType:a,get defaultValue(){return"function"==typeof b?b():b}})})(a,b),a.prefault=b=>(function(a,b){return new bD({type:"prefault",innerType:a,get defaultValue(){return"function"==typeof b?b():b}})})(a,b),a.catch=b=>(function(a,b){return new bF({type:"catch",innerType:a,catchValue:"function"==typeof b?b:()=>b})})(a,b),a.pipe=b=>bH(a,b),a.readonly=()=>new bI({type:"readonly",innerType:a}),a.describe=b=>{let c=a.clone();return bg.add(c,{description:b}),c},Object.defineProperty(a,"description",{get:()=>bg.get(a)?.description,configurable:!0}),a.meta=(...b)=>{if(0===b.length)return bg.get(a);let c=a.clone();return bg.add(c,b[0]),c},a.isOptional=()=>a.safeParse(void 0).success,a.isNullable=()=>a.safeParse(null).success,a)),bp=C("ZodUnknown",(a,b)=>{aR.init(a,b),bo.init(a,b)});function bq(){return new bp({type:"unknown"})}var br=C("ZodNever",(a,b)=>{aS.init(a,b),bo.init(a,b)}),bs=C("ZodArray",(a,b)=>{aU.init(a,b),bo.init(a,b),a.element=b.element,a.min=(b,c)=>a.check(bh(b,c)),a.nonempty=b=>a.check(bh(1,b)),a.max=(b,c)=>a.check(new aK({check:"max_length",...ah(c),maximum:b})),a.length=(b,c)=>a.check(new aM({check:"length_equals",...ah(c),length:b})),a.unwrap=()=>a.element}),bt=C("ZodObject",(a,b)=>{aX.init(a,b),bo.init(a,b),G.defineLazy(a,"shape",()=>b.shape),a.keyof=()=>(function(a,b){return new bw({type:"enum",entries:Array.isArray(a)?Object.fromEntries(a.map(a=>[a,a])):a,...G.normalizeParams(void 0)})})(Object.keys(a._zod.def.shape)),a.catchall=b=>a.clone({...a._zod.def,catchall:b}),a.passthrough=()=>a.clone({...a._zod.def,catchall:bq()}),a.loose=()=>a.clone({...a._zod.def,catchall:bq()}),a.strict=()=>a.clone({...a._zod.def,catchall:new br({type:"never",...ah(void 0)})}),a.strip=()=>a.clone({...a._zod.def,catchall:void 0}),a.extend=b=>G.extend(a,b),a.merge=b=>G.merge(a,b),a.pick=b=>G.pick(a,b),a.omit=b=>G.omit(a,b),a.partial=(...b)=>G.partial(by,a,b[0]),a.required=(...b)=>G.required(bE,a,b[0])}),bu=C("ZodUnion",(a,b)=>{aZ.init(a,b),bo.init(a,b),a.options=b.options}),bv=C("ZodIntersection",(a,b)=>{a$.init(a,b),bo.init(a,b)}),bw=C("ZodEnum",(a,b)=>{a0.init(a,b),bo.init(a,b),a.enum=b.entries,a.options=Object.values(b.entries);let c=new Set(Object.keys(b.entries));a.extract=(a,d)=>{let e={};for(let d of a)if(c.has(d))e[d]=b.entries[d];else throw Error(`Key ${d} not found in enum`);return new bw({...b,checks:[],...G.normalizeParams(d),entries:e})},a.exclude=(a,d)=>{let e={...b.entries};for(let b of a)if(c.has(b))delete e[b];else throw Error(`Key ${b} not found in enum`);return new bw({...b,checks:[],...G.normalizeParams(d),entries:e})}}),bx=C("ZodTransform",(a,b)=>{a1.init(a,b),bo.init(a,b),a._zod.parse=(c,d)=>{c.addIssue=d=>{"string"==typeof d?c.issues.push(G.issue(d,c.value,b)):(d.fatal&&(d.continue=!1),d.code??(d.code="custom"),d.input??(d.input=c.value),d.inst??(d.inst=a),d.continue??(d.continue=!0),c.issues.push(G.issue(d)))};let e=b.transform(c.value,c);return e instanceof Promise?e.then(a=>(c.value=a,c)):(c.value=e,c)}}),by=C("ZodOptional",(a,b)=>{a2.init(a,b),bo.init(a,b),a.unwrap=()=>a._zod.def.innerType});function bz(a){return new by({type:"optional",innerType:a})}var bA=C("ZodNullable",(a,b)=>{a3.init(a,b),bo.init(a,b),a.unwrap=()=>a._zod.def.innerType});function bB(a){return new bA({type:"nullable",innerType:a})}var bC=C("ZodDefault",(a,b)=>{a4.init(a,b),bo.init(a,b),a.unwrap=()=>a._zod.def.innerType,a.removeDefault=a.unwrap}),bD=C("ZodPrefault",(a,b)=>{a6.init(a,b),bo.init(a,b),a.unwrap=()=>a._zod.def.innerType}),bE=C("ZodNonOptional",(a,b)=>{a7.init(a,b),bo.init(a,b),a.unwrap=()=>a._zod.def.innerType}),bF=C("ZodCatch",(a,b)=>{a9.init(a,b),bo.init(a,b),a.unwrap=()=>a._zod.def.innerType,a.removeCatch=a.unwrap}),bG=C("ZodPipe",(a,b)=>{ba.init(a,b),bo.init(a,b),a.in=b.in,a.out=b.out});function bH(a,b){return new bG({type:"pipe",in:a,out:b})}var bI=C("ZodReadonly",(a,b)=>{bc.init(a,b),bo.init(a,b)}),bJ=C("ZodCustom",(a,b)=>{be.init(a,b),bo.init(a,b)}),bK={};function bL(a){switch(a.constructor.name){case"ZodString":default:return"string";case"ZodNumber":return"number";case"ZodBoolean":return"boolean";case"ZodObject":return"object";case"ZodArray":return"array"}}function bM(a){let b=[];return a.metadata?.openapi?.parameters?b.push(...a.metadata.openapi.parameters):a.query instanceof bt&&Object.entries(a.query.shape).forEach(([a,c])=>{c instanceof bt&&b.push({name:a,in:"query",schema:{type:bL(c),..."minLength"in c&&c.minLength?{minLength:c.minLength}:{},description:c.description}})}),b}function bN(a){return{400:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}},required:["message"]}}},description:"Bad Request. Usually due to missing parameters, or invalid parameters."},401:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}},required:["message"]}}},description:"Unauthorized. Due to missing or invalid authentication."},403:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}},description:"Forbidden. You do not have permission to access this resource or to perform this action."},404:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}},description:"Not Found. The requested resource was not found."},429:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}},description:"Too Many Requests. You have exceeded the rate limit. Try again later."},500:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}},description:"Internal Server Error. This is a problem with the server that you cannot fix."},...a}}async function bO(a,b){return Object.entries(a).forEach(([a,b])=>{let c=b.options;if(!c.metadata?.SERVER_ONLY&&("GET"===c.method&&(bK[b.path]={get:{tags:["Default",...c.metadata?.openapi?.tags||[]],description:c.metadata?.openapi?.description,operationId:c.metadata?.openapi?.operationId,security:[{bearerAuth:[]}],parameters:bM(c),responses:bN(c.metadata?.openapi?.responses)}}),"POST"===c.method)){let a=function(a){if(a.metadata?.openapi?.requestBody)return a.metadata.openapi.requestBody;if(a.body&&(a.body instanceof bt||a.body instanceof by)){let b=a.body.shape;if(!b)return;let c={},d=[];return Object.entries(b).forEach(([a,b])=>{b instanceof bt&&(c[a]={type:bL(b),description:b.description},b instanceof by||d.push(a))}),{required:!(a.body instanceof by)&&!!a.body,content:{"application/json":{schema:{type:"object",properties:c,required:d}}}}}}(c);bK[b.path]={post:{tags:["Default",...c.metadata?.openapi?.tags||[]],description:c.metadata?.openapi?.description,operationId:c.metadata?.openapi?.operationId,security:[{bearerAuth:[]}],parameters:bM(c),...a?{requestBody:a}:{requestBody:{content:{"application/json":{schema:{type:"object",properties:{}}}}}},responses:bN(c.metadata?.openapi?.responses)}}}}),{openapi:"3.1.1",info:{title:"Better Auth",description:"API Reference for your Better Auth Instance",version:"1.1.0"},components:{schemas:{}},security:[{apiKeyCookie:[]}],servers:[{url:b?.url}],tags:[{name:"Default",description:"Default endpoints that are included with Better Auth by default. These endpoints are not part of any plugin."}],paths:bK}}var bP=(a,b)=>{if(!b?.openapi?.disabled){let c={path:"/api/reference",...b?.openapi};a.openapi=B(c.path,{method:"GET"},async b=>new Response(((a,b)=>`<!doctype html>
<html>
  <head>
    <title>Scalar API Reference</title>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1" />
  </head>
  <body>
    <script
      id="api-reference"
      type="application/json">
    ${JSON.stringify(a)}
    </script>
	 <script>
      var configuration = {
	  	favicon: ${b?.logo?`data:image/svg+xml;utf8,${encodeURIComponent(b.logo)}`:void 0} ,
	   	theme: ${b?.theme||"saturn"},
        metaData: {
			title: ${b?.title||"Open API Reference"},
			description: ${b?.description||"Better Call Open API"},
		}
      }
      document.getElementById('api-reference').dataset.configuration =
        JSON.stringify(configuration)
    </script>
	  <script src="https://cdn.jsdelivr.net/npm/@scalar/api-reference"></script>
  </body>
</html>`)(await bO(a),c.scalar),{headers:{"Content-Type":"text/html"}}))}let c=f(),d=f();for(let b of Object.values(a))if(!(!b.options||b.options?.metadata?.SERVER_ONLY))for(let a of Array.isArray(b.options?.method)?b.options.method:[b.options?.method])i(c,a,b.path,b);if(b?.routerMiddleware?.length)for(let{path:a,middleware:c}of b.routerMiddleware)i(d,"*",a,c);let e=async a=>{let e=new URL(a.url),f=b?.basePath?e.pathname.split(b.basePath).reduce((a,c,d)=>(0!==d&&(d>1?a.push(`${b.basePath}${c}`):a.push(c)),a),[]).join(""):e.pathname;if(!f?.length)return new Response(null,{status:404,statusText:"Not Found"});let i=function(a,b="",c,d){"/"===c[c.length-1]&&(c=c.slice(0,-1));let e=a.static[c];if(e&&e.methods){let a=e.methods[b]||e.methods[""];if(void 0!==a)return a[0]}let f=g(c),i=function a(b,c,d,e,f){if(f===e.length){if(c.methods){let a=c.methods[d]||c.methods[""];if(a)return a}if(c.param&&c.param.methods){let a=c.param.methods[d]||c.param.methods[""];if(a){let b=a[0].paramsMap;if(b?.[b?.length-1]?.[2])return a}}if(c.wildcard&&c.wildcard.methods){let a=c.wildcard.methods[d]||c.wildcard.methods[""];if(a){let b=a[0].paramsMap;if(b?.[b?.length-1]?.[2])return a}}return}let g=e[f];if(c.static){let h=c.static[g];if(h){let c=a(b,h,d,e,f+1);if(c)return c}}if(c.param){let g=a(b,c.param,d,e,f+1);if(g)return g}if(c.wildcard&&c.wildcard.methods)return c.wildcard.methods[d]||c.wildcard.methods[""]}(a,a.root,b,f,0)?.[0];if(void 0!==i)return{data:i.data,params:i.paramsMap?h(f,i.paramsMap):void 0}}(c,a.method,f);if(!i?.data)return new Response(null,{status:404,statusText:"Not Found"});let j={};e.searchParams.forEach((a,b)=>{b in j?Array.isArray(j[b])?j[b].push(a):j[b]=[j[b],a]:j[b]=a});let k=i.data,l={path:f,method:a.method,headers:a.headers,params:i.params?JSON.parse(JSON.stringify(i.params)):{},request:a,body:k.options.disableBody?void 0:await m(k.options.cloneRequest?a.clone():a),query:j,_flag:"router",asResponse:!0,context:b?.routerContext};try{let a=function(a,b="",c,d){"/"===c[c.length-1]&&(c=c.slice(0,-1));let e=g(c);return(function a(b,c,d,e,f,g=[]){let h=e[f];if(c.wildcard&&c.wildcard.methods){let a=c.wildcard.methods[d]||c.wildcard.methods[""];a&&g.push(...a)}if(c.param&&(a(b,c.param,d,e,f+1,g),f===e.length&&c.param.methods)){let a=c.param.methods[d]||c.param.methods[""];a&&g.push(...a)}let i=c.static?.[h];if(i&&a(b,i,d,e,f+1,g),f===e.length&&c.methods){let a=c.methods[d]||c.methods[""];a&&g.push(...a)}return g})(a,a.root,b,e,0).map(a=>({data:a.data,params:a.paramsMap?h(e,a.paramsMap):void 0}))}(d,"*",f);if(a?.length)for(let{data:b,params:c}of a){let a=await b({...l,params:c,asResponse:!1});if(a instanceof Response)return a}return await k(l)}catch(a){if(b?.onError)try{let c=await b.onError(a);if(c instanceof Response)return o(c)}catch(a){if(n(a))return o(a);throw a}if(b?.throwError)throw a;if(n(a))return o(a);return console.error("# SERVER_ERROR: ",a),new Response(null,{status:500,statusText:"Internal Server Error"})}};return{handler:async a=>{let c=await b?.onRequest?.(a);if(c instanceof Response)return c;let d=c instanceof Request?c:a,f=await e(d),g=await b?.onResponse?.(f);return g instanceof Response?g:f},endpoints:a}}},24118:(a,b,c)=>{c.d(b,{r:()=>f});var d=c(60353),e=c(33423);let f=(0,d.CN)({is:a=>"MergeQueryNode"===a.kind,create:(a,b)=>(0,d.CN)({kind:"MergeQueryNode",into:a,...b&&{with:b}}),cloneWithUsing:(a,b)=>(0,d.CN)({...a,using:b}),cloneWithWhen:(a,b)=>(0,d.CN)({...a,whens:a.whens?(0,d.CN)([...a.whens,b]):(0,d.CN)([b])}),cloneWithThen:(a,b)=>(0,d.CN)({...a,whens:a.whens?(0,d.CN)([...a.whens.slice(0,-1),e.t.cloneWithResult(a.whens[a.whens.length-1],b)]):void 0})})},24340:()=>{var a;function b(a,b,c){function d(c,d){var e;for(let f in Object.defineProperty(c,"_zod",{value:c._zod??{},enumerable:!1}),(e=c._zod).traits??(e.traits=new Set),c._zod.traits.add(a),b(c,d),g.prototype)f in c||Object.defineProperty(c,f,{value:g.prototype[f].bind(c)});c._zod.constr=g,c._zod.def=d}let e=c?.Parent??Object;class f extends e{}function g(a){var b;let e=c?.Parent?new f:this;for(let c of(d(e,a),(b=e._zod).deferred??(b.deferred=[]),e._zod.deferred))c();return e}return Object.defineProperty(f,"name",{value:a}),Object.defineProperty(g,"init",{value:d}),Object.defineProperty(g,Symbol.hasInstance,{value:b=>!!c?.Parent&&b instanceof c.Parent||b?._zod?.traits?.has(a)}),Object.defineProperty(g,"name",{value:a}),g}Object.freeze({status:"aborted"}),Symbol("zod_brand");class c extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}class d extends Error{constructor(a){super(`Encountered unidirectional transform during encode: ${a}`),this.name="ZodEncodeError"}}let e={};function f(a){return a&&Object.assign(e,a),e}function g(a,b="|"){return a.map(a=>y(a)).join(b)}function h(a,b){return"bigint"==typeof b?b.toString():b}function i(a){return{get value(){{let b=a();return Object.defineProperty(this,"value",{value:b}),b}}}}function j(a){let b=+!!a.startsWith("^"),c=a.endsWith("$")?a.length-1:a.length;return a.slice(b,c)}let k=Symbol("evaluating");function l(a,b,c){let d;Object.defineProperty(a,b,{get(){if(d!==k)return void 0===d&&(d=k,d=c()),d},set(c){Object.defineProperty(a,b,{value:c})},configurable:!0})}function m(a,b,c){Object.defineProperty(a,b,{value:c,writable:!0,enumerable:!0,configurable:!0})}function n(...a){let b={};for(let c of a)Object.assign(b,Object.getOwnPropertyDescriptors(c));return Object.defineProperties({},b)}function o(a){return JSON.stringify(a)}let p="captureStackTrace"in Error?Error.captureStackTrace:(...a)=>{};function q(a){return"object"==typeof a&&null!==a&&!Array.isArray(a)}let r=i(()=>{if("undefined"!=typeof navigator&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{return Function(""),!0}catch(a){return!1}});function s(a){if(!1===q(a))return!1;let b=a.constructor;if(void 0===b)return!0;let c=b.prototype;return!1!==q(c)&&!1!==Object.prototype.hasOwnProperty.call(c,"isPrototypeOf")}function t(a){return s(a)?{...a}:Array.isArray(a)?[...a]:a}let u=new Set(["string","number","symbol"]);function v(a){return a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function w(a,b,c){let d=new a._zod.constr(b??a._zod.def);return(!b||c?.parent)&&(d._zod.parent=a),d}function x(a){if(!a)return{};if("string"==typeof a)return{error:()=>a};if(a?.message!==void 0){if(a?.error!==void 0)throw Error("Cannot specify both `message` and `error` params");a.error=a.message}return(delete a.message,"string"==typeof a.error)?{...a,error:()=>a.error}:a}function y(a){return"bigint"==typeof a?a.toString()+"n":"string"==typeof a?`"${a}"`:`${a}`}let z={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-0x80000000,0x7fffffff],uint32:[0,0xffffffff],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]};function A(a,b=0){if(!0===a.aborted)return!0;for(let c=b;c<a.issues.length;c++)if(a.issues[c]?.continue!==!0)return!0;return!1}function B(a,b){return b.map(b=>(b.path??(b.path=[]),b.path.unshift(a),b))}function C(a){return"string"==typeof a?a:a?.message}function D(a,b,c){let d={...a,path:a.path??[]};return a.message||(d.message=C(a.inst?._zod.def?.error?.(a))??C(b?.error?.(a))??C(c.customError?.(a))??C(c.localeError?.(a))??"Invalid input"),delete d.inst,delete d.continue,b?.reportInput||delete d.input,d}function E(a){return Array.isArray(a)?"array":"string"==typeof a?"string":"unknown"}function F(...a){let[b,c,d]=a;return"string"==typeof b?{message:b,code:"custom",input:c,inst:d}:{...b}}let G=(a,b)=>{a.name="$ZodError",Object.defineProperty(a,"_zod",{value:a._zod,enumerable:!1}),Object.defineProperty(a,"issues",{value:b,enumerable:!1}),a.message=JSON.stringify(b,h,2),Object.defineProperty(a,"toString",{value:()=>a.message,enumerable:!1})},H=b("$ZodError",G),I=b("$ZodError",G,{Parent:Error}),J=a=>(b,d,e,g)=>{let h=e?Object.assign(e,{async:!1}):{async:!1},i=b._zod.run({value:d,issues:[]},h);if(i instanceof Promise)throw new c;if(i.issues.length){let b=new(g?.Err??a)(i.issues.map(a=>D(a,h,f())));throw p(b,g?.callee),b}return i.value},K=a=>async(b,c,d,e)=>{let g=d?Object.assign(d,{async:!0}):{async:!0},h=b._zod.run({value:c,issues:[]},g);if(h instanceof Promise&&(h=await h),h.issues.length){let b=new(e?.Err??a)(h.issues.map(a=>D(a,g,f())));throw p(b,e?.callee),b}return h.value},L=a=>(b,d,e)=>{let g=e?{...e,async:!1}:{async:!1},h=b._zod.run({value:d,issues:[]},g);if(h instanceof Promise)throw new c;return h.issues.length?{success:!1,error:new(a??H)(h.issues.map(a=>D(a,g,f())))}:{success:!0,data:h.value}},M=L(I),N=a=>async(b,c,d)=>{let e=d?Object.assign(d,{async:!0}):{async:!0},g=b._zod.run({value:c,issues:[]},e);return g instanceof Promise&&(g=await g),g.issues.length?{success:!1,error:new a(g.issues.map(a=>D(a,e,f())))}:{success:!0,data:g.value}},O=N(I),P=/^[cC][^\s-]{8,}$/,Q=/^[0-9a-z]+$/,R=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,S=/^[0-9a-vA-V]{20}$/,T=/^[A-Za-z0-9]{27}$/,U=/^[a-zA-Z0-9_-]{21}$/,V=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,W=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,X=a=>a?RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${a}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/,Y=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,Z=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,$=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:))$/,_=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,aa=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,ab=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,ac=/^[A-Za-z0-9_-]*$/,ad=/^(?=.{1,253}\.?$)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[-0-9a-zA-Z]{0,61}[0-9a-zA-Z])?)*\.?$/,ae=/^\+(?:[0-9]){6,14}[0-9]$/,af="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",ag=RegExp(`^${af}$`);function ah(a){let b="(?:[01]\\d|2[0-3]):[0-5]\\d";return"number"==typeof a.precision?-1===a.precision?`${b}`:0===a.precision?`${b}:[0-5]\\d`:`${b}:[0-5]\\d\\.\\d{${a.precision}}`:`${b}(?::[0-5]\\d(?:\\.\\d+)?)?`}let ai=/^-?\d+n?$/,aj=/^-?\d+$/,ak=/^-?\d+(?:\.\d+)?/,al=/^(?:true|false)$/i,am=/^[^A-Z]*$/,an=/^[^a-z]*$/,ao=b("$ZodCheck",(a,b)=>{var c;a._zod??(a._zod={}),a._zod.def=b,(c=a._zod).onattach??(c.onattach=[])}),ap={number:"number",bigint:"bigint",object:"date"},aq=b("$ZodCheckLessThan",(a,b)=>{ao.init(a,b);let c=ap[typeof b.value];a._zod.onattach.push(a=>{let c=a._zod.bag,d=(b.inclusive?c.maximum:c.exclusiveMaximum)??1/0;b.value<d&&(b.inclusive?c.maximum=b.value:c.exclusiveMaximum=b.value)}),a._zod.check=d=>{(b.inclusive?d.value<=b.value:d.value<b.value)||d.issues.push({origin:c,code:"too_big",maximum:b.value,input:d.value,inclusive:b.inclusive,inst:a,continue:!b.abort})}}),ar=b("$ZodCheckGreaterThan",(a,b)=>{ao.init(a,b);let c=ap[typeof b.value];a._zod.onattach.push(a=>{let c=a._zod.bag,d=(b.inclusive?c.minimum:c.exclusiveMinimum)??-1/0;b.value>d&&(b.inclusive?c.minimum=b.value:c.exclusiveMinimum=b.value)}),a._zod.check=d=>{(b.inclusive?d.value>=b.value:d.value>b.value)||d.issues.push({origin:c,code:"too_small",minimum:b.value,input:d.value,inclusive:b.inclusive,inst:a,continue:!b.abort})}}),as=b("$ZodCheckMultipleOf",(a,b)=>{ao.init(a,b),a._zod.onattach.push(a=>{var c;(c=a._zod.bag).multipleOf??(c.multipleOf=b.value)}),a._zod.check=c=>{if(typeof c.value!=typeof b.value)throw Error("Cannot mix number and bigint in multiple_of check.");("bigint"==typeof c.value?c.value%b.value===BigInt(0):0===function(a,b){let c=(a.toString().split(".")[1]||"").length,d=b.toString(),e=(d.split(".")[1]||"").length;if(0===e&&/\d?e-\d?/.test(d)){let a=d.match(/\d?e-(\d?)/);a?.[1]&&(e=Number.parseInt(a[1]))}let f=c>e?c:e;return Number.parseInt(a.toFixed(f).replace(".",""))%Number.parseInt(b.toFixed(f).replace(".",""))/10**f}(c.value,b.value))||c.issues.push({origin:typeof c.value,code:"not_multiple_of",divisor:b.value,input:c.value,inst:a,continue:!b.abort})}}),at=b("$ZodCheckNumberFormat",(a,b)=>{ao.init(a,b),b.format=b.format||"float64";let c=b.format?.includes("int"),d=c?"int":"number",[e,f]=z[b.format];a._zod.onattach.push(a=>{let d=a._zod.bag;d.format=b.format,d.minimum=e,d.maximum=f,c&&(d.pattern=aj)}),a._zod.check=g=>{let h=g.value;if(c){if(!Number.isInteger(h))return void g.issues.push({expected:d,format:b.format,code:"invalid_type",continue:!1,input:h,inst:a});if(!Number.isSafeInteger(h))return void(h>0?g.issues.push({input:h,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:a,origin:d,continue:!b.abort}):g.issues.push({input:h,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:a,origin:d,continue:!b.abort}))}h<e&&g.issues.push({origin:"number",input:h,code:"too_small",minimum:e,inclusive:!0,inst:a,continue:!b.abort}),h>f&&g.issues.push({origin:"number",input:h,code:"too_big",maximum:f,inst:a})}}),au=b("$ZodCheckMaxLength",(a,b)=>{var c;ao.init(a,b),(c=a._zod.def).when??(c.when=a=>{let b=a.value;return null!=b&&void 0!==b.length}),a._zod.onattach.push(a=>{let c=a._zod.bag.maximum??1/0;b.maximum<c&&(a._zod.bag.maximum=b.maximum)}),a._zod.check=c=>{let d=c.value;if(d.length<=b.maximum)return;let e=E(d);c.issues.push({origin:e,code:"too_big",maximum:b.maximum,inclusive:!0,input:d,inst:a,continue:!b.abort})}}),av=b("$ZodCheckMinLength",(a,b)=>{var c;ao.init(a,b),(c=a._zod.def).when??(c.when=a=>{let b=a.value;return null!=b&&void 0!==b.length}),a._zod.onattach.push(a=>{let c=a._zod.bag.minimum??-1/0;b.minimum>c&&(a._zod.bag.minimum=b.minimum)}),a._zod.check=c=>{let d=c.value;if(d.length>=b.minimum)return;let e=E(d);c.issues.push({origin:e,code:"too_small",minimum:b.minimum,inclusive:!0,input:d,inst:a,continue:!b.abort})}}),aw=b("$ZodCheckLengthEquals",(a,b)=>{var c;ao.init(a,b),(c=a._zod.def).when??(c.when=a=>{let b=a.value;return null!=b&&void 0!==b.length}),a._zod.onattach.push(a=>{let c=a._zod.bag;c.minimum=b.length,c.maximum=b.length,c.length=b.length}),a._zod.check=c=>{let d=c.value,e=d.length;if(e===b.length)return;let f=E(d),g=e>b.length;c.issues.push({origin:f,...g?{code:"too_big",maximum:b.length}:{code:"too_small",minimum:b.length},inclusive:!0,exact:!0,input:c.value,inst:a,continue:!b.abort})}}),ax=b("$ZodCheckStringFormat",(a,b)=>{var c,d;ao.init(a,b),a._zod.onattach.push(a=>{let c=a._zod.bag;c.format=b.format,b.pattern&&(c.patterns??(c.patterns=new Set),c.patterns.add(b.pattern))}),b.pattern?(c=a._zod).check??(c.check=c=>{b.pattern.lastIndex=0,b.pattern.test(c.value)||c.issues.push({origin:"string",code:"invalid_format",format:b.format,input:c.value,...b.pattern?{pattern:b.pattern.toString()}:{},inst:a,continue:!b.abort})}):(d=a._zod).check??(d.check=()=>{})}),ay=b("$ZodCheckRegex",(a,b)=>{ax.init(a,b),a._zod.check=c=>{b.pattern.lastIndex=0,b.pattern.test(c.value)||c.issues.push({origin:"string",code:"invalid_format",format:"regex",input:c.value,pattern:b.pattern.toString(),inst:a,continue:!b.abort})}}),az=b("$ZodCheckLowerCase",(a,b)=>{b.pattern??(b.pattern=am),ax.init(a,b)}),aA=b("$ZodCheckUpperCase",(a,b)=>{b.pattern??(b.pattern=an),ax.init(a,b)}),aB=b("$ZodCheckIncludes",(a,b)=>{ao.init(a,b);let c=v(b.includes),d=new RegExp("number"==typeof b.position?`^.{${b.position}}${c}`:c);b.pattern=d,a._zod.onattach.push(a=>{let b=a._zod.bag;b.patterns??(b.patterns=new Set),b.patterns.add(d)}),a._zod.check=c=>{c.value.includes(b.includes,b.position)||c.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:b.includes,input:c.value,inst:a,continue:!b.abort})}}),aC=b("$ZodCheckStartsWith",(a,b)=>{ao.init(a,b);let c=RegExp(`^${v(b.prefix)}.*`);b.pattern??(b.pattern=c),a._zod.onattach.push(a=>{let b=a._zod.bag;b.patterns??(b.patterns=new Set),b.patterns.add(c)}),a._zod.check=c=>{c.value.startsWith(b.prefix)||c.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:b.prefix,input:c.value,inst:a,continue:!b.abort})}}),aD=b("$ZodCheckEndsWith",(a,b)=>{ao.init(a,b);let c=RegExp(`.*${v(b.suffix)}$`);b.pattern??(b.pattern=c),a._zod.onattach.push(a=>{let b=a._zod.bag;b.patterns??(b.patterns=new Set),b.patterns.add(c)}),a._zod.check=c=>{c.value.endsWith(b.suffix)||c.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:b.suffix,input:c.value,inst:a,continue:!b.abort})}}),aE=b("$ZodCheckOverwrite",(a,b)=>{ao.init(a,b),a._zod.check=a=>{a.value=b.tx(a.value)}});class aF{constructor(a=[]){this.content=[],this.indent=0,this&&(this.args=a)}indented(a){this.indent+=1,a(this),this.indent-=1}write(a){if("function"==typeof a){a(this,{execution:"sync"}),a(this,{execution:"async"});return}let b=a.split("\n").filter(a=>a),c=Math.min(...b.map(a=>a.length-a.trimStart().length));for(let a of b.map(a=>a.slice(c)).map(a=>" ".repeat(2*this.indent)+a))this.content.push(a)}compile(){return Function(...this?.args,[...(this?.content??[""]).map(a=>`  ${a}`)].join("\n"))}}let aG={major:4,minor:1,patch:12},aH=b("$ZodType",(a,b)=>{var d;a??(a={}),a._zod.def=b,a._zod.bag=a._zod.bag||{},a._zod.version=aG;let e=[...a._zod.def.checks??[]];for(let b of(a._zod.traits.has("$ZodCheck")&&e.unshift(a),e))for(let c of b._zod.onattach)c(a);if(0===e.length)(d=a._zod).deferred??(d.deferred=[]),a._zod.deferred?.push(()=>{a._zod.run=a._zod.parse});else{let b=(a,b,d)=>{let e,f=A(a);for(let g of b){if(g._zod.def.when){if(!g._zod.def.when(a))continue}else if(f)continue;let b=a.issues.length,h=g._zod.check(a);if(h instanceof Promise&&d?.async===!1)throw new c;if(e||h instanceof Promise)e=(e??Promise.resolve()).then(async()=>{await h,a.issues.length!==b&&(f||(f=A(a,b)))});else{if(a.issues.length===b)continue;f||(f=A(a,b))}}return e?e.then(()=>a):a},d=(d,f,g)=>{if(A(d))return d.aborted=!0,d;let h=b(f,e,g);if(h instanceof Promise){if(!1===g.async)throw new c;return h.then(b=>a._zod.parse(b,g))}return a._zod.parse(h,g)};a._zod.run=(f,g)=>{if(g.skipChecks)return a._zod.parse(f,g);if("backward"===g.direction){let b=a._zod.parse({value:f.value,issues:[]},{...g,skipChecks:!0});return b instanceof Promise?b.then(a=>d(a,f,g)):d(b,f,g)}let h=a._zod.parse(f,g);if(h instanceof Promise){if(!1===g.async)throw new c;return h.then(a=>b(a,e,g))}return b(h,e,g)}}a["~standard"]={validate:b=>{try{let c=M(a,b);return c.success?{value:c.data}:{issues:c.error?.issues}}catch(c){return O(a,b).then(a=>a.success?{value:a.data}:{issues:a.error?.issues})}},vendor:"zod",version:1}}),aI=b("$ZodString",(a,b)=>{aH.init(a,b),a._zod.pattern=[...a?._zod.bag?.patterns??[]].pop()??(a=>{let b=a?`[\\s\\S]{${a?.minimum??0},${a?.maximum??""}}`:"[\\s\\S]*";return RegExp(`^${b}$`)})(a._zod.bag),a._zod.parse=(c,d)=>{if(b.coerce)try{c.value=String(c.value)}catch(a){}return"string"==typeof c.value||c.issues.push({expected:"string",code:"invalid_type",input:c.value,inst:a}),c}}),aJ=b("$ZodStringFormat",(a,b)=>{ax.init(a,b),aI.init(a,b)}),aK=b("$ZodGUID",(a,b)=>{b.pattern??(b.pattern=W),aJ.init(a,b)}),aL=b("$ZodUUID",(a,b)=>{if(b.version){let a={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[b.version];if(void 0===a)throw Error(`Invalid UUID version: "${b.version}"`);b.pattern??(b.pattern=X(a))}else b.pattern??(b.pattern=X());aJ.init(a,b)}),aM=b("$ZodEmail",(a,b)=>{b.pattern??(b.pattern=Y),aJ.init(a,b)}),aN=b("$ZodURL",(a,b)=>{aJ.init(a,b),a._zod.check=c=>{try{let d=c.value.trim(),e=new URL(d);b.hostname&&(b.hostname.lastIndex=0,b.hostname.test(e.hostname)||c.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:ad.source,input:c.value,inst:a,continue:!b.abort})),b.protocol&&(b.protocol.lastIndex=0,b.protocol.test(e.protocol.endsWith(":")?e.protocol.slice(0,-1):e.protocol)||c.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:b.protocol.source,input:c.value,inst:a,continue:!b.abort})),b.normalize?c.value=e.href:c.value=d;return}catch(d){c.issues.push({code:"invalid_format",format:"url",input:c.value,inst:a,continue:!b.abort})}}}),aO=b("$ZodEmoji",(a,b)=>{b.pattern??(b.pattern=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),aJ.init(a,b)}),aP=b("$ZodNanoID",(a,b)=>{b.pattern??(b.pattern=U),aJ.init(a,b)}),aQ=b("$ZodCUID",(a,b)=>{b.pattern??(b.pattern=P),aJ.init(a,b)}),aR=b("$ZodCUID2",(a,b)=>{b.pattern??(b.pattern=Q),aJ.init(a,b)}),aS=b("$ZodULID",(a,b)=>{b.pattern??(b.pattern=R),aJ.init(a,b)}),aT=b("$ZodXID",(a,b)=>{b.pattern??(b.pattern=S),aJ.init(a,b)}),aU=b("$ZodKSUID",(a,b)=>{b.pattern??(b.pattern=T),aJ.init(a,b)}),aV=b("$ZodISODateTime",(a,b)=>{b.pattern??(b.pattern=function(a){let b=ah({precision:a.precision}),c=["Z"];a.local&&c.push(""),a.offset&&c.push("([+-](?:[01]\\d|2[0-3]):[0-5]\\d)");let d=`${b}(?:${c.join("|")})`;return RegExp(`^${af}T(?:${d})$`)}(b)),aJ.init(a,b)}),aW=b("$ZodISODate",(a,b)=>{b.pattern??(b.pattern=ag),aJ.init(a,b)}),aX=b("$ZodISOTime",(a,b)=>{b.pattern??(b.pattern=RegExp(`^${ah(b)}$`)),aJ.init(a,b)}),aY=b("$ZodISODuration",(a,b)=>{b.pattern??(b.pattern=V),aJ.init(a,b)}),aZ=b("$ZodIPv4",(a,b)=>{b.pattern??(b.pattern=Z),aJ.init(a,b),a._zod.onattach.push(a=>{a._zod.bag.format="ipv4"})}),a$=b("$ZodIPv6",(a,b)=>{b.pattern??(b.pattern=$),aJ.init(a,b),a._zod.onattach.push(a=>{a._zod.bag.format="ipv6"}),a._zod.check=c=>{try{new URL(`http://[${c.value}]`)}catch{c.issues.push({code:"invalid_format",format:"ipv6",input:c.value,inst:a,continue:!b.abort})}}}),a_=b("$ZodCIDRv4",(a,b)=>{b.pattern??(b.pattern=_),aJ.init(a,b)}),a0=b("$ZodCIDRv6",(a,b)=>{b.pattern??(b.pattern=aa),aJ.init(a,b),a._zod.check=c=>{let d=c.value.split("/");try{if(2!==d.length)throw Error();let[a,b]=d;if(!b)throw Error();let c=Number(b);if(`${c}`!==b||c<0||c>128)throw Error();new URL(`http://[${a}]`)}catch{c.issues.push({code:"invalid_format",format:"cidrv6",input:c.value,inst:a,continue:!b.abort})}}});function a1(a){if(""===a)return!0;if(a.length%4!=0)return!1;try{return atob(a),!0}catch{return!1}}let a2=b("$ZodBase64",(a,b)=>{b.pattern??(b.pattern=ab),aJ.init(a,b),a._zod.onattach.push(a=>{a._zod.bag.contentEncoding="base64"}),a._zod.check=c=>{a1(c.value)||c.issues.push({code:"invalid_format",format:"base64",input:c.value,inst:a,continue:!b.abort})}}),a3=b("$ZodBase64URL",(a,b)=>{b.pattern??(b.pattern=ac),aJ.init(a,b),a._zod.onattach.push(a=>{a._zod.bag.contentEncoding="base64url"}),a._zod.check=c=>{!function(a){if(!ac.test(a))return!1;let b=a.replace(/[-_]/g,a=>"-"===a?"+":"/");return a1(b.padEnd(4*Math.ceil(b.length/4),"="))}(c.value)&&c.issues.push({code:"invalid_format",format:"base64url",input:c.value,inst:a,continue:!b.abort})}}),a4=b("$ZodE164",(a,b)=>{b.pattern??(b.pattern=ae),aJ.init(a,b)}),a5=b("$ZodJWT",(a,b)=>{aJ.init(a,b),a._zod.check=c=>{!function(a,b=null){try{let c=a.split(".");if(3!==c.length)return!1;let[d]=c;if(!d)return!1;let e=JSON.parse(atob(d));if("typ"in e&&e?.typ!=="JWT"||!e.alg||b&&(!("alg"in e)||e.alg!==b))return!1;return!0}catch{return!1}}(c.value,b.alg)&&c.issues.push({code:"invalid_format",format:"jwt",input:c.value,inst:a,continue:!b.abort})}}),a6=b("$ZodNumber",(a,b)=>{aH.init(a,b),a._zod.pattern=a._zod.bag.pattern??ak,a._zod.parse=(c,d)=>{if(b.coerce)try{c.value=Number(c.value)}catch(a){}let e=c.value;if("number"==typeof e&&!Number.isNaN(e)&&Number.isFinite(e))return c;let f="number"==typeof e?Number.isNaN(e)?"NaN":Number.isFinite(e)?void 0:"Infinity":void 0;return c.issues.push({expected:"number",code:"invalid_type",input:e,inst:a,...f?{received:f}:{}}),c}}),a7=b("$ZodNumber",(a,b)=>{at.init(a,b),a6.init(a,b)}),a8=b("$ZodBoolean",(a,b)=>{aH.init(a,b),a._zod.pattern=al,a._zod.parse=(c,d)=>{if(b.coerce)try{c.value=!!c.value}catch(a){}let e=c.value;return"boolean"==typeof e||c.issues.push({expected:"boolean",code:"invalid_type",input:e,inst:a}),c}}),a9=((a,b)=>{aH.init(a,b),a._zod.pattern=ai,a._zod.parse=(c,d)=>{if(b.coerce)try{c.value=BigInt(c.value)}catch(a){}return"bigint"==typeof c.value||c.issues.push({expected:"bigint",code:"invalid_type",input:c.value,inst:a}),c}},b("$ZodUnknown",(a,b)=>{aH.init(a,b),a._zod.parse=a=>a})),ba=b("$ZodNever",(a,b)=>{aH.init(a,b),a._zod.parse=(b,c)=>(b.issues.push({expected:"never",code:"invalid_type",input:b.value,inst:a}),b)}),bb=b("$ZodDate",(a,b)=>{aH.init(a,b),a._zod.parse=(c,d)=>{if(b.coerce)try{c.value=new Date(c.value)}catch(a){}let e=c.value,f=e instanceof Date;return f&&!Number.isNaN(e.getTime())||c.issues.push({expected:"date",code:"invalid_type",input:e,...f?{received:"Invalid Date"}:{},inst:a}),c}});function bc(a,b,c){a.issues.length&&b.issues.push(...B(c,a.issues)),b.value[c]=a.value}let bd=b("$ZodArray",(a,b)=>{aH.init(a,b),a._zod.parse=(c,d)=>{let e=c.value;if(!Array.isArray(e))return c.issues.push({expected:"array",code:"invalid_type",input:e,inst:a}),c;c.value=Array(e.length);let f=[];for(let a=0;a<e.length;a++){let g=e[a],h=b.element._zod.run({value:g,issues:[]},d);h instanceof Promise?f.push(h.then(b=>bc(b,c,a))):bc(h,c,a)}return f.length?Promise.all(f).then(()=>c):c}});function be(a,b,c,d){a.issues.length&&b.issues.push(...B(c,a.issues)),void 0===a.value?c in d&&(b.value[c]=void 0):b.value[c]=a.value}function bf(a){var b;let c=Object.keys(a.shape);for(let b of c)if(!a.shape?.[b]?._zod?.traits?.has("$ZodType"))throw Error(`Invalid element at key "${b}": expected a Zod schema`);let d=Object.keys(b=a.shape).filter(a=>"optional"===b[a]._zod.optin&&"optional"===b[a]._zod.optout);return{...a,keys:c,keySet:new Set(c),numKeys:c.length,optionalKeys:new Set(d)}}function bg(a,b,c,d,e,f){let g=[],h=e.keySet,i=e.catchall._zod,j=i.def.type;for(let e of Object.keys(b)){if(h.has(e))continue;if("never"===j){g.push(e);continue}let f=i.run({value:b[e],issues:[]},d);f instanceof Promise?a.push(f.then(a=>be(a,c,e,b))):be(f,c,e,b)}return(g.length&&c.issues.push({code:"unrecognized_keys",keys:g,input:b,inst:f}),a.length)?Promise.all(a).then(()=>c):c}let bh=b("$ZodObject",(a,b)=>{let c;aH.init(a,b);let d=Object.getOwnPropertyDescriptor(b,"shape");if(!d?.get){let a=b.shape;Object.defineProperty(b,"shape",{get:()=>{let c={...a};return Object.defineProperty(b,"shape",{value:c}),c}})}let e=i(()=>bf(b));l(a._zod,"propValues",()=>{let a=b.shape,c={};for(let b in a){let d=a[b]._zod;if(d.values)for(let a of(c[b]??(c[b]=new Set),d.values))c[b].add(a)}return c});let f=b.catchall;a._zod.parse=(b,d)=>{c??(c=e.value);let g=b.value;if(!q(g))return b.issues.push({expected:"object",code:"invalid_type",input:g,inst:a}),b;b.value={};let h=[],i=c.shape;for(let a of c.keys){let c=i[a]._zod.run({value:g[a],issues:[]},d);c instanceof Promise?h.push(c.then(c=>be(c,b,a,g))):be(c,b,a,g)}return f?bg(h,g,b,d,e.value,a):h.length?Promise.all(h).then(()=>b):b}}),bi=b("$ZodObjectJIT",(a,b)=>{let c,d;bh.init(a,b);let f=a._zod.parse,g=i(()=>bf(b)),h=!e.jitless,j=h&&r.value,k=b.catchall;a._zod.parse=(e,i)=>{d??(d=g.value);let l=e.value;return q(l)?h&&j&&i?.async===!1&&!0!==i.jitless?(c||(c=(a=>{let b=new aF(["shape","payload","ctx"]),c=g.value,d=a=>{let b=o(a);return`shape[${b}]._zod.run({ value: input[${b}], issues: [] }, ctx)`};b.write("const input = payload.value;");let e=Object.create(null),f=0;for(let a of c.keys)e[a]=`key_${f++}`;for(let a of(b.write("const newResult = {};"),c.keys)){let c=e[a],f=o(a);b.write(`const ${c} = ${d(a)};`),b.write(`
        if (${c}.issues.length) {
          payload.issues = payload.issues.concat(${c}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${f}, ...iss.path] : [${f}]
          })));
        }
        
        
        if (${c}.value === undefined) {
          if (${f} in input) {
            newResult[${f}] = undefined;
          }
        } else {
          newResult[${f}] = ${c}.value;
        }
        
      `)}b.write("payload.value = newResult;"),b.write("return payload;");let h=b.compile();return(b,c)=>h(a,b,c)})(b.shape)),e=c(e,i),k)?bg([],l,e,i,d,a):e:f(e,i):(e.issues.push({expected:"object",code:"invalid_type",input:l,inst:a}),e)}});function bj(a,b,c,d){for(let c of a)if(0===c.issues.length)return b.value=c.value,b;let e=a.filter(a=>!A(a));return 1===e.length?(b.value=e[0].value,e[0]):(b.issues.push({code:"invalid_union",input:b.value,inst:c,errors:a.map(a=>a.issues.map(a=>D(a,d,f())))}),b)}let bk=b("$ZodUnion",(a,b)=>{aH.init(a,b),l(a._zod,"optin",()=>b.options.some(a=>"optional"===a._zod.optin)?"optional":void 0),l(a._zod,"optout",()=>b.options.some(a=>"optional"===a._zod.optout)?"optional":void 0),l(a._zod,"values",()=>{if(b.options.every(a=>a._zod.values))return new Set(b.options.flatMap(a=>Array.from(a._zod.values)))}),l(a._zod,"pattern",()=>{if(b.options.every(a=>a._zod.pattern)){let a=b.options.map(a=>a._zod.pattern);return RegExp(`^(${a.map(a=>j(a.source)).join("|")})$`)}});let c=1===b.options.length,d=b.options[0]._zod.run;a._zod.parse=(e,f)=>{if(c)return d(e,f);let g=!1,h=[];for(let a of b.options){let b=a._zod.run({value:e.value,issues:[]},f);if(b instanceof Promise)h.push(b),g=!0;else{if(0===b.issues.length)return b;h.push(b)}}return g?Promise.all(h).then(b=>bj(b,e,a,f)):bj(h,e,a,f)}}),bl=b("$ZodIntersection",(a,b)=>{aH.init(a,b),a._zod.parse=(a,c)=>{let d=a.value,e=b.left._zod.run({value:d,issues:[]},c),f=b.right._zod.run({value:d,issues:[]},c);return e instanceof Promise||f instanceof Promise?Promise.all([e,f]).then(([b,c])=>bm(a,b,c)):bm(a,e,f)}});function bm(a,b,c){if(b.issues.length&&a.issues.push(...b.issues),c.issues.length&&a.issues.push(...c.issues),A(a))return a;let d=function a(b,c){if(b===c||b instanceof Date&&c instanceof Date&&+b==+c)return{valid:!0,data:b};if(s(b)&&s(c)){let d=Object.keys(c),e=Object.keys(b).filter(a=>-1!==d.indexOf(a)),f={...b,...c};for(let d of e){let e=a(b[d],c[d]);if(!e.valid)return{valid:!1,mergeErrorPath:[d,...e.mergeErrorPath]};f[d]=e.data}return{valid:!0,data:f}}if(Array.isArray(b)&&Array.isArray(c)){if(b.length!==c.length)return{valid:!1,mergeErrorPath:[]};let d=[];for(let e=0;e<b.length;e++){let f=a(b[e],c[e]);if(!f.valid)return{valid:!1,mergeErrorPath:[e,...f.mergeErrorPath]};d.push(f.data)}return{valid:!0,data:d}}return{valid:!1,mergeErrorPath:[]}}(b.value,c.value);if(!d.valid)throw Error(`Unmergable intersection. Error path: ${JSON.stringify(d.mergeErrorPath)}`);return a.value=d.data,a}let bn=b("$ZodEnum",(a,b)=>{aH.init(a,b);let c=function(a){let b=Object.values(a).filter(a=>"number"==typeof a);return Object.entries(a).filter(([a,c])=>-1===b.indexOf(+a)).map(([a,b])=>b)}(b.entries),d=new Set(c);a._zod.values=d,a._zod.pattern=RegExp(`^(${c.filter(a=>u.has(typeof a)).map(a=>"string"==typeof a?v(a):a.toString()).join("|")})$`),a._zod.parse=(b,e)=>{let f=b.value;return d.has(f)||b.issues.push({code:"invalid_value",values:c,input:f,inst:a}),b}}),bo=b("$ZodTransform",(a,b)=>{aH.init(a,b),a._zod.parse=(e,f)=>{if("backward"===f.direction)throw new d(a.constructor.name);let g=b.transform(e.value,e);if(f.async)return(g instanceof Promise?g:Promise.resolve(g)).then(a=>(e.value=a,e));if(g instanceof Promise)throw new c;return e.value=g,e}});function bp(a,b){return a.issues.length&&void 0===b?{issues:[],value:void 0}:a}let bq=b("$ZodOptional",(a,b)=>{aH.init(a,b),a._zod.optin="optional",a._zod.optout="optional",l(a._zod,"values",()=>b.innerType._zod.values?new Set([...b.innerType._zod.values,void 0]):void 0),l(a._zod,"pattern",()=>{let a=b.innerType._zod.pattern;return a?RegExp(`^(${j(a.source)})?$`):void 0}),a._zod.parse=(a,c)=>{if("optional"===b.innerType._zod.optin){let d=b.innerType._zod.run(a,c);return d instanceof Promise?d.then(b=>bp(b,a.value)):bp(d,a.value)}return void 0===a.value?a:b.innerType._zod.run(a,c)}}),br=b("$ZodNullable",(a,b)=>{aH.init(a,b),l(a._zod,"optin",()=>b.innerType._zod.optin),l(a._zod,"optout",()=>b.innerType._zod.optout),l(a._zod,"pattern",()=>{let a=b.innerType._zod.pattern;return a?RegExp(`^(${j(a.source)}|null)$`):void 0}),l(a._zod,"values",()=>b.innerType._zod.values?new Set([...b.innerType._zod.values,null]):void 0),a._zod.parse=(a,c)=>null===a.value?a:b.innerType._zod.run(a,c)}),bs=b("$ZodDefault",(a,b)=>{aH.init(a,b),a._zod.optin="optional",l(a._zod,"values",()=>b.innerType._zod.values),a._zod.parse=(a,c)=>{if("backward"===c.direction)return b.innerType._zod.run(a,c);if(void 0===a.value)return a.value=b.defaultValue,a;let d=b.innerType._zod.run(a,c);return d instanceof Promise?d.then(a=>bt(a,b)):bt(d,b)}});function bt(a,b){return void 0===a.value&&(a.value=b.defaultValue),a}let bu=b("$ZodPrefault",(a,b)=>{aH.init(a,b),a._zod.optin="optional",l(a._zod,"values",()=>b.innerType._zod.values),a._zod.parse=(a,c)=>("backward"===c.direction||void 0===a.value&&(a.value=b.defaultValue),b.innerType._zod.run(a,c))}),bv=b("$ZodNonOptional",(a,b)=>{aH.init(a,b),l(a._zod,"values",()=>{let a=b.innerType._zod.values;return a?new Set([...a].filter(a=>void 0!==a)):void 0}),a._zod.parse=(c,d)=>{let e=b.innerType._zod.run(c,d);return e instanceof Promise?e.then(b=>bw(b,a)):bw(e,a)}});function bw(a,b){return a.issues.length||void 0!==a.value||a.issues.push({code:"invalid_type",expected:"nonoptional",input:a.value,inst:b}),a}let bx=b("$ZodCatch",(a,b)=>{aH.init(a,b),l(a._zod,"optin",()=>b.innerType._zod.optin),l(a._zod,"optout",()=>b.innerType._zod.optout),l(a._zod,"values",()=>b.innerType._zod.values),a._zod.parse=(a,c)=>{if("backward"===c.direction)return b.innerType._zod.run(a,c);let d=b.innerType._zod.run(a,c);return d instanceof Promise?d.then(d=>(a.value=d.value,d.issues.length&&(a.value=b.catchValue({...a,error:{issues:d.issues.map(a=>D(a,c,f()))},input:a.value}),a.issues=[]),a)):(a.value=d.value,d.issues.length&&(a.value=b.catchValue({...a,error:{issues:d.issues.map(a=>D(a,c,f()))},input:a.value}),a.issues=[]),a)}}),by=b("$ZodPipe",(a,b)=>{aH.init(a,b),l(a._zod,"values",()=>b.in._zod.values),l(a._zod,"optin",()=>b.in._zod.optin),l(a._zod,"optout",()=>b.out._zod.optout),l(a._zod,"propValues",()=>b.in._zod.propValues),a._zod.parse=(a,c)=>{if("backward"===c.direction){let d=b.out._zod.run(a,c);return d instanceof Promise?d.then(a=>bz(a,b.in,c)):bz(d,b.in,c)}let d=b.in._zod.run(a,c);return d instanceof Promise?d.then(a=>bz(a,b.out,c)):bz(d,b.out,c)}});function bz(a,b,c){return a.issues.length?(a.aborted=!0,a):b._zod.run({value:a.value,issues:a.issues},c)}let bA=b("$ZodReadonly",(a,b)=>{aH.init(a,b),l(a._zod,"propValues",()=>b.innerType._zod.propValues),l(a._zod,"values",()=>b.innerType._zod.values),l(a._zod,"optin",()=>b.innerType._zod.optin),l(a._zod,"optout",()=>b.innerType._zod.optout),a._zod.parse=(a,c)=>{if("backward"===c.direction)return b.innerType._zod.run(a,c);let d=b.innerType._zod.run(a,c);return d instanceof Promise?d.then(bB):bB(d)}});function bB(a){return a.value=Object.freeze(a.value),a}let bC=b("$ZodCustom",(a,b)=>{ao.init(a,b),aH.init(a,b),a._zod.parse=(a,b)=>a,a._zod.check=c=>{let d=c.value,e=b.fn(d);if(e instanceof Promise)return e.then(b=>bD(b,c,d,a));bD(e,c,d,a)}});function bD(a,b,c,d){if(!a){let a={code:"custom",input:c,inst:d,path:[...d._zod.def.path??[]],continue:!d._zod.def.abort};d._zod.def.params&&(a.params=d._zod.def.params),b.issues.push(F(a))}}Symbol("ZodOutput"),Symbol("ZodInput");class bE{constructor(){this._map=new WeakMap,this._idmap=new Map}add(a,...b){let c=b[0];if(this._map.set(a,c),c&&"object"==typeof c&&"id"in c){if(this._idmap.has(c.id))throw Error(`ID ${c.id} already exists in the registry`);this._idmap.set(c.id,a)}return this}clear(){return this._map=new WeakMap,this._idmap=new Map,this}remove(a){let b=this._map.get(a);return b&&"object"==typeof b&&"id"in b&&this._idmap.delete(b.id),this._map.delete(a),this}get(a){let b=a._zod.parent;if(b){let c={...this.get(b)??{}};delete c.id;let d={...c,...this._map.get(a)};return Object.keys(d).length?d:void 0}return this._map.get(a)}has(a){return this._map.has(a)}}let bF=new bE;function bG(a,b){return new a({type:"string",format:"guid",check:"string_format",abort:!1,...x(b)})}function bH(a,b){return new aq({check:"less_than",...x(b),value:a,inclusive:!1})}function bI(a,b){return new aq({check:"less_than",...x(b),value:a,inclusive:!0})}function bJ(a,b){return new ar({check:"greater_than",...x(b),value:a,inclusive:!1})}function bK(a,b){return new ar({check:"greater_than",...x(b),value:a,inclusive:!0})}function bL(a,b){return new as({check:"multiple_of",...x(b),value:a})}function bM(a,b){return new au({check:"max_length",...x(b),maximum:a})}function bN(a,b){return new av({check:"min_length",...x(b),minimum:a})}function bO(a,b){return new aw({check:"length_equals",...x(b),length:a})}function bP(a){return new aE({check:"overwrite",tx:a})}let bQ=b("ZodISODateTime",(a,b)=>{aV.init(a,b),ca.init(a,b)}),bR=b("ZodISODate",(a,b)=>{aW.init(a,b),ca.init(a,b)}),bS=b("ZodISOTime",(a,b)=>{aX.init(a,b),ca.init(a,b)}),bT=b("ZodISODuration",(a,b)=>{aY.init(a,b),ca.init(a,b)}),bU=(a,b)=>{H.init(a,b),a.name="ZodError",Object.defineProperties(a,{format:{value:b=>(function(a,b=a=>a.message){let c={_errors:[]},d=a=>{for(let e of a.issues)if("invalid_union"===e.code&&e.errors.length)e.errors.map(a=>d({issues:a}));else if("invalid_key"===e.code)d({issues:e.issues});else if("invalid_element"===e.code)d({issues:e.issues});else if(0===e.path.length)c._errors.push(b(e));else{let a=c,d=0;for(;d<e.path.length;){let c=e.path[d];d===e.path.length-1?(a[c]=a[c]||{_errors:[]},a[c]._errors.push(b(e))):a[c]=a[c]||{_errors:[]},a=a[c],d++}}};return d(a),c})(a,b)},flatten:{value:b=>(function(a,b=a=>a.message){let c={},d=[];for(let e of a.issues)e.path.length>0?(c[e.path[0]]=c[e.path[0]]||[],c[e.path[0]].push(b(e))):d.push(b(e));return{formErrors:d,fieldErrors:c}})(a,b)},addIssue:{value:b=>{a.issues.push(b),a.message=JSON.stringify(a.issues,h,2)}},addIssues:{value:b=>{a.issues.push(...b),a.message=JSON.stringify(a.issues,h,2)}},isEmpty:{get:()=>0===a.issues.length}})};b("ZodError",bU);let bV=b("ZodError",bU,{Parent:Error}),bW=J(bV),bX=K(bV),bY=L(bV),bZ=N(bV),b$=(a,b,c)=>{let d=c?Object.assign(c,{direction:"backward"}):{direction:"backward"};return J(bV)(a,b,d)},b_=(a,b,c)=>J(bV)(a,b,c),b0=async(a,b,c)=>{let d=c?Object.assign(c,{direction:"backward"}):{direction:"backward"};return K(bV)(a,b,d)},b1=async(a,b,c)=>K(bV)(a,b,c),b2=(a,b,c)=>{let d=c?Object.assign(c,{direction:"backward"}):{direction:"backward"};return L(bV)(a,b,d)},b3=(a,b,c)=>L(bV)(a,b,c),b4=async(a,b,c)=>{let d=c?Object.assign(c,{direction:"backward"}):{direction:"backward"};return N(bV)(a,b,d)},b5=async(a,b,c)=>N(bV)(a,b,c),b6=b("ZodType",(a,b)=>(aH.init(a,b),a.def=b,a.type=b.type,Object.defineProperty(a,"_def",{value:b}),a.check=(...c)=>a.clone(n(b,{checks:[...b.checks??[],...c.map(a=>"function"==typeof a?{_zod:{check:a,def:{check:"custom"},onattach:[]}}:a)]})),a.clone=(b,c)=>w(a,b,c),a.brand=()=>a,a.register=(b,c)=>(b.add(a,c),a),a.parse=(b,c)=>bW(a,b,c,{callee:a.parse}),a.safeParse=(b,c)=>bY(a,b,c),a.parseAsync=async(b,c)=>bX(a,b,c,{callee:a.parseAsync}),a.safeParseAsync=async(b,c)=>bZ(a,b,c),a.spa=a.safeParseAsync,a.encode=(b,c)=>b$(a,b,c),a.decode=(b,c)=>b_(a,b,c),a.encodeAsync=async(b,c)=>b0(a,b,c),a.decodeAsync=async(b,c)=>b1(a,b,c),a.safeEncode=(b,c)=>b2(a,b,c),a.safeDecode=(b,c)=>b3(a,b,c),a.safeEncodeAsync=async(b,c)=>b4(a,b,c),a.safeDecodeAsync=async(b,c)=>b5(a,b,c),a.refine=(b,c)=>a.check(function(a,b={}){return new cU({type:"custom",check:"custom",fn:a,...x(b)})}(b,c)),a.superRefine=b=>a.check(function(a){let b=function(a,b){let c=new ao({check:"custom",...x(void 0)});return c._zod.check=a,c}(c=>(c.addIssue=a=>{"string"==typeof a?c.issues.push(F(a,c.value,b._zod.def)):(a.fatal&&(a.continue=!1),a.code??(a.code="custom"),a.input??(a.input=c.value),a.inst??(a.inst=b),a.continue??(a.continue=!b._zod.def.abort),c.issues.push(F(a)))},a(c.value,c)));return b}(b)),a.overwrite=b=>a.check(bP(b)),a.optional=()=>cK(a),a.nullable=()=>cM(a),a.nullish=()=>cK(cM(a)),a.nonoptional=b=>new cP({type:"nonoptional",innerType:a,...x(b)}),a.array=()=>(function(a,b){return new cD({type:"array",element:a,...x(void 0)})})(a),a.or=b=>new cF({type:"union",options:[a,b],...x(void 0)}),a.and=b=>new cG({type:"intersection",left:a,right:b}),a.transform=b=>cS(a,new cI({type:"transform",transform:b})),a.default=b=>(function(a,b){return new cN({type:"default",innerType:a,get defaultValue(){return"function"==typeof b?b():t(b)}})})(a,b),a.prefault=b=>(function(a,b){return new cO({type:"prefault",innerType:a,get defaultValue(){return"function"==typeof b?b():t(b)}})})(a,b),a.catch=b=>(function(a,b){return new cQ({type:"catch",innerType:a,catchValue:"function"==typeof b?b:()=>b})})(a,b),a.pipe=b=>cS(a,b),a.readonly=()=>new cT({type:"readonly",innerType:a}),a.describe=b=>{let c=a.clone();return bF.add(c,{description:b}),c},Object.defineProperty(a,"description",{get:()=>bF.get(a)?.description,configurable:!0}),a.meta=(...b)=>{if(0===b.length)return bF.get(a);let c=a.clone();return bF.add(c,b[0]),c},a.isOptional=()=>a.safeParse(void 0).success,a.isNullable=()=>a.safeParse(null).success,a)),b7=b("_ZodString",(a,b)=>{aI.init(a,b),b6.init(a,b);let c=a._zod.bag;a.format=c.format??null,a.minLength=c.minimum??null,a.maxLength=c.maximum??null,a.regex=(...b)=>a.check(function(a,b){return new ay({check:"string_format",format:"regex",...x(b),pattern:a})}(...b)),a.includes=(...b)=>a.check(function(a,b){return new aB({check:"string_format",format:"includes",...x(b),includes:a})}(...b)),a.startsWith=(...b)=>a.check(function(a,b){return new aC({check:"string_format",format:"starts_with",...x(b),prefix:a})}(...b)),a.endsWith=(...b)=>a.check(function(a,b){return new aD({check:"string_format",format:"ends_with",...x(b),suffix:a})}(...b)),a.min=(...b)=>a.check(bN(...b)),a.max=(...b)=>a.check(bM(...b)),a.length=(...b)=>a.check(bO(...b)),a.nonempty=(...b)=>a.check(bN(1,...b)),a.lowercase=b=>a.check(new az({check:"string_format",format:"lowercase",...x(b)})),a.uppercase=b=>a.check(new aA({check:"string_format",format:"uppercase",...x(b)})),a.trim=()=>a.check(bP(a=>a.trim())),a.normalize=(...b)=>a.check(function(a){return bP(b=>b.normalize(a))}(...b)),a.toLowerCase=()=>a.check(bP(a=>a.toLowerCase())),a.toUpperCase=()=>a.check(bP(a=>a.toUpperCase()))}),b8=b("ZodString",(a,b)=>{aI.init(a,b),b7.init(a,b),a.email=b=>a.check(new cb({type:"string",format:"email",check:"string_format",abort:!1,...x(b)})),a.url=b=>a.check(new ce({type:"string",format:"url",check:"string_format",abort:!1,...x(b)})),a.jwt=b=>a.check(new ct({type:"string",format:"jwt",check:"string_format",abort:!1,...x(b)})),a.emoji=b=>a.check(new cf({type:"string",format:"emoji",check:"string_format",abort:!1,...x(b)})),a.guid=b=>a.check(bG(cc,b)),a.uuid=b=>a.check(new cd({type:"string",format:"uuid",check:"string_format",abort:!1,...x(b)})),a.uuidv4=b=>a.check(new cd({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...x(b)})),a.uuidv6=b=>a.check(new cd({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...x(b)})),a.uuidv7=b=>a.check(new cd({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...x(b)})),a.nanoid=b=>a.check(new cg({type:"string",format:"nanoid",check:"string_format",abort:!1,...x(b)})),a.guid=b=>a.check(bG(cc,b)),a.cuid=b=>a.check(new ch({type:"string",format:"cuid",check:"string_format",abort:!1,...x(b)})),a.cuid2=b=>a.check(new ci({type:"string",format:"cuid2",check:"string_format",abort:!1,...x(b)})),a.ulid=b=>a.check(new cj({type:"string",format:"ulid",check:"string_format",abort:!1,...x(b)})),a.base64=b=>a.check(new cq({type:"string",format:"base64",check:"string_format",abort:!1,...x(b)})),a.base64url=b=>a.check(new cr({type:"string",format:"base64url",check:"string_format",abort:!1,...x(b)})),a.xid=b=>a.check(new ck({type:"string",format:"xid",check:"string_format",abort:!1,...x(b)})),a.ksuid=b=>a.check(new cl({type:"string",format:"ksuid",check:"string_format",abort:!1,...x(b)})),a.ipv4=b=>a.check(new cm({type:"string",format:"ipv4",check:"string_format",abort:!1,...x(b)})),a.ipv6=b=>a.check(new cn({type:"string",format:"ipv6",check:"string_format",abort:!1,...x(b)})),a.cidrv4=b=>a.check(new co({type:"string",format:"cidrv4",check:"string_format",abort:!1,...x(b)})),a.cidrv6=b=>a.check(new cp({type:"string",format:"cidrv6",check:"string_format",abort:!1,...x(b)})),a.e164=b=>a.check(new cs({type:"string",format:"e164",check:"string_format",abort:!1,...x(b)})),a.datetime=b=>a.check(new bQ({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...x(b)})),a.date=b=>a.check(new bR({type:"string",format:"date",check:"string_format",...x(b)})),a.time=b=>a.check(new bS({type:"string",format:"time",check:"string_format",precision:null,...x(b)})),a.duration=b=>a.check(new bT({type:"string",format:"duration",check:"string_format",...x(b)}))});function b9(a){return new b8({type:"string",...x(a)})}let ca=b("ZodStringFormat",(a,b)=>{aJ.init(a,b),b7.init(a,b)}),cb=b("ZodEmail",(a,b)=>{aM.init(a,b),ca.init(a,b)}),cc=b("ZodGUID",(a,b)=>{aK.init(a,b),ca.init(a,b)}),cd=b("ZodUUID",(a,b)=>{aL.init(a,b),ca.init(a,b)}),ce=b("ZodURL",(a,b)=>{aN.init(a,b),ca.init(a,b)}),cf=b("ZodEmoji",(a,b)=>{aO.init(a,b),ca.init(a,b)}),cg=b("ZodNanoID",(a,b)=>{aP.init(a,b),ca.init(a,b)}),ch=b("ZodCUID",(a,b)=>{aQ.init(a,b),ca.init(a,b)}),ci=b("ZodCUID2",(a,b)=>{aR.init(a,b),ca.init(a,b)}),cj=b("ZodULID",(a,b)=>{aS.init(a,b),ca.init(a,b)}),ck=b("ZodXID",(a,b)=>{aT.init(a,b),ca.init(a,b)}),cl=b("ZodKSUID",(a,b)=>{aU.init(a,b),ca.init(a,b)}),cm=b("ZodIPv4",(a,b)=>{aZ.init(a,b),ca.init(a,b)}),cn=b("ZodIPv6",(a,b)=>{a$.init(a,b),ca.init(a,b)}),co=b("ZodCIDRv4",(a,b)=>{a_.init(a,b),ca.init(a,b)}),cp=b("ZodCIDRv6",(a,b)=>{a0.init(a,b),ca.init(a,b)}),cq=b("ZodBase64",(a,b)=>{a2.init(a,b),ca.init(a,b)}),cr=b("ZodBase64URL",(a,b)=>{a3.init(a,b),ca.init(a,b)}),cs=b("ZodE164",(a,b)=>{a4.init(a,b),ca.init(a,b)}),ct=b("ZodJWT",(a,b)=>{a5.init(a,b),ca.init(a,b)}),cu=b("ZodNumber",(a,b)=>{a6.init(a,b),b6.init(a,b),a.gt=(b,c)=>a.check(bJ(b,c)),a.gte=(b,c)=>a.check(bK(b,c)),a.min=(b,c)=>a.check(bK(b,c)),a.lt=(b,c)=>a.check(bH(b,c)),a.lte=(b,c)=>a.check(bI(b,c)),a.max=(b,c)=>a.check(bI(b,c)),a.int=b=>a.check(cw(b)),a.safe=b=>a.check(cw(b)),a.positive=b=>a.check(bJ(0,b)),a.nonnegative=b=>a.check(bK(0,b)),a.negative=b=>a.check(bH(0,b)),a.nonpositive=b=>a.check(bI(0,b)),a.multipleOf=(b,c)=>a.check(bL(b,c)),a.step=(b,c)=>a.check(bL(b,c)),a.finite=()=>a;let c=a._zod.bag;a.minValue=Math.max(c.minimum??-1/0,c.exclusiveMinimum??-1/0)??null,a.maxValue=Math.min(c.maximum??1/0,c.exclusiveMaximum??1/0)??null,a.isInt=(c.format??"").includes("int")||Number.isSafeInteger(c.multipleOf??.5),a.isFinite=!0,a.format=c.format??null}),cv=b("ZodNumberFormat",(a,b)=>{a7.init(a,b),cu.init(a,b)});function cw(a){return new cv({type:"number",check:"number_format",abort:!1,format:"safeint",...x(a)})}let cx=b("ZodBoolean",(a,b)=>{a8.init(a,b),b6.init(a,b)}),cy=b("ZodUnknown",(a,b)=>{a9.init(a,b),b6.init(a,b)});function cz(){return new cy({type:"unknown"})}let cA=b("ZodNever",(a,b)=>{ba.init(a,b),b6.init(a,b)}),cB=b("ZodDate",(a,b)=>{bb.init(a,b),b6.init(a,b),a.min=(b,c)=>a.check(bK(b,c)),a.max=(b,c)=>a.check(bI(b,c));let c=a._zod.bag;a.minDate=c.minimum?new Date(c.minimum):null,a.maxDate=c.maximum?new Date(c.maximum):null});function cC(a){return new cB({type:"date",...x(a)})}let cD=b("ZodArray",(a,b)=>{bd.init(a,b),b6.init(a,b),a.element=b.element,a.min=(b,c)=>a.check(bN(b,c)),a.nonempty=b=>a.check(bN(1,b)),a.max=(b,c)=>a.check(bM(b,c)),a.length=(b,c)=>a.check(bO(b,c)),a.unwrap=()=>a.element}),cE=b("ZodObject",(a,b)=>{bi.init(a,b),b6.init(a,b),l(a,"shape",()=>b.shape),a.keyof=()=>(function(a,b){return new cH({type:"enum",entries:Array.isArray(a)?Object.fromEntries(a.map(a=>[a,a])):a,...x(void 0)})})(Object.keys(a._zod.def.shape)),a.catchall=b=>a.clone({...a._zod.def,catchall:b}),a.passthrough=()=>a.clone({...a._zod.def,catchall:cz()}),a.loose=()=>a.clone({...a._zod.def,catchall:cz()}),a.strict=()=>a.clone({...a._zod.def,catchall:new cA({type:"never",...x(void 0)})}),a.strip=()=>a.clone({...a._zod.def,catchall:void 0}),a.extend=b=>(function(a,b){if(!s(b))throw Error("Invalid input to extend: expected a plain object");let c=a._zod.def.checks;if(c&&c.length>0)throw Error("Object schemas containing refinements cannot be extended. Use `.safeExtend()` instead.");let d=n(a._zod.def,{get shape(){let c={...a._zod.def.shape,...b};return m(this,"shape",c),c},checks:[]});return w(a,d)})(a,b),a.safeExtend=b=>(function(a,b){if(!s(b))throw Error("Invalid input to safeExtend: expected a plain object");let c={...a._zod.def,get shape(){let c={...a._zod.def.shape,...b};return m(this,"shape",c),c},checks:a._zod.def.checks};return w(a,c)})(a,b),a.merge=b=>(function(a,b){let c=n(a._zod.def,{get shape(){let c={...a._zod.def.shape,...b._zod.def.shape};return m(this,"shape",c),c},get catchall(){return b._zod.def.catchall},checks:[]});return w(a,c)})(a,b),a.pick=b=>(function(a,b){let c=a._zod.def,d=n(a._zod.def,{get shape(){let a={};for(let d in b){if(!(d in c.shape))throw Error(`Unrecognized key: "${d}"`);b[d]&&(a[d]=c.shape[d])}return m(this,"shape",a),a},checks:[]});return w(a,d)})(a,b),a.omit=b=>(function(a,b){let c=a._zod.def,d=n(a._zod.def,{get shape(){let d={...a._zod.def.shape};for(let a in b){if(!(a in c.shape))throw Error(`Unrecognized key: "${a}"`);b[a]&&delete d[a]}return m(this,"shape",d),d},checks:[]});return w(a,d)})(a,b),a.partial=(...b)=>(function(a,b,c){let d=n(b._zod.def,{get shape(){let d=b._zod.def.shape,e={...d};if(c)for(let b in c){if(!(b in d))throw Error(`Unrecognized key: "${b}"`);c[b]&&(e[b]=a?new a({type:"optional",innerType:d[b]}):d[b])}else for(let b in d)e[b]=a?new a({type:"optional",innerType:d[b]}):d[b];return m(this,"shape",e),e},checks:[]});return w(b,d)})(cJ,a,b[0]),a.required=(...b)=>(function(a,b,c){let d=n(b._zod.def,{get shape(){let d=b._zod.def.shape,e={...d};if(c)for(let b in c){if(!(b in e))throw Error(`Unrecognized key: "${b}"`);c[b]&&(e[b]=new a({type:"nonoptional",innerType:d[b]}))}else for(let b in d)e[b]=new a({type:"nonoptional",innerType:d[b]});return m(this,"shape",e),e},checks:[]});return w(b,d)})(cP,a,b[0])}),cF=b("ZodUnion",(a,b)=>{bk.init(a,b),b6.init(a,b),a.options=b.options}),cG=b("ZodIntersection",(a,b)=>{bl.init(a,b),b6.init(a,b)}),cH=b("ZodEnum",(a,b)=>{bn.init(a,b),b6.init(a,b),a.enum=b.entries,a.options=Object.values(b.entries);let c=new Set(Object.keys(b.entries));a.extract=(a,d)=>{let e={};for(let d of a)if(c.has(d))e[d]=b.entries[d];else throw Error(`Key ${d} not found in enum`);return new cH({...b,checks:[],...x(d),entries:e})},a.exclude=(a,d)=>{let e={...b.entries};for(let b of a)if(c.has(b))delete e[b];else throw Error(`Key ${b} not found in enum`);return new cH({...b,checks:[],...x(d),entries:e})}}),cI=b("ZodTransform",(a,b)=>{bo.init(a,b),b6.init(a,b),a._zod.parse=(c,e)=>{if("backward"===e.direction)throw new d(a.constructor.name);c.addIssue=d=>{"string"==typeof d?c.issues.push(F(d,c.value,b)):(d.fatal&&(d.continue=!1),d.code??(d.code="custom"),d.input??(d.input=c.value),d.inst??(d.inst=a),c.issues.push(F(d)))};let f=b.transform(c.value,c);return f instanceof Promise?f.then(a=>(c.value=a,c)):(c.value=f,c)}}),cJ=b("ZodOptional",(a,b)=>{bq.init(a,b),b6.init(a,b),a.unwrap=()=>a._zod.def.innerType});function cK(a){return new cJ({type:"optional",innerType:a})}let cL=b("ZodNullable",(a,b)=>{br.init(a,b),b6.init(a,b),a.unwrap=()=>a._zod.def.innerType});function cM(a){return new cL({type:"nullable",innerType:a})}let cN=b("ZodDefault",(a,b)=>{bs.init(a,b),b6.init(a,b),a.unwrap=()=>a._zod.def.innerType,a.removeDefault=a.unwrap}),cO=b("ZodPrefault",(a,b)=>{bu.init(a,b),b6.init(a,b),a.unwrap=()=>a._zod.def.innerType}),cP=b("ZodNonOptional",(a,b)=>{bv.init(a,b),b6.init(a,b),a.unwrap=()=>a._zod.def.innerType}),cQ=b("ZodCatch",(a,b)=>{bx.init(a,b),b6.init(a,b),a.unwrap=()=>a._zod.def.innerType,a.removeCatch=a.unwrap}),cR=b("ZodPipe",(a,b)=>{by.init(a,b),b6.init(a,b),a.in=b.in,a.out=b.out});function cS(a,b){return new cR({type:"pipe",in:a,out:b})}let cT=b("ZodReadonly",(a,b)=>{bA.init(a,b),b6.init(a,b),a.unwrap=()=>a._zod.def.innerType}),cU=b("ZodCustom",(a,b)=>{bC.init(a,b),b6.init(a,b)});function cV(a){return new b8({type:"string",coerce:!0,...x(a)})}a||(a={}),f({localeError:(()=>{let a={string:{unit:"characters",verb:"to have"},file:{unit:"bytes",verb:"to have"},array:{unit:"items",verb:"to have"},set:{unit:"items",verb:"to have"}},b={regex:"input",email:"email address",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO datetime",date:"ISO date",time:"ISO time",duration:"ISO duration",ipv4:"IPv4 address",ipv6:"IPv6 address",cidrv4:"IPv4 range",cidrv6:"IPv6 range",base64:"base64-encoded string",base64url:"base64url-encoded string",json_string:"JSON string",e164:"E.164 number",jwt:"JWT",template_literal:"input"};return c=>{switch(c.code){case"invalid_type":return`Invalid input: expected ${c.expected}, received ${(a=>{let b=typeof a;switch(b){case"number":return Number.isNaN(a)?"NaN":"number";case"object":if(Array.isArray(a))return"array";if(null===a)return"null";if(Object.getPrototypeOf(a)!==Object.prototype&&a.constructor)return a.constructor.name}return b})(c.input)}`;case"invalid_value":if(1===c.values.length)return`Invalid input: expected ${y(c.values[0])}`;return`Invalid option: expected one of ${g(c.values,"|")}`;case"too_big":{let b=c.inclusive?"<=":"<",d=a[c.origin]??null;if(d)return`Too big: expected ${c.origin??"value"} to have ${b}${c.maximum.toString()} ${d.unit??"elements"}`;return`Too big: expected ${c.origin??"value"} to be ${b}${c.maximum.toString()}`}case"too_small":{let b=c.inclusive?">=":">",d=a[c.origin]??null;if(d)return`Too small: expected ${c.origin} to have ${b}${c.minimum.toString()} ${d.unit}`;return`Too small: expected ${c.origin} to be ${b}${c.minimum.toString()}`}case"invalid_format":if("starts_with"===c.format)return`Invalid string: must start with "${c.prefix}"`;if("ends_with"===c.format)return`Invalid string: must end with "${c.suffix}"`;if("includes"===c.format)return`Invalid string: must include "${c.includes}"`;if("regex"===c.format)return`Invalid string: must match pattern ${c.pattern}`;return`Invalid ${b[c.format]??c.format}`;case"not_multiple_of":return`Invalid number: must be a multiple of ${c.divisor}`;case"unrecognized_keys":return`Unrecognized key${c.keys.length>1?"s":""}: ${g(c.keys,", ")}`;case"invalid_key":return`Invalid key in ${c.origin}`;case"invalid_union":default:return"Invalid input";case"invalid_element":return`Invalid value in ${c.origin}`}}})()});let cW=new cE({type:"object",shape:{id:b9(),createdAt:cC().default(()=>new Date),updatedAt:cC().default(()=>new Date)}??{},...x(void 0)});cW.extend({email:b9().transform(a=>a.toLowerCase()),emailVerified:new cx({type:"boolean",...x(void 0)}).default(!1),name:b9(),image:b9().nullish()}),cW.extend({providerId:b9(),accountId:b9(),userId:cV(),accessToken:b9().nullish(),refreshToken:b9().nullish(),idToken:b9().nullish(),accessTokenExpiresAt:cC().nullish(),refreshTokenExpiresAt:cC().nullish(),scope:b9().nullish(),password:b9().nullish()}),cW.extend({userId:cV(),expiresAt:cC(),token:b9(),ipAddress:b9().nullish(),userAgent:b9().nullish()}),cW.extend({value:b9(),expiresAt:cC(),identifier:b9()})},27320:(a,b,c)=>{c.d(b,{zZ:()=>z});var d=Object.defineProperty,e=Object.defineProperties,f=Object.getOwnPropertyDescriptors,g=Object.getOwnPropertySymbols,h=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,j=(a,b,c)=>b in a?d(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,k=(a,b)=>{for(var c in b||(b={}))h.call(b,c)&&j(a,c,b[c]);if(g)for(var c of g(b))i.call(b,c)&&j(a,c,b[c]);return a},l=(a,b)=>e(a,f(b)),m=class extends Error{constructor(a,b,c){super(b||a.toString(),{cause:c}),this.status=a,this.statusText=b,this.error=c}},n=async(a,b)=>{var c,d,e,f,g,h;let i=b||{},j={onRequest:[null==b?void 0:b.onRequest],onResponse:[null==b?void 0:b.onResponse],onSuccess:[null==b?void 0:b.onSuccess],onError:[null==b?void 0:b.onError],onRetry:[null==b?void 0:b.onRetry]};if(!b||!(null==b?void 0:b.plugins))return{url:a,options:i,hooks:j};for(let k of(null==b?void 0:b.plugins)||[]){if(k.init){let d=await (null==(c=k.init)?void 0:c.call(k,a.toString(),b));i=d.options||i,a=d.url}j.onRequest.push(null==(d=k.hooks)?void 0:d.onRequest),j.onResponse.push(null==(e=k.hooks)?void 0:e.onResponse),j.onSuccess.push(null==(f=k.hooks)?void 0:f.onSuccess),j.onError.push(null==(g=k.hooks)?void 0:g.onError),j.onRetry.push(null==(h=k.hooks)?void 0:h.onRetry)}return{url:a,options:i,hooks:j}},o=class{constructor(a){this.options=a}shouldAttemptRetry(a,b){return this.options.shouldRetry?Promise.resolve(a<this.options.attempts&&this.options.shouldRetry(b)):Promise.resolve(a<this.options.attempts)}getDelay(){return this.options.delay}},p=class{constructor(a){this.options=a}shouldAttemptRetry(a,b){return this.options.shouldRetry?Promise.resolve(a<this.options.attempts&&this.options.shouldRetry(b)):Promise.resolve(a<this.options.attempts)}getDelay(a){return Math.min(this.options.maxDelay,this.options.baseDelay*2**a)}},q=async a=>{let b={},c=async a=>"function"==typeof a?await a():a;if(null==a?void 0:a.auth){if("Bearer"===a.auth.type){let d=await c(a.auth.token);if(!d)return b;b.authorization=`Bearer ${d}`}else if("Basic"===a.auth.type){let d=c(a.auth.username),e=c(a.auth.password);if(!d||!e)return b;b.authorization=`Basic ${btoa(`${d}:${e}`)}`}else if("Custom"===a.auth.type){let d=c(a.auth.value);if(!d)return b;b.authorization=`${c(a.auth.prefix)} ${d}`}}return b},r=/^application\/(?:[\w!#$%&*.^`~-]*\+)?json(;.+)?$/i;function s(a){if(void 0===a)return!1;let b=typeof a;return"string"===b||"number"===b||"boolean"===b||null===b||"object"===b&&(!!Array.isArray(a)||!a.buffer&&(a.constructor&&"Object"===a.constructor.name||"function"==typeof a.toJSON))}function t(a){try{return JSON.parse(a)}catch(b){return a}}function u(a){return"function"==typeof a}async function v(a){let b=new Headers(null==a?void 0:a.headers);for(let[c,d]of Object.entries(await q(a)||{}))b.set(c,d);if(!b.has("content-type")){let c=s(null==a?void 0:a.body)?"application/json":null;c&&b.set("content-type",c)}return b}var w=class a extends Error{constructor(b,c){super(c||JSON.stringify(b,null,2)),this.issues=b,Object.setPrototypeOf(this,a.prototype)}};async function x(a,b){let c=await a["~standard"].validate(b);if(c.issues)throw new w(c.issues);return c.value}var y=["get","post","put","patch","delete"],z=async(a,b)=>{var c,d,e,f,g,h,i,j;let{hooks:q,url:w,options:A}=await n(a,b),B=function(a){if(null==a?void 0:a.customFetchImpl)return a.customFetchImpl;if("undefined"!=typeof globalThis&&u(globalThis.fetch))return globalThis.fetch;if("undefined"!=typeof window&&u(window.fetch))return window.fetch;throw Error("No fetch implementation found")}(A),C=new AbortController,D=null!=(c=A.signal)?c:C.signal,E=function(a,b){let{baseURL:c,params:d,query:e}=b||{query:{},params:{},baseURL:""},f=a.startsWith("http")?a.split("/").slice(0,3).join("/"):c||"";if(a.startsWith("@")){let b=a.toString().split("@")[1].split("/")[0];y.includes(b)&&(a=a.replace(`@${b}/`,"/"))}f.endsWith("/")||(f+="/");let[g,h]=a.replace(f,"").split("?"),i=new URLSearchParams(h);for(let[a,b]of Object.entries(e||{}))null!=b&&i.set(a,String(b));if(d)if(Array.isArray(d))for(let[a,b]of g.split("/").filter(a=>a.startsWith(":")).entries()){let c=d[a];g=g.replace(b,c)}else for(let[a,b]of Object.entries(d))g=g.replace(`:${a}`,String(b));(g=g.split("/").map(encodeURIComponent).join("/")).startsWith("/")&&(g=g.slice(1));let j=i.toString();return(j=j.length>0?`?${j}`.replace(/\+/g,"%20"):"",f.startsWith("http"))?new URL(`${g}${j}`,f):`${f}${g}${j}`}(w,A),F=function(a){if(!(null==a?void 0:a.body))return null;let b=new Headers(null==a?void 0:a.headers);if(s(a.body)&&!b.has("content-type")){for(let[b,c]of Object.entries(null==a?void 0:a.body))c instanceof Date&&(a.body[b]=c.toISOString());return JSON.stringify(a.body)}return a.body}(A),G=await v(A),H=function(a,b){var c;if(null==b?void 0:b.method)return b.method.toUpperCase();if(a.startsWith("@")){let d=null==(c=a.split("@")[1])?void 0:c.split("/")[0];return y.includes(d)?d.toUpperCase():(null==b?void 0:b.body)?"POST":"GET"}return(null==b?void 0:b.body)?"POST":"GET"}(w,A),I=l(k({},A),{url:E,headers:G,body:F,method:H,signal:D});for(let a of q.onRequest)if(a){let b=await a(I);b instanceof Object&&(I=b)}("pipeTo"in I&&"function"==typeof I.pipeTo||"function"==typeof(null==(d=null==b?void 0:b.body)?void 0:d.pipe))&&!("duplex"in I)&&(I.duplex="half");let{clearTimeout:J}=function(a,b){let c;return!(null==a?void 0:a.signal)&&(null==a?void 0:a.timeout)&&(c=setTimeout(()=>null==b?void 0:b.abort(),null==a?void 0:a.timeout)),{abortTimeout:c,clearTimeout:()=>{c&&clearTimeout(c)}}}(A,C),K=await B(I.url,I);J();let L={response:K,request:I};for(let a of q.onResponse)if(a){let c=await a(l(k({},L),{response:(null==(e=null==b?void 0:b.hookOptions)?void 0:e.cloneResponse)?K.clone():K}));c instanceof Response?K=c:c instanceof Object&&(K=c.response)}if(K.ok){if("HEAD"===I.method)return{data:"",error:null};let a=function(a){let b=a.headers.get("content-type"),c=new Set(["image/svg","application/xml","application/xhtml","application/html"]);if(!b)return"json";let d=b.split(";").shift()||"";return r.test(d)?"json":c.has(d)||d.startsWith("text/")?"text":"blob"}(K),c={data:"",response:K,request:I};if("json"===a||"text"===a){let a=await K.text(),b=null!=(f=I.jsonParser)?f:t;c.data=await b(a)}else c.data=await K[a]();for(let a of((null==I?void 0:I.output)&&I.output&&!I.disableValidation&&(c.data=await x(I.output,c.data)),q.onSuccess))a&&await a(l(k({},c),{response:(null==(g=null==b?void 0:b.hookOptions)?void 0:g.cloneResponse)?K.clone():K}));return(null==b?void 0:b.throw)?c.data:{data:c.data,error:null}}let M=null!=(h=null==b?void 0:b.jsonParser)?h:t,N=await K.text(),O=function(a){try{return JSON.parse(a),!0}catch(a){return!1}}(N),P=O?await M(N):null,Q={response:K,responseText:N,request:I,error:l(k({},P),{status:K.status,statusText:K.statusText})};for(let a of q.onError)a&&await a(l(k({},Q),{response:(null==(i=null==b?void 0:b.hookOptions)?void 0:i.cloneResponse)?K.clone():K}));if(null==b?void 0:b.retry){let c=function(a){if("number"==typeof a)return new o({type:"linear",attempts:a,delay:1e3});switch(a.type){case"linear":return new o(a);case"exponential":return new p(a);default:throw Error("Invalid retry strategy")}}(b.retry),d=null!=(j=b.retryAttempt)?j:0;if(await c.shouldAttemptRetry(d,K)){for(let a of q.onRetry)a&&await a(L);let e=c.getDelay(d);return await new Promise(a=>setTimeout(a,e)),await z(a,l(k({},b),{retryAttempt:d+1}))}}if(null==b?void 0:b.throw)throw new m(K.status,K.statusText,O?P:N);return{data:null,error:l(k({},P),{status:K.status,statusText:K.statusText})}}},27646:(a,b,c)=>{c.d(b,{C:()=>h,g:()=>g});var d=c(39450),e=c(2952),f=c(60353);class g{#aC;get dynamicReference(){return this.#aC}get refType(){}constructor(a){this.#aC=a}toOperationNode(){return(0,e.vd)(this.#aC)}}function h(a){return(0,f.Gv)(a)&&(0,d.N)(a)&&(0,f.Kg)(a.dynamicReference)}},28244:(a,b,c)=>{c.d(b,{K:()=>e});var d=c(60353);let e=(0,d.CN)({is:a=>"OrNode"===a.kind,create:(a,b)=>(0,d.CN)({kind:"OrNode",left:a,right:b})})},31009:(a,b,c)=>{c.d(b,{Z:()=>f});var d=c(60353),e=c(81266);let f=(0,d.CN)({is:a=>"ColumnNode"===a.kind,create:a=>(0,d.CN)({kind:"ColumnNode",column:e.O.create(a)})})},31575:(a,b,c)=>{c.d(b,{z:()=>e});var d=c(60353);let e=(0,d.CN)({is:a=>"RawNode"===a.kind,create:(a,b)=>(0,d.CN)({kind:"RawNode",sqlFragments:(0,d.CN)(a),parameters:(0,d.CN)(b)}),createWithSql:a=>e.create([a],[]),createWithChild:a=>e.create(["",""],[a]),createWithChildren:a=>e.create(Array(a.length+1).fill(""),a)})},31700:(a,b,c)=>{c.d(b,{a:()=>e});var d=c(96931);function e(){return new f}class f{#aD;get queryId(){return void 0===this.#aD&&(this.#aD=(0,d.D)(8)),this.#aD}}},33423:(a,b,c)=>{c.d(b,{t:()=>e});var d=c(60353);let e=(0,d.CN)({is:a=>"WhenNode"===a.kind,create:a=>(0,d.CN)({kind:"WhenNode",condition:a}),cloneWithResult:(a,b)=>(0,d.CN)({...a,result:b})})},33679:(a,b,c)=>{c.d(b,{a:()=>e});let d=new Map,e={decode:(a,b="utf-8")=>(d.has(b)||d.set(b,new TextDecoder(b)),d.get(b).decode(a)),encode:new TextEncoder().encode}},34220:(a,b,c)=>{c.d(b,{l:()=>r});var d=c(81266),e=c(39450),f=c(31575),g=c(90350),h=c(2952),i=c(19795),j=c(82324),k=c(31700),l=c(44625),m=c(60353),n=c(22795);class o{#G;constructor(a){this.#G=(0,m.CN)(a)}get expressionType(){}get isRawBuilder(){return!0}as(a){return new q(this,a)}$castTo(){return new o({...this.#G})}$notNull(){return new o(this.#G)}withPlugin(a){return new o({...this.#G,plugins:void 0!==this.#G.plugins?(0,m.CN)([...this.#G.plugins,a]):(0,m.CN)([a])})}toOperationNode(){return this.#aE(this.#aF())}compile(a){return this.#aG(this.#aF(a))}async execute(a){let b=this.#aF(a);return b.executeQuery(this.#aG(b))}#aF(a){let b=void 0!==a?a.getExecutor():n.W;return void 0!==this.#G.plugins?b.withPlugins(this.#G.plugins):b}#aE(a){return a.transformQuery(this.#G.rawNode,this.#G.queryId)}#aG(a){return a.compileQuery(this.#aE(a),this.#G.queryId)}}function p(a){return new o(a)}class q{#aH;#aA;constructor(a,b){this.#aH=a,this.#aA=b}get expression(){return this.#aH}get alias(){return this.#aA}get rawBuilder(){return this.#aH}toOperationNode(){return l.N.create(this.#aH.toOperationNode(),(0,e.N)(this.#aA)?this.#aA.toOperationNode():d.O.create(this.#aA))}}let r=Object.assign((a,...b)=>p({queryId:(0,k.a)(),rawNode:f.z.create(a,b?.map(s)??[])}),{ref:a=>p({queryId:(0,k.a)(),rawNode:f.z.createWithChild((0,h.q5)(a))}),val:a=>p({queryId:(0,k.a)(),rawNode:f.z.createWithChild((0,j.$s)(a))}),value(a){return this.val(a)},table:a=>p({queryId:(0,k.a)(),rawNode:f.z.createWithChild((0,i.M$)(a))}),id(...a){let b=Array(a.length+1).fill(".");return b[0]="",b[b.length-1]="",p({queryId:(0,k.a)(),rawNode:f.z.create(b,a.map(d.O.create))})},lit:a=>p({queryId:(0,k.a)(),rawNode:f.z.createWithChild(g.q.createImmediate(a))}),literal(a){return this.lit(a)},raw:a=>p({queryId:(0,k.a)(),rawNode:f.z.createWithSql(a)}),join(a,b=r`, `){let c=Array(Math.max(2*a.length-1,0)),d=b.toOperationNode();for(let b=0;b<a.length;++b)c[2*b]=s(a[b]),b!==a.length-1&&(c[2*b+1]=d);return p({queryId:(0,k.a)(),rawNode:f.z.createWithChildren(c)})}});function s(a){return(0,e.N)(a)?a.toOperationNode():(0,j.$s)(a)}},36903:(a,b,c)=>{c.d(b,{f:()=>f});var d=c(60353);let e=(0,d.CN)({is:a=>"TopNode"===a.kind,create:(a,b)=>(0,d.CN)({kind:"TopNode",expression:a,modifiers:b})});function f(a,b){var c;if(!(0,d.Et)(a)&&!(0,d.sI)(a))throw Error(`Invalid top expression: ${a}`);if(!(0,d.b0)(b)&&"percent"!==(c=b)&&"with ties"!==c&&"percent with ties"!==c)throw Error(`Invalid top modifiers: ${b}`);return e.create(a,b)}},36923:(a,b,c)=>{c.d(b,{y:()=>f});var d=c(60353),e=c(81266);let f=(0,d.CN)({is:a=>"SchemableIdentifierNode"===a.kind,create:a=>(0,d.CN)({kind:"SchemableIdentifierNode",identifier:e.O.create(a)}),createWithSchema:(a,b)=>(0,d.CN)({kind:"SchemableIdentifierNode",schema:e.O.create(a),identifier:e.O.create(b)})})},37305:(a,b,c)=>{c.d(b,{s:()=>g});var d=c(62767),e=c(5109),f=c(40016);let g=(a="SHA-256",b="none")=>{let c={importKey:async(b,c)=>(0,f.N)().importKey("raw","string"==typeof b?new TextEncoder().encode(b):b,{name:"HMAC",hash:{name:a}},!1,[c]),sign:async(a,g)=>{"string"==typeof a&&(a=await c.importKey(a,"sign"));let h=await (0,f.N)().sign("HMAC",a,"string"==typeof g?new TextEncoder().encode(g):g);return"hex"===b?d.u.encode(h):"base64"===b||"base64url"===b||"base64urlnopad"===b?e.z.encode(h,{padding:"base64urlnopad"!==b}):h},verify:async(a,g,h)=>("string"==typeof a&&(a=await c.importKey(a,"verify")),"hex"===b&&(h=d.u.decode(h)),("base64"===b||"base64url"===b||"base64urlnopad"===b)&&(h=await e.K.decode(h)),(0,f.N)().verify("HMAC",a,"string"==typeof h?new TextEncoder().encode(h):h,"string"==typeof g?new TextEncoder().encode(g):g))};return c}},37381:(a,b,c)=>{c.d(b,{c:()=>d});class d{#e;#f;#aI;constructor(){this.#e=new Promise((a,b)=>{this.#aI=b,this.#f=a})}get promise(){return this.#e}resolve=a=>{this.#f&&this.#f(a)};reject=a=>{this.#aI&&this.#aI(a)}}},38729:(a,b,c)=>{c.d(b,{Q:()=>e});var d=c(60353);let e=(0,d.CN)({is:a=>"JSONReferenceNode"===a.kind,create:(a,b)=>(0,d.CN)({kind:"JSONReferenceNode",reference:a,traversal:b}),cloneWithTraversal:(a,b)=>(0,d.CN)({...a,traversal:b})})},39281:(a,b,c)=>{c.d(b,{O:()=>K,A:()=>L});var d=c(90423),e=c(18804),f=c(19795),g=c(19151),h=c(31700),i=c(71644),j=c(2952),k=c(53284),l=c(94296),m=c(77688),n=c(40659),o=c(60353);let p=(0,o.CN)({is:a=>"UnaryOperationNode"===a.kind,create:(a,b)=>(0,o.CN)({kind:"UnaryOperationNode",operator:a,operand:b})});var q=c(82324),r=c(22795),s=c(61238),t=c(69079),u=c(44625),v=c(81266),w=c(80906);let x=(0,o.CN)({is:a=>"JSONPathLegNode"===a.kind,create:(a,b)=>(0,o.CN)({kind:"JSONPathLegNode",type:a,value:b})});var y=c(67183),z=c(38729),A=c(39450),B=c(90350);class C{#D;constructor(a){this.#D=a}at(a){return this.#aJ("ArrayLocation",a)}key(a){return this.#aJ("Member",a)}#aJ(a,b){return new D(z.Q.is(this.#D)?z.Q.cloneWithTraversal(this.#D,y.c.is(this.#D.traversal)?y.c.cloneWithLeg(this.#D.traversal,x.create(a,b)):w.k.cloneWithValue(this.#D.traversal,B.q.createImmediate(b))):y.c.cloneWithLeg(this.#D,x.create(a,b)))}}class D extends C{#D;constructor(a){super(a),this.#D=a}get expressionType(){}as(a){return new E(this,a)}$castTo(){return new D(this.#D)}$notNull(){return new D(this.#D)}toOperationNode(){return this.#D}}class E{#aK;#aA;constructor(a,b){this.#aK=a,this.#aA=b}get expression(){return this.#aK}get alias(){return this.#aA}toOperationNode(){return u.N.create(this.#aK.toOperationNode(),(0,A.N)(this.#aA)?this.#aA.toOperationNode():v.O.create(this.#aA))}}var F=c(56112),G=c(55914);let H=(0,o.CN)({is:a=>"TupleNode"===a.kind,create:a=>(0,o.CN)({kind:"TupleNode",values:(0,o.CN)(a)})});var I=c(43926);let J=(0,o.CN)({is:a=>"CastNode"===a.kind,create:(a,b)=>(0,o.CN)({kind:"CastNode",expression:a,dataType:b})});function K(a=r.W){function b(a,b){return new m.Is(p.create(n.zX.create(a),(0,j.$O)(b)))}let c=Object.assign(function(a,b,c){return new m.Is((0,k.ds)(a,b,c))},{fn:void 0,eb:void 0,selectFrom:b=>(0,d.c)({queryId:(0,h.a)(),executor:a,queryNode:e.L.createFrom((0,f.JB)(b))}),case:a=>new s.OU({node:t.P.create((0,o.b0)(a)?void 0:(0,j.$O)(a))}),ref:(a,b)=>(0,o.b0)(b)?new m.Is((0,j.q5)(a)):new C((0,j.NF)(a,b)),jsonPath:()=>new C(y.c.create()),table:a=>new m.Is((0,f.M$)(a)),val:a=>new m.Is((0,q.$s)(a)),refTuple:(...a)=>new m.Is(H.create(a.map(j.$O))),tuple:(...a)=>new m.Is(H.create(a.map(q.$s))),lit:a=>new m.Is((0,q.dJ)(a)),unary:b,not:a=>b("not",a),exists:a=>b("exists",a),neg:a=>b("-",a),between:(a,b,c)=>new m.Is(F.l.create((0,j.$O)(a),n.zX.create("between"),G.s.create((0,q.$s)(b),(0,q.$s)(c)))),betweenSymmetric:(a,b,c)=>new m.Is(F.l.create((0,j.$O)(a),n.zX.create("between symmetric"),G.s.create((0,q.$s)(b),(0,q.$s)(c)))),and:a=>new m.Is((0,o.MH)(a)?(0,k.KN)(a,"and"):(0,k.Ve)(a,"and")),or:a=>new m.Is((0,o.MH)(a)?(0,k.KN)(a,"or"):(0,k.Ve)(a,"or")),parens(...a){let b=(0,k.GB)(a);return new m.Is(l.k.is(b)?b:l.k.create(b))},cast:(a,b)=>new m.Is(J.create((0,j.$O)(a),(0,I.Q)(b))),withSchema:b=>K(a.withPluginAtFront(new g.B(b)))});return c.fn=(0,i.t)(),c.eb=c,c}function L(a){return K()}},39450:(a,b,c)=>{c.d(b,{N:()=>e});var d=c(60353);function e(a){return(0,d.Gv)(a)&&(0,d.Tn)(a.toOperationNode)}},40016:(a,b,c)=>{c.d(b,{N:()=>d});function d(){let a="undefined"!=typeof globalThis&&globalThis.crypto;if(a&&"object"==typeof a.subtle&&null!=a.subtle)return a.subtle;throw Error("crypto.subtle must be defined")}},40659:(a,b,c)=>{c.d(b,{Xm:()=>h,we:()=>f,zX:()=>g});var d=c(60353);let e=["->","->>"],f=["=","==","!=","<>",">",">=","<","<=","in","not in","is","is not","like","not like","match","ilike","not ilike","@>","<@","^@","&&","?","?&","?|","!<","!>","<=>","!~","~","~*","!~*","@@","@@@","!!","<->","regexp","is distinct from","is not distinct from","+","-","*","/","%","^","&","|","#","<<",">>","&&","||",...e,"not","-","exists","not exists","between","between symmetric"],g=(0,d.CN)({is:a=>"OperatorNode"===a.kind,create:a=>(0,d.CN)({kind:"OperatorNode",operator:a})});function h(a){return(0,d.Kg)(a)&&e.includes(a)}},42437:(a,b,c)=>{c.d(b,{V:()=>e});var d=c(60353);class e{nodeStack=[];#aL=(0,d.CN)({AliasNode:this.transformAlias.bind(this),ColumnNode:this.transformColumn.bind(this),IdentifierNode:this.transformIdentifier.bind(this),SchemableIdentifierNode:this.transformSchemableIdentifier.bind(this),RawNode:this.transformRaw.bind(this),ReferenceNode:this.transformReference.bind(this),SelectQueryNode:this.transformSelectQuery.bind(this),SelectionNode:this.transformSelection.bind(this),TableNode:this.transformTable.bind(this),FromNode:this.transformFrom.bind(this),SelectAllNode:this.transformSelectAll.bind(this),AndNode:this.transformAnd.bind(this),OrNode:this.transformOr.bind(this),ValueNode:this.transformValue.bind(this),ValueListNode:this.transformValueList.bind(this),PrimitiveValueListNode:this.transformPrimitiveValueList.bind(this),ParensNode:this.transformParens.bind(this),JoinNode:this.transformJoin.bind(this),OperatorNode:this.transformOperator.bind(this),WhereNode:this.transformWhere.bind(this),InsertQueryNode:this.transformInsertQuery.bind(this),DeleteQueryNode:this.transformDeleteQuery.bind(this),ReturningNode:this.transformReturning.bind(this),CreateTableNode:this.transformCreateTable.bind(this),AddColumnNode:this.transformAddColumn.bind(this),ColumnDefinitionNode:this.transformColumnDefinition.bind(this),DropTableNode:this.transformDropTable.bind(this),DataTypeNode:this.transformDataType.bind(this),OrderByNode:this.transformOrderBy.bind(this),OrderByItemNode:this.transformOrderByItem.bind(this),GroupByNode:this.transformGroupBy.bind(this),GroupByItemNode:this.transformGroupByItem.bind(this),UpdateQueryNode:this.transformUpdateQuery.bind(this),ColumnUpdateNode:this.transformColumnUpdate.bind(this),LimitNode:this.transformLimit.bind(this),OffsetNode:this.transformOffset.bind(this),OnConflictNode:this.transformOnConflict.bind(this),OnDuplicateKeyNode:this.transformOnDuplicateKey.bind(this),CreateIndexNode:this.transformCreateIndex.bind(this),DropIndexNode:this.transformDropIndex.bind(this),ListNode:this.transformList.bind(this),PrimaryKeyConstraintNode:this.transformPrimaryKeyConstraint.bind(this),UniqueConstraintNode:this.transformUniqueConstraint.bind(this),ReferencesNode:this.transformReferences.bind(this),CheckConstraintNode:this.transformCheckConstraint.bind(this),WithNode:this.transformWith.bind(this),CommonTableExpressionNode:this.transformCommonTableExpression.bind(this),CommonTableExpressionNameNode:this.transformCommonTableExpressionName.bind(this),HavingNode:this.transformHaving.bind(this),CreateSchemaNode:this.transformCreateSchema.bind(this),DropSchemaNode:this.transformDropSchema.bind(this),AlterTableNode:this.transformAlterTable.bind(this),DropColumnNode:this.transformDropColumn.bind(this),RenameColumnNode:this.transformRenameColumn.bind(this),AlterColumnNode:this.transformAlterColumn.bind(this),ModifyColumnNode:this.transformModifyColumn.bind(this),AddConstraintNode:this.transformAddConstraint.bind(this),DropConstraintNode:this.transformDropConstraint.bind(this),RenameConstraintNode:this.transformRenameConstraint.bind(this),ForeignKeyConstraintNode:this.transformForeignKeyConstraint.bind(this),CreateViewNode:this.transformCreateView.bind(this),RefreshMaterializedViewNode:this.transformRefreshMaterializedView.bind(this),DropViewNode:this.transformDropView.bind(this),GeneratedNode:this.transformGenerated.bind(this),DefaultValueNode:this.transformDefaultValue.bind(this),OnNode:this.transformOn.bind(this),ValuesNode:this.transformValues.bind(this),SelectModifierNode:this.transformSelectModifier.bind(this),CreateTypeNode:this.transformCreateType.bind(this),DropTypeNode:this.transformDropType.bind(this),ExplainNode:this.transformExplain.bind(this),DefaultInsertValueNode:this.transformDefaultInsertValue.bind(this),AggregateFunctionNode:this.transformAggregateFunction.bind(this),OverNode:this.transformOver.bind(this),PartitionByNode:this.transformPartitionBy.bind(this),PartitionByItemNode:this.transformPartitionByItem.bind(this),SetOperationNode:this.transformSetOperation.bind(this),BinaryOperationNode:this.transformBinaryOperation.bind(this),UnaryOperationNode:this.transformUnaryOperation.bind(this),UsingNode:this.transformUsing.bind(this),FunctionNode:this.transformFunction.bind(this),CaseNode:this.transformCase.bind(this),WhenNode:this.transformWhen.bind(this),JSONReferenceNode:this.transformJSONReference.bind(this),JSONPathNode:this.transformJSONPath.bind(this),JSONPathLegNode:this.transformJSONPathLeg.bind(this),JSONOperatorChainNode:this.transformJSONOperatorChain.bind(this),TupleNode:this.transformTuple.bind(this),MergeQueryNode:this.transformMergeQuery.bind(this),MatchedNode:this.transformMatched.bind(this),AddIndexNode:this.transformAddIndex.bind(this),CastNode:this.transformCast.bind(this),FetchNode:this.transformFetch.bind(this),TopNode:this.transformTop.bind(this),OutputNode:this.transformOutput.bind(this),OrActionNode:this.transformOrAction.bind(this),CollateNode:this.transformCollate.bind(this)});transformNode(a,b){if(!a)return a;this.nodeStack.push(a);let c=this.transformNodeImpl(a,b);return this.nodeStack.pop(),(0,d.CN)(c)}transformNodeImpl(a,b){return this.#aL[a.kind](a,b)}transformNodeList(a,b){return a?(0,d.CN)(a.map(a=>this.transformNode(a,b))):a}transformSelectQuery(a,b){return{kind:"SelectQueryNode",from:this.transformNode(a.from,b),selections:this.transformNodeList(a.selections,b),distinctOn:this.transformNodeList(a.distinctOn,b),joins:this.transformNodeList(a.joins,b),groupBy:this.transformNode(a.groupBy,b),orderBy:this.transformNode(a.orderBy,b),where:this.transformNode(a.where,b),frontModifiers:this.transformNodeList(a.frontModifiers,b),endModifiers:this.transformNodeList(a.endModifiers,b),limit:this.transformNode(a.limit,b),offset:this.transformNode(a.offset,b),with:this.transformNode(a.with,b),having:this.transformNode(a.having,b),explain:this.transformNode(a.explain,b),setOperations:this.transformNodeList(a.setOperations,b),fetch:this.transformNode(a.fetch,b),top:this.transformNode(a.top,b)}}transformSelection(a,b){return{kind:"SelectionNode",selection:this.transformNode(a.selection,b)}}transformColumn(a,b){return{kind:"ColumnNode",column:this.transformNode(a.column,b)}}transformAlias(a,b){return{kind:"AliasNode",node:this.transformNode(a.node,b),alias:this.transformNode(a.alias,b)}}transformTable(a,b){return{kind:"TableNode",table:this.transformNode(a.table,b)}}transformFrom(a,b){return{kind:"FromNode",froms:this.transformNodeList(a.froms,b)}}transformReference(a,b){return{kind:"ReferenceNode",column:this.transformNode(a.column,b),table:this.transformNode(a.table,b)}}transformAnd(a,b){return{kind:"AndNode",left:this.transformNode(a.left,b),right:this.transformNode(a.right,b)}}transformOr(a,b){return{kind:"OrNode",left:this.transformNode(a.left,b),right:this.transformNode(a.right,b)}}transformValueList(a,b){return{kind:"ValueListNode",values:this.transformNodeList(a.values,b)}}transformParens(a,b){return{kind:"ParensNode",node:this.transformNode(a.node,b)}}transformJoin(a,b){return{kind:"JoinNode",joinType:a.joinType,table:this.transformNode(a.table,b),on:this.transformNode(a.on,b)}}transformRaw(a,b){return{kind:"RawNode",sqlFragments:(0,d.CN)([...a.sqlFragments]),parameters:this.transformNodeList(a.parameters,b)}}transformWhere(a,b){return{kind:"WhereNode",where:this.transformNode(a.where,b)}}transformInsertQuery(a,b){return{kind:"InsertQueryNode",into:this.transformNode(a.into,b),columns:this.transformNodeList(a.columns,b),values:this.transformNode(a.values,b),returning:this.transformNode(a.returning,b),onConflict:this.transformNode(a.onConflict,b),onDuplicateKey:this.transformNode(a.onDuplicateKey,b),endModifiers:this.transformNodeList(a.endModifiers,b),with:this.transformNode(a.with,b),ignore:a.ignore,orAction:this.transformNode(a.orAction,b),replace:a.replace,explain:this.transformNode(a.explain,b),defaultValues:a.defaultValues,top:this.transformNode(a.top,b),output:this.transformNode(a.output,b)}}transformValues(a,b){return{kind:"ValuesNode",values:this.transformNodeList(a.values,b)}}transformDeleteQuery(a,b){return{kind:"DeleteQueryNode",from:this.transformNode(a.from,b),using:this.transformNode(a.using,b),joins:this.transformNodeList(a.joins,b),where:this.transformNode(a.where,b),returning:this.transformNode(a.returning,b),endModifiers:this.transformNodeList(a.endModifiers,b),with:this.transformNode(a.with,b),orderBy:this.transformNode(a.orderBy,b),limit:this.transformNode(a.limit,b),explain:this.transformNode(a.explain,b),top:this.transformNode(a.top,b),output:this.transformNode(a.output,b)}}transformReturning(a,b){return{kind:"ReturningNode",selections:this.transformNodeList(a.selections,b)}}transformCreateTable(a,b){return{kind:"CreateTableNode",table:this.transformNode(a.table,b),columns:this.transformNodeList(a.columns,b),constraints:this.transformNodeList(a.constraints,b),temporary:a.temporary,ifNotExists:a.ifNotExists,onCommit:a.onCommit,frontModifiers:this.transformNodeList(a.frontModifiers,b),endModifiers:this.transformNodeList(a.endModifiers,b),selectQuery:this.transformNode(a.selectQuery,b)}}transformColumnDefinition(a,b){return{kind:"ColumnDefinitionNode",column:this.transformNode(a.column,b),dataType:this.transformNode(a.dataType,b),references:this.transformNode(a.references,b),primaryKey:a.primaryKey,autoIncrement:a.autoIncrement,unique:a.unique,notNull:a.notNull,unsigned:a.unsigned,defaultTo:this.transformNode(a.defaultTo,b),check:this.transformNode(a.check,b),generated:this.transformNode(a.generated,b),frontModifiers:this.transformNodeList(a.frontModifiers,b),endModifiers:this.transformNodeList(a.endModifiers,b),nullsNotDistinct:a.nullsNotDistinct,identity:a.identity,ifNotExists:a.ifNotExists}}transformAddColumn(a,b){return{kind:"AddColumnNode",column:this.transformNode(a.column,b)}}transformDropTable(a,b){return{kind:"DropTableNode",table:this.transformNode(a.table,b),ifExists:a.ifExists,cascade:a.cascade}}transformOrderBy(a,b){return{kind:"OrderByNode",items:this.transformNodeList(a.items,b)}}transformOrderByItem(a,b){return{kind:"OrderByItemNode",orderBy:this.transformNode(a.orderBy,b),direction:this.transformNode(a.direction,b),collation:this.transformNode(a.collation,b),nulls:a.nulls}}transformGroupBy(a,b){return{kind:"GroupByNode",items:this.transformNodeList(a.items,b)}}transformGroupByItem(a,b){return{kind:"GroupByItemNode",groupBy:this.transformNode(a.groupBy,b)}}transformUpdateQuery(a,b){return{kind:"UpdateQueryNode",table:this.transformNode(a.table,b),from:this.transformNode(a.from,b),joins:this.transformNodeList(a.joins,b),where:this.transformNode(a.where,b),updates:this.transformNodeList(a.updates,b),returning:this.transformNode(a.returning,b),endModifiers:this.transformNodeList(a.endModifiers,b),with:this.transformNode(a.with,b),explain:this.transformNode(a.explain,b),limit:this.transformNode(a.limit,b),top:this.transformNode(a.top,b),output:this.transformNode(a.output,b),orderBy:this.transformNode(a.orderBy,b)}}transformColumnUpdate(a,b){return{kind:"ColumnUpdateNode",column:this.transformNode(a.column,b),value:this.transformNode(a.value,b)}}transformLimit(a,b){return{kind:"LimitNode",limit:this.transformNode(a.limit,b)}}transformOffset(a,b){return{kind:"OffsetNode",offset:this.transformNode(a.offset,b)}}transformOnConflict(a,b){return{kind:"OnConflictNode",columns:this.transformNodeList(a.columns,b),constraint:this.transformNode(a.constraint,b),indexExpression:this.transformNode(a.indexExpression,b),indexWhere:this.transformNode(a.indexWhere,b),updates:this.transformNodeList(a.updates,b),updateWhere:this.transformNode(a.updateWhere,b),doNothing:a.doNothing}}transformOnDuplicateKey(a,b){return{kind:"OnDuplicateKeyNode",updates:this.transformNodeList(a.updates,b)}}transformCreateIndex(a,b){return{kind:"CreateIndexNode",name:this.transformNode(a.name,b),table:this.transformNode(a.table,b),columns:this.transformNodeList(a.columns,b),unique:a.unique,using:this.transformNode(a.using,b),ifNotExists:a.ifNotExists,where:this.transformNode(a.where,b),nullsNotDistinct:a.nullsNotDistinct}}transformList(a,b){return{kind:"ListNode",items:this.transformNodeList(a.items,b)}}transformDropIndex(a,b){return{kind:"DropIndexNode",name:this.transformNode(a.name,b),table:this.transformNode(a.table,b),ifExists:a.ifExists,cascade:a.cascade}}transformPrimaryKeyConstraint(a,b){return{kind:"PrimaryKeyConstraintNode",columns:this.transformNodeList(a.columns,b),name:this.transformNode(a.name,b),deferrable:a.deferrable,initiallyDeferred:a.initiallyDeferred}}transformUniqueConstraint(a,b){return{kind:"UniqueConstraintNode",columns:this.transformNodeList(a.columns,b),name:this.transformNode(a.name,b),nullsNotDistinct:a.nullsNotDistinct,deferrable:a.deferrable,initiallyDeferred:a.initiallyDeferred}}transformForeignKeyConstraint(a,b){return{kind:"ForeignKeyConstraintNode",columns:this.transformNodeList(a.columns,b),references:this.transformNode(a.references,b),name:this.transformNode(a.name,b),onDelete:a.onDelete,onUpdate:a.onUpdate,deferrable:a.deferrable,initiallyDeferred:a.initiallyDeferred}}transformSetOperation(a,b){return{kind:"SetOperationNode",operator:a.operator,expression:this.transformNode(a.expression,b),all:a.all}}transformReferences(a,b){return{kind:"ReferencesNode",table:this.transformNode(a.table,b),columns:this.transformNodeList(a.columns,b),onDelete:a.onDelete,onUpdate:a.onUpdate}}transformCheckConstraint(a,b){return{kind:"CheckConstraintNode",expression:this.transformNode(a.expression,b),name:this.transformNode(a.name,b)}}transformWith(a,b){return{kind:"WithNode",expressions:this.transformNodeList(a.expressions,b),recursive:a.recursive}}transformCommonTableExpression(a,b){return{kind:"CommonTableExpressionNode",name:this.transformNode(a.name,b),materialized:a.materialized,expression:this.transformNode(a.expression,b)}}transformCommonTableExpressionName(a,b){return{kind:"CommonTableExpressionNameNode",table:this.transformNode(a.table,b),columns:this.transformNodeList(a.columns,b)}}transformHaving(a,b){return{kind:"HavingNode",having:this.transformNode(a.having,b)}}transformCreateSchema(a,b){return{kind:"CreateSchemaNode",schema:this.transformNode(a.schema,b),ifNotExists:a.ifNotExists}}transformDropSchema(a,b){return{kind:"DropSchemaNode",schema:this.transformNode(a.schema,b),ifExists:a.ifExists,cascade:a.cascade}}transformAlterTable(a,b){return{kind:"AlterTableNode",table:this.transformNode(a.table,b),renameTo:this.transformNode(a.renameTo,b),setSchema:this.transformNode(a.setSchema,b),columnAlterations:this.transformNodeList(a.columnAlterations,b),addConstraint:this.transformNode(a.addConstraint,b),dropConstraint:this.transformNode(a.dropConstraint,b),renameConstraint:this.transformNode(a.renameConstraint,b),addIndex:this.transformNode(a.addIndex,b),dropIndex:this.transformNode(a.dropIndex,b)}}transformDropColumn(a,b){return{kind:"DropColumnNode",column:this.transformNode(a.column,b)}}transformRenameColumn(a,b){return{kind:"RenameColumnNode",column:this.transformNode(a.column,b),renameTo:this.transformNode(a.renameTo,b)}}transformAlterColumn(a,b){return{kind:"AlterColumnNode",column:this.transformNode(a.column,b),dataType:this.transformNode(a.dataType,b),dataTypeExpression:this.transformNode(a.dataTypeExpression,b),setDefault:this.transformNode(a.setDefault,b),dropDefault:a.dropDefault,setNotNull:a.setNotNull,dropNotNull:a.dropNotNull}}transformModifyColumn(a,b){return{kind:"ModifyColumnNode",column:this.transformNode(a.column,b)}}transformAddConstraint(a,b){return{kind:"AddConstraintNode",constraint:this.transformNode(a.constraint,b)}}transformDropConstraint(a,b){return{kind:"DropConstraintNode",constraintName:this.transformNode(a.constraintName,b),ifExists:a.ifExists,modifier:a.modifier}}transformRenameConstraint(a,b){return{kind:"RenameConstraintNode",oldName:this.transformNode(a.oldName,b),newName:this.transformNode(a.newName,b)}}transformCreateView(a,b){return{kind:"CreateViewNode",name:this.transformNode(a.name,b),temporary:a.temporary,orReplace:a.orReplace,ifNotExists:a.ifNotExists,materialized:a.materialized,columns:this.transformNodeList(a.columns,b),as:this.transformNode(a.as,b)}}transformRefreshMaterializedView(a,b){return{kind:"RefreshMaterializedViewNode",name:this.transformNode(a.name,b),concurrently:a.concurrently,withNoData:a.withNoData}}transformDropView(a,b){return{kind:"DropViewNode",name:this.transformNode(a.name,b),ifExists:a.ifExists,materialized:a.materialized,cascade:a.cascade}}transformGenerated(a,b){return{kind:"GeneratedNode",byDefault:a.byDefault,always:a.always,identity:a.identity,stored:a.stored,expression:this.transformNode(a.expression,b)}}transformDefaultValue(a,b){return{kind:"DefaultValueNode",defaultValue:this.transformNode(a.defaultValue,b)}}transformOn(a,b){return{kind:"OnNode",on:this.transformNode(a.on,b)}}transformSelectModifier(a,b){return{kind:"SelectModifierNode",modifier:a.modifier,rawModifier:this.transformNode(a.rawModifier,b),of:this.transformNodeList(a.of,b)}}transformCreateType(a,b){return{kind:"CreateTypeNode",name:this.transformNode(a.name,b),enum:this.transformNode(a.enum,b)}}transformDropType(a,b){return{kind:"DropTypeNode",name:this.transformNode(a.name,b),ifExists:a.ifExists}}transformExplain(a,b){return{kind:"ExplainNode",format:a.format,options:this.transformNode(a.options,b)}}transformSchemableIdentifier(a,b){return{kind:"SchemableIdentifierNode",schema:this.transformNode(a.schema,b),identifier:this.transformNode(a.identifier,b)}}transformAggregateFunction(a,b){return{kind:"AggregateFunctionNode",func:a.func,aggregated:this.transformNodeList(a.aggregated,b),distinct:a.distinct,orderBy:this.transformNode(a.orderBy,b),withinGroup:this.transformNode(a.withinGroup,b),filter:this.transformNode(a.filter,b),over:this.transformNode(a.over,b)}}transformOver(a,b){return{kind:"OverNode",orderBy:this.transformNode(a.orderBy,b),partitionBy:this.transformNode(a.partitionBy,b)}}transformPartitionBy(a,b){return{kind:"PartitionByNode",items:this.transformNodeList(a.items,b)}}transformPartitionByItem(a,b){return{kind:"PartitionByItemNode",partitionBy:this.transformNode(a.partitionBy,b)}}transformBinaryOperation(a,b){return{kind:"BinaryOperationNode",leftOperand:this.transformNode(a.leftOperand,b),operator:this.transformNode(a.operator,b),rightOperand:this.transformNode(a.rightOperand,b)}}transformUnaryOperation(a,b){return{kind:"UnaryOperationNode",operator:this.transformNode(a.operator,b),operand:this.transformNode(a.operand,b)}}transformUsing(a,b){return{kind:"UsingNode",tables:this.transformNodeList(a.tables,b)}}transformFunction(a,b){return{kind:"FunctionNode",func:a.func,arguments:this.transformNodeList(a.arguments,b)}}transformCase(a,b){return{kind:"CaseNode",value:this.transformNode(a.value,b),when:this.transformNodeList(a.when,b),else:this.transformNode(a.else,b),isStatement:a.isStatement}}transformWhen(a,b){return{kind:"WhenNode",condition:this.transformNode(a.condition,b),result:this.transformNode(a.result,b)}}transformJSONReference(a,b){return{kind:"JSONReferenceNode",reference:this.transformNode(a.reference,b),traversal:this.transformNode(a.traversal,b)}}transformJSONPath(a,b){return{kind:"JSONPathNode",inOperator:this.transformNode(a.inOperator,b),pathLegs:this.transformNodeList(a.pathLegs,b)}}transformJSONPathLeg(a,b){return{kind:"JSONPathLegNode",type:a.type,value:a.value}}transformJSONOperatorChain(a,b){return{kind:"JSONOperatorChainNode",operator:this.transformNode(a.operator,b),values:this.transformNodeList(a.values,b)}}transformTuple(a,b){return{kind:"TupleNode",values:this.transformNodeList(a.values,b)}}transformMergeQuery(a,b){return{kind:"MergeQueryNode",into:this.transformNode(a.into,b),using:this.transformNode(a.using,b),whens:this.transformNodeList(a.whens,b),with:this.transformNode(a.with,b),top:this.transformNode(a.top,b),endModifiers:this.transformNodeList(a.endModifiers,b),output:this.transformNode(a.output,b),returning:this.transformNode(a.returning,b)}}transformMatched(a,b){return{kind:"MatchedNode",not:a.not,bySource:a.bySource}}transformAddIndex(a,b){return{kind:"AddIndexNode",name:this.transformNode(a.name,b),columns:this.transformNodeList(a.columns,b),unique:a.unique,using:this.transformNode(a.using,b),ifNotExists:a.ifNotExists}}transformCast(a,b){return{kind:"CastNode",expression:this.transformNode(a.expression,b),dataType:this.transformNode(a.dataType,b)}}transformFetch(a,b){return{kind:"FetchNode",rowCount:this.transformNode(a.rowCount,b),modifier:a.modifier}}transformTop(a,b){return{kind:"TopNode",expression:a.expression,modifiers:a.modifiers}}transformOutput(a,b){return{kind:"OutputNode",selections:this.transformNodeList(a.selections,b)}}transformDataType(a,b){return a}transformSelectAll(a,b){return a}transformIdentifier(a,b){return a}transformValue(a,b){return a}transformPrimitiveValueList(a,b){return a}transformOperator(a,b){return a}transformDefaultInsertValue(a,b){return a}transformOrAction(a,b){return a}transformCollate(a,b){return a}}},43926:(a,b,c)=>{c.d(b,{Q:()=>i});var d=c(60353);let e=["varchar","char","text","integer","int2","int4","int8","smallint","bigint","boolean","real","double precision","float4","float8","decimal","numeric","binary","bytea","date","datetime","time","timetz","timestamp","timestamptz","serial","bigserial","uuid","json","jsonb","blob","varbinary","int4range","int4multirange","int8range","int8multirange","numrange","nummultirange","tsrange","tsmultirange","tstzrange","tstzmultirange","daterange","datemultirange"],f=[/^varchar\(\d+\)$/,/^char\(\d+\)$/,/^decimal\(\d+, \d+\)$/,/^numeric\(\d+, \d+\)$/,/^binary\(\d+\)$/,/^datetime\(\d+\)$/,/^time\(\d+\)$/,/^timetz\(\d+\)$/,/^timestamp\(\d+\)$/,/^timestamptz\(\d+\)$/,/^varbinary\(\d+\)$/],g=(0,d.CN)({is:a=>"DataTypeNode"===a.kind,create:a=>(0,d.CN)({kind:"DataTypeNode",dataType:a})});var h=c(39450);function i(a){if((0,h.N)(a))return a.toOperationNode();if(e.includes(a)||f.some(b=>b.test(a)))return g.create(a);throw Error(`invalid column data type ${JSON.stringify(a)}`)}},44625:(a,b,c)=>{c.d(b,{N:()=>e});var d=c(60353);let e=(0,d.CN)({is:a=>"AliasNode"===a.kind,create:(a,b)=>(0,d.CN)({kind:"AliasNode",node:a,alias:b})})},46377:(a,b,c)=>{function d(a){return a?.[Symbol.toStringTag]==="CryptoKey"}function e(a){return a?.[Symbol.toStringTag]==="KeyObject"}c.d(b,{Ay:()=>f,D2:()=>e,R7:()=>d});let f=a=>d(a)||e(a)},46639:(a,b,c)=>{function d(a,b,...c){if((c=c.filter(Boolean)).length>2){let b=c.pop();a+=`one of type ${c.join(", ")}, or ${b}.`}else 2===c.length?a+=`one of type ${c[0]} or ${c[1]}.`:a+=`of type ${c[0]}.`;return null==b?a+=` Received ${b}`:"function"==typeof b&&b.name?a+=` Received function ${b.name}`:"object"==typeof b&&null!=b&&b.constructor?.name&&(a+=` Received an instance of ${b.constructor.name}`),a}c.d(b,{A:()=>e,t:()=>f});let e=(a,...b)=>d("Key must be ",a,...b);function f(a,b,...c){return d(`Key for the ${a} algorithm must be `,b,...c)}},46762:(a,b,c)=>{c.d(b,{bzn:()=>cP,YOg:()=>cW,zMY:()=>cM,auy:()=>e,IeY:()=>dh,p6U:()=>cU,Rpp:()=>cm,k5n:()=>c3,uXy:()=>cy,ugL:()=>cA,aig:()=>cI,Ikc:()=>cY,lqM:()=>c6,g1P:()=>c1,YjP:()=>cj,KCZ:()=>c$,L5J:()=>cR});var d,e={};function f(a,b,c){function d(c,d){var e;for(let f in Object.defineProperty(c,"_zod",{value:c._zod??{},enumerable:!1}),(e=c._zod).traits??(e.traits=new Set),c._zod.traits.add(a),b(c,d),g.prototype)f in c||Object.defineProperty(c,f,{value:g.prototype[f].bind(c)});c._zod.constr=g,c._zod.def=d}let e=c?.Parent??Object;class f extends e{}function g(a){var b;let e=c?.Parent?new f:this;for(let c of(d(e,a),(b=e._zod).deferred??(b.deferred=[]),e._zod.deferred))c();return e}return Object.defineProperty(f,"name",{value:a}),Object.defineProperty(g,"init",{value:d}),Object.defineProperty(g,Symbol.hasInstance,{value:b=>!!c?.Parent&&b instanceof c.Parent||b?._zod?.traits?.has(a)}),Object.defineProperty(g,"name",{value:a}),g}c.r(e),c.d(e,{bigint:()=>dl,boolean:()=>dk,date:()=>dm,number:()=>dj,string:()=>di}),Object.freeze({status:"aborted"}),Symbol("zod_brand");class g extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}class h extends Error{constructor(a){super(`Encountered unidirectional transform during encode: ${a}`),this.name="ZodEncodeError"}}let i={};function j(a){return a&&Object.assign(i,a),i}function k(a,b="|"){return a.map(a=>C(a)).join(b)}function l(a,b){return"bigint"==typeof b?b.toString():b}function m(a){return{get value(){{let b=a();return Object.defineProperty(this,"value",{value:b}),b}}}}function n(a){let b=+!!a.startsWith("^"),c=a.endsWith("$")?a.length-1:a.length;return a.slice(b,c)}let o=Symbol("evaluating");function p(a,b,c){let d;Object.defineProperty(a,b,{get(){if(d!==o)return void 0===d&&(d=o,d=c()),d},set(c){Object.defineProperty(a,b,{value:c})},configurable:!0})}function q(a,b,c){Object.defineProperty(a,b,{value:c,writable:!0,enumerable:!0,configurable:!0})}function r(...a){let b={};for(let c of a)Object.assign(b,Object.getOwnPropertyDescriptors(c));return Object.defineProperties({},b)}function s(a){return JSON.stringify(a)}let t="captureStackTrace"in Error?Error.captureStackTrace:(...a)=>{};function u(a){return"object"==typeof a&&null!==a&&!Array.isArray(a)}let v=m(()=>{if("undefined"!=typeof navigator&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{return Function(""),!0}catch(a){return!1}});function w(a){if(!1===u(a))return!1;let b=a.constructor;if(void 0===b)return!0;let c=b.prototype;return!1!==u(c)&&!1!==Object.prototype.hasOwnProperty.call(c,"isPrototypeOf")}function x(a){return w(a)?{...a}:Array.isArray(a)?[...a]:a}let y=new Set(["string","number","symbol"]);function z(a){return a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function A(a,b,c){let d=new a._zod.constr(b??a._zod.def);return(!b||c?.parent)&&(d._zod.parent=a),d}function B(a){if(!a)return{};if("string"==typeof a)return{error:()=>a};if(a?.message!==void 0){if(a?.error!==void 0)throw Error("Cannot specify both `message` and `error` params");a.error=a.message}return(delete a.message,"string"==typeof a.error)?{...a,error:()=>a.error}:a}function C(a){return"bigint"==typeof a?a.toString()+"n":"string"==typeof a?`"${a}"`:`${a}`}let D={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-0x80000000,0x7fffffff],uint32:[0,0xffffffff],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]};function E(a,b=0){if(!0===a.aborted)return!0;for(let c=b;c<a.issues.length;c++)if(a.issues[c]?.continue!==!0)return!0;return!1}function F(a,b){return b.map(b=>(b.path??(b.path=[]),b.path.unshift(a),b))}function G(a){return"string"==typeof a?a:a?.message}function H(a,b,c){let d={...a,path:a.path??[]};return a.message||(d.message=G(a.inst?._zod.def?.error?.(a))??G(b?.error?.(a))??G(c.customError?.(a))??G(c.localeError?.(a))??"Invalid input"),delete d.inst,delete d.continue,b?.reportInput||delete d.input,d}function I(a){return Array.isArray(a)?"array":"string"==typeof a?"string":"unknown"}function J(...a){let[b,c,d]=a;return"string"==typeof b?{message:b,code:"custom",input:c,inst:d}:{...b}}let K=(a,b)=>{a.name="$ZodError",Object.defineProperty(a,"_zod",{value:a._zod,enumerable:!1}),Object.defineProperty(a,"issues",{value:b,enumerable:!1}),a.message=JSON.stringify(b,l,2),Object.defineProperty(a,"toString",{value:()=>a.message,enumerable:!1})},L=f("$ZodError",K),M=f("$ZodError",K,{Parent:Error}),N=a=>(b,c,d,e)=>{let f=d?Object.assign(d,{async:!1}):{async:!1},h=b._zod.run({value:c,issues:[]},f);if(h instanceof Promise)throw new g;if(h.issues.length){let b=new(e?.Err??a)(h.issues.map(a=>H(a,f,j())));throw t(b,e?.callee),b}return h.value},O=a=>async(b,c,d,e)=>{let f=d?Object.assign(d,{async:!0}):{async:!0},g=b._zod.run({value:c,issues:[]},f);if(g instanceof Promise&&(g=await g),g.issues.length){let b=new(e?.Err??a)(g.issues.map(a=>H(a,f,j())));throw t(b,e?.callee),b}return g.value},P=a=>(b,c,d)=>{let e=d?{...d,async:!1}:{async:!1},f=b._zod.run({value:c,issues:[]},e);if(f instanceof Promise)throw new g;return f.issues.length?{success:!1,error:new(a??L)(f.issues.map(a=>H(a,e,j())))}:{success:!0,data:f.value}},Q=P(M),R=a=>async(b,c,d)=>{let e=d?Object.assign(d,{async:!0}):{async:!0},f=b._zod.run({value:c,issues:[]},e);return f instanceof Promise&&(f=await f),f.issues.length?{success:!1,error:new a(f.issues.map(a=>H(a,e,j())))}:{success:!0,data:f.value}},S=R(M),T=/^[cC][^\s-]{8,}$/,U=/^[0-9a-z]+$/,V=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,W=/^[0-9a-vA-V]{20}$/,X=/^[A-Za-z0-9]{27}$/,Y=/^[a-zA-Z0-9_-]{21}$/,Z=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,$=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,_=a=>a?RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${a}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/,aa=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,ab=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ac=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:))$/,ad=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,ae=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,af=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,ag=/^[A-Za-z0-9_-]*$/,ah=/^(?=.{1,253}\.?$)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[-0-9a-zA-Z]{0,61}[0-9a-zA-Z])?)*\.?$/,ai=/^\+(?:[0-9]){6,14}[0-9]$/,aj="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",ak=RegExp(`^${aj}$`);function al(a){let b="(?:[01]\\d|2[0-3]):[0-5]\\d";return"number"==typeof a.precision?-1===a.precision?`${b}`:0===a.precision?`${b}:[0-5]\\d`:`${b}:[0-5]\\d\\.\\d{${a.precision}}`:`${b}(?::[0-5]\\d(?:\\.\\d+)?)?`}let am=/^-?\d+n?$/,an=/^-?\d+$/,ao=/^-?\d+(?:\.\d+)?/,ap=/^(?:true|false)$/i,aq=/^[^A-Z]*$/,ar=/^[^a-z]*$/,as=f("$ZodCheck",(a,b)=>{var c;a._zod??(a._zod={}),a._zod.def=b,(c=a._zod).onattach??(c.onattach=[])}),at={number:"number",bigint:"bigint",object:"date"},au=f("$ZodCheckLessThan",(a,b)=>{as.init(a,b);let c=at[typeof b.value];a._zod.onattach.push(a=>{let c=a._zod.bag,d=(b.inclusive?c.maximum:c.exclusiveMaximum)??1/0;b.value<d&&(b.inclusive?c.maximum=b.value:c.exclusiveMaximum=b.value)}),a._zod.check=d=>{(b.inclusive?d.value<=b.value:d.value<b.value)||d.issues.push({origin:c,code:"too_big",maximum:b.value,input:d.value,inclusive:b.inclusive,inst:a,continue:!b.abort})}}),av=f("$ZodCheckGreaterThan",(a,b)=>{as.init(a,b);let c=at[typeof b.value];a._zod.onattach.push(a=>{let c=a._zod.bag,d=(b.inclusive?c.minimum:c.exclusiveMinimum)??-1/0;b.value>d&&(b.inclusive?c.minimum=b.value:c.exclusiveMinimum=b.value)}),a._zod.check=d=>{(b.inclusive?d.value>=b.value:d.value>b.value)||d.issues.push({origin:c,code:"too_small",minimum:b.value,input:d.value,inclusive:b.inclusive,inst:a,continue:!b.abort})}}),aw=f("$ZodCheckMultipleOf",(a,b)=>{as.init(a,b),a._zod.onattach.push(a=>{var c;(c=a._zod.bag).multipleOf??(c.multipleOf=b.value)}),a._zod.check=c=>{if(typeof c.value!=typeof b.value)throw Error("Cannot mix number and bigint in multiple_of check.");("bigint"==typeof c.value?c.value%b.value===BigInt(0):0===function(a,b){let c=(a.toString().split(".")[1]||"").length,d=b.toString(),e=(d.split(".")[1]||"").length;if(0===e&&/\d?e-\d?/.test(d)){let a=d.match(/\d?e-(\d?)/);a?.[1]&&(e=Number.parseInt(a[1]))}let f=c>e?c:e;return Number.parseInt(a.toFixed(f).replace(".",""))%Number.parseInt(b.toFixed(f).replace(".",""))/10**f}(c.value,b.value))||c.issues.push({origin:typeof c.value,code:"not_multiple_of",divisor:b.value,input:c.value,inst:a,continue:!b.abort})}}),ax=f("$ZodCheckNumberFormat",(a,b)=>{as.init(a,b),b.format=b.format||"float64";let c=b.format?.includes("int"),d=c?"int":"number",[e,f]=D[b.format];a._zod.onattach.push(a=>{let d=a._zod.bag;d.format=b.format,d.minimum=e,d.maximum=f,c&&(d.pattern=an)}),a._zod.check=g=>{let h=g.value;if(c){if(!Number.isInteger(h))return void g.issues.push({expected:d,format:b.format,code:"invalid_type",continue:!1,input:h,inst:a});if(!Number.isSafeInteger(h))return void(h>0?g.issues.push({input:h,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:a,origin:d,continue:!b.abort}):g.issues.push({input:h,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:a,origin:d,continue:!b.abort}))}h<e&&g.issues.push({origin:"number",input:h,code:"too_small",minimum:e,inclusive:!0,inst:a,continue:!b.abort}),h>f&&g.issues.push({origin:"number",input:h,code:"too_big",maximum:f,inst:a})}}),ay=f("$ZodCheckMaxLength",(a,b)=>{var c;as.init(a,b),(c=a._zod.def).when??(c.when=a=>{let b=a.value;return null!=b&&void 0!==b.length}),a._zod.onattach.push(a=>{let c=a._zod.bag.maximum??1/0;b.maximum<c&&(a._zod.bag.maximum=b.maximum)}),a._zod.check=c=>{let d=c.value;if(d.length<=b.maximum)return;let e=I(d);c.issues.push({origin:e,code:"too_big",maximum:b.maximum,inclusive:!0,input:d,inst:a,continue:!b.abort})}}),az=f("$ZodCheckMinLength",(a,b)=>{var c;as.init(a,b),(c=a._zod.def).when??(c.when=a=>{let b=a.value;return null!=b&&void 0!==b.length}),a._zod.onattach.push(a=>{let c=a._zod.bag.minimum??-1/0;b.minimum>c&&(a._zod.bag.minimum=b.minimum)}),a._zod.check=c=>{let d=c.value;if(d.length>=b.minimum)return;let e=I(d);c.issues.push({origin:e,code:"too_small",minimum:b.minimum,inclusive:!0,input:d,inst:a,continue:!b.abort})}}),aA=f("$ZodCheckLengthEquals",(a,b)=>{var c;as.init(a,b),(c=a._zod.def).when??(c.when=a=>{let b=a.value;return null!=b&&void 0!==b.length}),a._zod.onattach.push(a=>{let c=a._zod.bag;c.minimum=b.length,c.maximum=b.length,c.length=b.length}),a._zod.check=c=>{let d=c.value,e=d.length;if(e===b.length)return;let f=I(d),g=e>b.length;c.issues.push({origin:f,...g?{code:"too_big",maximum:b.length}:{code:"too_small",minimum:b.length},inclusive:!0,exact:!0,input:c.value,inst:a,continue:!b.abort})}}),aB=f("$ZodCheckStringFormat",(a,b)=>{var c,d;as.init(a,b),a._zod.onattach.push(a=>{let c=a._zod.bag;c.format=b.format,b.pattern&&(c.patterns??(c.patterns=new Set),c.patterns.add(b.pattern))}),b.pattern?(c=a._zod).check??(c.check=c=>{b.pattern.lastIndex=0,b.pattern.test(c.value)||c.issues.push({origin:"string",code:"invalid_format",format:b.format,input:c.value,...b.pattern?{pattern:b.pattern.toString()}:{},inst:a,continue:!b.abort})}):(d=a._zod).check??(d.check=()=>{})}),aC=f("$ZodCheckRegex",(a,b)=>{aB.init(a,b),a._zod.check=c=>{b.pattern.lastIndex=0,b.pattern.test(c.value)||c.issues.push({origin:"string",code:"invalid_format",format:"regex",input:c.value,pattern:b.pattern.toString(),inst:a,continue:!b.abort})}}),aD=f("$ZodCheckLowerCase",(a,b)=>{b.pattern??(b.pattern=aq),aB.init(a,b)}),aE=f("$ZodCheckUpperCase",(a,b)=>{b.pattern??(b.pattern=ar),aB.init(a,b)}),aF=f("$ZodCheckIncludes",(a,b)=>{as.init(a,b);let c=z(b.includes),d=new RegExp("number"==typeof b.position?`^.{${b.position}}${c}`:c);b.pattern=d,a._zod.onattach.push(a=>{let b=a._zod.bag;b.patterns??(b.patterns=new Set),b.patterns.add(d)}),a._zod.check=c=>{c.value.includes(b.includes,b.position)||c.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:b.includes,input:c.value,inst:a,continue:!b.abort})}}),aG=f("$ZodCheckStartsWith",(a,b)=>{as.init(a,b);let c=RegExp(`^${z(b.prefix)}.*`);b.pattern??(b.pattern=c),a._zod.onattach.push(a=>{let b=a._zod.bag;b.patterns??(b.patterns=new Set),b.patterns.add(c)}),a._zod.check=c=>{c.value.startsWith(b.prefix)||c.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:b.prefix,input:c.value,inst:a,continue:!b.abort})}}),aH=f("$ZodCheckEndsWith",(a,b)=>{as.init(a,b);let c=RegExp(`.*${z(b.suffix)}$`);b.pattern??(b.pattern=c),a._zod.onattach.push(a=>{let b=a._zod.bag;b.patterns??(b.patterns=new Set),b.patterns.add(c)}),a._zod.check=c=>{c.value.endsWith(b.suffix)||c.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:b.suffix,input:c.value,inst:a,continue:!b.abort})}}),aI=f("$ZodCheckOverwrite",(a,b)=>{as.init(a,b),a._zod.check=a=>{a.value=b.tx(a.value)}});class aJ{constructor(a=[]){this.content=[],this.indent=0,this&&(this.args=a)}indented(a){this.indent+=1,a(this),this.indent-=1}write(a){if("function"==typeof a){a(this,{execution:"sync"}),a(this,{execution:"async"});return}let b=a.split("\n").filter(a=>a),c=Math.min(...b.map(a=>a.length-a.trimStart().length));for(let a of b.map(a=>a.slice(c)).map(a=>" ".repeat(2*this.indent)+a))this.content.push(a)}compile(){return Function(...this?.args,[...(this?.content??[""]).map(a=>`  ${a}`)].join("\n"))}}let aK={major:4,minor:1,patch:11},aL=f("$ZodType",(a,b)=>{var c;a??(a={}),a._zod.def=b,a._zod.bag=a._zod.bag||{},a._zod.version=aK;let d=[...a._zod.def.checks??[]];for(let b of(a._zod.traits.has("$ZodCheck")&&d.unshift(a),d))for(let c of b._zod.onattach)c(a);if(0===d.length)(c=a._zod).deferred??(c.deferred=[]),a._zod.deferred?.push(()=>{a._zod.run=a._zod.parse});else{let b=(a,b,c)=>{let d,e=E(a);for(let f of b){if(f._zod.def.when){if(!f._zod.def.when(a))continue}else if(e)continue;let b=a.issues.length,h=f._zod.check(a);if(h instanceof Promise&&c?.async===!1)throw new g;if(d||h instanceof Promise)d=(d??Promise.resolve()).then(async()=>{await h,a.issues.length!==b&&(e||(e=E(a,b)))});else{if(a.issues.length===b)continue;e||(e=E(a,b))}}return d?d.then(()=>a):a},c=(c,e,f)=>{if(E(c))return c.aborted=!0,c;let h=b(e,d,f);if(h instanceof Promise){if(!1===f.async)throw new g;return h.then(b=>a._zod.parse(b,f))}return a._zod.parse(h,f)};a._zod.run=(e,f)=>{if(f.skipChecks)return a._zod.parse(e,f);if("backward"===f.direction){let b=a._zod.parse({value:e.value,issues:[]},{...f,skipChecks:!0});return b instanceof Promise?b.then(a=>c(a,e,f)):c(b,e,f)}let h=a._zod.parse(e,f);if(h instanceof Promise){if(!1===f.async)throw new g;return h.then(a=>b(a,d,f))}return b(h,d,f)}}a["~standard"]={validate:b=>{try{let c=Q(a,b);return c.success?{value:c.data}:{issues:c.error?.issues}}catch(c){return S(a,b).then(a=>a.success?{value:a.data}:{issues:a.error?.issues})}},vendor:"zod",version:1}}),aM=f("$ZodString",(a,b)=>{aL.init(a,b),a._zod.pattern=[...a?._zod.bag?.patterns??[]].pop()??(a=>{let b=a?`[\\s\\S]{${a?.minimum??0},${a?.maximum??""}}`:"[\\s\\S]*";return RegExp(`^${b}$`)})(a._zod.bag),a._zod.parse=(c,d)=>{if(b.coerce)try{c.value=String(c.value)}catch(a){}return"string"==typeof c.value||c.issues.push({expected:"string",code:"invalid_type",input:c.value,inst:a}),c}}),aN=f("$ZodStringFormat",(a,b)=>{aB.init(a,b),aM.init(a,b)}),aO=f("$ZodGUID",(a,b)=>{b.pattern??(b.pattern=$),aN.init(a,b)}),aP=f("$ZodUUID",(a,b)=>{if(b.version){let a={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[b.version];if(void 0===a)throw Error(`Invalid UUID version: "${b.version}"`);b.pattern??(b.pattern=_(a))}else b.pattern??(b.pattern=_());aN.init(a,b)}),aQ=f("$ZodEmail",(a,b)=>{b.pattern??(b.pattern=aa),aN.init(a,b)}),aR=f("$ZodURL",(a,b)=>{aN.init(a,b),a._zod.check=c=>{try{let d=c.value.trim(),e=new URL(d);b.hostname&&(b.hostname.lastIndex=0,b.hostname.test(e.hostname)||c.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:ah.source,input:c.value,inst:a,continue:!b.abort})),b.protocol&&(b.protocol.lastIndex=0,b.protocol.test(e.protocol.endsWith(":")?e.protocol.slice(0,-1):e.protocol)||c.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:b.protocol.source,input:c.value,inst:a,continue:!b.abort})),b.normalize?c.value=e.href:c.value=d;return}catch(d){c.issues.push({code:"invalid_format",format:"url",input:c.value,inst:a,continue:!b.abort})}}}),aS=f("$ZodEmoji",(a,b)=>{b.pattern??(b.pattern=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),aN.init(a,b)}),aT=f("$ZodNanoID",(a,b)=>{b.pattern??(b.pattern=Y),aN.init(a,b)}),aU=f("$ZodCUID",(a,b)=>{b.pattern??(b.pattern=T),aN.init(a,b)}),aV=f("$ZodCUID2",(a,b)=>{b.pattern??(b.pattern=U),aN.init(a,b)}),aW=f("$ZodULID",(a,b)=>{b.pattern??(b.pattern=V),aN.init(a,b)}),aX=f("$ZodXID",(a,b)=>{b.pattern??(b.pattern=W),aN.init(a,b)}),aY=f("$ZodKSUID",(a,b)=>{b.pattern??(b.pattern=X),aN.init(a,b)}),aZ=f("$ZodISODateTime",(a,b)=>{b.pattern??(b.pattern=function(a){let b=al({precision:a.precision}),c=["Z"];a.local&&c.push(""),a.offset&&c.push("([+-](?:[01]\\d|2[0-3]):[0-5]\\d)");let d=`${b}(?:${c.join("|")})`;return RegExp(`^${aj}T(?:${d})$`)}(b)),aN.init(a,b)}),a$=f("$ZodISODate",(a,b)=>{b.pattern??(b.pattern=ak),aN.init(a,b)}),a_=f("$ZodISOTime",(a,b)=>{b.pattern??(b.pattern=RegExp(`^${al(b)}$`)),aN.init(a,b)}),a0=f("$ZodISODuration",(a,b)=>{b.pattern??(b.pattern=Z),aN.init(a,b)}),a1=f("$ZodIPv4",(a,b)=>{b.pattern??(b.pattern=ab),aN.init(a,b),a._zod.onattach.push(a=>{a._zod.bag.format="ipv4"})}),a2=f("$ZodIPv6",(a,b)=>{b.pattern??(b.pattern=ac),aN.init(a,b),a._zod.onattach.push(a=>{a._zod.bag.format="ipv6"}),a._zod.check=c=>{try{new URL(`http://[${c.value}]`)}catch{c.issues.push({code:"invalid_format",format:"ipv6",input:c.value,inst:a,continue:!b.abort})}}}),a3=f("$ZodCIDRv4",(a,b)=>{b.pattern??(b.pattern=ad),aN.init(a,b)}),a4=f("$ZodCIDRv6",(a,b)=>{b.pattern??(b.pattern=ae),aN.init(a,b),a._zod.check=c=>{let d=c.value.split("/");try{if(2!==d.length)throw Error();let[a,b]=d;if(!b)throw Error();let c=Number(b);if(`${c}`!==b||c<0||c>128)throw Error();new URL(`http://[${a}]`)}catch{c.issues.push({code:"invalid_format",format:"cidrv6",input:c.value,inst:a,continue:!b.abort})}}});function a5(a){if(""===a)return!0;if(a.length%4!=0)return!1;try{return atob(a),!0}catch{return!1}}let a6=f("$ZodBase64",(a,b)=>{b.pattern??(b.pattern=af),aN.init(a,b),a._zod.onattach.push(a=>{a._zod.bag.contentEncoding="base64"}),a._zod.check=c=>{a5(c.value)||c.issues.push({code:"invalid_format",format:"base64",input:c.value,inst:a,continue:!b.abort})}}),a7=f("$ZodBase64URL",(a,b)=>{b.pattern??(b.pattern=ag),aN.init(a,b),a._zod.onattach.push(a=>{a._zod.bag.contentEncoding="base64url"}),a._zod.check=c=>{!function(a){if(!ag.test(a))return!1;let b=a.replace(/[-_]/g,a=>"-"===a?"+":"/");return a5(b.padEnd(4*Math.ceil(b.length/4),"="))}(c.value)&&c.issues.push({code:"invalid_format",format:"base64url",input:c.value,inst:a,continue:!b.abort})}}),a8=f("$ZodE164",(a,b)=>{b.pattern??(b.pattern=ai),aN.init(a,b)}),a9=f("$ZodJWT",(a,b)=>{aN.init(a,b),a._zod.check=c=>{!function(a,b=null){try{let c=a.split(".");if(3!==c.length)return!1;let[d]=c;if(!d)return!1;let e=JSON.parse(atob(d));if("typ"in e&&e?.typ!=="JWT"||!e.alg||b&&(!("alg"in e)||e.alg!==b))return!1;return!0}catch{return!1}}(c.value,b.alg)&&c.issues.push({code:"invalid_format",format:"jwt",input:c.value,inst:a,continue:!b.abort})}}),ba=f("$ZodNumber",(a,b)=>{aL.init(a,b),a._zod.pattern=a._zod.bag.pattern??ao,a._zod.parse=(c,d)=>{if(b.coerce)try{c.value=Number(c.value)}catch(a){}let e=c.value;if("number"==typeof e&&!Number.isNaN(e)&&Number.isFinite(e))return c;let f="number"==typeof e?Number.isNaN(e)?"NaN":Number.isFinite(e)?void 0:"Infinity":void 0;return c.issues.push({expected:"number",code:"invalid_type",input:e,inst:a,...f?{received:f}:{}}),c}}),bb=f("$ZodNumber",(a,b)=>{ax.init(a,b),ba.init(a,b)}),bc=f("$ZodBoolean",(a,b)=>{aL.init(a,b),a._zod.pattern=ap,a._zod.parse=(c,d)=>{if(b.coerce)try{c.value=!!c.value}catch(a){}let e=c.value;return"boolean"==typeof e||c.issues.push({expected:"boolean",code:"invalid_type",input:e,inst:a}),c}}),bd=f("$ZodBigInt",(a,b)=>{aL.init(a,b),a._zod.pattern=am,a._zod.parse=(c,d)=>{if(b.coerce)try{c.value=BigInt(c.value)}catch(a){}return"bigint"==typeof c.value||c.issues.push({expected:"bigint",code:"invalid_type",input:c.value,inst:a}),c}}),be=f("$ZodAny",(a,b)=>{aL.init(a,b),a._zod.parse=a=>a}),bf=f("$ZodUnknown",(a,b)=>{aL.init(a,b),a._zod.parse=a=>a}),bg=f("$ZodNever",(a,b)=>{aL.init(a,b),a._zod.parse=(b,c)=>(b.issues.push({expected:"never",code:"invalid_type",input:b.value,inst:a}),b)}),bh=f("$ZodDate",(a,b)=>{aL.init(a,b),a._zod.parse=(c,d)=>{if(b.coerce)try{c.value=new Date(c.value)}catch(a){}let e=c.value,f=e instanceof Date;return f&&!Number.isNaN(e.getTime())||c.issues.push({expected:"date",code:"invalid_type",input:e,...f?{received:"Invalid Date"}:{},inst:a}),c}});function bi(a,b,c){a.issues.length&&b.issues.push(...F(c,a.issues)),b.value[c]=a.value}let bj=f("$ZodArray",(a,b)=>{aL.init(a,b),a._zod.parse=(c,d)=>{let e=c.value;if(!Array.isArray(e))return c.issues.push({expected:"array",code:"invalid_type",input:e,inst:a}),c;c.value=Array(e.length);let f=[];for(let a=0;a<e.length;a++){let g=e[a],h=b.element._zod.run({value:g,issues:[]},d);h instanceof Promise?f.push(h.then(b=>bi(b,c,a))):bi(h,c,a)}return f.length?Promise.all(f).then(()=>c):c}});function bk(a,b,c,d){a.issues.length&&b.issues.push(...F(c,a.issues)),void 0===a.value?c in d&&(b.value[c]=void 0):b.value[c]=a.value}function bl(a){var b;let c=Object.keys(a.shape);for(let b of c)if(!a.shape?.[b]?._zod?.traits?.has("$ZodType"))throw Error(`Invalid element at key "${b}": expected a Zod schema`);let d=Object.keys(b=a.shape).filter(a=>"optional"===b[a]._zod.optin&&"optional"===b[a]._zod.optout);return{...a,keys:c,keySet:new Set(c),numKeys:c.length,optionalKeys:new Set(d)}}function bm(a,b,c,d,e,f){let g=[],h=e.keySet,i=e.catchall._zod,j=i.def.type;for(let e of Object.keys(b)){if(h.has(e))continue;if("never"===j){g.push(e);continue}let f=i.run({value:b[e],issues:[]},d);f instanceof Promise?a.push(f.then(a=>bk(a,c,e,b))):bk(f,c,e,b)}return(g.length&&c.issues.push({code:"unrecognized_keys",keys:g,input:b,inst:f}),a.length)?Promise.all(a).then(()=>c):c}let bn=f("$ZodObject",(a,b)=>{let c;aL.init(a,b);let d=Object.getOwnPropertyDescriptor(b,"shape");if(!d?.get){let a=b.shape;Object.defineProperty(b,"shape",{get:()=>{let c={...a};return Object.defineProperty(b,"shape",{value:c}),c}})}let e=m(()=>bl(b));p(a._zod,"propValues",()=>{let a=b.shape,c={};for(let b in a){let d=a[b]._zod;if(d.values)for(let a of(c[b]??(c[b]=new Set),d.values))c[b].add(a)}return c});let f=b.catchall;a._zod.parse=(b,d)=>{c??(c=e.value);let g=b.value;if(!u(g))return b.issues.push({expected:"object",code:"invalid_type",input:g,inst:a}),b;b.value={};let h=[],i=c.shape;for(let a of c.keys){let c=i[a]._zod.run({value:g[a],issues:[]},d);c instanceof Promise?h.push(c.then(c=>bk(c,b,a,g))):bk(c,b,a,g)}return f?bm(h,g,b,d,e.value,a):h.length?Promise.all(h).then(()=>b):b}}),bo=f("$ZodObjectJIT",(a,b)=>{let c,d;bn.init(a,b);let e=a._zod.parse,f=m(()=>bl(b)),g=!i.jitless,h=g&&v.value,j=b.catchall;a._zod.parse=(i,k)=>{d??(d=f.value);let l=i.value;return u(l)?g&&h&&k?.async===!1&&!0!==k.jitless?(c||(c=(a=>{let b=new aJ(["shape","payload","ctx"]),c=f.value,d=a=>{let b=s(a);return`shape[${b}]._zod.run({ value: input[${b}], issues: [] }, ctx)`};b.write("const input = payload.value;");let e=Object.create(null),g=0;for(let a of c.keys)e[a]=`key_${g++}`;for(let a of(b.write("const newResult = {};"),c.keys)){let c=e[a],f=s(a);b.write(`const ${c} = ${d(a)};`),b.write(`
        if (${c}.issues.length) {
          payload.issues = payload.issues.concat(${c}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${f}, ...iss.path] : [${f}]
          })));
        }
        
        
        if (${c}.value === undefined) {
          if (${f} in input) {
            newResult[${f}] = undefined;
          }
        } else {
          newResult[${f}] = ${c}.value;
        }
        
      `)}b.write("payload.value = newResult;"),b.write("return payload;");let h=b.compile();return(b,c)=>h(a,b,c)})(b.shape)),i=c(i,k),j)?bm([],l,i,k,d,a):i:e(i,k):(i.issues.push({expected:"object",code:"invalid_type",input:l,inst:a}),i)}});function bp(a,b,c,d){for(let c of a)if(0===c.issues.length)return b.value=c.value,b;let e=a.filter(a=>!E(a));return 1===e.length?(b.value=e[0].value,e[0]):(b.issues.push({code:"invalid_union",input:b.value,inst:c,errors:a.map(a=>a.issues.map(a=>H(a,d,j())))}),b)}let bq=f("$ZodUnion",(a,b)=>{aL.init(a,b),p(a._zod,"optin",()=>b.options.some(a=>"optional"===a._zod.optin)?"optional":void 0),p(a._zod,"optout",()=>b.options.some(a=>"optional"===a._zod.optout)?"optional":void 0),p(a._zod,"values",()=>{if(b.options.every(a=>a._zod.values))return new Set(b.options.flatMap(a=>Array.from(a._zod.values)))}),p(a._zod,"pattern",()=>{if(b.options.every(a=>a._zod.pattern)){let a=b.options.map(a=>a._zod.pattern);return RegExp(`^(${a.map(a=>n(a.source)).join("|")})$`)}});let c=1===b.options.length,d=b.options[0]._zod.run;a._zod.parse=(e,f)=>{if(c)return d(e,f);let g=!1,h=[];for(let a of b.options){let b=a._zod.run({value:e.value,issues:[]},f);if(b instanceof Promise)h.push(b),g=!0;else{if(0===b.issues.length)return b;h.push(b)}}return g?Promise.all(h).then(b=>bp(b,e,a,f)):bp(h,e,a,f)}}),br=f("$ZodIntersection",(a,b)=>{aL.init(a,b),a._zod.parse=(a,c)=>{let d=a.value,e=b.left._zod.run({value:d,issues:[]},c),f=b.right._zod.run({value:d,issues:[]},c);return e instanceof Promise||f instanceof Promise?Promise.all([e,f]).then(([b,c])=>bs(a,b,c)):bs(a,e,f)}});function bs(a,b,c){if(b.issues.length&&a.issues.push(...b.issues),c.issues.length&&a.issues.push(...c.issues),E(a))return a;let d=function a(b,c){if(b===c||b instanceof Date&&c instanceof Date&&+b==+c)return{valid:!0,data:b};if(w(b)&&w(c)){let d=Object.keys(c),e=Object.keys(b).filter(a=>-1!==d.indexOf(a)),f={...b,...c};for(let d of e){let e=a(b[d],c[d]);if(!e.valid)return{valid:!1,mergeErrorPath:[d,...e.mergeErrorPath]};f[d]=e.data}return{valid:!0,data:f}}if(Array.isArray(b)&&Array.isArray(c)){if(b.length!==c.length)return{valid:!1,mergeErrorPath:[]};let d=[];for(let e=0;e<b.length;e++){let f=a(b[e],c[e]);if(!f.valid)return{valid:!1,mergeErrorPath:[e,...f.mergeErrorPath]};d.push(f.data)}return{valid:!0,data:d}}return{valid:!1,mergeErrorPath:[]}}(b.value,c.value);if(!d.valid)throw Error(`Unmergable intersection. Error path: ${JSON.stringify(d.mergeErrorPath)}`);return a.value=d.data,a}let bt=f("$ZodRecord",(a,b)=>{aL.init(a,b),a._zod.parse=(c,d)=>{let e=c.value;if(!w(e))return c.issues.push({expected:"record",code:"invalid_type",input:e,inst:a}),c;let f=[];if(b.keyType._zod.values){let g,h=b.keyType._zod.values;for(let a of(c.value={},h))if("string"==typeof a||"number"==typeof a||"symbol"==typeof a){let g=b.valueType._zod.run({value:e[a],issues:[]},d);g instanceof Promise?f.push(g.then(b=>{b.issues.length&&c.issues.push(...F(a,b.issues)),c.value[a]=b.value})):(g.issues.length&&c.issues.push(...F(a,g.issues)),c.value[a]=g.value)}for(let a in e)h.has(a)||(g=g??[]).push(a);g&&g.length>0&&c.issues.push({code:"unrecognized_keys",input:e,inst:a,keys:g})}else for(let g of(c.value={},Reflect.ownKeys(e))){if("__proto__"===g)continue;let h=b.keyType._zod.run({value:g,issues:[]},d);if(h instanceof Promise)throw Error("Async schemas not supported in object keys currently");if(h.issues.length){c.issues.push({code:"invalid_key",origin:"record",issues:h.issues.map(a=>H(a,d,j())),input:g,path:[g],inst:a}),c.value[h.value]=h.value;continue}let i=b.valueType._zod.run({value:e[g],issues:[]},d);i instanceof Promise?f.push(i.then(a=>{a.issues.length&&c.issues.push(...F(g,a.issues)),c.value[h.value]=a.value})):(i.issues.length&&c.issues.push(...F(g,i.issues)),c.value[h.value]=i.value)}return f.length?Promise.all(f).then(()=>c):c}}),bu=f("$ZodEnum",(a,b)=>{aL.init(a,b);let c=function(a){let b=Object.values(a).filter(a=>"number"==typeof a);return Object.entries(a).filter(([a,c])=>-1===b.indexOf(+a)).map(([a,b])=>b)}(b.entries),d=new Set(c);a._zod.values=d,a._zod.pattern=RegExp(`^(${c.filter(a=>y.has(typeof a)).map(a=>"string"==typeof a?z(a):a.toString()).join("|")})$`),a._zod.parse=(b,e)=>{let f=b.value;return d.has(f)||b.issues.push({code:"invalid_value",values:c,input:f,inst:a}),b}}),bv=f("$ZodTransform",(a,b)=>{aL.init(a,b),a._zod.parse=(c,d)=>{if("backward"===d.direction)throw new h(a.constructor.name);let e=b.transform(c.value,c);if(d.async)return(e instanceof Promise?e:Promise.resolve(e)).then(a=>(c.value=a,c));if(e instanceof Promise)throw new g;return c.value=e,c}});function bw(a,b){return a.issues.length&&void 0===b?{issues:[],value:void 0}:a}let bx=f("$ZodOptional",(a,b)=>{aL.init(a,b),a._zod.optin="optional",a._zod.optout="optional",p(a._zod,"values",()=>b.innerType._zod.values?new Set([...b.innerType._zod.values,void 0]):void 0),p(a._zod,"pattern",()=>{let a=b.innerType._zod.pattern;return a?RegExp(`^(${n(a.source)})?$`):void 0}),a._zod.parse=(a,c)=>{if("optional"===b.innerType._zod.optin){let d=b.innerType._zod.run(a,c);return d instanceof Promise?d.then(b=>bw(b,a.value)):bw(d,a.value)}return void 0===a.value?a:b.innerType._zod.run(a,c)}}),by=f("$ZodNullable",(a,b)=>{aL.init(a,b),p(a._zod,"optin",()=>b.innerType._zod.optin),p(a._zod,"optout",()=>b.innerType._zod.optout),p(a._zod,"pattern",()=>{let a=b.innerType._zod.pattern;return a?RegExp(`^(${n(a.source)}|null)$`):void 0}),p(a._zod,"values",()=>b.innerType._zod.values?new Set([...b.innerType._zod.values,null]):void 0),a._zod.parse=(a,c)=>null===a.value?a:b.innerType._zod.run(a,c)}),bz=f("$ZodDefault",(a,b)=>{aL.init(a,b),a._zod.optin="optional",p(a._zod,"values",()=>b.innerType._zod.values),a._zod.parse=(a,c)=>{if("backward"===c.direction)return b.innerType._zod.run(a,c);if(void 0===a.value)return a.value=b.defaultValue,a;let d=b.innerType._zod.run(a,c);return d instanceof Promise?d.then(a=>bA(a,b)):bA(d,b)}});function bA(a,b){return void 0===a.value&&(a.value=b.defaultValue),a}let bB=f("$ZodPrefault",(a,b)=>{aL.init(a,b),a._zod.optin="optional",p(a._zod,"values",()=>b.innerType._zod.values),a._zod.parse=(a,c)=>("backward"===c.direction||void 0===a.value&&(a.value=b.defaultValue),b.innerType._zod.run(a,c))}),bC=f("$ZodNonOptional",(a,b)=>{aL.init(a,b),p(a._zod,"values",()=>{let a=b.innerType._zod.values;return a?new Set([...a].filter(a=>void 0!==a)):void 0}),a._zod.parse=(c,d)=>{let e=b.innerType._zod.run(c,d);return e instanceof Promise?e.then(b=>bD(b,a)):bD(e,a)}});function bD(a,b){return a.issues.length||void 0!==a.value||a.issues.push({code:"invalid_type",expected:"nonoptional",input:a.value,inst:b}),a}let bE=f("$ZodCatch",(a,b)=>{aL.init(a,b),p(a._zod,"optin",()=>b.innerType._zod.optin),p(a._zod,"optout",()=>b.innerType._zod.optout),p(a._zod,"values",()=>b.innerType._zod.values),a._zod.parse=(a,c)=>{if("backward"===c.direction)return b.innerType._zod.run(a,c);let d=b.innerType._zod.run(a,c);return d instanceof Promise?d.then(d=>(a.value=d.value,d.issues.length&&(a.value=b.catchValue({...a,error:{issues:d.issues.map(a=>H(a,c,j()))},input:a.value}),a.issues=[]),a)):(a.value=d.value,d.issues.length&&(a.value=b.catchValue({...a,error:{issues:d.issues.map(a=>H(a,c,j()))},input:a.value}),a.issues=[]),a)}}),bF=f("$ZodPipe",(a,b)=>{aL.init(a,b),p(a._zod,"values",()=>b.in._zod.values),p(a._zod,"optin",()=>b.in._zod.optin),p(a._zod,"optout",()=>b.out._zod.optout),p(a._zod,"propValues",()=>b.in._zod.propValues),a._zod.parse=(a,c)=>{if("backward"===c.direction){let d=b.out._zod.run(a,c);return d instanceof Promise?d.then(a=>bG(a,b.in,c)):bG(d,b.in,c)}let d=b.in._zod.run(a,c);return d instanceof Promise?d.then(a=>bG(a,b.out,c)):bG(d,b.out,c)}});function bG(a,b,c){return a.issues.length?(a.aborted=!0,a):b._zod.run({value:a.value,issues:a.issues},c)}let bH=f("$ZodReadonly",(a,b)=>{aL.init(a,b),p(a._zod,"propValues",()=>b.innerType._zod.propValues),p(a._zod,"values",()=>b.innerType._zod.values),p(a._zod,"optin",()=>b.innerType._zod.optin),p(a._zod,"optout",()=>b.innerType._zod.optout),a._zod.parse=(a,c)=>{if("backward"===c.direction)return b.innerType._zod.run(a,c);let d=b.innerType._zod.run(a,c);return d instanceof Promise?d.then(bI):bI(d)}});function bI(a){return a.value=Object.freeze(a.value),a}let bJ=f("$ZodCustom",(a,b)=>{as.init(a,b),aL.init(a,b),a._zod.parse=(a,b)=>a,a._zod.check=c=>{let d=c.value,e=b.fn(d);if(e instanceof Promise)return e.then(b=>bK(b,c,d,a));bK(e,c,d,a)}});function bK(a,b,c,d){if(!a){let a={code:"custom",input:c,inst:d,path:[...d._zod.def.path??[]],continue:!d._zod.def.abort};d._zod.def.params&&(a.params=d._zod.def.params),b.issues.push(J(a))}}Symbol("ZodOutput"),Symbol("ZodInput");class bL{constructor(){this._map=new WeakMap,this._idmap=new Map}add(a,...b){let c=b[0];if(this._map.set(a,c),c&&"object"==typeof c&&"id"in c){if(this._idmap.has(c.id))throw Error(`ID ${c.id} already exists in the registry`);this._idmap.set(c.id,a)}return this}clear(){return this._map=new WeakMap,this._idmap=new Map,this}remove(a){let b=this._map.get(a);return b&&"object"==typeof b&&"id"in b&&this._idmap.delete(b.id),this._map.delete(a),this}get(a){let b=a._zod.parent;if(b){let c={...this.get(b)??{}};delete c.id;let d={...c,...this._map.get(a)};return Object.keys(d).length?d:void 0}return this._map.get(a)}has(a){return this._map.has(a)}}let bM=new bL;function bN(a,b){return new a({type:"string",format:"email",check:"string_format",abort:!1,...B(b)})}function bO(a,b){return new a({type:"string",format:"guid",check:"string_format",abort:!1,...B(b)})}function bP(a,b){return new a({type:"string",format:"ipv4",check:"string_format",abort:!1,...B(b)})}function bQ(a,b){return new a({type:"string",format:"ipv6",check:"string_format",abort:!1,...B(b)})}function bR(a,b){return new au({check:"less_than",...B(b),value:a,inclusive:!1})}function bS(a,b){return new au({check:"less_than",...B(b),value:a,inclusive:!0})}function bT(a,b){return new av({check:"greater_than",...B(b),value:a,inclusive:!1})}function bU(a,b){return new av({check:"greater_than",...B(b),value:a,inclusive:!0})}function bV(a,b){return new aw({check:"multiple_of",...B(b),value:a})}function bW(a,b){return new ay({check:"max_length",...B(b),maximum:a})}function bX(a,b){return new az({check:"min_length",...B(b),minimum:a})}function bY(a,b){return new aA({check:"length_equals",...B(b),length:a})}function bZ(a){return new aI({check:"overwrite",tx:a})}let b$=f("ZodISODateTime",(a,b)=>{aZ.init(a,b),ck.init(a,b)}),b_=f("ZodISODate",(a,b)=>{a$.init(a,b),ck.init(a,b)}),b0=f("ZodISOTime",(a,b)=>{a_.init(a,b),ck.init(a,b)}),b1=f("ZodISODuration",(a,b)=>{a0.init(a,b),ck.init(a,b)}),b2=(a,b)=>{L.init(a,b),a.name="ZodError",Object.defineProperties(a,{format:{value:b=>(function(a,b){let c=b||function(a){return a.message},d={_errors:[]},e=a=>{for(let b of a.issues)if("invalid_union"===b.code&&b.errors.length)b.errors.map(a=>e({issues:a}));else if("invalid_key"===b.code)e({issues:b.issues});else if("invalid_element"===b.code)e({issues:b.issues});else if(0===b.path.length)d._errors.push(c(b));else{let a=d,e=0;for(;e<b.path.length;){let d=b.path[e];e===b.path.length-1?(a[d]=a[d]||{_errors:[]},a[d]._errors.push(c(b))):a[d]=a[d]||{_errors:[]},a=a[d],e++}}};return e(a),d})(a,b)},flatten:{value:b=>(function(a,b=a=>a.message){let c={},d=[];for(let e of a.issues)e.path.length>0?(c[e.path[0]]=c[e.path[0]]||[],c[e.path[0]].push(b(e))):d.push(b(e));return{formErrors:d,fieldErrors:c}})(a,b)},addIssue:{value:b=>{a.issues.push(b),a.message=JSON.stringify(a.issues,l,2)}},addIssues:{value:b=>{a.issues.push(...b),a.message=JSON.stringify(a.issues,l,2)}},isEmpty:{get:()=>0===a.issues.length}})};f("ZodError",b2);let b3=f("ZodError",b2,{Parent:Error}),b4=N(b3),b5=O(b3),b6=P(b3),b7=R(b3),b8=(a,b,c)=>{let d=c?Object.assign(c,{direction:"backward"}):{direction:"backward"};return N(b3)(a,b,d)},b9=(a,b,c)=>N(b3)(a,b,c),ca=async(a,b,c)=>{let d=c?Object.assign(c,{direction:"backward"}):{direction:"backward"};return O(b3)(a,b,d)},cb=async(a,b,c)=>O(b3)(a,b,c),cc=(a,b,c)=>{let d=c?Object.assign(c,{direction:"backward"}):{direction:"backward"};return P(b3)(a,b,d)},cd=(a,b,c)=>P(b3)(a,b,c),ce=async(a,b,c)=>{let d=c?Object.assign(c,{direction:"backward"}):{direction:"backward"};return R(b3)(a,b,d)},cf=async(a,b,c)=>R(b3)(a,b,c),cg=f("ZodType",(a,b)=>(aL.init(a,b),a.def=b,a.type=b.type,Object.defineProperty(a,"_def",{value:b}),a.check=(...c)=>a.clone(r(b,{checks:[...b.checks??[],...c.map(a=>"function"==typeof a?{_zod:{check:a,def:{check:"custom"},onattach:[]}}:a)]})),a.clone=(b,c)=>A(a,b,c),a.brand=()=>a,a.register=(b,c)=>(b.add(a,c),a),a.parse=(b,c)=>b4(a,b,c,{callee:a.parse}),a.safeParse=(b,c)=>b6(a,b,c),a.parseAsync=async(b,c)=>b5(a,b,c,{callee:a.parseAsync}),a.safeParseAsync=async(b,c)=>b7(a,b,c),a.spa=a.safeParseAsync,a.encode=(b,c)=>b8(a,b,c),a.decode=(b,c)=>b9(a,b,c),a.encodeAsync=async(b,c)=>ca(a,b,c),a.decodeAsync=async(b,c)=>cb(a,b,c),a.safeEncode=(b,c)=>cc(a,b,c),a.safeDecode=(b,c)=>cd(a,b,c),a.safeEncodeAsync=async(b,c)=>ce(a,b,c),a.safeDecodeAsync=async(b,c)=>cf(a,b,c),a.refine=(b,c)=>a.check(function(a,b={}){return new dg({type:"custom",check:"custom",fn:a,...B(b)})}(b,c)),a.superRefine=b=>a.check(function(a){let b=function(a,b){let c=new as({check:"custom",...B(void 0)});return c._zod.check=a,c}(c=>(c.addIssue=a=>{"string"==typeof a?c.issues.push(J(a,c.value,b._zod.def)):(a.fatal&&(a.continue=!1),a.code??(a.code="custom"),a.input??(a.input=c.value),a.inst??(a.inst=b),a.continue??(a.continue=!b._zod.def.abort),c.issues.push(J(a)))},a(c.value,c)));return b}(b)),a.overwrite=b=>a.check(bZ(b)),a.optional=()=>c6(a),a.nullable=()=>c8(a),a.nullish=()=>c6(c8(a)),a.nonoptional=b=>new db({type:"nonoptional",innerType:a,...B(b)}),a.array=()=>cW(a),a.or=b=>c$([a,b]),a.and=b=>new c_({type:"intersection",left:a,right:b}),a.transform=b=>de(a,new c4({type:"transform",transform:b})),a.default=b=>(function(a,b){return new c9({type:"default",innerType:a,get defaultValue(){return"function"==typeof b?b():x(b)}})})(a,b),a.prefault=b=>(function(a,b){return new da({type:"prefault",innerType:a,get defaultValue(){return"function"==typeof b?b():x(b)}})})(a,b),a.catch=b=>(function(a,b){return new dc({type:"catch",innerType:a,catchValue:"function"==typeof b?b:()=>b})})(a,b),a.pipe=b=>de(a,b),a.readonly=()=>new df({type:"readonly",innerType:a}),a.describe=b=>{let c=a.clone();return bM.add(c,{description:b}),c},Object.defineProperty(a,"description",{get:()=>bM.get(a)?.description,configurable:!0}),a.meta=(...b)=>{if(0===b.length)return bM.get(a);let c=a.clone();return bM.add(c,b[0]),c},a.isOptional=()=>a.safeParse(void 0).success,a.isNullable=()=>a.safeParse(null).success,a)),ch=f("_ZodString",(a,b)=>{aM.init(a,b),cg.init(a,b);let c=a._zod.bag;a.format=c.format??null,a.minLength=c.minimum??null,a.maxLength=c.maximum??null,a.regex=(...b)=>a.check(function(a,b){return new aC({check:"string_format",format:"regex",...B(b),pattern:a})}(...b)),a.includes=(...b)=>a.check(function(a,b){return new aF({check:"string_format",format:"includes",...B(b),includes:a})}(...b)),a.startsWith=(...b)=>a.check(function(a,b){return new aG({check:"string_format",format:"starts_with",...B(b),prefix:a})}(...b)),a.endsWith=(...b)=>a.check(function(a,b){return new aH({check:"string_format",format:"ends_with",...B(b),suffix:a})}(...b)),a.min=(...b)=>a.check(bX(...b)),a.max=(...b)=>a.check(bW(...b)),a.length=(...b)=>a.check(bY(...b)),a.nonempty=(...b)=>a.check(bX(1,...b)),a.lowercase=b=>a.check(new aD({check:"string_format",format:"lowercase",...B(b)})),a.uppercase=b=>a.check(new aE({check:"string_format",format:"uppercase",...B(b)})),a.trim=()=>a.check(bZ(a=>a.trim())),a.normalize=(...b)=>a.check(function(a){return bZ(b=>b.normalize(a))}(...b)),a.toLowerCase=()=>a.check(bZ(a=>a.toLowerCase())),a.toUpperCase=()=>a.check(bZ(a=>a.toUpperCase()))}),ci=f("ZodString",(a,b)=>{aM.init(a,b),ch.init(a,b),a.email=b=>a.check(bN(cl,b)),a.url=b=>a.check(new cp({type:"string",format:"url",check:"string_format",abort:!1,...B(b)})),a.jwt=b=>a.check(new cG({type:"string",format:"jwt",check:"string_format",abort:!1,...B(b)})),a.emoji=b=>a.check(new cq({type:"string",format:"emoji",check:"string_format",abort:!1,...B(b)})),a.guid=b=>a.check(bO(cn,b)),a.uuid=b=>a.check(new co({type:"string",format:"uuid",check:"string_format",abort:!1,...B(b)})),a.uuidv4=b=>a.check(new co({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...B(b)})),a.uuidv6=b=>a.check(new co({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...B(b)})),a.uuidv7=b=>a.check(new co({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...B(b)})),a.nanoid=b=>a.check(new cr({type:"string",format:"nanoid",check:"string_format",abort:!1,...B(b)})),a.guid=b=>a.check(bO(cn,b)),a.cuid=b=>a.check(new cs({type:"string",format:"cuid",check:"string_format",abort:!1,...B(b)})),a.cuid2=b=>a.check(new ct({type:"string",format:"cuid2",check:"string_format",abort:!1,...B(b)})),a.ulid=b=>a.check(new cu({type:"string",format:"ulid",check:"string_format",abort:!1,...B(b)})),a.base64=b=>a.check(new cD({type:"string",format:"base64",check:"string_format",abort:!1,...B(b)})),a.base64url=b=>a.check(new cE({type:"string",format:"base64url",check:"string_format",abort:!1,...B(b)})),a.xid=b=>a.check(new cv({type:"string",format:"xid",check:"string_format",abort:!1,...B(b)})),a.ksuid=b=>a.check(new cw({type:"string",format:"ksuid",check:"string_format",abort:!1,...B(b)})),a.ipv4=b=>a.check(bP(cx,b)),a.ipv6=b=>a.check(bQ(cz,b)),a.cidrv4=b=>a.check(new cB({type:"string",format:"cidrv4",check:"string_format",abort:!1,...B(b)})),a.cidrv6=b=>a.check(new cC({type:"string",format:"cidrv6",check:"string_format",abort:!1,...B(b)})),a.e164=b=>a.check(new cF({type:"string",format:"e164",check:"string_format",abort:!1,...B(b)})),a.datetime=b=>a.check(new b$({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...B(b)})),a.date=b=>a.check(new b_({type:"string",format:"date",check:"string_format",...B(b)})),a.time=b=>a.check(new b0({type:"string",format:"time",check:"string_format",precision:null,...B(b)})),a.duration=b=>a.check(new b1({type:"string",format:"duration",check:"string_format",...B(b)}))});function cj(a){return new ci({type:"string",...B(a)})}let ck=f("ZodStringFormat",(a,b)=>{aN.init(a,b),ch.init(a,b)}),cl=f("ZodEmail",(a,b)=>{aQ.init(a,b),ck.init(a,b)});function cm(a){return bN(cl,a)}let cn=f("ZodGUID",(a,b)=>{aO.init(a,b),ck.init(a,b)}),co=f("ZodUUID",(a,b)=>{aP.init(a,b),ck.init(a,b)}),cp=f("ZodURL",(a,b)=>{aR.init(a,b),ck.init(a,b)}),cq=f("ZodEmoji",(a,b)=>{aS.init(a,b),ck.init(a,b)}),cr=f("ZodNanoID",(a,b)=>{aT.init(a,b),ck.init(a,b)}),cs=f("ZodCUID",(a,b)=>{aU.init(a,b),ck.init(a,b)}),ct=f("ZodCUID2",(a,b)=>{aV.init(a,b),ck.init(a,b)}),cu=f("ZodULID",(a,b)=>{aW.init(a,b),ck.init(a,b)}),cv=f("ZodXID",(a,b)=>{aX.init(a,b),ck.init(a,b)}),cw=f("ZodKSUID",(a,b)=>{aY.init(a,b),ck.init(a,b)}),cx=f("ZodIPv4",(a,b)=>{a1.init(a,b),ck.init(a,b)});function cy(a){return bP(cx,a)}let cz=f("ZodIPv6",(a,b)=>{a2.init(a,b),ck.init(a,b)});function cA(a){return bQ(cz,a)}let cB=f("ZodCIDRv4",(a,b)=>{a3.init(a,b),ck.init(a,b)}),cC=f("ZodCIDRv6",(a,b)=>{a4.init(a,b),ck.init(a,b)}),cD=f("ZodBase64",(a,b)=>{a6.init(a,b),ck.init(a,b)}),cE=f("ZodBase64URL",(a,b)=>{a7.init(a,b),ck.init(a,b)}),cF=f("ZodE164",(a,b)=>{a8.init(a,b),ck.init(a,b)}),cG=f("ZodJWT",(a,b)=>{a9.init(a,b),ck.init(a,b)}),cH=f("ZodNumber",(a,b)=>{ba.init(a,b),cg.init(a,b),a.gt=(b,c)=>a.check(bT(b,c)),a.gte=(b,c)=>a.check(bU(b,c)),a.min=(b,c)=>a.check(bU(b,c)),a.lt=(b,c)=>a.check(bR(b,c)),a.lte=(b,c)=>a.check(bS(b,c)),a.max=(b,c)=>a.check(bS(b,c)),a.int=b=>a.check(cK(b)),a.safe=b=>a.check(cK(b)),a.positive=b=>a.check(bT(0,b)),a.nonnegative=b=>a.check(bU(0,b)),a.negative=b=>a.check(bR(0,b)),a.nonpositive=b=>a.check(bS(0,b)),a.multipleOf=(b,c)=>a.check(bV(b,c)),a.step=(b,c)=>a.check(bV(b,c)),a.finite=()=>a;let c=a._zod.bag;a.minValue=Math.max(c.minimum??-1/0,c.exclusiveMinimum??-1/0)??null,a.maxValue=Math.min(c.maximum??1/0,c.exclusiveMaximum??1/0)??null,a.isInt=(c.format??"").includes("int")||Number.isSafeInteger(c.multipleOf??.5),a.isFinite=!0,a.format=c.format??null});function cI(a){return new cH({type:"number",checks:[],...B(a)})}let cJ=f("ZodNumberFormat",(a,b)=>{bb.init(a,b),cH.init(a,b)});function cK(a){return new cJ({type:"number",check:"number_format",abort:!1,format:"safeint",...B(a)})}let cL=f("ZodBoolean",(a,b)=>{bc.init(a,b),cg.init(a,b)});function cM(a){return new cL({type:"boolean",...B(a)})}let cN=f("ZodBigInt",(a,b)=>{bd.init(a,b),cg.init(a,b),a.gte=(b,c)=>a.check(bU(b,c)),a.min=(b,c)=>a.check(bU(b,c)),a.gt=(b,c)=>a.check(bT(b,c)),a.gte=(b,c)=>a.check(bU(b,c)),a.min=(b,c)=>a.check(bU(b,c)),a.lt=(b,c)=>a.check(bR(b,c)),a.lte=(b,c)=>a.check(bS(b,c)),a.max=(b,c)=>a.check(bS(b,c)),a.positive=b=>a.check(bT(BigInt(0),b)),a.negative=b=>a.check(bR(BigInt(0),b)),a.nonpositive=b=>a.check(bS(BigInt(0),b)),a.nonnegative=b=>a.check(bU(BigInt(0),b)),a.multipleOf=(b,c)=>a.check(bV(b,c));let c=a._zod.bag;a.minValue=c.minimum??null,a.maxValue=c.maximum??null,a.format=c.format??null}),cO=f("ZodAny",(a,b)=>{be.init(a,b),cg.init(a,b)});function cP(){return new cO({type:"any"})}let cQ=f("ZodUnknown",(a,b)=>{bf.init(a,b),cg.init(a,b)});function cR(){return new cQ({type:"unknown"})}let cS=f("ZodNever",(a,b)=>{bg.init(a,b),cg.init(a,b)}),cT=f("ZodDate",(a,b)=>{bh.init(a,b),cg.init(a,b),a.min=(b,c)=>a.check(bU(b,c)),a.max=(b,c)=>a.check(bS(b,c));let c=a._zod.bag;a.minDate=c.minimum?new Date(c.minimum):null,a.maxDate=c.maximum?new Date(c.maximum):null});function cU(a){return new cT({type:"date",...B(a)})}let cV=f("ZodArray",(a,b)=>{bj.init(a,b),cg.init(a,b),a.element=b.element,a.min=(b,c)=>a.check(bX(b,c)),a.nonempty=b=>a.check(bX(1,b)),a.max=(b,c)=>a.check(bW(b,c)),a.length=(b,c)=>a.check(bY(b,c)),a.unwrap=()=>a.element});function cW(a,b){return new cV({type:"array",element:a,...B(b)})}let cX=f("ZodObject",(a,b)=>{bo.init(a,b),cg.init(a,b),p(a,"shape",()=>b.shape),a.keyof=()=>c3(Object.keys(a._zod.def.shape)),a.catchall=b=>a.clone({...a._zod.def,catchall:b}),a.passthrough=()=>a.clone({...a._zod.def,catchall:cR()}),a.loose=()=>a.clone({...a._zod.def,catchall:cR()}),a.strict=()=>a.clone({...a._zod.def,catchall:new cS({type:"never",...B(void 0)})}),a.strip=()=>a.clone({...a._zod.def,catchall:void 0}),a.extend=b=>(function(a,b){if(!w(b))throw Error("Invalid input to extend: expected a plain object");let c=a._zod.def.checks;if(c&&c.length>0)throw Error("Object schemas containing refinements cannot be extended. Use `.safeExtend()` instead.");let d=r(a._zod.def,{get shape(){let c={...a._zod.def.shape,...b};return q(this,"shape",c),c},checks:[]});return A(a,d)})(a,b),a.safeExtend=b=>(function(a,b){if(!w(b))throw Error("Invalid input to safeExtend: expected a plain object");let c={...a._zod.def,get shape(){let c={...a._zod.def.shape,...b};return q(this,"shape",c),c},checks:a._zod.def.checks};return A(a,c)})(a,b),a.merge=b=>(function(a,b){let c=r(a._zod.def,{get shape(){let c={...a._zod.def.shape,...b._zod.def.shape};return q(this,"shape",c),c},get catchall(){return b._zod.def.catchall},checks:[]});return A(a,c)})(a,b),a.pick=b=>(function(a,b){let c=a._zod.def,d=r(a._zod.def,{get shape(){let a={};for(let d in b){if(!(d in c.shape))throw Error(`Unrecognized key: "${d}"`);b[d]&&(a[d]=c.shape[d])}return q(this,"shape",a),a},checks:[]});return A(a,d)})(a,b),a.omit=b=>(function(a,b){let c=a._zod.def,d=r(a._zod.def,{get shape(){let d={...a._zod.def.shape};for(let a in b){if(!(a in c.shape))throw Error(`Unrecognized key: "${a}"`);b[a]&&delete d[a]}return q(this,"shape",d),d},checks:[]});return A(a,d)})(a,b),a.partial=(...b)=>(function(a,b,c){let d=r(b._zod.def,{get shape(){let d=b._zod.def.shape,e={...d};if(c)for(let b in c){if(!(b in d))throw Error(`Unrecognized key: "${b}"`);c[b]&&(e[b]=a?new a({type:"optional",innerType:d[b]}):d[b])}else for(let b in d)e[b]=a?new a({type:"optional",innerType:d[b]}):d[b];return q(this,"shape",e),e},checks:[]});return A(b,d)})(c5,a,b[0]),a.required=(...b)=>(function(a,b,c){let d=r(b._zod.def,{get shape(){let d=b._zod.def.shape,e={...d};if(c)for(let b in c){if(!(b in e))throw Error(`Unrecognized key: "${b}"`);c[b]&&(e[b]=new a({type:"nonoptional",innerType:d[b]}))}else for(let b in d)e[b]=new a({type:"nonoptional",innerType:d[b]});return q(this,"shape",e),e},checks:[]});return A(b,d)})(db,a,b[0])});function cY(a,b){return new cX({type:"object",shape:a??{},...B(b)})}let cZ=f("ZodUnion",(a,b)=>{bq.init(a,b),cg.init(a,b),a.options=b.options});function c$(a,b){return new cZ({type:"union",options:a,...B(b)})}let c_=f("ZodIntersection",(a,b)=>{br.init(a,b),cg.init(a,b)}),c0=f("ZodRecord",(a,b)=>{bt.init(a,b),cg.init(a,b),a.keyType=b.keyType,a.valueType=b.valueType});function c1(a,b,c){return new c0({type:"record",keyType:a,valueType:b,...B(c)})}let c2=f("ZodEnum",(a,b)=>{bu.init(a,b),cg.init(a,b),a.enum=b.entries,a.options=Object.values(b.entries);let c=new Set(Object.keys(b.entries));a.extract=(a,d)=>{let e={};for(let d of a)if(c.has(d))e[d]=b.entries[d];else throw Error(`Key ${d} not found in enum`);return new c2({...b,checks:[],...B(d),entries:e})},a.exclude=(a,d)=>{let e={...b.entries};for(let b of a)if(c.has(b))delete e[b];else throw Error(`Key ${b} not found in enum`);return new c2({...b,checks:[],...B(d),entries:e})}});function c3(a,b){return new c2({type:"enum",entries:Array.isArray(a)?Object.fromEntries(a.map(a=>[a,a])):a,...B(b)})}let c4=f("ZodTransform",(a,b)=>{bv.init(a,b),cg.init(a,b),a._zod.parse=(c,d)=>{if("backward"===d.direction)throw new h(a.constructor.name);c.addIssue=d=>{"string"==typeof d?c.issues.push(J(d,c.value,b)):(d.fatal&&(d.continue=!1),d.code??(d.code="custom"),d.input??(d.input=c.value),d.inst??(d.inst=a),c.issues.push(J(d)))};let e=b.transform(c.value,c);return e instanceof Promise?e.then(a=>(c.value=a,c)):(c.value=e,c)}}),c5=f("ZodOptional",(a,b)=>{bx.init(a,b),cg.init(a,b),a.unwrap=()=>a._zod.def.innerType});function c6(a){return new c5({type:"optional",innerType:a})}let c7=f("ZodNullable",(a,b)=>{by.init(a,b),cg.init(a,b),a.unwrap=()=>a._zod.def.innerType});function c8(a){return new c7({type:"nullable",innerType:a})}let c9=f("ZodDefault",(a,b)=>{bz.init(a,b),cg.init(a,b),a.unwrap=()=>a._zod.def.innerType,a.removeDefault=a.unwrap}),da=f("ZodPrefault",(a,b)=>{bB.init(a,b),cg.init(a,b),a.unwrap=()=>a._zod.def.innerType}),db=f("ZodNonOptional",(a,b)=>{bC.init(a,b),cg.init(a,b),a.unwrap=()=>a._zod.def.innerType}),dc=f("ZodCatch",(a,b)=>{bE.init(a,b),cg.init(a,b),a.unwrap=()=>a._zod.def.innerType,a.removeCatch=a.unwrap}),dd=f("ZodPipe",(a,b)=>{bF.init(a,b),cg.init(a,b),a.in=b.in,a.out=b.out});function de(a,b){return new dd({type:"pipe",in:a,out:b})}let df=f("ZodReadonly",(a,b)=>{bH.init(a,b),cg.init(a,b),a.unwrap=()=>a._zod.def.innerType}),dg=f("ZodCustom",(a,b)=>{bJ.init(a,b),cg.init(a,b)});function dh(a,b){let c=B(b);return c.abort??(c.abort=!0),new dg({type:"custom",check:"custom",fn:a??(()=>!0),...c})}function di(a){return new ci({type:"string",coerce:!0,...B(a)})}function dj(a){return new cH({type:"number",coerce:!0,checks:[],...B(a)})}function dk(a){return new cL({type:"boolean",coerce:!0,...B(a)})}function dl(a){return new cN({type:"bigint",coerce:!0,...B(a)})}function dm(a){return new cT({type:"date",coerce:!0,...B(a)})}d||(d={}),j({localeError:(()=>{let a={string:{unit:"characters",verb:"to have"},file:{unit:"bytes",verb:"to have"},array:{unit:"items",verb:"to have"},set:{unit:"items",verb:"to have"}},b={regex:"input",email:"email address",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO datetime",date:"ISO date",time:"ISO time",duration:"ISO duration",ipv4:"IPv4 address",ipv6:"IPv6 address",cidrv4:"IPv4 range",cidrv6:"IPv6 range",base64:"base64-encoded string",base64url:"base64url-encoded string",json_string:"JSON string",e164:"E.164 number",jwt:"JWT",template_literal:"input"};return c=>{switch(c.code){case"invalid_type":return`Invalid input: expected ${c.expected}, received ${(a=>{let b=typeof a;switch(b){case"number":return Number.isNaN(a)?"NaN":"number";case"object":if(Array.isArray(a))return"array";if(null===a)return"null";if(Object.getPrototypeOf(a)!==Object.prototype&&a.constructor)return a.constructor.name}return b})(c.input)}`;case"invalid_value":if(1===c.values.length)return`Invalid input: expected ${C(c.values[0])}`;return`Invalid option: expected one of ${k(c.values,"|")}`;case"too_big":{let b=c.inclusive?"<=":"<",d=a[c.origin]??null;if(d)return`Too big: expected ${c.origin??"value"} to have ${b}${c.maximum.toString()} ${d.unit??"elements"}`;return`Too big: expected ${c.origin??"value"} to be ${b}${c.maximum.toString()}`}case"too_small":{let b=c.inclusive?">=":">",d=a[c.origin]??null;if(d)return`Too small: expected ${c.origin} to have ${b}${c.minimum.toString()} ${d.unit}`;return`Too small: expected ${c.origin} to be ${b}${c.minimum.toString()}`}case"invalid_format":if("starts_with"===c.format)return`Invalid string: must start with "${c.prefix}"`;if("ends_with"===c.format)return`Invalid string: must end with "${c.suffix}"`;if("includes"===c.format)return`Invalid string: must include "${c.includes}"`;if("regex"===c.format)return`Invalid string: must match pattern ${c.pattern}`;return`Invalid ${b[c.format]??c.format}`;case"not_multiple_of":return`Invalid number: must be a multiple of ${c.divisor}`;case"unrecognized_keys":return`Unrecognized key${c.keys.length>1?"s":""}: ${k(c.keys,", ")}`;case"invalid_key":return`Invalid key in ${c.origin}`;case"invalid_union":default:return"Invalid input";case"invalid_element":return`Invalid value in ${c.origin}`}}})()})},47467:(a,b,c)=>{c.d(b,{o:()=>e});var d=c(60353);let e=(0,d.CN)({is:a=>"InsertQueryNode"===a.kind,create:(a,b,c)=>(0,d.CN)({kind:"InsertQueryNode",into:a,...b&&{with:b},replace:c}),createWithoutInto:()=>(0,d.CN)({kind:"InsertQueryNode"}),cloneWith:(a,b)=>(0,d.CN)({...a,...b})})},47777:(a,b,c)=>{c.d(b,{O:()=>e});var d=c(60353);let e=(0,d.CN)({is:a=>"OrderByNode"===a.kind,create:a=>(0,d.CN)({kind:"OrderByNode",items:(0,d.CN)([...a])}),cloneWithItems:(a,b)=>(0,d.CN)({...a,items:(0,d.CN)([...a.items,...b])})})},48026:(a,b,c)=>{c.d(b,{g:()=>d});let d=a=>{let b=(a.plugins??[]).reduce((a,b)=>{let c=b.schema;if(!c)return a;for(let[b,d]of Object.entries(c))a[b]={fields:{...a[b]?.fields,...d.fields},modelName:d.modelName||b};return a},{}),c=a.rateLimit?.storage==="database",d={rateLimit:{modelName:a.rateLimit?.modelName||"rateLimit",fields:{key:{type:"string",fieldName:a.rateLimit?.fields?.key||"key"},count:{type:"number",fieldName:a.rateLimit?.fields?.count||"count"},lastRequest:{type:"number",bigint:!0,fieldName:a.rateLimit?.fields?.lastRequest||"lastRequest"}}}},{user:e,session:f,account:g,...h}=b,i={session:{modelName:a.session?.modelName||"session",fields:{expiresAt:{type:"date",required:!0,fieldName:a.session?.fields?.expiresAt||"expiresAt"},token:{type:"string",required:!0,fieldName:a.session?.fields?.token||"token",unique:!0},createdAt:{type:"date",required:!0,fieldName:a.session?.fields?.createdAt||"createdAt",defaultValue:()=>new Date},updatedAt:{type:"date",required:!0,fieldName:a.session?.fields?.updatedAt||"updatedAt",onUpdate:()=>new Date},ipAddress:{type:"string",required:!1,fieldName:a.session?.fields?.ipAddress||"ipAddress"},userAgent:{type:"string",required:!1,fieldName:a.session?.fields?.userAgent||"userAgent"},userId:{type:"string",fieldName:a.session?.fields?.userId||"userId",references:{model:a.user?.modelName||"user",field:"id",onDelete:"cascade"},required:!0},...f?.fields,...a.session?.additionalFields},order:2}};return{user:{modelName:a.user?.modelName||"user",fields:{name:{type:"string",required:!0,fieldName:a.user?.fields?.name||"name",sortable:!0},email:{type:"string",unique:!0,required:!0,fieldName:a.user?.fields?.email||"email",sortable:!0},emailVerified:{type:"boolean",defaultValue:!1,required:!0,fieldName:a.user?.fields?.emailVerified||"emailVerified"},image:{type:"string",required:!1,fieldName:a.user?.fields?.image||"image"},createdAt:{type:"date",defaultValue:()=>new Date,required:!0,fieldName:a.user?.fields?.createdAt||"createdAt"},updatedAt:{type:"date",defaultValue:()=>new Date,onUpdate:()=>new Date,required:!0,fieldName:a.user?.fields?.updatedAt||"updatedAt"},...e?.fields,...a.user?.additionalFields},order:1},...!a.secondaryStorage||a.session?.storeSessionInDatabase?i:{},account:{modelName:a.account?.modelName||"account",fields:{accountId:{type:"string",required:!0,fieldName:a.account?.fields?.accountId||"accountId"},providerId:{type:"string",required:!0,fieldName:a.account?.fields?.providerId||"providerId"},userId:{type:"string",references:{model:a.user?.modelName||"user",field:"id",onDelete:"cascade"},required:!0,fieldName:a.account?.fields?.userId||"userId"},accessToken:{type:"string",required:!1,fieldName:a.account?.fields?.accessToken||"accessToken"},refreshToken:{type:"string",required:!1,fieldName:a.account?.fields?.refreshToken||"refreshToken"},idToken:{type:"string",required:!1,fieldName:a.account?.fields?.idToken||"idToken"},accessTokenExpiresAt:{type:"date",required:!1,fieldName:a.account?.fields?.accessTokenExpiresAt||"accessTokenExpiresAt"},refreshTokenExpiresAt:{type:"date",required:!1,fieldName:a.account?.fields?.refreshTokenExpiresAt||"refreshTokenExpiresAt"},scope:{type:"string",required:!1,fieldName:a.account?.fields?.scope||"scope"},password:{type:"string",required:!1,fieldName:a.account?.fields?.password||"password"},createdAt:{type:"date",required:!0,fieldName:a.account?.fields?.createdAt||"createdAt",defaultValue:()=>new Date},updatedAt:{type:"date",required:!0,fieldName:a.account?.fields?.updatedAt||"updatedAt",onUpdate:()=>new Date},...g?.fields,...a.account?.additionalFields},order:3},verification:{modelName:a.verification?.modelName||"verification",fields:{identifier:{type:"string",required:!0,fieldName:a.verification?.fields?.identifier||"identifier"},value:{type:"string",required:!0,fieldName:a.verification?.fields?.value||"value"},expiresAt:{type:"date",required:!0,fieldName:a.verification?.fields?.expiresAt||"expiresAt"},createdAt:{type:"date",required:!0,defaultValue:()=>new Date,fieldName:a.verification?.fields?.createdAt||"createdAt"},updatedAt:{type:"date",required:!0,defaultValue:()=>new Date,onUpdate:()=>new Date,fieldName:a.verification?.fields?.updatedAt||"updatedAt"}},order:4},...h,...c?d:{}}}},48137:(a,b,c)=>{c.d(b,{G:()=>f});var d=c(37381),e=c(60353);async function f(a){let b=new d.c,c=new d.c;return a.provideConnection(async a=>(b.resolve(a),await c.promise)).catch(a=>b.reject(a)),(0,e.CN)({connection:await b.promise,release:c.resolve})}},48560:(a,b,c)=>{c.d(b,{M3:()=>g,W2:()=>f,ll:()=>e,t9:()=>h});var d=c(65145);function e(a){return(0,d.A)(a)&&"string"==typeof a.kty}function f(a){return"oct"!==a.kty&&("AKP"===a.kty&&"string"==typeof a.priv||"string"==typeof a.d)}function g(a){return"oct"!==a.kty&&void 0===a.d&&void 0===a.priv}function h(a){return"oct"===a.kty&&"string"==typeof a.k}},48623:(a,b,c)=>{c.d(b,{A:()=>e});var d=c(90009);let e=async a=>{if(!a.alg)throw TypeError('"alg" argument is required when "jwk.alg" is not present');let{algorithm:b,keyUsages:c}=function(a){let b,c;switch(a.kty){case"AKP":switch(a.alg){case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":b={name:a.alg},c=a.priv?["sign"]:["verify"];break;default:throw new d.T0('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"RSA":switch(a.alg){case"PS256":case"PS384":case"PS512":b={name:"RSA-PSS",hash:`SHA-${a.alg.slice(-3)}`},c=a.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":b={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${a.alg.slice(-3)}`},c=a.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":b={name:"RSA-OAEP",hash:`SHA-${parseInt(a.alg.slice(-3),10)||1}`},c=a.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new d.T0('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"EC":switch(a.alg){case"ES256":b={name:"ECDSA",namedCurve:"P-256"},c=a.d?["sign"]:["verify"];break;case"ES384":b={name:"ECDSA",namedCurve:"P-384"},c=a.d?["sign"]:["verify"];break;case"ES512":b={name:"ECDSA",namedCurve:"P-521"},c=a.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":b={name:"ECDH",namedCurve:a.crv},c=a.d?["deriveBits"]:[];break;default:throw new d.T0('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"OKP":switch(a.alg){case"Ed25519":case"EdDSA":b={name:"Ed25519"},c=a.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":b={name:a.crv},c=a.d?["deriveBits"]:[];break;default:throw new d.T0('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;default:throw new d.T0('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:b,keyUsages:c}}(a),e={...a};return"AKP"!==e.kty&&delete e.alg,delete e.use,crypto.subtle.importKey("jwk",e,b,a.ext??(!a.d&&!a.priv),a.key_ops??c)}},49374:(a,b,c)=>{c.d(b,{q:()=>f});var d=c(9005),e=c(60353);let f=(0,e.CN)({is:a=>"ReferenceNode"===a.kind,create:(a,b)=>(0,e.CN)({kind:"ReferenceNode",table:b,column:a}),createSelectAll:a=>(0,e.CN)({kind:"ReferenceNode",table:a,column:d.U.create()})})},51067:(a,b,c)=>{c.d(b,{g:()=>e});var d=c(94285);let e=a=>(0,d.q)("a-z","A-Z","0-9")(a||32)},51591:(a,b,c)=>{c.d(b,{a:()=>h});var d=c(17793),e=c(53284),f=c(71088),g=c(19795);function h(a,b){var c,h,i,j,k,l,m,n;if(3===b.length){return c=a,h=b[0],i=b[1],j=b[2],d.b.createWithOn(c,(0,g.uJ)(h),(0,e.vC)(i,"=",j))}if(2===b.length){return k=a,l=b[0],(0,b[1])((0,f.GQ)(k,l)).toOperationNode()}if(1===b.length){return m=a,n=b[0],d.b.create(m,(0,g.uJ)(n))}throw Error("not implemented")}},52436:(a,b,c)=>{c.d(b,{A:()=>e});var d=c(90009);let e=(a,b,c,e,f)=>{let g;if(void 0!==f.crit&&e?.crit===void 0)throw new a('"crit" (Critical) Header Parameter MUST be integrity protected');if(!e||void 0===e.crit)return new Set;if(!Array.isArray(e.crit)||0===e.crit.length||e.crit.some(a=>"string"!=typeof a||0===a.length))throw new a('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');for(let h of(g=void 0!==c?new Map([...Object.entries(c),...b.entries()]):b,e.crit)){if(!g.has(h))throw new d.T0(`Extension Header Parameter "${h}" is not recognized`);if(void 0===f[h])throw new a(`Extension Header Parameter "${h}" is missing`);if(g.get(h)&&void 0===e[h])throw new a(`Extension Header Parameter "${h}" MUST be integrity protected`)}return new Set(e.crit)}},52628:(a,b,c)=>{c.d(b,{D:()=>e,l:()=>f});var d=c(81671);function e(a){if(Uint8Array.fromBase64)return Uint8Array.fromBase64("string"==typeof a?a:d.D0.decode(a),{alphabet:"base64url"});let b=a;b instanceof Uint8Array&&(b=d.D0.decode(b)),b=b.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{var c=b;if(Uint8Array.fromBase64)return Uint8Array.fromBase64(c);let a=atob(c),d=new Uint8Array(a.length);for(let b=0;b<a.length;b++)d[b]=a.charCodeAt(b);return d}catch{throw TypeError("The input to be decoded is not correctly encoded.")}}function f(a){let b=a;return("string"==typeof b&&(b=d.Rd.encode(b)),Uint8Array.prototype.toBase64)?b.toBase64({alphabet:"base64url",omitPadding:!0}):(function(a){if(Uint8Array.prototype.toBase64)return a.toBase64();let b=[];for(let c=0;c<a.length;c+=32768)b.push(String.fromCharCode.apply(null,a.subarray(c,c+32768)));return btoa(b.join(""))})(b).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}},53284:(a,b,c)=>{c.d(b,{GB:()=>n,KN:()=>r,Ve:()=>q,ds:()=>o,vC:()=>p});var d=c(56112),e=c(60353),f=c(39450),g=c(40659),h=c(2952),i=c(82324),j=c(90350),k=c(55914),l=c(94296),m=c(28244);function n(a){if(3===a.length)return o(a[0],a[1],a[2]);if(1===a.length)return(0,i.$s)(a[0]);throw Error(`invalid arguments: ${JSON.stringify(a)}`)}function o(a,b,c){var e;return("is"===(e=b)||"is not"===e)&&s(c)?d.l.create((0,h.$O)(a),t(b),j.q.createImmediate(c)):d.l.create((0,h.$O)(a),t(b),(0,i.U2)(c))}function p(a,b,c){return d.l.create((0,h.$O)(a),t(b),(0,h.$O)(c))}function q(a,b){return r(Object.entries(a).filter(([,a])=>!(0,e.b0)(a)).map(([a,b])=>o(a,s(b)?"is":"=",b)),b)}function r(a,b,c=!0){let e="and"===b?k.s.create:m.K.create;if(0===a.length)return d.l.create(j.q.createImmediate(1),g.zX.create("="),j.q.createImmediate(+("and"===b)));let f=u(a[0]);for(let b=1;b<a.length;++b)f=e(f,u(a[b]));return a.length>1&&c?l.k.create(f):f}function s(a){return(0,e.kZ)(a)||(0,e.Lm)(a)}function t(a){if((0,e.Kg)(a)&&g.we.includes(a))return g.zX.create(a);if((0,f.N)(a))return a.toOperationNode();throw Error(`invalid operator ${JSON.stringify(a)}`)}function u(a){return(0,f.N)(a)?a.toOperationNode():a}},54315:(a,b,c)=>{c.d(b,{h:()=>e});var d=c(60353);let e=(0,d.CN)({is:a=>"PrimitiveValueListNode"===a.kind,create:a=>(0,d.CN)({kind:"PrimitiveValueListNode",values:(0,d.CN)([...a])})})},54744:(a,b,c)=>{c.d(b,{o:()=>g});var d=c(60353),e=c(55914),f=c(28244);let g=(0,d.CN)({is:a=>"WhereNode"===a.kind,create:a=>(0,d.CN)({kind:"WhereNode",where:a}),cloneWithOperation:(a,b,c)=>(0,d.CN)({...a,where:"And"===b?e.s.create(a.where,c):f.K.create(a.where,c)})})},55220:(a,b,c)=>{c.d(b,{Er:()=>aU,VH:()=>aR,FA:()=>aQ,zp:()=>aX,vX:()=>aW,BE:()=>aV});var d=c(69744);function e(a){if("boolean"!=typeof a)throw Error(`boolean expected, not ${a}`)}function f(a){if(!Number.isSafeInteger(a)||a<0)throw Error("positive integer expected, got "+a)}function g(a,b,c=""){let d=a instanceof Uint8Array||ArrayBuffer.isView(a)&&"Uint8Array"===a.constructor.name,e=a?.length,f=void 0!==b;if(!d||f&&e!==b)throw Error((c&&`"${c}" `)+"expected Uint8Array"+(f?` of length ${b}`:"")+", got "+(d?`length=${e}`:`type=${typeof a}`));return a}function h(a,b=!0){if(a.destroyed)throw Error("Hash instance has been destroyed");if(b&&a.finished)throw Error("Hash#digest() has already been called")}function i(a){return new Uint32Array(a.buffer,a.byteOffset,Math.floor(a.byteLength/4))}function j(...a){for(let b=0;b<a.length;b++)a[b].fill(0)}let k=68===new Uint8Array(new Uint32Array([0x11223344]).buffer)[0],l="function"==typeof Uint8Array.from([]).toHex&&"function"==typeof Uint8Array.fromHex,m=Array.from({length:256},(a,b)=>b.toString(16).padStart(2,"0")),n={_0:48,_9:57,A:65,F:70,a:97,f:102};function o(a){return a>=n._0&&a<=n._9?a-n._0:a>=n.A&&a<=n.F?a-(n.A-10):a>=n.a&&a<=n.f?a-(n.a-10):void 0}function p(a,b,c=!0){if(void 0===b)return new Uint8Array(a);if(b.length!==a)throw Error('"output" expected Uint8Array of length '+a+", got: "+b.length);if(c&&b.byteOffset%4!=0)throw Error("invalid output, must be aligned");return b}function q(a){return Uint8Array.from(a)}function r(a=32){let b="object"==typeof globalThis?globalThis.crypto:null;if("function"!=typeof b?.getRandomValues)throw Error("crypto.getRandomValues must be defined");return b.getRandomValues(new Uint8Array(a))}function s(a,b=r){let{nonceLength:c}=a;f(c);let d=(a,b)=>{let c=function(...a){let b=0;for(let c=0;c<a.length;c++){let d=a[c];g(d),b+=d.length}let c=new Uint8Array(b);for(let b=0,d=0;b<a.length;b++){let e=a[b];c.set(e,d),d+=e.length}return c}(a,b);return b.fill(0),c};return(e,...f)=>({encrypt(h){g(h);let i=b(c),j=a(e,i,...f).encrypt(h);return j instanceof Promise?j.then(a=>d(i,a)):d(i,j)},decrypt(b){g(b);let d=b.subarray(0,c),h=b.subarray(c);return a(e,d,...f).decrypt(h)}})}let t=a=>Uint8Array.from(a.split(""),a=>a.charCodeAt(0)),u=t("expand 16-byte k"),v=t("expand 32-byte k"),w=i(u),x=i(v);function y(a,b){return a<<b|a>>>32-b}function z(a){return a.byteOffset%4==0}let A=0x100000000-1,B=Uint32Array.of();function C(a,b){let{allowShortKeys:c,extendNonceFn:d,counterLength:h,counterRight:k,rounds:l}=function(a,b){if(null==b||"object"!=typeof b)throw Error("options must be defined");return Object.assign(a,b)}({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},b);if("function"!=typeof a)throw Error("core must be a function");return f(h),f(l),e(k),e(c),(b,e,m,n,o=0)=>{let p,r;g(b,void 0,"key"),g(e,void 0,"nonce"),g(m,void 0,"data");let s=m.length;if(void 0===n&&(n=new Uint8Array(s)),g(n,void 0,"output"),f(o),o<0||o>=A)throw Error("arx: counter overflow");if(n.length<s)throw Error(`arx: output (${n.length}) is shorter than data (${s})`);let t=[],u=b.length;if(32===u)t.push(p=q(b)),r=x;else if(16===u&&c)(p=new Uint8Array(32)).set(b),p.set(b,16),r=w,t.push(p);else throw g(b,32,"arx key"),Error("invalid key size");z(e)||t.push(e=q(e));let v=i(p);if(d){if(24!==e.length)throw Error("arx: extended nonce must be 24 bytes");d(r,v,i(e.subarray(0,16)),v),e=e.subarray(16)}let y=16-h;if(y!==e.length)throw Error(`arx: nonce must be ${y} or 16 bytes`);if(12!==y){let a=new Uint8Array(12);a.set(e,k?0:12-e.length),e=a,t.push(e)}return!function(a,b,c,d,e,f,g,h){let j=e.length,k=new Uint8Array(64),l=i(k),m=z(e)&&z(f),n=m?i(e):B,o=m?i(f):B;for(let i=0;i<j;g++){if(a(b,c,d,l,g,h),g>=A)throw Error("arx: counter overflow");let p=Math.min(64,j-i);if(m&&64===p){let a=i/4;if(i%4!=0)throw Error("arx: invalid block position");for(let b=0,c;b<16;b++)o[c=a+b]=n[c]^l[b];i+=64;continue}for(let a=0,b;a<p;a++)f[b=i+a]=e[b]^k[a];i+=p}}(a,r,v,i(e),m,n,o,l),j(...t),n}}function D(a,b){return 255&a[b++]|(255&a[b++])<<8}class E{blockLen=16;outputLen=16;buffer=new Uint8Array(16);r=new Uint16Array(10);h=new Uint16Array(10);pad=new Uint16Array(8);pos=0;finished=!1;constructor(a){let b=D(a=q(g(a,32,"key")),0),c=D(a,2),d=D(a,4),e=D(a,6),f=D(a,8),h=D(a,10),i=D(a,12),j=D(a,14);this.r[0]=8191&b,this.r[1]=(b>>>13|c<<3)&8191,this.r[2]=(c>>>10|d<<6)&7939,this.r[3]=(d>>>7|e<<9)&8191,this.r[4]=(e>>>4|f<<12)&255,this.r[5]=f>>>1&8190,this.r[6]=(f>>>14|h<<2)&8191,this.r[7]=(h>>>11|i<<5)&8065,this.r[8]=(i>>>8|j<<8)&8191,this.r[9]=j>>>5&127;for(let b=0;b<8;b++)this.pad[b]=D(a,16+2*b)}process(a,b,c=!1){let{h:d,r:e}=this,f=e[0],g=e[1],h=e[2],i=e[3],j=e[4],k=e[5],l=e[6],m=e[7],n=e[8],o=e[9],p=D(a,b+0),q=D(a,b+2),r=D(a,b+4),s=D(a,b+6),t=D(a,b+8),u=D(a,b+10),v=D(a,b+12),w=D(a,b+14),x=d[0]+(8191&p),y=d[1]+((p>>>13|q<<3)&8191),z=d[2]+((q>>>10|r<<6)&8191),A=d[3]+((r>>>7|s<<9)&8191),B=d[4]+((s>>>4|t<<12)&8191),C=d[5]+(t>>>1&8191),E=d[6]+((t>>>14|u<<2)&8191),F=d[7]+((u>>>11|v<<5)&8191),G=d[8]+((v>>>8|w<<8)&8191),H=d[9]+(w>>>5|2048*!c),I=0,J=0+x*f+5*o*y+5*n*z+5*m*A+5*l*B;I=J>>>13,J&=8191,J+=5*k*C+5*j*E+5*i*F+5*h*G+5*g*H,I+=J>>>13,J&=8191;let K=I+x*g+y*f+5*o*z+5*n*A+5*m*B;I=K>>>13,K&=8191,K+=5*l*C+5*k*E+5*j*F+5*i*G+5*h*H,I+=K>>>13,K&=8191;let L=I+x*h+y*g+z*f+5*o*A+5*n*B;I=L>>>13,L&=8191,L+=5*m*C+5*l*E+5*k*F+5*j*G+5*i*H,I+=L>>>13,L&=8191;let M=I+x*i+y*h+z*g+A*f+5*o*B;I=M>>>13,M&=8191,M+=5*n*C+5*m*E+5*l*F+5*k*G+5*j*H,I+=M>>>13,M&=8191;let N=I+x*j+y*i+z*h+A*g+B*f;I=N>>>13,N&=8191,N+=5*o*C+5*n*E+5*m*F+5*l*G+5*k*H,I+=N>>>13,N&=8191;let O=I+x*k+y*j+z*i+A*h+B*g;I=O>>>13,O&=8191,O+=C*f+5*o*E+5*n*F+5*m*G+5*l*H,I+=O>>>13,O&=8191;let P=I+x*l+y*k+z*j+A*i+B*h;I=P>>>13,P&=8191,P+=C*g+E*f+5*o*F+5*n*G+5*m*H,I+=P>>>13,P&=8191;let Q=I+x*m+y*l+z*k+A*j+B*i;I=Q>>>13,Q&=8191,Q+=C*h+E*g+F*f+5*o*G+5*n*H,I+=Q>>>13,Q&=8191;let R=I+x*n+y*m+z*l+A*k+B*j;I=R>>>13,R&=8191,R+=C*i+E*h+F*g+G*f+5*o*H,I+=R>>>13,R&=8191;let S=I+x*o+y*n+z*m+A*l+B*k;I=S>>>13,S&=8191,S+=C*j+E*i+F*h+G*g+H*f,I+=S>>>13,S&=8191,J=8191&(I=(I=(I<<2)+I|0)+J|0),I>>>=13,K+=I,d[0]=J,d[1]=K,d[2]=L,d[3]=M,d[4]=N,d[5]=O,d[6]=P,d[7]=Q,d[8]=R,d[9]=S}finalize(){let{h:a,pad:b}=this,c=new Uint16Array(10),d=a[1]>>>13;a[1]&=8191;for(let b=2;b<10;b++)a[b]+=d,d=a[b]>>>13,a[b]&=8191;a[0]+=5*d,d=a[0]>>>13,a[0]&=8191,a[1]+=d,d=a[1]>>>13,a[1]&=8191,a[2]+=d,c[0]=a[0]+5,d=c[0]>>>13,c[0]&=8191;for(let b=1;b<10;b++)c[b]=a[b]+d,d=c[b]>>>13,c[b]&=8191;c[9]-=8192;let e=(1^d)-1;for(let a=0;a<10;a++)c[a]&=e;e=~e;for(let b=0;b<10;b++)a[b]=a[b]&e|c[b];a[0]=(a[0]|a[1]<<13)&65535,a[1]=(a[1]>>>3|a[2]<<10)&65535,a[2]=(a[2]>>>6|a[3]<<7)&65535,a[3]=(a[3]>>>9|a[4]<<4)&65535,a[4]=(a[4]>>>12|a[5]<<1|a[6]<<14)&65535,a[5]=(a[6]>>>2|a[7]<<11)&65535,a[6]=(a[7]>>>5|a[8]<<8)&65535,a[7]=(a[8]>>>8|a[9]<<5)&65535;let f=a[0]+b[0];a[0]=65535&f;for(let c=1;c<8;c++)f=(a[c]+b[c]|0)+(f>>>16)|0,a[c]=65535&f;j(c)}update(a){h(this),g(a);let{buffer:b,blockLen:c}=this,d=(a=q(a)).length;for(let e=0;e<d;){let f=Math.min(c-this.pos,d-e);if(f===c){for(;c<=d-e;e+=c)this.process(a,e);continue}b.set(a.subarray(e,e+f),this.pos),this.pos+=f,e+=f,this.pos===c&&(this.process(b,0,!1),this.pos=0)}return this}destroy(){j(this.h,this.r,this.buffer,this.pad)}digestInto(a){h(this);g(a,void 0,"output");let b=this.outputLen;if(a.length<b)throw Error("digestInto() expects output buffer of length at least "+b);this.finished=!0;let{buffer:c,h:d}=this,{pos:e}=this;if(e){for(c[e++]=1;e<16;e++)c[e]=0;this.process(c,0,!0)}this.finalize();let f=0;for(let b=0;b<8;b++)a[f++]=d[b]>>>0,a[f++]=d[b]>>>8;return a}digest(){let{buffer:a,outputLen:b}=this;this.digestInto(a);let c=a.slice(0,b);return this.destroy(),c}}let F=function(a){let b=(b,c)=>a(c).update(b).digest(),c=a(new Uint8Array(32));return b.outputLen=c.outputLen,b.blockLen=c.blockLen,b.create=b=>a(b),b}(a=>new E(a));function G(a,b,c,d,e,f=20){let g=a[0],h=a[1],i=a[2],j=a[3],k=b[0],l=b[1],m=b[2],n=b[3],o=b[4],p=b[5],q=b[6],r=b[7],s=c[0],t=c[1],u=c[2],v=g,w=h,x=i,z=j,A=k,B=l,C=m,D=n,E=o,F=p,H=q,I=r,J=e,K=s,L=t,M=u;for(let a=0;a<f;a+=2)E=E+(J=y(J^(v=v+A|0),16))|0,v=v+(A=y(A^E,12))|0,E=E+(J=y(J^v,8))|0,A=y(A^E,7),F=F+(K=y(K^(w=w+B|0),16))|0,w=w+(B=y(B^F,12))|0,F=F+(K=y(K^w,8))|0,B=y(B^F,7),H=H+(L=y(L^(x=x+C|0),16))|0,x=x+(C=y(C^H,12))|0,H=H+(L=y(L^x,8))|0,C=y(C^H,7),I=I+(M=y(M^(z=z+D|0),16))|0,z=z+(D=y(D^I,12))|0,I=I+(M=y(M^z,8))|0,D=y(D^I,7),H=H+(M=y(M^(v=v+B|0),16))|0,v=v+(B=y(B^H,12))|0,H=H+(M=y(M^v,8))|0,B=y(B^H,7),I=I+(J=y(J^(w=w+C|0),16))|0,w=w+(C=y(C^I,12))|0,I=I+(J=y(J^w,8))|0,C=y(C^I,7),E=E+(K=y(K^(x=x+D|0),16))|0,x=x+(D=y(D^E,12))|0,E=E+(K=y(K^x,8))|0,D=y(D^E,7),F=F+(L=y(L^(z=z+A|0),16))|0,z=z+(A=y(A^F,12))|0,F=F+(L=y(L^z,8))|0,A=y(A^F,7);let N=0;d[N++]=g+v|0,d[N++]=h+w|0,d[N++]=i+x|0,d[N++]=j+z|0,d[N++]=k+A|0,d[N++]=l+B|0,d[N++]=m+C|0,d[N++]=n+D|0,d[N++]=o+E|0,d[N++]=p+F|0,d[N++]=q+H|0,d[N++]=r+I|0,d[N++]=e+J|0,d[N++]=s+K|0,d[N++]=t+L|0,d[N++]=u+M|0}let H=C(G,{counterRight:!1,counterLength:4,allowShortKeys:!1}),I=C(G,{counterRight:!1,counterLength:8,extendNonceFn:function(a,b,c,d){let e=a[0],f=a[1],g=a[2],h=a[3],i=b[0],j=b[1],k=b[2],l=b[3],m=b[4],n=b[5],o=b[6],p=b[7],q=c[0],r=c[1],s=c[2],t=c[3];for(let a=0;a<20;a+=2)m=m+(q=y(q^(e=e+i|0),16))|0,e=e+(i=y(i^m,12))|0,m=m+(q=y(q^e,8))|0,i=y(i^m,7),n=n+(r=y(r^(f=f+j|0),16))|0,f=f+(j=y(j^n,12))|0,n=n+(r=y(r^f,8))|0,j=y(j^n,7),o=o+(s=y(s^(g=g+k|0),16))|0,g=g+(k=y(k^o,12))|0,o=o+(s=y(s^g,8))|0,k=y(k^o,7),p=p+(t=y(t^(h=h+l|0),16))|0,h=h+(l=y(l^p,12))|0,p=p+(t=y(t^h,8))|0,l=y(l^p,7),o=o+(t=y(t^(e=e+j|0),16))|0,e=e+(j=y(j^o,12))|0,o=o+(t=y(t^e,8))|0,j=y(j^o,7),p=p+(q=y(q^(f=f+k|0),16))|0,f=f+(k=y(k^p,12))|0,p=p+(q=y(q^f,8))|0,k=y(k^p,7),m=m+(r=y(r^(g=g+l|0),16))|0,g=g+(l=y(l^m,12))|0,m=m+(r=y(r^g,8))|0,l=y(l^m,7),n=n+(s=y(s^(h=h+i|0),16))|0,h=h+(i=y(i^n,12))|0,n=n+(s=y(s^h,8))|0,i=y(i^n,7);let u=0;d[u++]=e,d[u++]=f,d[u++]=g,d[u++]=h,d[u++]=q,d[u++]=r,d[u++]=s,d[u++]=t},allowShortKeys:!1}),J=new Uint8Array(16),K=(a,b)=>{a.update(b);let c=b.length%16;c&&a.update(J.subarray(c))},L=new Uint8Array(32);function M(a,b,c,d,f){void 0!==f&&g(f,void 0,"AAD");let h=a(b,c,L),i=function(a,b,c){e(c);let d=new Uint8Array(16),f=new DataView(d.buffer,d.byteOffset,d.byteLength);return f.setBigUint64(0,BigInt(b),c),f.setBigUint64(8,BigInt(a),c),d}(d.length,f?f.length:0,!0),k=F.create(h);f&&K(k,f),K(k,d),k.update(i);let l=k.digest();return j(h,i),l}let N=a=>(b,c,d)=>({encrypt(e,f){let g=e.length;(f=p(g+16,f,!1)).set(e);let h=f.subarray(0,-16);a(b,c,h,h,1);let i=M(a,b,c,h,d);return f.set(i,g),j(i),f},decrypt(e,f){f=p(e.length-16,f,!1);let g=e.subarray(0,-16),h=e.subarray(-16),i=M(a,b,c,g,d);if(!function(a,b){if(a.length!==b.length)return!1;let c=0;for(let d=0;d<a.length;d++)c|=a[d]^b[d];return 0===c}(h,i))throw Error("invalid tag");return f.set(e.subarray(0,-16)),a(b,c,f,f,1),j(i),f}});N(H);let O=((a,b)=>{function c(d,...e){if(g(d,void 0,"key"),!k)throw Error("Non little-endian hardware is not yet supported");void 0!==a.nonceLength&&g(e[0],a.varSizeNonce?void 0:a.nonceLength,"nonce");let f=a.tagLength;f&&void 0!==e[1]&&g(e[1],void 0,"AAD");let h=b(d,...e),i=(a,b)=>{if(void 0!==b){if(2!==a)throw Error("cipher output not supported");g(b,void 0,"output")}},j=!1;return{encrypt(a,b){if(j)throw Error("cannot encrypt() twice with same key + nonce");return j=!0,g(a),i(h.encrypt.length,b),h.encrypt(a,b)},decrypt(a,b){if(g(a),f&&a.length<f)throw Error('"ciphertext" expected length bigger than tagLength='+f);return i(h.decrypt.length,b),h.decrypt(a,b)}}}return Object.assign(c,a),c})({blockSize:64,nonceLength:24,tagLength:16},N(I));var P=c(5109),Q=c(52628),R=c(89961),S=c(93226),T=c(5091);let U=async(a,b,c)=>{let d=await (0,T.A)(a,b,"sign");return(0,S.A)(a,d),new Uint8Array(await crypto.subtle.sign((0,R.A)(a,d.algorithm),d,c))};var V=c(96370),W=c(90009),X=c(81671),Y=c(83514),Z=c(52436),$=c(84108);class _{#aM;#aN;#aO;constructor(a){if(!(a instanceof Uint8Array))throw TypeError("payload must be an instance of Uint8Array");this.#aM=a}setProtectedHeader(a){if(this.#aN)throw TypeError("setProtectedHeader can only be called once");return this.#aN=a,this}setUnprotectedHeader(a){if(this.#aO)throw TypeError("setUnprotectedHeader can only be called once");return this.#aO=a,this}async sign(a,b){let c;if(!this.#aN&&!this.#aO)throw new W.Ye("either setProtectedHeader or setUnprotectedHeader must be called before #sign()");if(!(0,V.A)(this.#aN,this.#aO))throw new W.Ye("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let d={...this.#aN,...this.#aO},e=(0,Z.A)(W.Ye,new Map([["b64",!0]]),b?.crit,this.#aN,d),f=!0;if(e.has("b64")&&"boolean"!=typeof(f=this.#aN.b64))throw new W.Ye('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:g}=d;if("string"!=typeof g||!g)throw new W.Ye('JWS "alg" (Algorithm) Header Parameter missing or invalid');(0,Y.A)(g,a,"sign");let h=this.#aM;f&&(h=X.Rd.encode((0,Q.l)(h))),c=this.#aN?X.Rd.encode((0,Q.l)(JSON.stringify(this.#aN))):X.Rd.encode("");let i=(0,X.xW)(c,X.Rd.encode("."),h),j=await (0,$.A)(a,g),k=await U(g,j,i),l={signature:(0,Q.l)(k),payload:""};return f&&(l.payload=X.D0.decode(h)),this.#aO&&(l.header=this.#aO),this.#aN&&(l.protected=X.D0.decode(c)),l}}class aa{#aP;constructor(a){this.#aP=new _(a)}setProtectedHeader(a){return this.#aP.setProtectedHeader(a),this}async sign(a,b){let c=await this.#aP.sign(a,b);if(void 0===c.payload)throw TypeError("use the flattened module for creating JWS with b64: false");return`${c.protected}.${c.payload}.${c.signature}`}}var ab=c(85256);class ac{#aN;#aQ;constructor(a={}){this.#aQ=new ab.c(a)}setIssuer(a){return this.#aQ.iss=a,this}setSubject(a){return this.#aQ.sub=a,this}setAudience(a){return this.#aQ.aud=a,this}setJti(a){return this.#aQ.jti=a,this}setNotBefore(a){return this.#aQ.nbf=a,this}setExpirationTime(a){return this.#aQ.exp=a,this}setIssuedAt(a){return this.#aQ.iat=a,this}setProtectedHeader(a){return this.#aN=a,this}async sign(a,b){let c=new aa(this.#aQ.data());if(c.setProtectedHeader(this.#aN),Array.isArray(this.#aN?.crit)&&this.#aN.crit.includes("b64")&&!1===this.#aN.b64)throw new W.Dp("JWTs MUST NOT use unencoded payload");return c.sign(a,b)}}function ad(a,b=""){if(!Number.isSafeInteger(a)||a<0){let c=b&&`"${b}" `;throw Error(`${c}expected integer >= 0, got ${a}`)}}function ae(a,b,c=""){let d=a instanceof Uint8Array||ArrayBuffer.isView(a)&&"Uint8Array"===a.constructor.name,e=a?.length,f=void 0!==b;if(!d||f&&e!==b)throw Error((c&&`"${c}" `)+"expected Uint8Array"+(f?` of length ${b}`:"")+", got "+(d?`length=${e}`:`type=${typeof a}`));return a}function af(a){if("function"!=typeof a||"function"!=typeof a.create)throw Error("Hash must wrapped by utils.createHasher");ad(a.outputLen),ad(a.blockLen)}function ag(a,b=!0){if(a.destroyed)throw Error("Hash instance has been destroyed");if(b&&a.finished)throw Error("Hash#digest() has already been called")}function ah(a){return new Uint32Array(a.buffer,a.byteOffset,Math.floor(a.byteLength/4))}function ai(...a){for(let b=0;b<a.length;b++)a[b].fill(0)}function aj(a){return new DataView(a.buffer,a.byteOffset,a.byteLength)}function ak(a,b){return a<<32-b|a>>>b}function al(a,b){return a<<b|a>>>32-b>>>0}let am=68===new Uint8Array(new Uint32Array([0x11223344]).buffer)[0]?a=>a:function(a){for(let c=0;c<a.length;c++){var b;a[c]=(b=a[c])<<24&0xff000000|b<<8&0xff0000|b>>>8&65280|b>>>24&255}return a},an="function"==typeof Uint8Array.from([]).toHex&&"function"==typeof Uint8Array.fromHex,ao={_0:48,_9:57,A:65,F:70,a:97,f:102};function ap(a){return a>=ao._0&&a<=ao._9?a-ao._0:a>=ao.A&&a<=ao.F?a-(ao.A-10):a>=ao.a&&a<=ao.f?a-(ao.a-10):void 0}let aq=async()=>{};async function ar(a,b,c){let d=Date.now();for(let e=0;e<a;e++){c(e);let a=Date.now()-d;a>=0&&a<b||(await aq(),d+=a)}}function as(a,b=""){if("string"==typeof a){if("string"!=typeof a)throw Error("string expected");return new Uint8Array(new TextEncoder().encode(a))}return ae(a,void 0,b)}function at(a,b){if(void 0!==b&&"[object Object]"!==({}).toString.call(b))throw Error("options must be object or undefined");return Object.assign(a,b)}class au{oHash;iHash;blockLen;outputLen;finished=!1;destroyed=!1;constructor(a,b){if(af(a),ae(b,void 0,"key"),this.iHash=a.create(),"function"!=typeof this.iHash.update)throw Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let c=this.blockLen,d=new Uint8Array(c);d.set(b.length>c?a.create().update(b).digest():b);for(let a=0;a<d.length;a++)d[a]^=54;this.iHash.update(d),this.oHash=a.create();for(let a=0;a<d.length;a++)d[a]^=106;this.oHash.update(d),ai(d)}update(a){return ag(this),this.iHash.update(a),this}digestInto(a){ag(this),ae(a,this.outputLen,"output"),this.finished=!0,this.iHash.digestInto(a),this.oHash.update(a),this.oHash.digestInto(a),this.destroy()}digest(){let a=new Uint8Array(this.oHash.outputLen);return this.digestInto(a),a}_cloneInto(a){a||=Object.create(Object.getPrototypeOf(this),{});let{oHash:b,iHash:c,finished:d,destroyed:e,blockLen:f,outputLen:g}=this;return a.finished=d,a.destroyed=e,a.blockLen=f,a.outputLen=g,a.oHash=b._cloneInto(a.oHash),a.iHash=c._cloneInto(a.iHash),a}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}let av=(a,b,c)=>new au(a,b).update(c).digest();function aw(a,b,c,d){var e;let f,{c:g,dkLen:h,DK:i,PRF:j,PRFSalt:k}=function(a,b,c,d){af(a);let{c:e,dkLen:f,asyncTick:g}=at({dkLen:32,asyncTick:10},d);if(ad(e,"c"),ad(f,"dkLen"),ad(g,"asyncTick"),e<1)throw Error("iterations (c) must be >= 1");let h=as(b,"password"),i=as(c,"salt"),j=new Uint8Array(f),k=av.create(a,h),l=k._cloneInto().update(i);return{c:e,dkLen:f,asyncTick:g,DK:j,PRF:k,PRFSalt:l}}(a,b,c,d),l=new Uint8Array(4),m=aj(l),n=new Uint8Array(j.outputLen);for(let a=1,b=0;b<h;a++,b+=j.outputLen){let c=i.subarray(b,b+j.outputLen);m.setInt32(0,a,!1),(f=k._cloneInto(f)).update(l).digestInto(n),c.set(n.subarray(0,c.length));for(let a=1;a<g;a++){j._cloneInto(f).update(n).digestInto(n);for(let a=0;a<c.length;a++)c[a]^=n[a]}}return e=f,j.destroy(),k.destroy(),e&&e.destroy(),ai(n),i}av.create=(a,b)=>new au(a,b);class ax{blockLen;outputLen;padOffset;isLE;buffer;view;finished=!1;length=0;pos=0;destroyed=!1;constructor(a,b,c,d){this.blockLen=a,this.outputLen=b,this.padOffset=c,this.isLE=d,this.buffer=new Uint8Array(a),this.view=aj(this.buffer)}update(a){ag(this),ae(a);let{view:b,buffer:c,blockLen:d}=this,e=a.length;for(let f=0;f<e;){let g=Math.min(d-this.pos,e-f);if(g===d){let b=aj(a);for(;d<=e-f;f+=d)this.process(b,f);continue}c.set(a.subarray(f,f+g),this.pos),this.pos+=g,f+=g,this.pos===d&&(this.process(b,0),this.pos=0)}return this.length+=a.length,this.roundClean(),this}digestInto(a){ag(this);ae(a,void 0,"digestInto() output");let b=this.outputLen;if(a.length<b)throw Error('"digestInto() output" expected to be of length >='+b);this.finished=!0;let{buffer:c,view:d,blockLen:e,isLE:f}=this,{pos:g}=this;c[g++]=128,ai(this.buffer.subarray(g)),this.padOffset>e-g&&(this.process(d,0),g=0);for(let a=g;a<e;a++)c[a]=0;d.setBigUint64(e-8,BigInt(8*this.length),f),this.process(d,0);let h=aj(a),i=this.outputLen;if(i%4)throw Error("_sha2: outputLen must be aligned to 32bit");let j=i/4,k=this.get();if(j>k.length)throw Error("_sha2: outputLen bigger than state");for(let a=0;a<j;a++)h.setUint32(4*a,k[a],f)}digest(){let{buffer:a,outputLen:b}=this;this.digestInto(a);let c=a.slice(0,b);return this.destroy(),c}_cloneInto(a){(a||=new this.constructor).set(...this.get());let{blockLen:b,buffer:c,length:d,finished:e,destroyed:f,pos:g}=this;return a.destroyed=f,a.finished=e,a.length=d,a.pos=g,d%b&&a.buffer.set(c),a}clone(){return this._cloneInto()}}let ay=Uint32Array.from([0x6a09e667,0xbb67ae85,0x3c6ef372,0xa54ff53a,0x510e527f,0x9b05688c,0x1f83d9ab,0x5be0cd19]),az=BigInt(0x100000000-1),aA=BigInt(32),aB=Uint32Array.from([0x428a2f98,0x71374491,0xb5c0fbcf,0xe9b5dba5,0x3956c25b,0x59f111f1,0x923f82a4,0xab1c5ed5,0xd807aa98,0x12835b01,0x243185be,0x550c7dc3,0x72be5d74,0x80deb1fe,0x9bdc06a7,0xc19bf174,0xe49b69c1,0xefbe4786,0xfc19dc6,0x240ca1cc,0x2de92c6f,0x4a7484aa,0x5cb0a9dc,0x76f988da,0x983e5152,0xa831c66d,0xb00327c8,0xbf597fc7,0xc6e00bf3,0xd5a79147,0x6ca6351,0x14292967,0x27b70a85,0x2e1b2138,0x4d2c6dfc,0x53380d13,0x650a7354,0x766a0abb,0x81c2c92e,0x92722c85,0xa2bfe8a1,0xa81a664b,0xc24b8b70,0xc76c51a3,0xd192e819,0xd6990624,0xf40e3585,0x106aa070,0x19a4c116,0x1e376c08,0x2748774c,0x34b0bcb5,0x391c0cb3,0x4ed8aa4a,0x5b9cca4f,0x682e6ff3,0x748f82ee,0x78a5636f,0x84c87814,0x8cc70208,0x90befffa,0xa4506ceb,0xbef9a3f7,0xc67178f2]),aC=new Uint32Array(64);class aD extends ax{constructor(a){super(64,a,8,!1)}get(){let{A:a,B:b,C:c,D:d,E:e,F:f,G:g,H:h}=this;return[a,b,c,d,e,f,g,h]}set(a,b,c,d,e,f,g,h){this.A=0|a,this.B=0|b,this.C=0|c,this.D=0|d,this.E=0|e,this.F=0|f,this.G=0|g,this.H=0|h}process(a,b){for(let c=0;c<16;c++,b+=4)aC[c]=a.getUint32(b,!1);for(let a=16;a<64;a++){let b=aC[a-15],c=aC[a-2],d=ak(b,7)^ak(b,18)^b>>>3,e=ak(c,17)^ak(c,19)^c>>>10;aC[a]=e+aC[a-7]+d+aC[a-16]|0}let{A:c,B:d,C:e,D:f,E:g,F:h,G:i,H:j}=this;for(let a=0;a<64;a++){var k,l,m,n;let b=j+(ak(g,6)^ak(g,11)^ak(g,25))+((k=g)&h^~k&i)+aB[a]+aC[a]|0,o=(ak(c,2)^ak(c,13)^ak(c,22))+((l=c)&(m=d)^l&(n=e)^m&n)|0;j=i,i=h,h=g,g=f+b|0,f=e,e=d,d=c,c=b+o|0}c=c+this.A|0,d=d+this.B|0,e=e+this.C|0,f=f+this.D|0,g=g+this.E|0,h=h+this.F|0,i=i+this.G|0,j=j+this.H|0,this.set(c,d,e,f,g,h,i,j)}roundClean(){ai(aC)}destroy(){this.set(0,0,0,0,0,0,0,0),ai(this.buffer)}}class aE extends aD{A=0|ay[0];B=0|ay[1];C=0|ay[2];D=0|ay[3];E=0|ay[4];F=0|ay[5];G=0|ay[6];H=0|ay[7];constructor(){super(32)}}let aF=function(a,b=!1){let c=a.length,d=new Uint32Array(c),e=new Uint32Array(c);for(let f=0;f<c;f++){let{h:c,l:g}=function(a,b=!1){return b?{h:Number(a&az),l:Number(a>>aA&az)}:{h:0|Number(a>>aA&az),l:0|Number(a&az)}}(a[f],b);[d[f],e[f]]=[c,g]}return[d,e]}(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(a=>BigInt(a))),aG=aF[0],aH=aF[1],aI=new Uint32Array(80),aJ=new Uint32Array(80);let aK=function(a,b={}){let c=(b,c)=>a(c).update(b).digest(),d=a(void 0);return c.outputLen=d.outputLen,c.blockLen=d.blockLen,c.create=b=>a(b),Object.assign(c,b),Object.freeze(c)}(()=>new aE,{oid:Uint8Array.from([6,9,96,134,72,1,101,3,4,2,1])});function aL(a,b,c,d,e,f){let g=a[b++]^c[d++],h=a[b++]^c[d++],i=a[b++]^c[d++],j=a[b++]^c[d++],k=a[b++]^c[d++],l=a[b++]^c[d++],m=a[b++]^c[d++],n=a[b++]^c[d++],o=a[b++]^c[d++],p=a[b++]^c[d++],q=a[b++]^c[d++],r=a[b++]^c[d++],s=a[b++]^c[d++],t=a[b++]^c[d++],u=a[b++]^c[d++],v=a[b++]^c[d++],w=g,x=h,y=i,z=j,A=k,B=l,C=m,D=n,E=o,F=p,G=q,H=r,I=s,J=t,K=u,L=v;for(let a=0;a<8;a+=2)A^=al(w+I|0,7),E^=al(A+w|0,9),I^=al(E+A|0,13),w^=al(I+E|0,18),F^=al(B+x|0,7),J^=al(F+B|0,9),x^=al(J+F|0,13),B^=al(x+J|0,18),K^=al(G+C|0,7),y^=al(K+G|0,9),C^=al(y+K|0,13),G^=al(C+y|0,18),z^=al(L+H|0,7),D^=al(z+L|0,9),H^=al(D+z|0,13),L^=al(H+D|0,18),x^=al(w+z|0,7),y^=al(x+w|0,9),z^=al(y+x|0,13),w^=al(z+y|0,18),C^=al(B+A|0,7),D^=al(C+B|0,9),A^=al(D+C|0,13),B^=al(A+D|0,18),H^=al(G+F|0,7),E^=al(H+G|0,9),F^=al(E+H|0,13),G^=al(F+E|0,18),I^=al(L+K|0,7),J^=al(I+L|0,9),K^=al(J+I|0,13),L^=al(K+J|0,18);e[f++]=g+w|0,e[f++]=h+x|0,e[f++]=i+y|0,e[f++]=j+z|0,e[f++]=k+A|0,e[f++]=l+B|0,e[f++]=m+C|0,e[f++]=n+D|0,e[f++]=o+E|0,e[f++]=p+F|0,e[f++]=q+G|0,e[f++]=r+H|0,e[f++]=s+I|0,e[f++]=t+J|0,e[f++]=u+K|0,e[f++]=v+L|0}function aM(a,b,c,d,e){let f=d+0,g=d+16*e;for(let d=0;d<16;d++)c[g+d]=a[b+(2*e-1)*16+d];for(let d=0;d<e;d++,f+=16,b+=16)aL(c,g,a,b,c,f),d>0&&(g+=16),aL(c,f,a,b+=16,c,g)}async function aN(a,b,c){let{N:d,r:e,p:f,dkLen:g,blockSize32:h,V:i,B32:j,B:k,tmp:l,blockMixCb:m,asyncTick:n}=function(a,b,c){let{N:d,r:e,p:f,dkLen:g,asyncTick:h,maxmem:i,onProgress:j}=at({dkLen:32,asyncTick:10,maxmem:0x40000400},c);if(ad(d,"N"),ad(e,"r"),ad(f,"p"),ad(g,"dkLen"),ad(h,"asyncTick"),ad(i,"maxmem"),void 0!==j&&"function"!=typeof j)throw Error("progressCb must be a function");let k=128*e,l=k/4;if(d<=1||(d&d-1)!=0||d>0x100000000)throw Error('"N" expected a power of 2, and 2^1 <= N <= 2^32');if(f<1||f>0x1fffffffe0/k)throw Error('"p" expected integer 1..((2^32 - 1) * 32) / (128 * r)');if(g<1||g>0x1fffffffe0)throw Error('"dkLen" expected integer 1..(2^32 - 1) * 32');if(k*(d+f)>i)throw Error('"maxmem" limit was hit, expected 128*r*(N+p) <= "maxmem"='+i);let m=aw(aK,a,b,{c:1,dkLen:k*f}),n=ah(m),o=ah(new Uint8Array(k*d)),p=ah(new Uint8Array(k)),q=()=>{};if(j){let a=2*d*f,b=Math.max(Math.floor(a/1e4),1),c=0;q=()=>{c++,j&&(!(c%b)||c===a)&&j(c/a)}}return{N:d,r:e,p:f,dkLen:g,blockSize32:l,V:o,B32:n,B:m,tmp:p,blockMixCb:q,asyncTick:h}}(a,b,c);am(j);for(let a=0;a<f;a++){let b=h*a;for(let a=0;a<h;a++)i[a]=j[b+a];let c=0;await ar(d-1,n,()=>{aM(i,c,i,c+=h,e),m()}),aM(i,(d-1)*h,j,b,e),m(),await ar(d,n,()=>{let a=(j[b+h-16]&d-1)>>>0;for(let c=0;c<h;c++)l[c]=j[b+c]^i[a*h+c];aM(l,0,j,b,e),m()})}am(j);let o=aw(aK,a,k,{c:1,dkLen:g});return ai(k,i,l),o}var aO=c(62767),aP=c(64515);async function aQ(a,b,c=3600){return await new ac(a).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime(Math.floor(Date.now()/1e3)+c).sign(new TextEncoder().encode(b))}async function aR(a){let b=await (0,d.n)("SHA-256").digest(a);return P.K.encode(b)}c(61287);let aS={N:16384,r:16,p:1,dkLen:64};async function aT(a,b){return await aN(a.normalize("NFKC"),b,{N:aS.N,p:aS.p,r:aS.r,dkLen:aS.dkLen,maxmem:128*aS.N*aS.r*2})}let aU=async a=>{let b=aO.u.encode(crypto.getRandomValues(new Uint8Array(16))),c=await aT(a,b);return`${b}:${aO.u.encode(c)}`},aV=async({hash:a,password:b})=>{let[c,d]=a.split(":");if(!c||!d)throw new aP.B("Invalid password hash");return function(a,b){let c=new Uint8Array(a),d=new Uint8Array(b),e=c.length^d.length,f=Math.max(c.length,d.length);for(let a=0;a<f;a++)e|=(a<c.length?c[a]:0)^(a<d.length?d[a]:0);return 0===e}(await aT(b,c),function(a){if("string"!=typeof a)throw Error("hex string expected, got "+typeof a);if(an)return Uint8Array.fromHex(a);let b=a.length,c=b/2;if(b%2)throw Error("hex string expected, got unpadded hex of length "+b);let d=new Uint8Array(c);for(let b=0,e=0;b<c;b++,e+=2){let c=ap(a.charCodeAt(e)),f=ap(a.charCodeAt(e+1));if(void 0===c||void 0===f)throw Error('hex string expected, got non-hex character "'+(a[e]+a[e+1])+'" at index '+e);d[b]=16*c+f}return d}(d))},aW=async({key:a,data:b})=>{let c=await (0,d.n)("SHA-256").digest(a),e=function(a){if("string"!=typeof a)throw Error("string expected");return new Uint8Array(new TextEncoder().encode(a))}(b);return function(a){if(g(a),l)return a.toHex();let b="";for(let c=0;c<a.length;c++)b+=m[a[c]];return b}(s(O)(new Uint8Array(c)).encrypt(e))},aX=async({key:a,data:b})=>{let c=await (0,d.n)("SHA-256").digest(a),e=function(a){if("string"!=typeof a)throw Error("hex string expected, got "+typeof a);if(l)return Uint8Array.fromHex(a);let b=a.length,c=b/2;if(b%2)throw Error("hex string expected, got unpadded hex of length "+b);let d=new Uint8Array(c);for(let b=0,e=0;b<c;b++,e+=2){let c=o(a.charCodeAt(e)),f=o(a.charCodeAt(e+1));if(void 0===c||void 0===f)throw Error('hex string expected, got non-hex character "'+(a[e]+a[e+1])+'" at index '+e);d[b]=16*c+f}return d}(b),f=s(O)(new Uint8Array(c));return new TextDecoder().decode(f.decrypt(e))}},55914:(a,b,c)=>{c.d(b,{s:()=>e});var d=c(60353);let e=(0,d.CN)({is:a=>"AndNode"===a.kind,create:(a,b)=>(0,d.CN)({kind:"AndNode",left:a,right:b})})},56112:(a,b,c)=>{c.d(b,{l:()=>e});var d=c(60353);let e=(0,d.CN)({is:a=>"BinaryOperationNode"===a.kind,create:(a,b,c)=>(0,d.CN)({kind:"BinaryOperationNode",leftOperand:a,operator:b,rightOperand:c})})},57105:(a,b,c)=>{c.d(b,{SS:()=>j,YK:()=>h,v0:()=>i});var d=c(70010),e=c(39450),f=c(39281),g=c(60353);function h(a){if((0,e.N)(a))return a.toOperationNode();if((0,g.Tn)(a))return a((0,f.A)()).toOperationNode();throw Error(`invalid expression: ${JSON.stringify(a)}`)}function i(a){if((0,e.N)(a))return a.toOperationNode();if((0,g.Tn)(a))return a((0,f.A)()).toOperationNode();throw Error(`invalid aliased expression: ${JSON.stringify(a)}`)}function j(a){return(0,d.B)(a)||(0,d.q)(a)||(0,g.Tn)(a)}},58298:(a,b,c)=>{c.d(b,{b:()=>i,d:()=>j,p:()=>h});var d=c(23427);let e=new WeakMap;function f(a,b){let c=b.fields,d={};for(let b in a){let e=c[b];if(!e){d[b]=a[b];continue}!1!==e.returned&&(d[b]=a[b])}return d}function g(a,b){e.has(a)||e.set(a,new Map);let c=e.get(a);if(c.has(b))return c.get(b);let d={..."user"===b?a.user?.additionalFields:{},..."session"===b?a.session?.additionalFields:{}};for(let c of a.plugins||[])c.schema&&c.schema[b]&&(d={...d,...c.schema[b].fields});return e.get(a).set(b,d),d}function h(a,b){return f(b,{fields:g(a,"user")})}function i(a,b){return f(b,{fields:g(a,"session")})}function j(a,b={},c){return function(a,b){let c=b.action||"create",e=b.fields,f=Object.assign(Object.create(null),null);for(let b in e){if(b in a){if(!1===e[b].input){if(e[b].defaultValue){f[b]=e[b].defaultValue;continue}if(f[b])throw new d.LG("BAD_REQUEST",{message:`${b} is not allowed to be set`});continue}if(e[b].validator?.input&&void 0!==a[b]){f[b]=e[b].validator.input.parse(a[b]);continue}if(e[b].transform?.input&&void 0!==a[b]){f[b]=e[b].transform?.input(a[b]);continue}f[b]=a[b];continue}if(e[b].defaultValue&&"create"===c){f[b]=e[b].defaultValue;continue}if(e[b].required&&"create"===c)throw new d.LG("BAD_REQUEST",{message:`${b} is required`})}return f}(b,{fields:g(a,"user"),action:c})}},60353:(a,b,c)=>{function d(a){return void 0===a||void 0===a}function e(a){return"string"==typeof a}function f(a){return"number"==typeof a}function g(a){return"boolean"==typeof a}function h(a){return null===a}function i(a){return a instanceof Date}function j(a){return"bigint"==typeof a}function k(a){return"undefined"!=typeof Buffer&&Buffer.isBuffer(a)}function l(a){return"function"==typeof a}function m(a){return"object"==typeof a&&null!==a}function n(a){return Object.freeze(a)}function o(a){return p(a)?a:[a]}function p(a){return Array.isArray(a)}function q(a){return a}c.d(b,{$P:()=>i,CN:()=>n,Et:()=>f,Gv:()=>m,Kg:()=>e,Lm:()=>g,MH:()=>p,Pe:()=>k,Tn:()=>l,_j:()=>o,b0:()=>d,kZ:()=>h,lQ:()=>q,sI:()=>j}),Object.prototype.toString},61238:(a,b,c)=>{c.d(b,{OU:()=>j});var d=c(77688),e=c(60353),f=c(69079),g=c(33423),h=c(53284),i=c(82324);class j{#G;constructor(a){this.#G=(0,e.CN)(a)}when(...a){return new k({...this.#G,node:f.P.cloneWithWhen(this.#G.node,g.t.create((0,h.GB)(a)))})}}class k{#G;constructor(a){this.#G=(0,e.CN)(a)}then(a){return new l({...this.#G,node:f.P.cloneWithThen(this.#G.node,(0,i.qH)(a)?(0,i.dJ)(a):(0,i.$s)(a))})}}class l{#G;constructor(a){this.#G=(0,e.CN)(a)}when(...a){return new k({...this.#G,node:f.P.cloneWithWhen(this.#G.node,g.t.create((0,h.GB)(a)))})}else(a){return new m({...this.#G,node:f.P.cloneWith(this.#G.node,{else:(0,i.qH)(a)?(0,i.dJ)(a):(0,i.$s)(a)})})}end(){return new d.Is(f.P.cloneWith(this.#G.node,{isStatement:!1}))}endCase(){return new d.Is(f.P.cloneWith(this.#G.node,{isStatement:!0}))}}class m{#G;constructor(a){this.#G=(0,e.CN)(a)}end(){return new d.Is(f.P.cloneWith(this.#G.node,{isStatement:!1}))}endCase(){return new d.Is(f.P.cloneWith(this.#G.node,{isStatement:!0}))}}},61287:(a,b,c)=>{c.d(b,{g:()=>d});let d=(0,c(94285).q)("a-z","0-9","A-Z","-_")},62728:(a,b,c)=>{c.d(b,{d:()=>q,O:()=>p}),c(8897),c(5109),c(37305),c(94324),c(33679);var d=c(5761);c(23427);var e=c(96843);c(4174),c(24340),c(69744),c(62767),c(61287);var f=c(46762),g=c(51067);(0,e.c)(async()=>({})),(0,e.c)({use:[e.s]},async a=>({session:a.context.session}));let h=f.YjP(),i=f.k5n(["pending","accepted","rejected","canceled"]).default("pending");f.Ikc({id:f.YjP().default(g.g),name:f.YjP(),slug:f.YjP(),logo:f.YjP().nullish().optional(),metadata:f.g1P(f.YjP(),f.L5J()).or(f.YjP().transform(a=>JSON.parse(a))).optional(),createdAt:f.p6U()}),f.Ikc({id:f.YjP().default(g.g),organizationId:f.YjP(),userId:f.auy.string(),role:h,createdAt:f.p6U().default(()=>new Date)}),f.Ikc({id:f.YjP().default(g.g),organizationId:f.YjP(),email:f.YjP(),role:h,status:i,teamId:f.YjP().nullish(),inviterId:f.YjP(),expiresAt:f.p6U()}),f.Ikc({id:f.YjP().default(g.g),name:f.YjP().min(1),organizationId:f.YjP(),createdAt:f.p6U(),updatedAt:f.p6U().optional()}),f.Ikc({id:f.YjP().default(g.g),teamId:f.YjP(),userId:f.YjP(),createdAt:f.p6U().default(()=>new Date)}),f.Ikc({id:f.YjP().default(g.g),organizationId:f.YjP(),role:f.YjP(),permission:f.g1P(f.YjP(),f.YOg(f.YjP())),createdAt:f.p6U().default(()=>new Date),updatedAt:f.p6U().optional()});let j=["admin","member","owner"];f.KCZ([f.k5n(j),f.YOg(f.k5n(j))]);var k=c(64515);function l(a){return{newRole:a=>{var b;return{authorize(a,c="AND"){let d=!1;for(let[e,f]of Object.entries(a)){let a=b[e];if(!a)return{success:!1,error:`You are not allowed to access resource: ${e}`};if(Array.isArray(f))d=f.every(b=>a.includes(b));else if("object"==typeof f)d="OR"===f.connector?f.actions.some(b=>a.includes(b)):f.actions.every(b=>a.includes(b));else throw new k.B("Invalid access control request");if(d&&"OR"===c)return{success:d};if(!d&&"AND"===c)return{success:!1,error:`unauthorized to access resource "${e}"`}}return d?{success:d}:{success:!1,error:"Not authorized"}},statements:b=a}},statements:a}}let m=l({organization:["update","delete"],member:["create","update","delete"],invitation:["create","cancel"],team:["create","update","delete"],ac:["create","read","update","delete"]});m.newRole({organization:["update"],invitation:["create","cancel"],member:["create","update","delete"],team:["create","update","delete"],ac:["create","read","update","delete"]}),m.newRole({organization:["update","delete"],member:["create","update","delete"],invitation:["create","cancel"],team:["create","update","delete"],ac:["create","read","update","delete"]}),m.newRole({organization:[],member:[],invitation:[],team:[],ac:["read"]});let n=l({user:["create","list","set-role","ban","impersonate","delete","set-password","get","update"],session:["list","revoke","delete"]});n.newRole({user:["create","list","set-role","ban","impersonate","delete","set-password","get","update"],session:["list","revoke","delete"]}),n.newRole({user:[],session:[]}),c(27320),c(55220),c(74823),c(92769),c(147),f.lqM(f.Ikc({disableCookieCache:f.zMY().meta({description:"Disable cookie cache and fetch session from database"}).or(f.YjP().transform(a=>"true"===a)).optional(),disableRefresh:f.zMY().meta({description:"Disable session refresh. Useful for checking session status, without updating the session"}).optional()})),c(58298),f.Ikc({id:f.YjP(),deviceCode:f.YjP(),userCode:f.YjP(),userId:f.YjP().optional(),expiresAt:f.p6U(),status:f.YjP(),lastPolledAt:f.p6U().optional(),pollingInterval:f.aig().optional(),clientId:f.YjP().optional(),scope:f.YjP().optional()});let o=f.IeY(a=>{try{(0,d.m)(a)}catch(a){return!1}return!0},{message:"Invalid time string format. Use formats like '30m', '5s', '1h', etc."});function p(a){let b=async b=>"handler"in a?a.handler(b):a(b);return{GET:b,POST:b}}f.Ikc({expiresIn:o.default("30m").describe("Time in seconds until the device code expires. Use formats like '30m', '5s', '1h', etc."),interval:o.default("5s").describe("Time in seconds between polling attempts. Use formats like '30m', '5s', '1h', etc."),deviceCodeLength:f.aig().int().positive().default(40).describe("Length of the device code to be generated. Default is 40 characters."),userCodeLength:f.aig().int().positive().default(8).describe("Length of the user code to be generated. Default is 8 characters."),generateDeviceCode:f.IeY(a=>"function"==typeof a,{message:"generateDeviceCode must be a function that returns a string or a promise that resolves to a string."}).optional().describe("Function to generate a device code. If not provided, a default random string generator will be used."),generateUserCode:f.IeY(a=>"function"==typeof a,{message:"generateUserCode must be a function that returns a string or a promise that resolves to a string."}).optional().describe("Function to generate a user code. If not provided, a default random string generator will be used."),validateClient:f.IeY(a=>"function"==typeof a,{message:"validateClient must be a function that returns a boolean or a promise that resolves to a boolean."}).optional().describe("Function to validate the client ID. If not provided, no validation will be performed."),onDeviceAuthRequest:f.IeY(a=>"function"==typeof a,{message:"onDeviceAuthRequest must be a function that returns void or a promise that resolves to void."}).optional().describe("Function to handle device authorization requests. If not provided, no additional actions will be taken."),schema:f.IeY(()=>!0)});let q=()=>({id:"next-cookies",hooks:{after:[{matcher:a=>!0,handler:(0,e.c)(async a=>{let b=a.context.responseHeaders;if((!("_flag"in a)||"router"!==a._flag)&&b instanceof Headers){let a,e=b?.get("set-cookie");if(!e)return;let f=(0,d.p)(e),{cookies:g}=await Promise.all([c.e(802),c.e(982)]).then(c.bind(c,86802));try{a=await g()}catch(a){if(a instanceof Error&&a.message.startsWith("`cookies` was called outside a request scope."))return;throw a}f.forEach((b,c)=>{if(!c)return;let d={sameSite:b.samesite,secure:b.secure,maxAge:b["max-age"],httpOnly:b.httponly,domain:b.domain,path:b.path};try{a.set(c,decodeURIComponent(b.value),d)}catch(a){}});return}})}]}})},62767:(a,b,c)=>{c.d(b,{u:()=>d});let d={encode:a=>{if("string"==typeof a&&(a=new TextEncoder().encode(a)),0===a.byteLength)return"";let b=new Uint8Array(a),c="";for(let a of b)c+=a.toString(16).padStart(2,"0");return c},decode:a=>{if(!a)return"";if("string"==typeof a){if(a.length%2!=0||!RegExp("^[0123456789abcdef]+$").test(a))throw Error("Invalid hexadecimal string");let b=new Uint8Array(a.length/2);for(let c=0;c<a.length;c+=2)b[c/2]=parseInt(a.slice(c,c+2),16);return new TextDecoder().decode(b)}return new TextDecoder().decode(a)}}},64515:(a,b,c)=>{c.d(b,{B:()=>d});class d extends Error{constructor(a,b){super(a),this.name="BetterAuthError",this.message=a,this.cause=b,this.stack=""}}},65145:(a,b,c)=>{c.d(b,{A:()=>d});let d=a=>{if(!function(a){return"object"==typeof a&&null!==a}(a)||"[object Object]"!==Object.prototype.toString.call(a))return!1;if(null===Object.getPrototypeOf(a))return!0;let b=a;for(;null!==Object.getPrototypeOf(b);)b=Object.getPrototypeOf(b);return Object.getPrototypeOf(a)===b}},65582:(a,b,c)=>{c.d(b,{J:()=>n,G:()=>function a(b){return(0,d.Tn)(b)?a(b((0,l.A)())):(0,d.MH)(b)?b.map(a=>m(a)):[m(b)]}});var d=c(60353),e=c(49374),f=c(9005);let g=(0,d.CN)({is:a=>"SelectionNode"===a.kind,create:a=>(0,d.CN)({kind:"SelectionNode",selection:a}),createSelectAll:()=>(0,d.CN)({kind:"SelectionNode",selection:f.U.create()}),createSelectAllFromTable:a=>(0,d.CN)({kind:"SelectionNode",selection:e.q.createSelectAll(a)})});var h=c(2952),i=c(27646),j=c(57105),k=c(19795),l=c(39281);function m(a){return(0,d.Kg)(a)?g.create((0,h.DT)(a)):(0,i.C)(a)?g.create(a.toOperationNode()):g.create((0,j.v0)(a))}function n(a){return a?Array.isArray(a)?a.map(o):[o(a)]:[g.createSelectAll()]}function o(a){if((0,d.Kg)(a))return g.createSelectAllFromTable((0,k.M$)(a));throw Error(`invalid value selectAll expression: ${JSON.stringify(a)}`)}},65966:(a,b,c)=>{c.d(b,{n:()=>an});var d=c(90423),e=c(65582),f=c(31009),g=c(54315),h=c(93159),i=c(60353),j=c(82324);let k=(0,i.CN)({is:a=>"ValuesNode"===a.kind,create:a=>(0,i.CN)({kind:"ValuesNode",values:(0,i.CN)(a)})});var l=c(57105);let m=(0,i.CN)({is:a=>"DefaultInsertValueNode"===a.kind,create:()=>(0,i.CN)({kind:"DefaultInsertValueNode"})});var n=c(39281);function o(a){let b=(0,i.Tn)(a)?a((0,n.A)()):a;var c=(0,i.MH)(b)?b:(0,i.CN)([b]);let d=function(a){let b=new Map;for(let c of a)for(let a of Object.keys(c))b.has(a)||void 0===c[a]||b.set(a,b.size);return b}(c);return[(0,i.CN)([...d.keys()].map(f.Z.create)),k.create(c.map(a=>(function(a,b){let c=Object.keys(a),d=Array.from({length:b.size}),e=!1,f=c.length;for(let g of c){let c=b.get(g);if((0,i.b0)(c)){f--;continue}let h=a[g];((0,i.b0)(h)||(0,l.SS)(h))&&(e=!0),d[c]=h}if(f<b.size||e){let a=m.create();return h.s.create(d.map(b=>(0,i.b0)(b)?a:(0,j.$s)(b)))}return g.h.create(d)})(a,d)))]}var p=c(47467),q=c(4315);let r=(0,i.CN)({is:a=>"ColumnUpdateNode"===a.kind,create:(a,b)=>(0,i.CN)({kind:"ColumnUpdateNode",column:a,value:b})});var s=c(2952);function t(a){return Object.entries((0,i.Tn)(a)?a((0,n.A)()):a).filter(([a,b])=>void 0!==b).map(([a,b])=>r.create(f.Z.create(a),(0,j.$s)(b)))}let u=(0,i.CN)({is:a=>"OnDuplicateKeyNode"===a.kind,create:a=>(0,i.CN)({kind:"OnDuplicateKeyNode",updates:a})});class v{insertId;numInsertedOrUpdatedRows;constructor(a,b){this.insertId=a,this.numInsertedOrUpdatedRows=b}}var w=c(10106),x=c(81266),y=c(54744);let z=(0,i.CN)({is:a=>"OnConflictNode"===a.kind,create:()=>(0,i.CN)({kind:"OnConflictNode"}),cloneWith:(a,b)=>(0,i.CN)({...a,...b}),cloneWithIndexWhere:(a,b)=>(0,i.CN)({...a,indexWhere:a.indexWhere?y.o.cloneWithOperation(a.indexWhere,"And",b):y.o.create(b)}),cloneWithIndexOrWhere:(a,b)=>(0,i.CN)({...a,indexWhere:a.indexWhere?y.o.cloneWithOperation(a.indexWhere,"Or",b):y.o.create(b)}),cloneWithUpdateWhere:(a,b)=>(0,i.CN)({...a,updateWhere:a.updateWhere?y.o.cloneWithOperation(a.updateWhere,"And",b):y.o.create(b)}),cloneWithUpdateOrWhere:(a,b)=>(0,i.CN)({...a,updateWhere:a.updateWhere?y.o.cloneWithOperation(a.updateWhere,"Or",b):y.o.create(b)}),cloneWithoutIndexWhere:a=>(0,i.CN)({...a,indexWhere:void 0}),cloneWithoutUpdateWhere:a=>(0,i.CN)({...a,updateWhere:void 0})});var A=c(53284);class B{#G;constructor(a){this.#G=(0,i.CN)(a)}column(a){let b=f.Z.create(a);return new B({...this.#G,onConflictNode:z.cloneWith(this.#G.onConflictNode,{columns:this.#G.onConflictNode.columns?(0,i.CN)([...this.#G.onConflictNode.columns,b]):(0,i.CN)([b])})})}columns(a){let b=a.map(f.Z.create);return new B({...this.#G,onConflictNode:z.cloneWith(this.#G.onConflictNode,{columns:this.#G.onConflictNode.columns?(0,i.CN)([...this.#G.onConflictNode.columns,...b]):(0,i.CN)(b)})})}constraint(a){return new B({...this.#G,onConflictNode:z.cloneWith(this.#G.onConflictNode,{constraint:x.O.create(a)})})}expression(a){return new B({...this.#G,onConflictNode:z.cloneWith(this.#G.onConflictNode,{indexExpression:a.toOperationNode()})})}where(...a){return new B({...this.#G,onConflictNode:z.cloneWithIndexWhere(this.#G.onConflictNode,(0,A.GB)(a))})}whereRef(a,b,c){return new B({...this.#G,onConflictNode:z.cloneWithIndexWhere(this.#G.onConflictNode,(0,A.vC)(a,b,c))})}clearWhere(){return new B({...this.#G,onConflictNode:z.cloneWithoutIndexWhere(this.#G.onConflictNode)})}doNothing(){return new C({...this.#G,onConflictNode:z.cloneWith(this.#G.onConflictNode,{doNothing:!0})})}doUpdateSet(a){return new D({...this.#G,onConflictNode:z.cloneWith(this.#G.onConflictNode,{updates:t(a)})})}$call(a){return a(this)}}class C{#G;constructor(a){this.#G=(0,i.CN)(a)}toOperationNode(){return this.#G.onConflictNode}}class D{#G;constructor(a){this.#G=(0,i.CN)(a)}where(...a){return new D({...this.#G,onConflictNode:z.cloneWithUpdateWhere(this.#G.onConflictNode,(0,A.GB)(a))})}whereRef(a,b,c){return new D({...this.#G,onConflictNode:z.cloneWithUpdateWhere(this.#G.onConflictNode,(0,A.vC)(a,b,c))})}clearWhere(){return new D({...this.#G,onConflictNode:z.cloneWithoutUpdateWhere(this.#G.onConflictNode)})}$call(a){return a(this)}toOperationNode(){return this.#G.onConflictNode}}var E=c(36903);let F=(0,i.CN)({is:a=>"OrActionNode"===a.kind,create:a=>(0,i.CN)({kind:"OrActionNode",action:a})});class G{#G;constructor(a){this.#G=(0,i.CN)(a)}values(a){let[b,c]=o(a);return new G({...this.#G,queryNode:p.o.cloneWith(this.#G.queryNode,{columns:b,values:c})})}columns(a){return new G({...this.#G,queryNode:p.o.cloneWith(this.#G.queryNode,{columns:(0,i.CN)(a.map(f.Z.create))})})}expression(a){return new G({...this.#G,queryNode:p.o.cloneWith(this.#G.queryNode,{values:(0,l.YK)(a)})})}defaultValues(){return new G({...this.#G,queryNode:p.o.cloneWith(this.#G.queryNode,{defaultValues:!0})})}modifyEnd(a){return new G({...this.#G,queryNode:q.L.cloneWithEndModifier(this.#G.queryNode,a.toOperationNode())})}ignore(){return new G({...this.#G,queryNode:p.o.cloneWith(this.#G.queryNode,{orAction:F.create("ignore")})})}orIgnore(){return new G({...this.#G,queryNode:p.o.cloneWith(this.#G.queryNode,{orAction:F.create("ignore")})})}orAbort(){return new G({...this.#G,queryNode:p.o.cloneWith(this.#G.queryNode,{orAction:F.create("abort")})})}orFail(){return new G({...this.#G,queryNode:p.o.cloneWith(this.#G.queryNode,{orAction:F.create("fail")})})}orReplace(){return new G({...this.#G,queryNode:p.o.cloneWith(this.#G.queryNode,{orAction:F.create("replace")})})}orRollback(){return new G({...this.#G,queryNode:p.o.cloneWith(this.#G.queryNode,{orAction:F.create("rollback")})})}top(a,b){return new G({...this.#G,queryNode:q.L.cloneWithTop(this.#G.queryNode,(0,E.f)(a,b))})}onConflict(a){return new G({...this.#G,queryNode:p.o.cloneWith(this.#G.queryNode,{onConflict:a(new B({onConflictNode:z.create()})).toOperationNode()})})}onDuplicateKeyUpdate(a){return new G({...this.#G,queryNode:p.o.cloneWith(this.#G.queryNode,{onDuplicateKey:u.create(t(a))})})}returning(a){return new G({...this.#G,queryNode:q.L.cloneWithReturning(this.#G.queryNode,(0,e.G)(a))})}returningAll(){return new G({...this.#G,queryNode:q.L.cloneWithReturning(this.#G.queryNode,(0,e.J)())})}output(a){return new G({...this.#G,queryNode:q.L.cloneWithOutput(this.#G.queryNode,(0,e.G)(a))})}outputAll(a){return new G({...this.#G,queryNode:q.L.cloneWithOutput(this.#G.queryNode,(0,e.J)(a))})}clearReturning(){return new G({...this.#G,queryNode:q.L.cloneWithoutReturning(this.#G.queryNode)})}$call(a){return a(this)}$if(a,b){return a?b(this):new G({...this.#G})}$castTo(){return new G(this.#G)}$narrowType(){return new G(this.#G)}$assertType(){return new G(this.#G)}withPlugin(a){return new G({...this.#G,executor:this.#G.executor.withPlugin(a)})}toOperationNode(){return this.#G.executor.transformQuery(this.#G.queryNode,this.#G.queryId)}compile(){return this.#G.executor.compileQuery(this.toOperationNode(),this.#G.queryId)}async execute(){let a=this.compile(),b=await this.#G.executor.executeQuery(a),{adapter:c}=this.#G.executor,d=a.query;return d.returning&&c.supportsReturning||d.output&&c.supportsOutput?b.rows:[new v(b.insertId,b.numAffectedRows??BigInt(0))]}async executeTakeFirst(){let[a]=await this.execute();return a}async executeTakeFirstOrThrow(a=w.F){let b=await this.executeTakeFirst();if(void 0===b)throw(0,w.x)(a)?new a(this.toOperationNode()):a(this.toOperationNode());return b}async *stream(a=100){let b=this.compile();for await(let c of this.#G.executor.stream(b,a))yield*c.rows}async explain(a,b){let c=new G({...this.#G,queryNode:q.L.cloneWithExplain(this.#G.queryNode,a,b)});return await c.execute()}}var H=c(51591),I=c(19795);class J{numDeletedRows;constructor(a){this.numDeletedRows=a}}var K=c(68228),L=c(70020),M=c(68019);class N{#G;constructor(a){this.#G=(0,i.CN)(a)}where(...a){return new N({...this.#G,queryNode:q.L.cloneWithWhere(this.#G.queryNode,(0,A.GB)(a))})}whereRef(a,b,c){return new N({...this.#G,queryNode:q.L.cloneWithWhere(this.#G.queryNode,(0,A.vC)(a,b,c))})}clearWhere(){return new N({...this.#G,queryNode:q.L.cloneWithoutWhere(this.#G.queryNode)})}top(a,b){return new N({...this.#G,queryNode:q.L.cloneWithTop(this.#G.queryNode,(0,E.f)(a,b))})}using(a){return new N({...this.#G,queryNode:K.e.cloneWithUsing(this.#G.queryNode,(0,I.JB)(a))})}innerJoin(...a){return this.#aR("InnerJoin",a)}leftJoin(...a){return this.#aR("LeftJoin",a)}rightJoin(...a){return this.#aR("RightJoin",a)}fullJoin(...a){return this.#aR("FullJoin",a)}#aR(a,b){return new N({...this.#G,queryNode:q.L.cloneWithJoin(this.#G.queryNode,(0,H.a)(a,b))})}returning(a){return new N({...this.#G,queryNode:q.L.cloneWithReturning(this.#G.queryNode,(0,e.G)(a))})}returningAll(a){return new N({...this.#G,queryNode:q.L.cloneWithReturning(this.#G.queryNode,(0,e.J)(a))})}output(a){return new N({...this.#G,queryNode:q.L.cloneWithOutput(this.#G.queryNode,(0,e.G)(a))})}outputAll(a){return new N({...this.#G,queryNode:q.L.cloneWithOutput(this.#G.queryNode,(0,e.J)(a))})}clearReturning(){return new N({...this.#G,queryNode:q.L.cloneWithoutReturning(this.#G.queryNode)})}clearLimit(){return new N({...this.#G,queryNode:K.e.cloneWithoutLimit(this.#G.queryNode)})}orderBy(...a){return new N({...this.#G,queryNode:q.L.cloneWithOrderByItems(this.#G.queryNode,(0,M.xk)(a))})}clearOrderBy(){return new N({...this.#G,queryNode:q.L.cloneWithoutOrderBy(this.#G.queryNode)})}limit(a){return new N({...this.#G,queryNode:K.e.cloneWithLimit(this.#G.queryNode,L.a.create((0,j.$s)(a)))})}modifyEnd(a){return new N({...this.#G,queryNode:q.L.cloneWithEndModifier(this.#G.queryNode,a.toOperationNode())})}$call(a){return a(this)}$if(a,b){return a?b(this):new N({...this.#G})}$castTo(){return new N(this.#G)}$narrowType(){return new N(this.#G)}$assertType(){return new N(this.#G)}withPlugin(a){return new N({...this.#G,executor:this.#G.executor.withPlugin(a)})}toOperationNode(){return this.#G.executor.transformQuery(this.#G.queryNode,this.#G.queryId)}compile(){return this.#G.executor.compileQuery(this.toOperationNode(),this.#G.queryId)}async execute(){let a=this.compile(),b=await this.#G.executor.executeQuery(a),{adapter:c}=this.#G.executor,d=a.query;return d.returning&&c.supportsReturning||d.output&&c.supportsOutput?b.rows:[new J(b.numAffectedRows??BigInt(0))]}async executeTakeFirst(){let[a]=await this.execute();return a}async executeTakeFirstOrThrow(a=w.F){let b=await this.executeTakeFirst();if(void 0===b)throw(0,w.x)(a)?new a(this.toOperationNode()):a(this.toOperationNode());return b}async *stream(a=100){let b=this.compile();for await(let c of this.#G.executor.stream(b,a))yield*c.rows}async explain(a,b){let c=new N({...this.#G,queryNode:q.L.cloneWithExplain(this.#G.queryNode,a,b)});return await c.execute()}}var O=c(93087);class P{numUpdatedRows;numChangedRows;constructor(a,b){this.numUpdatedRows=a,this.numChangedRows=b}}class Q{#G;constructor(a){this.#G=(0,i.CN)(a)}where(...a){return new Q({...this.#G,queryNode:q.L.cloneWithWhere(this.#G.queryNode,(0,A.GB)(a))})}whereRef(a,b,c){return new Q({...this.#G,queryNode:q.L.cloneWithWhere(this.#G.queryNode,(0,A.vC)(a,b,c))})}clearWhere(){return new Q({...this.#G,queryNode:q.L.cloneWithoutWhere(this.#G.queryNode)})}top(a,b){return new Q({...this.#G,queryNode:q.L.cloneWithTop(this.#G.queryNode,(0,E.f)(a,b))})}from(a){return new Q({...this.#G,queryNode:O.U.cloneWithFromItems(this.#G.queryNode,(0,I.JB)(a))})}innerJoin(...a){return this.#aR("InnerJoin",a)}leftJoin(...a){return this.#aR("LeftJoin",a)}rightJoin(...a){return this.#aR("RightJoin",a)}fullJoin(...a){return this.#aR("FullJoin",a)}#aR(a,b){return new Q({...this.#G,queryNode:q.L.cloneWithJoin(this.#G.queryNode,(0,H.a)(a,b))})}orderBy(...a){return new Q({...this.#G,queryNode:q.L.cloneWithOrderByItems(this.#G.queryNode,(0,M.xk)(a))})}clearOrderBy(){return new Q({...this.#G,queryNode:q.L.cloneWithoutOrderBy(this.#G.queryNode)})}limit(a){return new Q({...this.#G,queryNode:O.U.cloneWithLimit(this.#G.queryNode,L.a.create((0,j.$s)(a)))})}set(...a){return new Q({...this.#G,queryNode:O.U.cloneWithUpdates(this.#G.queryNode,function(...a){return 2===a.length?[r.create((0,s.$O)(a[0]),(0,j.$s)(a[1]))]:t(a[0])}(...a))})}returning(a){return new Q({...this.#G,queryNode:q.L.cloneWithReturning(this.#G.queryNode,(0,e.G)(a))})}returningAll(a){return new Q({...this.#G,queryNode:q.L.cloneWithReturning(this.#G.queryNode,(0,e.J)(a))})}output(a){return new Q({...this.#G,queryNode:q.L.cloneWithOutput(this.#G.queryNode,(0,e.G)(a))})}outputAll(a){return new Q({...this.#G,queryNode:q.L.cloneWithOutput(this.#G.queryNode,(0,e.J)(a))})}modifyEnd(a){return new Q({...this.#G,queryNode:q.L.cloneWithEndModifier(this.#G.queryNode,a.toOperationNode())})}clearReturning(){return new Q({...this.#G,queryNode:q.L.cloneWithoutReturning(this.#G.queryNode)})}$call(a){return a(this)}$if(a,b){return a?b(this):new Q({...this.#G})}$castTo(){return new Q(this.#G)}$narrowType(){return new Q(this.#G)}$assertType(){return new Q(this.#G)}withPlugin(a){return new Q({...this.#G,executor:this.#G.executor.withPlugin(a)})}toOperationNode(){return this.#G.executor.transformQuery(this.#G.queryNode,this.#G.queryId)}compile(){return this.#G.executor.compileQuery(this.toOperationNode(),this.#G.queryId)}async execute(){let a=this.compile(),b=await this.#G.executor.executeQuery(a),{adapter:c}=this.#G.executor,d=a.query;return d.returning&&c.supportsReturning||d.output&&c.supportsOutput?b.rows:[new P(b.numAffectedRows??BigInt(0),b.numChangedRows)]}async executeTakeFirst(){let[a]=await this.execute();return a}async executeTakeFirstOrThrow(a=w.F){let b=await this.executeTakeFirst();if(void 0===b)throw(0,w.x)(a)?new a(this.toOperationNode()):a(this.toOperationNode());return b}async *stream(a=100){let b=this.compile();for await(let c of this.#G.executor.stream(b,a))yield*c.rows}async explain(a,b){let c=new Q({...this.#G,queryNode:q.L.cloneWithExplain(this.#G.queryNode,a,b)});return await c.execute()}}var R=c(18804),S=c(69385);let T=(0,i.CN)({is:a=>"CommonTableExpressionNameNode"===a.kind,create:(a,b)=>(0,i.CN)({kind:"CommonTableExpressionNameNode",table:S.H.create(a),columns:b?(0,i.CN)(b.map(f.Z.create)):void 0})});var U=c(71088);let V=(0,i.CN)({is:a=>"CommonTableExpressionNode"===a.kind,create:(a,b)=>(0,i.CN)({kind:"CommonTableExpressionNode",name:a,expression:b}),cloneWith:(a,b)=>(0,i.CN)({...a,...b})});class W{#G;constructor(a){this.#G=(0,i.CN)(a)}materialized(){return new W({...this.#G,node:V.cloneWith(this.#G.node,{materialized:!0})})}notMaterialized(){return new W({...this.#G,node:V.cloneWith(this.#G.node,{materialized:!1})})}toOperationNode(){return this.#G.node}}function X(a,b){var c;let d=b((0,U.bl)()).toOperationNode();return(0,i.Tn)(a)?a((c=d,a=>new W({node:V.create(Y(a),c)}))).toOperationNode():V.create(Y(a),d)}function Y(a){if(!a.includes("("))return T.create(a);{let b=a.split(/[\(\)]/),c=b[0],d=b[1].split(",").map(a=>a.trim());return T.create(c,d)}}let Z=(0,i.CN)({is:a=>"WithNode"===a.kind,create:(a,b)=>(0,i.CN)({kind:"WithNode",expressions:(0,i.CN)([a]),...b}),cloneWithExpression:(a,b)=>(0,i.CN)({...a,expressions:(0,i.CN)([...a.expressions,b])})});var $=c(31700),_=c(19151),aa=c(24118);let ab=(0,i.CN)({is:a=>"MatchedNode"===a.kind,create:(a,b=!1)=>(0,i.CN)({kind:"MatchedNode",not:a,bySource:b})});var ac=c(39450),ad=c(31575),ae=c(33423);function af(a,b,c){return ae.t.create((0,A.KN)([ab.create(!a.isMatched,a.bySource),...b&&b.length>0?[3===b.length&&c?(0,A.vC)(b[0],b[1],b[2]):(0,A.GB)(b)]:[]],"and",!1))}function ag(a){return(0,i.Kg)(a)?ad.z.create([a],[]):(0,ac.N)(a)?a.toOperationNode():a}var ah=c(22795);class ai{numChangedRows;constructor(a){this.numChangedRows=a}}class aj{#G;constructor(a){this.#G=(0,i.CN)(a)}modifyEnd(a){return new aj({...this.#G,queryNode:q.L.cloneWithEndModifier(this.#G.queryNode,a.toOperationNode())})}top(a,b){return new aj({...this.#G,queryNode:q.L.cloneWithTop(this.#G.queryNode,(0,E.f)(a,b))})}using(...a){return new ak({...this.#G,queryNode:aa.r.cloneWithUsing(this.#G.queryNode,(0,H.a)("Using",a))})}returning(a){return new aj({...this.#G,queryNode:q.L.cloneWithReturning(this.#G.queryNode,(0,e.G)(a))})}returningAll(a){return new aj({...this.#G,queryNode:q.L.cloneWithReturning(this.#G.queryNode,(0,e.J)(a))})}output(a){return new aj({...this.#G,queryNode:q.L.cloneWithOutput(this.#G.queryNode,(0,e.G)(a))})}outputAll(a){return new aj({...this.#G,queryNode:q.L.cloneWithOutput(this.#G.queryNode,(0,e.J)(a))})}}class ak{#G;constructor(a){this.#G=(0,i.CN)(a)}modifyEnd(a){return new ak({...this.#G,queryNode:q.L.cloneWithEndModifier(this.#G.queryNode,a.toOperationNode())})}top(a,b){return new ak({...this.#G,queryNode:q.L.cloneWithTop(this.#G.queryNode,(0,E.f)(a,b))})}whenMatched(){return this.#aS([])}whenMatchedAnd(...a){return this.#aS(a)}whenMatchedAndRef(a,b,c){return this.#aS([a,b,c],!0)}#aS(a,b){return new al({...this.#G,queryNode:aa.r.cloneWithWhen(this.#G.queryNode,af({isMatched:!0},a,b))})}whenNotMatched(){return this.#aT([])}whenNotMatchedAnd(...a){return this.#aT(a)}whenNotMatchedAndRef(a,b,c){return this.#aT([a,b,c],!0)}whenNotMatchedBySource(){return this.#aT([],!1,!0)}whenNotMatchedBySourceAnd(...a){return this.#aT(a,!1,!0)}whenNotMatchedBySourceAndRef(a,b,c){return this.#aT([a,b,c],!0,!0)}returning(a){return new ak({...this.#G,queryNode:q.L.cloneWithReturning(this.#G.queryNode,(0,e.G)(a))})}returningAll(a){return new ak({...this.#G,queryNode:q.L.cloneWithReturning(this.#G.queryNode,(0,e.J)(a))})}output(a){return new ak({...this.#G,queryNode:q.L.cloneWithOutput(this.#G.queryNode,(0,e.G)(a))})}outputAll(a){return new ak({...this.#G,queryNode:q.L.cloneWithOutput(this.#G.queryNode,(0,e.J)(a))})}#aT(a,b=!1,c=!1){let d={...this.#G,queryNode:aa.r.cloneWithWhen(this.#G.queryNode,af({isMatched:!1,bySource:c},a,b))};return new(c?al:am)(d)}$call(a){return a(this)}$if(a,b){return a?b(this):new ak({...this.#G})}toOperationNode(){return this.#G.executor.transformQuery(this.#G.queryNode,this.#G.queryId)}compile(){return this.#G.executor.compileQuery(this.toOperationNode(),this.#G.queryId)}async execute(){let a=this.compile(),b=await this.#G.executor.executeQuery(a),{adapter:c}=this.#G.executor,d=a.query;return d.returning&&c.supportsReturning||d.output&&c.supportsOutput?b.rows:[new ai(b.numAffectedRows)]}async executeTakeFirst(){let[a]=await this.execute();return a}async executeTakeFirstOrThrow(a=w.F){let b=await this.executeTakeFirst();if(void 0===b)throw(0,w.x)(a)?new a(this.toOperationNode()):a(this.toOperationNode());return b}}class al{#G;constructor(a){this.#G=(0,i.CN)(a)}thenDelete(){return new ak({...this.#G,queryNode:aa.r.cloneWithThen(this.#G.queryNode,ag("delete"))})}thenDoNothing(){return new ak({...this.#G,queryNode:aa.r.cloneWithThen(this.#G.queryNode,ag("do nothing"))})}thenUpdate(a){return new ak({...this.#G,queryNode:aa.r.cloneWithThen(this.#G.queryNode,ag(a(new Q({queryId:this.#G.queryId,executor:ah.W,queryNode:O.U.createWithoutTable()}))))})}thenUpdateSet(...a){return this.thenUpdate(b=>b.set(...a))}}class am{#G;constructor(a){this.#G=(0,i.CN)(a)}thenDoNothing(){return new ak({...this.#G,queryNode:aa.r.cloneWithThen(this.#G.queryNode,ag("do nothing"))})}thenInsertValues(a){let[b,c]=o(a);return new ak({...this.#G,queryNode:aa.r.cloneWithThen(this.#G.queryNode,ag(p.o.cloneWith(p.o.createWithoutInto(),{columns:b,values:c})))})}}class an{#G;constructor(a){this.#G=(0,i.CN)(a)}selectFrom(a){return(0,d.c)({queryId:(0,$.a)(),executor:this.#G.executor,queryNode:R.L.createFrom((0,I.JB)(a),this.#G.withNode)})}selectNoFrom(a){return(0,d.c)({queryId:(0,$.a)(),executor:this.#G.executor,queryNode:R.L.cloneWithSelections(R.L.create(this.#G.withNode),(0,e.G)(a))})}insertInto(a){return new G({queryId:(0,$.a)(),executor:this.#G.executor,queryNode:p.o.create((0,I.M$)(a),this.#G.withNode)})}replaceInto(a){return new G({queryId:(0,$.a)(),executor:this.#G.executor,queryNode:p.o.create((0,I.M$)(a),this.#G.withNode,!0)})}deleteFrom(a){return new N({queryId:(0,$.a)(),executor:this.#G.executor,queryNode:K.e.create((0,I.JB)(a),this.#G.withNode)})}updateTable(a){return new Q({queryId:(0,$.a)(),executor:this.#G.executor,queryNode:O.U.create((0,I.JB)(a),this.#G.withNode)})}mergeInto(a){return new aj({queryId:(0,$.a)(),executor:this.#G.executor,queryNode:aa.r.create((0,I.Xm)(a),this.#G.withNode)})}with(a,b){let c=X(a,b);return new an({...this.#G,withNode:this.#G.withNode?Z.cloneWithExpression(this.#G.withNode,c):Z.create(c)})}withRecursive(a,b){let c=X(a,b);return new an({...this.#G,withNode:this.#G.withNode?Z.cloneWithExpression(this.#G.withNode,c):Z.create(c,{recursive:!0})})}withPlugin(a){return new an({...this.#G,executor:this.#G.executor.withPlugin(a)})}withoutPlugins(){return new an({...this.#G,executor:this.#G.executor.withoutPlugins()})}withSchema(a){return new an({...this.#G,executor:this.#G.executor.withPluginAtFront(new _.B(a))})}}},67183:(a,b,c)=>{c.d(b,{c:()=>e});var d=c(60353);let e=(0,d.CN)({is:a=>"JSONPathNode"===a.kind,create:a=>(0,d.CN)({kind:"JSONPathNode",inOperator:a,pathLegs:(0,d.CN)([])}),cloneWithLeg:(a,b)=>(0,d.CN)({...a,pathLegs:(0,d.CN)([...a.pathLegs,b])})})},68019:(a,b,c)=>{c.d(b,{bE:()=>o,xk:()=>p});var d=c(27646),e=c(70010),f=c(60353);let g=(0,f.CN)({is:a=>"OrderByItemNode"===a.kind,create:(a,b)=>(0,f.CN)({kind:"OrderByItemNode",orderBy:a,direction:b}),cloneWith:(a,b)=>(0,f.CN)({...a,...b})});var h=c(31575),i=c(81266);let j={create:a=>(0,f.CN)({kind:"CollateNode",collation:i.O.create(a)})};class k{#G;constructor(a){this.#G=(0,f.CN)(a)}desc(){return new k({node:g.cloneWith(this.#G.node,{direction:h.z.createWithSql("desc")})})}asc(){return new k({node:g.cloneWith(this.#G.node,{direction:h.z.createWithSql("asc")})})}nullsLast(){return new k({node:g.cloneWith(this.#G.node,{nulls:"last"})})}nullsFirst(){return new k({node:g.cloneWith(this.#G.node,{nulls:"first"})})}collate(a){return new k({node:g.cloneWith(this.#G.node,{collation:j.create(a)})})}toOperationNode(){return this.#G.node}}var l=c(80234),m=c(57105),n=c(2952);function o(a){return"asc"===a||"desc"===a}function p(a){if(2===a.length)return[q(a[0],a[1])];if(1===a.length){let[b]=a;return Array.isArray(b)?((0,l.u)("orderBy(array) is deprecated, use multiple orderBy calls instead."),b.map(a=>q(a))):[q(b)]}throw Error(`Invalid number of arguments at order by! expected 1-2, received ${a.length}`)}function q(a,b){let c=function(a){if((0,m.SS)(a))return(0,m.YK)(a);if((0,d.C)(a))return a.toOperationNode();let[b,c]=a.split(" ");return c?((0,l.u)("`orderBy('column asc')` is deprecated. Use `orderBy('column', 'asc')` instead."),r((0,n.q5)(b),c)):(0,n.q5)(a)}(a);if(g.is(c)){if(b)throw Error("Cannot specify direction twice!");return c}return r(c,b)}function r(a,b){if("string"==typeof b){if(!o(b))throw Error(`Invalid order by direction: ${b}`);return g.create(a,h.z.createWithSql(b))}if((0,e.B)(b))return(0,l.u)("`orderBy(..., expr)` is deprecated. Use `orderBy(..., 'asc')` or `orderBy(..., (ob) => ...)` instead."),g.create(a,b.toOperationNode());let c=g.create(a);return b?b(new k({node:c})).toOperationNode():c}},68228:(a,b,c)=>{c.d(b,{e:()=>h});var d=c(60353),e=c(75227);let f=(0,d.CN)({is:a=>"UsingNode"===a.kind,create:a=>(0,d.CN)({kind:"UsingNode",tables:(0,d.CN)(a)}),cloneWithTables:(a,b)=>(0,d.CN)({...a,tables:(0,d.CN)([...a.tables,...b])})});var g=c(4315);let h=(0,d.CN)({is:a=>"DeleteQueryNode"===a.kind,create:(a,b)=>(0,d.CN)({kind:"DeleteQueryNode",from:e.N.create(a),...b&&{with:b}}),cloneWithOrderByItems:(a,b)=>g.L.cloneWithOrderByItems(a,b),cloneWithoutOrderBy:a=>g.L.cloneWithoutOrderBy(a),cloneWithLimit:(a,b)=>(0,d.CN)({...a,limit:b}),cloneWithoutLimit:a=>(0,d.CN)({...a,limit:void 0}),cloneWithUsing:(a,b)=>(0,d.CN)({...a,using:void 0!==a.using?f.cloneWithTables(a.using,b):f.create(b)})})},68558:(a,b,c)=>{c.d(b,{n:()=>p});var d=c(93092),e=c(47467),f=c(60353);class g{nodeStack=[];get parentNode(){return this.nodeStack[this.nodeStack.length-2]}#aU=(0,f.CN)({AliasNode:this.visitAlias.bind(this),ColumnNode:this.visitColumn.bind(this),IdentifierNode:this.visitIdentifier.bind(this),SchemableIdentifierNode:this.visitSchemableIdentifier.bind(this),RawNode:this.visitRaw.bind(this),ReferenceNode:this.visitReference.bind(this),SelectQueryNode:this.visitSelectQuery.bind(this),SelectionNode:this.visitSelection.bind(this),TableNode:this.visitTable.bind(this),FromNode:this.visitFrom.bind(this),SelectAllNode:this.visitSelectAll.bind(this),AndNode:this.visitAnd.bind(this),OrNode:this.visitOr.bind(this),ValueNode:this.visitValue.bind(this),ValueListNode:this.visitValueList.bind(this),PrimitiveValueListNode:this.visitPrimitiveValueList.bind(this),ParensNode:this.visitParens.bind(this),JoinNode:this.visitJoin.bind(this),OperatorNode:this.visitOperator.bind(this),WhereNode:this.visitWhere.bind(this),InsertQueryNode:this.visitInsertQuery.bind(this),DeleteQueryNode:this.visitDeleteQuery.bind(this),ReturningNode:this.visitReturning.bind(this),CreateTableNode:this.visitCreateTable.bind(this),AddColumnNode:this.visitAddColumn.bind(this),ColumnDefinitionNode:this.visitColumnDefinition.bind(this),DropTableNode:this.visitDropTable.bind(this),DataTypeNode:this.visitDataType.bind(this),OrderByNode:this.visitOrderBy.bind(this),OrderByItemNode:this.visitOrderByItem.bind(this),GroupByNode:this.visitGroupBy.bind(this),GroupByItemNode:this.visitGroupByItem.bind(this),UpdateQueryNode:this.visitUpdateQuery.bind(this),ColumnUpdateNode:this.visitColumnUpdate.bind(this),LimitNode:this.visitLimit.bind(this),OffsetNode:this.visitOffset.bind(this),OnConflictNode:this.visitOnConflict.bind(this),OnDuplicateKeyNode:this.visitOnDuplicateKey.bind(this),CreateIndexNode:this.visitCreateIndex.bind(this),DropIndexNode:this.visitDropIndex.bind(this),ListNode:this.visitList.bind(this),PrimaryKeyConstraintNode:this.visitPrimaryKeyConstraint.bind(this),UniqueConstraintNode:this.visitUniqueConstraint.bind(this),ReferencesNode:this.visitReferences.bind(this),CheckConstraintNode:this.visitCheckConstraint.bind(this),WithNode:this.visitWith.bind(this),CommonTableExpressionNode:this.visitCommonTableExpression.bind(this),CommonTableExpressionNameNode:this.visitCommonTableExpressionName.bind(this),HavingNode:this.visitHaving.bind(this),CreateSchemaNode:this.visitCreateSchema.bind(this),DropSchemaNode:this.visitDropSchema.bind(this),AlterTableNode:this.visitAlterTable.bind(this),DropColumnNode:this.visitDropColumn.bind(this),RenameColumnNode:this.visitRenameColumn.bind(this),AlterColumnNode:this.visitAlterColumn.bind(this),ModifyColumnNode:this.visitModifyColumn.bind(this),AddConstraintNode:this.visitAddConstraint.bind(this),DropConstraintNode:this.visitDropConstraint.bind(this),RenameConstraintNode:this.visitRenameConstraint.bind(this),ForeignKeyConstraintNode:this.visitForeignKeyConstraint.bind(this),CreateViewNode:this.visitCreateView.bind(this),RefreshMaterializedViewNode:this.visitRefreshMaterializedView.bind(this),DropViewNode:this.visitDropView.bind(this),GeneratedNode:this.visitGenerated.bind(this),DefaultValueNode:this.visitDefaultValue.bind(this),OnNode:this.visitOn.bind(this),ValuesNode:this.visitValues.bind(this),SelectModifierNode:this.visitSelectModifier.bind(this),CreateTypeNode:this.visitCreateType.bind(this),DropTypeNode:this.visitDropType.bind(this),ExplainNode:this.visitExplain.bind(this),DefaultInsertValueNode:this.visitDefaultInsertValue.bind(this),AggregateFunctionNode:this.visitAggregateFunction.bind(this),OverNode:this.visitOver.bind(this),PartitionByNode:this.visitPartitionBy.bind(this),PartitionByItemNode:this.visitPartitionByItem.bind(this),SetOperationNode:this.visitSetOperation.bind(this),BinaryOperationNode:this.visitBinaryOperation.bind(this),UnaryOperationNode:this.visitUnaryOperation.bind(this),UsingNode:this.visitUsing.bind(this),FunctionNode:this.visitFunction.bind(this),CaseNode:this.visitCase.bind(this),WhenNode:this.visitWhen.bind(this),JSONReferenceNode:this.visitJSONReference.bind(this),JSONPathNode:this.visitJSONPath.bind(this),JSONPathLegNode:this.visitJSONPathLeg.bind(this),JSONOperatorChainNode:this.visitJSONOperatorChain.bind(this),TupleNode:this.visitTuple.bind(this),MergeQueryNode:this.visitMergeQuery.bind(this),MatchedNode:this.visitMatched.bind(this),AddIndexNode:this.visitAddIndex.bind(this),CastNode:this.visitCast.bind(this),FetchNode:this.visitFetch.bind(this),TopNode:this.visitTop.bind(this),OutputNode:this.visitOutput.bind(this),OrActionNode:this.visitOrAction.bind(this),CollateNode:this.visitCollate.bind(this)});visitNode=a=>{this.nodeStack.push(a),this.#aU[a.kind](a),this.nodeStack.pop()}}var h=c(40659),i=c(94296),j=c(4315),k=c(88487),l=c(90409),m=c(24118),n=c(80234);let o=/'/g;class p extends g{#aV="";#aW=[];get numParameters(){return this.#aW.length}compileQuery(a,b){return this.#aV="",this.#aW=[],this.nodeStack.splice(0,this.nodeStack.length),this.visitNode(a),(0,f.CN)({query:a,queryId:b,sql:this.getSql(),parameters:[...this.#aW]})}getSql(){return this.#aV}visitSelectQuery(a){let b=void 0!==this.parentNode&&!i.k.is(this.parentNode)&&!e.o.is(this.parentNode)&&!d.B.is(this.parentNode)&&!k.Y.is(this.parentNode)&&!l.i.is(this.parentNode);void 0===this.parentNode&&a.explain&&(this.visitNode(a.explain),this.append(" ")),b&&this.append("("),a.with&&(this.visitNode(a.with),this.append(" ")),this.append("select"),a.distinctOn&&(this.append(" "),this.compileDistinctOn(a.distinctOn)),a.frontModifiers?.length&&(this.append(" "),this.compileList(a.frontModifiers," ")),a.top&&(this.append(" "),this.visitNode(a.top)),a.selections&&(this.append(" "),this.compileList(a.selections)),a.from&&(this.append(" "),this.visitNode(a.from)),a.joins&&(this.append(" "),this.compileList(a.joins," ")),a.where&&(this.append(" "),this.visitNode(a.where)),a.groupBy&&(this.append(" "),this.visitNode(a.groupBy)),a.having&&(this.append(" "),this.visitNode(a.having)),a.setOperations&&(this.append(" "),this.compileList(a.setOperations," ")),a.orderBy&&(this.append(" "),this.visitNode(a.orderBy)),a.limit&&(this.append(" "),this.visitNode(a.limit)),a.offset&&(this.append(" "),this.visitNode(a.offset)),a.fetch&&(this.append(" "),this.visitNode(a.fetch)),a.endModifiers?.length&&(this.append(" "),this.compileList(this.sortSelectModifiers([...a.endModifiers])," ")),b&&this.append(")")}visitFrom(a){this.append("from "),this.compileList(a.froms)}visitSelection(a){this.visitNode(a.selection)}visitColumn(a){this.visitNode(a.column)}compileDistinctOn(a){this.append("distinct on ("),this.compileList(a),this.append(")")}compileList(a,b=", "){let c=a.length-1;for(let d=0;d<=c;d++)this.visitNode(a[d]),d<c&&this.append(b)}visitWhere(a){this.append("where "),this.visitNode(a.where)}visitHaving(a){this.append("having "),this.visitNode(a.having)}visitInsertQuery(a){let b=this.nodeStack.find(j.L.is),c=b!==a;!c&&a.explain&&(this.visitNode(a.explain),this.append(" ")),c&&!m.r.is(b)&&this.append("("),a.with&&(this.visitNode(a.with),this.append(" ")),this.append(a.replace?"replace":"insert"),a.ignore&&((0,n.u)("`InsertQueryNode.ignore` is deprecated. Use `InsertQueryNode.orAction` instead."),this.append(" ignore")),a.orAction&&(this.append(" "),this.visitNode(a.orAction)),a.top&&(this.append(" "),this.visitNode(a.top)),a.into&&(this.append(" into "),this.visitNode(a.into)),a.columns&&(this.append(" ("),this.compileList(a.columns),this.append(")")),a.output&&(this.append(" "),this.visitNode(a.output)),a.values&&(this.append(" "),this.visitNode(a.values)),a.defaultValues&&(this.append(" "),this.append("default values")),a.onConflict&&(this.append(" "),this.visitNode(a.onConflict)),a.onDuplicateKey&&(this.append(" "),this.visitNode(a.onDuplicateKey)),a.returning&&(this.append(" "),this.visitNode(a.returning)),c&&!m.r.is(b)&&this.append(")"),a.endModifiers?.length&&(this.append(" "),this.compileList(a.endModifiers," "))}visitValues(a){this.append("values "),this.compileList(a.values)}visitDeleteQuery(a){let b=this.nodeStack.find(j.L.is)!==a;!b&&a.explain&&(this.visitNode(a.explain),this.append(" ")),b&&this.append("("),a.with&&(this.visitNode(a.with),this.append(" ")),this.append("delete "),a.top&&(this.visitNode(a.top),this.append(" ")),this.visitNode(a.from),a.output&&(this.append(" "),this.visitNode(a.output)),a.using&&(this.append(" "),this.visitNode(a.using)),a.joins&&(this.append(" "),this.compileList(a.joins," ")),a.where&&(this.append(" "),this.visitNode(a.where)),a.orderBy&&(this.append(" "),this.visitNode(a.orderBy)),a.limit&&(this.append(" "),this.visitNode(a.limit)),a.returning&&(this.append(" "),this.visitNode(a.returning)),b&&this.append(")"),a.endModifiers?.length&&(this.append(" "),this.compileList(a.endModifiers," "))}visitReturning(a){this.append("returning "),this.compileList(a.selections)}visitAlias(a){this.visitNode(a.node),this.append(" as "),this.visitNode(a.alias)}visitReference(a){a.table&&(this.visitNode(a.table),this.append(".")),this.visitNode(a.column)}visitSelectAll(a){this.append("*")}visitIdentifier(a){this.append(this.getLeftIdentifierWrapper()),this.compileUnwrappedIdentifier(a),this.append(this.getRightIdentifierWrapper())}compileUnwrappedIdentifier(a){if(!(0,f.Kg)(a.name))throw Error("a non-string identifier was passed to compileUnwrappedIdentifier.");this.append(this.sanitizeIdentifier(a.name))}visitAnd(a){this.visitNode(a.left),this.append(" and "),this.visitNode(a.right)}visitOr(a){this.visitNode(a.left),this.append(" or "),this.visitNode(a.right)}visitValue(a){a.immediate?this.appendImmediateValue(a.value):this.appendValue(a.value)}visitValueList(a){this.append("("),this.compileList(a.values),this.append(")")}visitTuple(a){this.append("("),this.compileList(a.values),this.append(")")}visitPrimitiveValueList(a){this.append("(");let{values:b}=a;for(let a=0;a<b.length;++a)this.appendValue(b[a]),a!==b.length-1&&this.append(", ");this.append(")")}visitParens(a){this.append("("),this.visitNode(a.node),this.append(")")}visitJoin(a){this.append(s[a.joinType]),this.append(" "),this.visitNode(a.table),a.on&&(this.append(" "),this.visitNode(a.on))}visitOn(a){this.append("on "),this.visitNode(a.on)}visitRaw(a){let{sqlFragments:b,parameters:c}=a;for(let a=0;a<b.length;++a)this.append(b[a]),c.length>a&&this.visitNode(c[a])}visitOperator(a){this.append(a.operator)}visitTable(a){this.visitNode(a.table)}visitSchemableIdentifier(a){a.schema&&(this.visitNode(a.schema),this.append(".")),this.visitNode(a.identifier)}visitCreateTable(a){this.append("create "),a.frontModifiers&&a.frontModifiers.length>0&&(this.compileList(a.frontModifiers," "),this.append(" ")),a.temporary&&this.append("temporary "),this.append("table "),a.ifNotExists&&this.append("if not exists "),this.visitNode(a.table),a.selectQuery?(this.append(" as "),this.visitNode(a.selectQuery)):(this.append(" ("),this.compileList([...a.columns,...a.constraints??[]]),this.append(")"),a.onCommit&&(this.append(" on commit "),this.append(a.onCommit)),a.endModifiers&&a.endModifiers.length>0&&(this.append(" "),this.compileList(a.endModifiers," ")))}visitColumnDefinition(a){a.ifNotExists&&this.append("if not exists "),this.visitNode(a.column),this.append(" "),this.visitNode(a.dataType),a.unsigned&&this.append(" unsigned"),a.frontModifiers&&a.frontModifiers.length>0&&(this.append(" "),this.compileList(a.frontModifiers," ")),a.generated&&(this.append(" "),this.visitNode(a.generated)),a.identity&&this.append(" identity"),a.defaultTo&&(this.append(" "),this.visitNode(a.defaultTo)),a.notNull&&this.append(" not null"),a.unique&&this.append(" unique"),a.nullsNotDistinct&&this.append(" nulls not distinct"),a.primaryKey&&this.append(" primary key"),a.autoIncrement&&(this.append(" "),this.append(this.getAutoIncrement())),a.references&&(this.append(" "),this.visitNode(a.references)),a.check&&(this.append(" "),this.visitNode(a.check)),a.endModifiers&&a.endModifiers.length>0&&(this.append(" "),this.compileList(a.endModifiers," "))}getAutoIncrement(){return"auto_increment"}visitReferences(a){this.append("references "),this.visitNode(a.table),this.append(" ("),this.compileList(a.columns),this.append(")"),a.onDelete&&(this.append(" on delete "),this.append(a.onDelete)),a.onUpdate&&(this.append(" on update "),this.append(a.onUpdate))}visitDropTable(a){this.append("drop table "),a.ifExists&&this.append("if exists "),this.visitNode(a.table),a.cascade&&this.append(" cascade")}visitDataType(a){this.append(a.dataType)}visitOrderBy(a){this.append("order by "),this.compileList(a.items)}visitOrderByItem(a){this.visitNode(a.orderBy),a.collation&&(this.append(" "),this.visitNode(a.collation)),a.direction&&(this.append(" "),this.visitNode(a.direction)),a.nulls&&(this.append(" nulls "),this.append(a.nulls))}visitGroupBy(a){this.append("group by "),this.compileList(a.items)}visitGroupByItem(a){this.visitNode(a.groupBy)}visitUpdateQuery(a){let b=this.nodeStack.find(j.L.is),c=b!==a;if(!c&&a.explain&&(this.visitNode(a.explain),this.append(" ")),c&&!m.r.is(b)&&this.append("("),a.with&&(this.visitNode(a.with),this.append(" ")),this.append("update "),a.top&&(this.visitNode(a.top),this.append(" ")),a.table&&(this.visitNode(a.table),this.append(" ")),this.append("set "),a.updates&&this.compileList(a.updates),a.output&&(this.append(" "),this.visitNode(a.output)),a.from&&(this.append(" "),this.visitNode(a.from)),a.joins){if(!a.from)throw Error("Joins in an update query are only supported as a part of a PostgreSQL 'update set from join' query. If you want to create a MySQL 'update join set' query, see https://kysely.dev/docs/examples/update/my-sql-joins");this.append(" "),this.compileList(a.joins," ")}a.where&&(this.append(" "),this.visitNode(a.where)),a.orderBy&&(this.append(" "),this.visitNode(a.orderBy)),a.limit&&(this.append(" "),this.visitNode(a.limit)),a.returning&&(this.append(" "),this.visitNode(a.returning)),c&&!m.r.is(b)&&this.append(")"),a.endModifiers?.length&&(this.append(" "),this.compileList(a.endModifiers," "))}visitColumnUpdate(a){this.visitNode(a.column),this.append(" = "),this.visitNode(a.value)}visitLimit(a){this.append("limit "),this.visitNode(a.limit)}visitOffset(a){this.append("offset "),this.visitNode(a.offset)}visitOnConflict(a){this.append("on conflict"),a.columns?(this.append(" ("),this.compileList(a.columns),this.append(")")):a.constraint?(this.append(" on constraint "),this.visitNode(a.constraint)):a.indexExpression&&(this.append(" ("),this.visitNode(a.indexExpression),this.append(")")),a.indexWhere&&(this.append(" "),this.visitNode(a.indexWhere)),!0===a.doNothing?this.append(" do nothing"):a.updates&&(this.append(" do update set "),this.compileList(a.updates),a.updateWhere&&(this.append(" "),this.visitNode(a.updateWhere)))}visitOnDuplicateKey(a){this.append("on duplicate key update "),this.compileList(a.updates)}visitCreateIndex(a){this.append("create "),a.unique&&this.append("unique "),this.append("index "),a.ifNotExists&&this.append("if not exists "),this.visitNode(a.name),a.table&&(this.append(" on "),this.visitNode(a.table)),a.using&&(this.append(" using "),this.visitNode(a.using)),a.columns&&(this.append(" ("),this.compileList(a.columns),this.append(")")),a.nullsNotDistinct&&this.append(" nulls not distinct"),a.where&&(this.append(" "),this.visitNode(a.where))}visitDropIndex(a){this.append("drop index "),a.ifExists&&this.append("if exists "),this.visitNode(a.name),a.table&&(this.append(" on "),this.visitNode(a.table)),a.cascade&&this.append(" cascade")}visitCreateSchema(a){this.append("create schema "),a.ifNotExists&&this.append("if not exists "),this.visitNode(a.schema)}visitDropSchema(a){this.append("drop schema "),a.ifExists&&this.append("if exists "),this.visitNode(a.schema),a.cascade&&this.append(" cascade")}visitPrimaryKeyConstraint(a){a.name&&(this.append("constraint "),this.visitNode(a.name),this.append(" ")),this.append("primary key ("),this.compileList(a.columns),this.append(")"),this.buildDeferrable(a)}buildDeferrable(a){void 0!==a.deferrable&&(a.deferrable?this.append(" deferrable"):this.append(" not deferrable")),void 0!==a.initiallyDeferred&&(a.initiallyDeferred?this.append(" initially deferred"):this.append(" initially immediate"))}visitUniqueConstraint(a){a.name&&(this.append("constraint "),this.visitNode(a.name),this.append(" ")),this.append("unique"),a.nullsNotDistinct&&this.append(" nulls not distinct"),this.append(" ("),this.compileList(a.columns),this.append(")"),this.buildDeferrable(a)}visitCheckConstraint(a){a.name&&(this.append("constraint "),this.visitNode(a.name),this.append(" ")),this.append("check ("),this.visitNode(a.expression),this.append(")")}visitForeignKeyConstraint(a){a.name&&(this.append("constraint "),this.visitNode(a.name),this.append(" ")),this.append("foreign key ("),this.compileList(a.columns),this.append(") "),this.visitNode(a.references),a.onDelete&&(this.append(" on delete "),this.append(a.onDelete)),a.onUpdate&&(this.append(" on update "),this.append(a.onUpdate)),this.buildDeferrable(a)}visitList(a){this.compileList(a.items)}visitWith(a){this.append("with "),a.recursive&&this.append("recursive "),this.compileList(a.expressions)}visitCommonTableExpression(a){this.visitNode(a.name),this.append(" as "),(0,f.Lm)(a.materialized)&&(a.materialized||this.append("not "),this.append("materialized ")),this.visitNode(a.expression)}visitCommonTableExpressionName(a){this.visitNode(a.table),a.columns&&(this.append("("),this.compileList(a.columns),this.append(")"))}visitAlterTable(a){this.append("alter table "),this.visitNode(a.table),this.append(" "),a.renameTo&&(this.append("rename to "),this.visitNode(a.renameTo)),a.setSchema&&(this.append("set schema "),this.visitNode(a.setSchema)),a.addConstraint&&this.visitNode(a.addConstraint),a.dropConstraint&&this.visitNode(a.dropConstraint),a.renameConstraint&&this.visitNode(a.renameConstraint),a.columnAlterations&&this.compileColumnAlterations(a.columnAlterations),a.addIndex&&this.visitNode(a.addIndex),a.dropIndex&&this.visitNode(a.dropIndex)}visitAddColumn(a){this.append("add column "),this.visitNode(a.column)}visitRenameColumn(a){this.append("rename column "),this.visitNode(a.column),this.append(" to "),this.visitNode(a.renameTo)}visitDropColumn(a){this.append("drop column "),this.visitNode(a.column)}visitAlterColumn(a){this.append("alter column "),this.visitNode(a.column),this.append(" "),a.dataType&&(this.announcesNewColumnDataType()&&this.append("type "),this.visitNode(a.dataType),a.dataTypeExpression&&(this.append("using "),this.visitNode(a.dataTypeExpression))),a.setDefault&&(this.append("set default "),this.visitNode(a.setDefault)),a.dropDefault&&this.append("drop default"),a.setNotNull&&this.append("set not null"),a.dropNotNull&&this.append("drop not null")}visitModifyColumn(a){this.append("modify column "),this.visitNode(a.column)}visitAddConstraint(a){this.append("add "),this.visitNode(a.constraint)}visitDropConstraint(a){this.append("drop constraint "),a.ifExists&&this.append("if exists "),this.visitNode(a.constraintName),"cascade"===a.modifier?this.append(" cascade"):"restrict"===a.modifier&&this.append(" restrict")}visitRenameConstraint(a){this.append("rename constraint "),this.visitNode(a.oldName),this.append(" to "),this.visitNode(a.newName)}visitSetOperation(a){this.append(a.operator),this.append(" "),a.all&&this.append("all "),this.visitNode(a.expression)}visitCreateView(a){this.append("create "),a.orReplace&&this.append("or replace "),a.materialized&&this.append("materialized "),a.temporary&&this.append("temporary "),this.append("view "),a.ifNotExists&&this.append("if not exists "),this.visitNode(a.name),this.append(" "),a.columns&&(this.append("("),this.compileList(a.columns),this.append(") ")),a.as&&(this.append("as "),this.visitNode(a.as))}visitRefreshMaterializedView(a){this.append("refresh materialized view "),a.concurrently&&this.append("concurrently "),this.visitNode(a.name),a.withNoData?this.append(" with no data"):this.append(" with data")}visitDropView(a){this.append("drop "),a.materialized&&this.append("materialized "),this.append("view "),a.ifExists&&this.append("if exists "),this.visitNode(a.name),a.cascade&&this.append(" cascade")}visitGenerated(a){this.append("generated "),a.always&&this.append("always "),a.byDefault&&this.append("by default "),this.append("as "),a.identity&&this.append("identity"),a.expression&&(this.append("("),this.visitNode(a.expression),this.append(")")),a.stored&&this.append(" stored")}visitDefaultValue(a){this.append("default "),this.visitNode(a.defaultValue)}visitSelectModifier(a){a.rawModifier?this.visitNode(a.rawModifier):this.append(q[a.modifier]),a.of&&(this.append(" of "),this.compileList(a.of,", "))}visitCreateType(a){this.append("create type "),this.visitNode(a.name),a.enum&&(this.append(" as enum "),this.visitNode(a.enum))}visitDropType(a){this.append("drop type "),a.ifExists&&this.append("if exists "),this.visitNode(a.name)}visitExplain(a){this.append("explain"),(a.options||a.format)&&(this.append(" "),this.append(this.getLeftExplainOptionsWrapper()),a.options&&(this.visitNode(a.options),a.format&&this.append(this.getExplainOptionsDelimiter())),a.format&&(this.append("format"),this.append(this.getExplainOptionAssignment()),this.append(a.format)),this.append(this.getRightExplainOptionsWrapper()))}visitDefaultInsertValue(a){this.append("default")}visitAggregateFunction(a){this.append(a.func),this.append("("),a.distinct&&this.append("distinct "),this.compileList(a.aggregated),a.orderBy&&(this.append(" "),this.visitNode(a.orderBy)),this.append(")"),a.withinGroup&&(this.append(" within group ("),this.visitNode(a.withinGroup),this.append(")")),a.filter&&(this.append(" filter("),this.visitNode(a.filter),this.append(")")),a.over&&(this.append(" "),this.visitNode(a.over))}visitOver(a){this.append("over("),a.partitionBy&&(this.visitNode(a.partitionBy),a.orderBy&&this.append(" ")),a.orderBy&&this.visitNode(a.orderBy),this.append(")")}visitPartitionBy(a){this.append("partition by "),this.compileList(a.items)}visitPartitionByItem(a){this.visitNode(a.partitionBy)}visitBinaryOperation(a){this.visitNode(a.leftOperand),this.append(" "),this.visitNode(a.operator),this.append(" "),this.visitNode(a.rightOperand)}visitUnaryOperation(a){this.visitNode(a.operator),this.isMinusOperator(a.operator)||this.append(" "),this.visitNode(a.operand)}isMinusOperator(a){return h.zX.is(a)&&"-"===a.operator}visitUsing(a){this.append("using "),this.compileList(a.tables)}visitFunction(a){this.append(a.func),this.append("("),this.compileList(a.arguments),this.append(")")}visitCase(a){this.append("case"),a.value&&(this.append(" "),this.visitNode(a.value)),a.when&&(this.append(" "),this.compileList(a.when," ")),a.else&&(this.append(" else "),this.visitNode(a.else)),this.append(" end"),a.isStatement&&this.append(" case")}visitWhen(a){this.append("when "),this.visitNode(a.condition),a.result&&(this.append(" then "),this.visitNode(a.result))}visitJSONReference(a){this.visitNode(a.reference),this.visitNode(a.traversal)}visitJSONPath(a){for(let b of(a.inOperator&&this.visitNode(a.inOperator),this.append("'$"),a.pathLegs))this.visitNode(b);this.append("'")}visitJSONPathLeg(a){let b="ArrayLocation"===a.type;this.append(b?"[":"."),this.append(String(a.value)),b&&this.append("]")}visitJSONOperatorChain(a){for(let b=0,c=a.values.length;b<c;b++)b===c-1?this.visitNode(a.operator):this.append("->"),this.visitNode(a.values[b])}visitMergeQuery(a){a.with&&(this.visitNode(a.with),this.append(" ")),this.append("merge "),a.top&&(this.visitNode(a.top),this.append(" ")),this.append("into "),this.visitNode(a.into),a.using&&(this.append(" "),this.visitNode(a.using)),a.whens&&(this.append(" "),this.compileList(a.whens," ")),a.returning&&(this.append(" "),this.visitNode(a.returning)),a.output&&(this.append(" "),this.visitNode(a.output)),a.endModifiers?.length&&(this.append(" "),this.compileList(a.endModifiers," "))}visitMatched(a){a.not&&this.append("not "),this.append("matched"),a.bySource&&this.append(" by source")}visitAddIndex(a){this.append("add "),a.unique&&this.append("unique "),this.append("index "),this.visitNode(a.name),a.columns&&(this.append(" ("),this.compileList(a.columns),this.append(")")),a.using&&(this.append(" using "),this.visitNode(a.using))}visitCast(a){this.append("cast("),this.visitNode(a.expression),this.append(" as "),this.visitNode(a.dataType),this.append(")")}visitFetch(a){this.append("fetch next "),this.visitNode(a.rowCount),this.append(` rows ${a.modifier}`)}visitOutput(a){this.append("output "),this.compileList(a.selections)}visitTop(a){this.append(`top(${a.expression})`),a.modifiers&&this.append(` ${a.modifiers}`)}visitOrAction(a){this.append(a.action)}visitCollate(a){this.append("collate "),this.visitNode(a.collation)}append(a){this.#aV+=a}appendValue(a){this.addParameter(a),this.append(this.getCurrentParameterPlaceholder())}getLeftIdentifierWrapper(){return'"'}getRightIdentifierWrapper(){return'"'}getCurrentParameterPlaceholder(){return"$"+this.numParameters}getLeftExplainOptionsWrapper(){return"("}getExplainOptionAssignment(){return" "}getExplainOptionsDelimiter(){return", "}getRightExplainOptionsWrapper(){return")"}sanitizeIdentifier(a){let b=this.getLeftIdentifierWrapper(),c=this.getRightIdentifierWrapper(),d="";for(let e of a)d+=e,e===b?d+=b:e===c&&(d+=c);return d}sanitizeStringLiteral(a){return a.replace(o,"''")}addParameter(a){this.#aW.push(a)}appendImmediateValue(a){if((0,f.Kg)(a))this.appendStringLiteral(a);else if((0,f.Et)(a)||(0,f.Lm)(a)||(0,f.sI)(a))this.append(a.toString());else if((0,f.kZ)(a))this.append("null");else if((0,f.$P)(a))this.appendImmediateValue(a.toISOString());else throw Error(`invalid immediate value ${a}`)}appendStringLiteral(a){this.append("'"),this.append(this.sanitizeStringLiteral(a)),this.append("'")}sortSelectModifiers(a){return a.sort((a,b)=>a.modifier&&b.modifier?r[a.modifier]-r[b.modifier]:1),(0,f.CN)(a)}compileColumnAlterations(a){this.compileList(a)}announcesNewColumnDataType(){return!0}}let q=(0,f.CN)({ForKeyShare:"for key share",ForNoKeyUpdate:"for no key update",ForUpdate:"for update",ForShare:"for share",NoWait:"nowait",SkipLocked:"skip locked",Distinct:"distinct"}),r=(0,f.CN)({ForKeyShare:1,ForNoKeyUpdate:1,ForUpdate:1,ForShare:1,NoWait:2,SkipLocked:2,Distinct:0}),s=(0,f.CN)({InnerJoin:"inner join",LeftJoin:"left join",RightJoin:"right join",FullJoin:"full join",CrossJoin:"cross join",LateralInnerJoin:"inner join lateral",LateralLeftJoin:"left join lateral",LateralCrossJoin:"cross join lateral",OuterApply:"outer apply",CrossApply:"cross apply",Using:"using"})},69079:(a,b,c)=>{c.d(b,{P:()=>f});var d=c(60353),e=c(33423);let f=(0,d.CN)({is:a=>"CaseNode"===a.kind,create:a=>(0,d.CN)({kind:"CaseNode",value:a}),cloneWithWhen:(a,b)=>(0,d.CN)({...a,when:(0,d.CN)(a.when?[...a.when,b]:[b])}),cloneWithThen:(a,b)=>(0,d.CN)({...a,when:a.when?(0,d.CN)([...a.when.slice(0,-1),e.t.cloneWithResult(a.when[a.when.length-1],b)]):void 0}),cloneWith:(a,b)=>(0,d.CN)({...a,...b})})},69385:(a,b,c)=>{c.d(b,{H:()=>f});var d=c(60353),e=c(36923);let f=(0,d.CN)({is:a=>"TableNode"===a.kind,create:a=>(0,d.CN)({kind:"TableNode",table:e.y.create(a)}),createWithSchema:(a,b)=>(0,d.CN)({kind:"TableNode",table:e.y.createWithSchema(a,b)})})},69744:(a,b,c)=>{c.d(b,{n:()=>f});var d=c(5109),e=c(40016);function f(a,b){return{digest:async c=>{let f=new TextEncoder,g="string"==typeof c?f.encode(c):c,h=await (0,e.N)().digest(a,g);return"hex"===b?Array.from(new Uint8Array(h)).map(a=>a.toString(16).padStart(2,"0")).join(""):"base64"===b||"base64url"===b||"base64urlnopad"===b?b.includes("url")?d.z.encode(h,{padding:"base64urlnopad"!==b}):d.K.encode(h):h}}}},70010:(a,b,c)=>{c.d(b,{B:()=>f,q:()=>g});var d=c(39450),e=c(60353);function f(a){return(0,e.Gv)(a)&&"expressionType"in a&&(0,d.N)(a)}function g(a){return(0,e.Gv)(a)&&"expression"in a&&(0,e.Kg)(a.alias)&&(0,d.N)(a)}},70020:(a,b,c)=>{c.d(b,{a:()=>e});var d=c(60353);let e=(0,d.CN)({is:a=>"LimitNode"===a.kind,create:a=>(0,d.CN)({kind:"LimitNode",limit:a})})},70837:(a,b,c)=>{c.d(b,{c:()=>j});var d=c(92769),e=c(48026),f=c(51067);c(23427),c(69744),c(5109),c(62767),c(61287);var g=c(94324);let h=[],i=-1,j=({adapter:a,config:b})=>c=>{let j=Math.random().toString(36).substring(2,15),o={...b,supportsBooleans:b.supportsBooleans??!0,supportsDates:b.supportsDates??!0,supportsJSON:b.supportsJSON??!1,adapterName:b.adapterName??b.adapterId,supportsNumericIds:b.supportsNumericIds??!0,transaction:b.transaction??!1,disableTransformInput:b.disableTransformInput??!1,disableTransformOutput:b.disableTransformOutput??!1};if(c.advanced?.database?.useNumberId===!0&&!1===o.supportsNumericIds)throw Error(`[${o.adapterName}] Your database or database adapter does not support numeric ids. Please disable "useNumberId" in your config.`);let p=(0,e.g)(c),q=({field:a,model:b})=>{if("id"===a||"_id"===a)return"id";let c=r(b),d=p[c]?.fields[a];if(!d){let b=Object.entries(p[c].fields).find(([b,c])=>c.fieldName===a);b&&(d=b[1],a=b[0])}if(!d)throw u(`Field ${a} not found in model ${c}`),u("Schema:",p),Error(`Field ${a} not found in model ${c}`);return a},r=a=>{if(o.usePlural&&"s"===a.charAt(a.length-1)){let b=a.slice(0,-1),c=p[b]?b:void 0;if(c||(c=Object.entries(p).find(([a,c])=>c.modelName===b)?.[0]),c)return c}let b=p[a]?a:void 0;if(b||(b=Object.entries(p).find(([b,c])=>c.modelName===a)?.[0]),!b)throw u(`Model "${a}" not found in schema`),u("Schema:",p),Error(`Model "${a}" not found in schema`);return b},s=a=>{let b=r(a),c=o&&o.usePlural;return p&&p[b]&&p[b].modelName!==a?c?`${p[b].modelName}s`:p[b].modelName:c?`${a}s`:a};function t({model:a,field:b}){let c=r(a),d=q({model:c,field:b});return p[c]?.fields[d]?.fieldName||d}let u=(...a)=>{if(!0===o.debugLogs||"object"==typeof o.debugLogs){if("object"==typeof o.debugLogs&&"isRunningAdapterTests"in o.debugLogs){o.debugLogs.isRunningAdapterTests&&(a.shift(),h.push({instance:j,args:a}));return}if("object"!=typeof o.debugLogs||!o.debugLogs.logCondition||o.debugLogs.logCondition?.())if("object"==typeof a[0]&&"method"in a[0]){let b=a.shift().method;if("object"==typeof o.debugLogs){if("create"===b&&!o.debugLogs.create)return;else if("update"===b&&!o.debugLogs.update)return;else if("updateMany"===b&&!o.debugLogs.updateMany)return;else if("findOne"===b&&!o.debugLogs.findOne)return;else if("findMany"===b&&!o.debugLogs.findMany)return;else if("delete"===b&&!o.debugLogs.delete)return;else if("deleteMany"===b&&!o.debugLogs.deleteMany)return;else if("count"===b&&!o.debugLogs.count)return}g.a.info(`[${o.adapterName}]`,...a)}else g.a.info(`[${o.adapterName}]`,...a)}},v=({customModelName:a,forceAllowId:b})=>{let d=!o.disableIdGeneration&&!c.advanced?.database?.useNumberId&&!b,e=r(a??"id");return{type:c.advanced?.database?.useNumberId?"number":"string",required:!!d,...d?{defaultValue(){if(o.disableIdGeneration)return;let a=c.advanced?.database?.useNumberId,b=c.advanced?.database?.generateId;if(c.advanced?.generateId!==void 0&&(g.a.warn("Your Better Auth config includes advanced.generateId which is deprecated. Please use advanced.database.generateId instead. This will be removed in future releases."),b=c.advanced?.generateId),!1!==b&&!a)return b?b({model:e}):o.customIdGenerator?o.customIdGenerator({model:e}):(0,f.g)()}}:{}}},w=({model:a,field:b})=>{let c=r(a),d=q({field:b,model:c}),e=p[c].fields;return e.id=v({customModelName:c}),e[d]},x=async(a,b,d,e)=>{let f={},g=p[b].fields,h=o.mapKeysTransformInput??{};for(let i in o.disableIdGeneration||c.advanced?.database?.useNumberId||(g.id=v({customModelName:b,forceAllowId:e&&"id"in a})),g){let e=a[i],j=g[i],k=h[i]||g[i].fieldName||i;if(void 0===e&&(void 0===j.defaultValue&&!j.transform?.input&&!("update"===d&&j.onUpdate)||"update"===d&&!j.onUpdate))continue;let l=function(a,b,c){if("update"===c)return void 0===a&&void 0!==b.onUpdate?"function"==typeof b.onUpdate?b.onUpdate():b.onUpdate:a;return null==a&&void 0!==b.defaultValue?"function"==typeof b.defaultValue?b.defaultValue():b.defaultValue:a}(e,j,d);j.transform?.input&&(l=await j.transform.input(l)),j.references?.field==="id"&&c.advanced?.database?.useNumberId?l=Array.isArray(l)?l.map(a=>null!==a?Number(a):null):null!==l?Number(l):null:!1===o.supportsJSON&&"object"==typeof l&&"json"===j.type?l=JSON.stringify(l):!1===o.supportsDates&&l instanceof Date&&"date"===j.type?l=l.toISOString():!1===o.supportsBooleans&&"boolean"==typeof l&&(l=+!!l),o.customTransformInput&&(l=o.customTransformInput({data:l,action:d,field:k,fieldAttributes:j,model:b,schema:p,options:c})),void 0!==l&&(f[k]=l)}return f},y=async(a,b,e=[])=>{if(!a)return null;let f=o.mapKeysTransformOutput??{},g={},h=p[b].fields;for(let i in h[Object.entries(f).find(([a,b])=>"id"===b)?.[0]??"id"]={type:c.advanced?.database?.useNumberId?"number":"string"},h){if(e.length&&!e.includes(i))continue;let j=h[i];if(j){let h=j.fieldName||i,k=a[Object.entries(f).find(([a,b])=>b===h)?.[0]||h];j.transform?.output&&(k=await j.transform.output(k));let l=f[i]||i;"id"===h||j.references?.field==="id"?null!=k&&(k=String(k)):!1===o.supportsJSON&&"string"==typeof k&&"json"===j.type?k=(0,d.s)(k):!1===o.supportsDates&&"string"==typeof k&&"date"===j.type?k=new Date(k):!1===o.supportsBooleans&&"number"==typeof k&&"boolean"===j.type&&(k=1===k),o.customTransformOutput&&(k=o.customTransformOutput({data:k,field:l,fieldAttributes:j,select:e,model:b,schema:p,options:c})),g[l]=k}}return g},z=({model:a,where:b})=>{if(!b)return;let d=o.mapKeysTransformInput??{};return b.map(b=>{let{field:e,value:f,operator:g="eq",connector:h="AND"}=b;if("in"===g&&!Array.isArray(f))throw Error("Value must be an array");let i=r(a),j=q({field:e,model:a}),k=d[j]||t({field:j,model:i}),l=w({field:j,model:i});return("id"===j||l.references?.field==="id")&&c.advanced?.database?.useNumberId?Array.isArray(f)?{operator:g,connector:h,field:k,value:f.map(Number)}:{operator:g,connector:h,field:k,value:Number(f)}:{operator:g,connector:h,field:k,value:f}})},A=a({options:c,schema:p,debugLog:u,getFieldName:t,getModelName:s,getDefaultModelName:r,getDefaultFieldName:q,getFieldAttributes:w,transformInput:x,transformOutput:y,transformWhereClause:z}),B=null,C={transaction:async a=>{if(!B)if(o.transaction)g.a.debug(`[${o.adapterName}] - Using provided transaction implementation.`),B=o.transaction;else"object"==typeof o.debugLogs&&"isRunningAdapterTests"in o.debugLogs&&o.debugLogs.isRunningAdapterTests||g.a.warn(`[${o.adapterName}] - Transactions are not supported. Executing operations sequentially.`),B=a=>a(C);return B(a)},create:async({data:a,model:b,select:c,forceAllowId:d=!1})=>{let e=++i,f=s(b);if(b=r(b),"id"in a&&!d){g.a.warn(`[${o.adapterName}] - You are trying to create a record with an id. This is not allowed as we handle id generation for you, unless you pass in the \`forceAllowId\` parameter. The id will be ignored.`);let b=Error();console.log(b.stack?.split("\n").filter((a,b)=>1!==b).join("\n").replace("Error:","Create method with `id` being called at:")),a.id=void 0}u({method:"create"},`${k(e)} ${l(1,4)}`,`${m("create")} ${n("Unsafe Input")}:`,{model:f,data:a});let h=a;o.disableTransformInput||(h=await x(a,b,"create",d)),u({method:"create"},`${k(e)} ${l(2,4)}`,`${m("create")} ${n("Parsed Input")}:`,{model:f,data:h});let j=await A.create({data:h,model:f});u({method:"create"},`${k(e)} ${l(3,4)}`,`${m("create")} ${n("DB Result")}:`,{model:f,res:j});let p=j;return o.disableTransformOutput||(p=await y(j,b,c)),u({method:"create"},`${k(e)} ${l(4,4)}`,`${m("create")} ${n("Parsed Result")}:`,{model:f,data:p}),p},update:async({model:a,where:b,update:c})=>{let d=++i,e=s(a=r(a)),f=z({model:a,where:b});u({method:"update"},`${k(d)} ${l(1,4)}`,`${m("update")} ${n("Unsafe Input")}:`,{model:e,data:c});let g=c;o.disableTransformInput||(g=await x(c,a,"update")),u({method:"update"},`${k(d)} ${l(2,4)}`,`${m("update")} ${n("Parsed Input")}:`,{model:e,data:g});let h=await A.update({model:e,where:f,update:g});u({method:"update"},`${k(d)} ${l(3,4)}`,`${m("update")} ${n("DB Result")}:`,{model:e,data:h});let j=h;return o.disableTransformOutput||(j=await y(h,a)),u({method:"update"},`${k(d)} ${l(4,4)}`,`${m("update")} ${n("Parsed Result")}:`,{model:e,data:j}),j},updateMany:async({model:a,where:b,update:c})=>{let d=++i,e=s(a),f=z({model:a,where:b});a=r(a),u({method:"updateMany"},`${k(d)} ${l(1,4)}`,`${m("updateMany")} ${n("Unsafe Input")}:`,{model:e,data:c});let g=c;o.disableTransformInput||(g=await x(c,a,"update")),u({method:"updateMany"},`${k(d)} ${l(2,4)}`,`${m("updateMany")} ${n("Parsed Input")}:`,{model:e,data:g});let h=await A.updateMany({model:e,where:f,update:g});return u({method:"updateMany"},`${k(d)} ${l(3,4)}`,`${m("updateMany")} ${n("DB Result")}:`,{model:e,data:h}),u({method:"updateMany"},`${k(d)} ${l(4,4)}`,`${m("updateMany")} ${n("Parsed Result")}:`,{model:e,data:h}),h},findOne:async({model:a,where:b,select:c})=>{let d=++i,e=s(a),f=z({model:a,where:b});a=r(a),u({method:"findOne"},`${k(d)} ${l(1,3)}`,`${m("findOne")}:`,{model:e,where:f,select:c});let g=await A.findOne({model:e,where:f,select:c});u({method:"findOne"},`${k(d)} ${l(2,3)}`,`${m("findOne")} ${n("DB Result")}:`,{model:e,data:g});let h=g;return o.disableTransformOutput||(h=await y(g,a,c)),u({method:"findOne"},`${k(d)} ${l(3,3)}`,`${m("findOne")} ${n("Parsed Result")}:`,{model:e,data:h}),h},findMany:async({model:a,where:b,limit:d,sortBy:e,offset:f})=>{let g=++i,h=d??c.advanced?.database?.defaultFindManyLimit??100,j=s(a),p=z({model:a,where:b});a=r(a),u({method:"findMany"},`${k(g)} ${l(1,3)}`,`${m("findMany")}:`,{model:j,where:p,limit:h,sortBy:e,offset:f});let q=await A.findMany({model:j,where:p,limit:h,sortBy:e,offset:f});u({method:"findMany"},`${k(g)} ${l(2,3)}`,`${m("findMany")} ${n("DB Result")}:`,{model:j,data:q});let t=q;return o.disableTransformOutput||(t=await Promise.all(q.map(async b=>await y(b,a)))),u({method:"findMany"},`${k(g)} ${l(3,3)}`,`${m("findMany")} ${n("Parsed Result")}:`,{model:j,data:t}),t},delete:async({model:a,where:b})=>{let c=++i,d=s(a),e=z({model:a,where:b});a=r(a),u({method:"delete"},`${k(c)} ${l(1,2)}`,`${m("delete")}:`,{model:d,where:e}),await A.delete({model:d,where:e}),u({method:"delete"},`${k(c)} ${l(2,2)}`,`${m("delete")} ${n("DB Result")}:`,{model:d})},deleteMany:async({model:a,where:b})=>{let c=++i,d=s(a),e=z({model:a,where:b});a=r(a),u({method:"deleteMany"},`${k(c)} ${l(1,2)}`,`${m("deleteMany")} ${n("DeleteMany")}:`,{model:d,where:e});let f=await A.deleteMany({model:d,where:e});return u({method:"deleteMany"},`${k(c)} ${l(2,2)}`,`${m("deleteMany")} ${n("DB Result")}:`,{model:d,data:f}),f},count:async({model:a,where:b})=>{let c=++i,d=s(a),e=z({model:a,where:b});a=r(a),u({method:"count"},`${k(c)} ${l(1,2)}`,`${m("count")}:`,{model:d,where:e});let f=await A.count({model:d,where:e});return u({method:"count"},`${k(c)} ${l(2,2)}`,`${m("count")}:`,{model:d,data:f}),f},createSchema:A.createSchema?async(a,b)=>{let d=(0,e.g)(c);return c.secondaryStorage&&!c.session?.storeSessionInDatabase&&delete d.session,c.rateLimit&&"database"===c.rateLimit.storage&&(void 0===c.rateLimit.enabled||!0===c.rateLimit.enabled)&&(d.ratelimit={modelName:c.rateLimit.modelName??"ratelimit",fields:{key:{type:"string",unique:!0,required:!0,fieldName:c.rateLimit.fields?.key??"key"},count:{type:"number",required:!0,fieldName:c.rateLimit.fields?.count??"count"},lastRequest:{type:"number",required:!0,bigint:!0,defaultValue:()=>Date.now(),fieldName:c.rateLimit.fields?.lastRequest??"lastRequest"}}}),A.createSchema({file:b,tables:d})}:void 0,options:{adapterConfig:o,...A.options??{}},id:o.adapterId,...o.debugLogs?.isRunningAdapterTests?{adapterTestDebugLogs:{resetDebugLogs(){h=h.filter(a=>a.instance!==j)},printDebugLogs(){let a=`\u2500`.repeat(80),b=h.filter(a=>a.instance===j);0!==b.length&&console.log(...b.reverse().map(a=>(a.args[0]=`
${a.args[0]}`,[...a.args,"\n"])).reduce((a,b)=>[...b,...a],[`
${a}`]))}}}:{}};return C};function k(a){return`${g.b.fg.magenta}#${a}${g.b.reset}`}function l(a,b){return`${g.b.bg.black}${g.b.fg.yellow}[${a}/${b}]${g.b.reset}`}function m(a){return`${g.b.bright}${a}${g.b.reset}`}function n(a){return`${g.b.dim}(${a})${g.b.reset}`}},71088:(a,b,c)=>{c.d(b,{GQ:()=>u,EQ:()=>v,bl:()=>t});var d=c(17793),e=c(60353),f=c(47777);let g=(0,e.CN)({is:a=>"PartitionByNode"===a.kind,create:a=>(0,e.CN)({kind:"PartitionByNode",items:(0,e.CN)(a)}),cloneWithItems:(a,b)=>(0,e.CN)({...a,items:(0,e.CN)([...a.items,...b])})}),h=(0,e.CN)({is:a=>"OverNode"===a.kind,create:()=>(0,e.CN)({kind:"OverNode"}),cloneWithOrderByItems:(a,b)=>(0,e.CN)({...a,orderBy:a.orderBy?f.O.cloneWithItems(a.orderBy,b):f.O.create(b)}),cloneWithPartitionByItems:(a,b)=>(0,e.CN)({...a,partitionBy:a.partitionBy?g.cloneWithItems(a.partitionBy,b):g.create(b)})});var i=c(31575),j=c(53284);class k{#G;constructor(a){this.#G=(0,e.CN)(a)}on(...a){return new k({...this.#G,joinNode:d.b.cloneWithOn(this.#G.joinNode,(0,j.GB)(a))})}onRef(a,b,c){return new k({...this.#G,joinNode:d.b.cloneWithOn(this.#G.joinNode,(0,j.vC)(a,b,c))})}onTrue(){return new k({...this.#G,joinNode:d.b.cloneWithOn(this.#G.joinNode,i.z.createWithSql("true"))})}$call(a){return a(this)}toOperationNode(){return this.#G.joinNode}}var l=c(4315),m=c(68019);let n=(0,e.CN)({is:a=>"PartitionByItemNode"===a.kind,create:a=>(0,e.CN)({kind:"PartitionByItemNode",partitionBy:a})});var o=c(2952);class p{#G;constructor(a){this.#G=(0,e.CN)(a)}orderBy(...a){return new p({overNode:h.cloneWithOrderByItems(this.#G.overNode,(0,m.xk)(a))})}clearOrderBy(){return new p({overNode:l.L.cloneWithoutOrderBy(this.#G.overNode)})}partitionBy(a){return new p({overNode:h.cloneWithPartitionByItems(this.#G.overNode,(0,o.kU)(a).map(n.create))})}$call(a){return a(this)}toOperationNode(){return this.#G.overNode}}var q=c(65966),r=c(22795),s=c(19795);function t(){return new q.n({executor:r.W})}function u(a,b){return new k({joinNode:d.b.create(a,(0,s.uJ)(b))})}function v(){return new p({overNode:h.create()})}},71644:(a,b,c)=>{c.d(b,{t:()=>u});var d=c(77688),e=c(60353),f=c(54744),g=c(47777);let h=(0,e.CN)({is:a=>"AggregateFunctionNode"===a.kind,create:(a,b=[])=>(0,e.CN)({kind:"AggregateFunctionNode",func:a,aggregated:b}),cloneWithDistinct:a=>(0,e.CN)({...a,distinct:!0}),cloneWithOrderBy(a,b,c=!1){let d=c?"withinGroup":"orderBy";return(0,e.CN)({...a,[d]:a[d]?g.O.cloneWithItems(a[d],b):g.O.create(b)})},cloneWithFilter:(a,b)=>(0,e.CN)({...a,filter:a.filter?f.o.cloneWithOperation(a.filter,"And",b):f.o.create(b)}),cloneWithOrFilter:(a,b)=>(0,e.CN)({...a,filter:a.filter?f.o.cloneWithOperation(a.filter,"Or",b):f.o.create(b)}),cloneWithOver:(a,b)=>(0,e.CN)({...a,over:b})}),i=(0,e.CN)({is:a=>"FunctionNode"===a.kind,create:(a,b)=>(0,e.CN)({kind:"FunctionNode",func:a,arguments:b})});var j=c(2952),k=c(65582),l=c(44625),m=c(81266),n=c(71088),o=c(53284),p=c(68019),q=c(4315);class r{#G;constructor(a){this.#G=(0,e.CN)(a)}get expressionType(){}as(a){return new s(this,a)}distinct(){return new r({...this.#G,aggregateFunctionNode:h.cloneWithDistinct(this.#G.aggregateFunctionNode)})}orderBy(...a){return new r({...this.#G,aggregateFunctionNode:q.L.cloneWithOrderByItems(this.#G.aggregateFunctionNode,(0,p.xk)(a))})}clearOrderBy(){return new r({...this.#G,aggregateFunctionNode:q.L.cloneWithoutOrderBy(this.#G.aggregateFunctionNode)})}withinGroupOrderBy(...a){return new r({...this.#G,aggregateFunctionNode:h.cloneWithOrderBy(this.#G.aggregateFunctionNode,(0,p.xk)(a),!0)})}filterWhere(...a){return new r({...this.#G,aggregateFunctionNode:h.cloneWithFilter(this.#G.aggregateFunctionNode,(0,o.GB)(a))})}filterWhereRef(a,b,c){return new r({...this.#G,aggregateFunctionNode:h.cloneWithFilter(this.#G.aggregateFunctionNode,(0,o.vC)(a,b,c))})}over(a){let b=(0,n.EQ)();return new r({...this.#G,aggregateFunctionNode:h.cloneWithOver(this.#G.aggregateFunctionNode,(a?a(b):b).toOperationNode())})}$call(a){return a(this)}$castTo(){return new r(this.#G)}$notNull(){return new r(this.#G)}toOperationNode(){return this.#G.aggregateFunctionNode}}class s{#aX;#aA;constructor(a,b){this.#aX=a,this.#aA=b}get expression(){return this.#aX}get alias(){return this.#aA}toOperationNode(){return l.N.create(this.#aX.toOperationNode(),m.O.create(this.#aA))}}var t=c(19795);function u(){let a=(a,b)=>new d.Is(i.create(a,(0,j.kU)(b??[]))),b=(a,b)=>new r({aggregateFunctionNode:h.create(a,b?(0,j.kU)(b):void 0)});return Object.assign(a,{agg:b,avg:a=>b("avg",[a]),coalesce:(...b)=>a("coalesce",b),count:a=>b("count",[a]),countAll:a=>new r({aggregateFunctionNode:h.create("count",(0,k.J)(a))}),max:a=>b("max",[a]),min:a=>b("min",[a]),sum:a=>b("sum",[a]),any:b=>a("any",[b]),jsonAgg:a=>new r({aggregateFunctionNode:h.create("json_agg",[(0,e.Kg)(a)?(0,t.M$)(a):a.toOperationNode()])}),toJson:a=>new d.Is(i.create("to_json",[(0,e.Kg)(a)?(0,t.M$)(a):a.toOperationNode()]))})}},74823:(a,b,c)=>{c.d(b,{a:()=>g,b:()=>j,c:()=>i,g:()=>h});var d=c(8897),e=c(64515);function f(a,b="/api/auth"){if(function(a){try{let b=new URL(a).pathname.replace(/\/+$/,"")||"/";return"/"!==b}catch(b){throw new e.B(`Invalid base URL: ${a}. Please provide a valid base URL.`)}}(a))return a;let c=a.replace(/\/+$/,"");return b&&"/"!==b?(b=b.startsWith("/")?b:`/${b}`,`${c}${b}`):c}function g(a,b,c,g){if(a)return f(a,b);if(!1!==g){let a=d.e.BETTER_AUTH_URL||d.e.NEXT_PUBLIC_BETTER_AUTH_URL||d.e.PUBLIC_BETTER_AUTH_URL||d.e.NUXT_PUBLIC_BETTER_AUTH_URL||d.e.NUXT_PUBLIC_AUTH_URL||("/"!==d.e.BASE_URL?d.e.BASE_URL:void 0);if(a)return f(a,b)}let i=c?.headers.get("x-forwarded-host"),j=c?.headers.get("x-forwarded-proto");if(i&&j)return f(`${j}://${i}`,b);if(c){let a=h(c.url);if(!a)throw new e.B("Could not get origin from request. Please provide a valid base URL.");return f(a,b)}if("undefined"!=typeof window&&window.location)return f(window.location.origin,b)}function h(a){try{return new URL(a).origin}catch(a){return null}}function i(a){try{return new URL(a).protocol}catch(a){return null}}function j(a){try{return new URL(a).host}catch(b){return a}}},75227:(a,b,c)=>{c.d(b,{N:()=>e});var d=c(60353);let e=(0,d.CN)({is:a=>"FromNode"===a.kind,create:a=>(0,d.CN)({kind:"FromNode",froms:(0,d.CN)(a)}),cloneWithFroms:(a,b)=>(0,d.CN)({...a,froms:(0,d.CN)([...a.froms,...b])})})},77688:(a,b,c)=>{c.d(b,{Is:()=>k});var d=c(44625),e=c(55914),f=c(81266),g=c(39450),h=c(28244),i=c(94296),j=c(53284);class k{#D;constructor(a){this.#D=a}get expressionType(){}as(a){return new l(this,a)}or(...a){return new m(h.K.create(this.#D,(0,j.GB)(a)))}and(...a){return new n(e.s.create(this.#D,(0,j.GB)(a)))}$castTo(){return new k(this.#D)}$notNull(){return new k(this.#D)}toOperationNode(){return this.#D}}class l{#aY;#aA;constructor(a,b){this.#aY=a,this.#aA=b}get expression(){return this.#aY}get alias(){return this.#aA}toOperationNode(){return d.N.create(this.#aY.toOperationNode(),(0,g.N)(this.#aA)?this.#aA.toOperationNode():f.O.create(this.#aA))}}class m{#D;constructor(a){this.#D=a}get expressionType(){}as(a){return new l(this,a)}or(...a){return new m(h.K.create(this.#D,(0,j.GB)(a)))}$castTo(){return new m(this.#D)}toOperationNode(){return i.k.create(this.#D)}}class n{#D;constructor(a){this.#D=a}get expressionType(){}as(a){return new l(this,a)}and(...a){return new n(e.s.create(this.#D,(0,j.GB)(a)))}$castTo(){return new n(this.#D)}toOperationNode(){return i.k.create(this.#D)}}},78329:(a,b,c)=>{c.d(b,{kQ:()=>e,sy:()=>f});var d=c(60353);let e="kysely_migration",f="kysely_migration_lock";(0,d.CN)({__noMigrations__:!0})},80234:(a,b,c)=>{c.d(b,{u:()=>e});let d=new Set;function e(a){d.has(a)||(d.add(a),console.log(a))}},80906:(a,b,c)=>{c.d(b,{k:()=>e});var d=c(60353);let e=(0,d.CN)({is:a=>"JSONOperatorChainNode"===a.kind,create:a=>(0,d.CN)({kind:"JSONOperatorChainNode",operator:a,values:(0,d.CN)([])}),cloneWithValue:(a,b)=>(0,d.CN)({...a,values:(0,d.CN)([...a.values,b])})})},81266:(a,b,c)=>{c.d(b,{O:()=>e});var d=c(60353);let e=(0,d.CN)({is:a=>"IdentifierNode"===a.kind,create:a=>(0,d.CN)({kind:"IdentifierNode",name:a})})},81671:(a,b,c)=>{c.d(b,{D0:()=>e,Rd:()=>d,xW:()=>f});let d=new TextEncoder,e=new TextDecoder;function f(...a){let b=new Uint8Array(a.reduce((a,{length:b})=>a+b,0)),c=0;for(let d of a)b.set(d,c),c+=d.length;return b}},82324:(a,b,c)=>{c.d(b,{$s:()=>j,U2:()=>i,dJ:()=>l,qH:()=>k});var d=c(54315),e=c(93159),f=c(90350),g=c(60353),h=c(57105);function i(a){var b;return(0,g.MH)(a)?(b=a).some(h.SS)?e.s.create(b.map(a=>j(a))):d.h.create(b):j(a)}function j(a){return(0,h.SS)(a)?(0,h.YK)(a):f.q.create(a)}function k(a){return(0,g.Et)(a)||(0,g.Lm)(a)||(0,g.kZ)(a)}function l(a){if(!k(a))throw Error(`unsafe immediate value ${JSON.stringify(a)}`);return f.q.createImmediate(a)}},83514:(a,b,c)=>{c.d(b,{A:()=>i});var d=c(46639),e=c(46377),f=c(48560);let g=a=>a?.[Symbol.toStringTag],h=(a,b,c)=>{if(void 0!==b.use){let a;switch(c){case"sign":case"verify":a="sig";break;case"encrypt":case"decrypt":a="enc"}if(b.use!==a)throw TypeError(`Invalid key for this operation, its "use" must be "${a}" when present`)}if(void 0!==b.alg&&b.alg!==a)throw TypeError(`Invalid key for this operation, its "alg" must be "${a}" when present`);if(Array.isArray(b.key_ops)){let d;switch(!0){case"sign"===c||"verify"===c:case"dir"===a:case a.includes("CBC-HS"):d=c;break;case a.startsWith("PBES2"):d="deriveBits";break;case/^A\d{3}(?:GCM)?(?:KW)?$/.test(a):d=!a.includes("GCM")&&a.endsWith("KW")?"encrypt"===c?"wrapKey":"unwrapKey":c;break;case"encrypt"===c&&a.startsWith("RSA"):d="wrapKey";break;case"decrypt"===c:d=a.startsWith("RSA")?"unwrapKey":"deriveBits"}if(d&&b.key_ops?.includes?.(d)===!1)throw TypeError(`Invalid key for this operation, its "key_ops" must include "${d}" when present`)}return!0},i=(a,b,c)=>{a.startsWith("HS")||"dir"===a||a.startsWith("PBES2")||/^A(?:128|192|256)(?:GCM)?(?:KW)?$/.test(a)||/^A(?:128|192|256)CBC-HS(?:256|384|512)$/.test(a)?((a,b,c)=>{if(!(b instanceof Uint8Array)){if(f.ll(b)){if(f.t9(b)&&h(a,b,c))return;throw TypeError('JSON Web Key for symmetric algorithms must have JWK "kty" (Key Type) equal to "oct" and the JWK "k" (Key Value) present')}if(!(0,e.Ay)(b))throw TypeError((0,d.t)(a,b,"CryptoKey","KeyObject","JSON Web Key","Uint8Array"));if("secret"!==b.type)throw TypeError(`${g(b)} instances for symmetric algorithms must be of type "secret"`)}})(a,b,c):((a,b,c)=>{if(f.ll(b))switch(c){case"decrypt":case"sign":if(f.W2(b)&&h(a,b,c))return;throw TypeError("JSON Web Key for this operation be a private JWK");case"encrypt":case"verify":if(f.M3(b)&&h(a,b,c))return;throw TypeError("JSON Web Key for this operation be a public JWK")}if(!(0,e.Ay)(b))throw TypeError((0,d.t)(a,b,"CryptoKey","KeyObject","JSON Web Key"));if("secret"===b.type)throw TypeError(`${g(b)} instances for asymmetric algorithms must not be of type "secret"`);if("public"===b.type)switch(c){case"sign":throw TypeError(`${g(b)} instances for asymmetric algorithm signing must be of type "private"`);case"decrypt":throw TypeError(`${g(b)} instances for asymmetric algorithm decryption must be of type "private"`)}if("private"===b.type)switch(c){case"verify":throw TypeError(`${g(b)} instances for asymmetric algorithm verifying must be of type "public"`);case"encrypt":throw TypeError(`${g(b)} instances for asymmetric algorithm encryption must be of type "public"`)}})(a,b,c)}},84108:(a,b,c)=>{let d;c.d(b,{A:()=>j});var e=c(48560),f=c(52628),g=c(48623),h=c(46377);let i=async(a,b,c,e=!1)=>{let f=(d||=new WeakMap).get(a);if(f?.[c])return f[c];let h=await (0,g.A)({...b,alg:c});return e&&Object.freeze(a),f?f[c]=h:d.set(a,{[c]:h}),h},j=async(a,b)=>{if(a instanceof Uint8Array||(0,h.R7)(a))return a;if((0,h.D2)(a)){if("secret"===a.type)return a.export();if("toCryptoKey"in a&&"function"==typeof a.toCryptoKey)try{return((a,b)=>{let c,e=(d||=new WeakMap).get(a);if(e?.[b])return e[b];let f="public"===a.type,g=!!f;if("x25519"===a.asymmetricKeyType){switch(b){case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":break;default:throw TypeError("given KeyObject instance cannot be used for this algorithm")}c=a.toCryptoKey(a.asymmetricKeyType,g,f?[]:["deriveBits"])}if("ed25519"===a.asymmetricKeyType){if("EdDSA"!==b&&"Ed25519"!==b)throw TypeError("given KeyObject instance cannot be used for this algorithm");c=a.toCryptoKey(a.asymmetricKeyType,g,[f?"verify":"sign"])}switch(a.asymmetricKeyType){case"ml-dsa-44":case"ml-dsa-65":case"ml-dsa-87":if(b!==a.asymmetricKeyType.toUpperCase())throw TypeError("given KeyObject instance cannot be used for this algorithm");c=a.toCryptoKey(a.asymmetricKeyType,g,[f?"verify":"sign"])}if("rsa"===a.asymmetricKeyType){let d;switch(b){case"RSA-OAEP":d="SHA-1";break;case"RS256":case"PS256":case"RSA-OAEP-256":d="SHA-256";break;case"RS384":case"PS384":case"RSA-OAEP-384":d="SHA-384";break;case"RS512":case"PS512":case"RSA-OAEP-512":d="SHA-512";break;default:throw TypeError("given KeyObject instance cannot be used for this algorithm")}if(b.startsWith("RSA-OAEP"))return a.toCryptoKey({name:"RSA-OAEP",hash:d},g,f?["encrypt"]:["decrypt"]);c=a.toCryptoKey({name:b.startsWith("PS")?"RSA-PSS":"RSASSA-PKCS1-v1_5",hash:d},g,[f?"verify":"sign"])}if("ec"===a.asymmetricKeyType){let d=new Map([["prime256v1","P-256"],["secp384r1","P-384"],["secp521r1","P-521"]]).get(a.asymmetricKeyDetails?.namedCurve);if(!d)throw TypeError("given KeyObject instance cannot be used for this algorithm");"ES256"===b&&"P-256"===d&&(c=a.toCryptoKey({name:"ECDSA",namedCurve:d},g,[f?"verify":"sign"])),"ES384"===b&&"P-384"===d&&(c=a.toCryptoKey({name:"ECDSA",namedCurve:d},g,[f?"verify":"sign"])),"ES512"===b&&"P-521"===d&&(c=a.toCryptoKey({name:"ECDSA",namedCurve:d},g,[f?"verify":"sign"])),b.startsWith("ECDH-ES")&&(c=a.toCryptoKey({name:"ECDH",namedCurve:d},g,f?[]:["deriveBits"]))}if(!c)throw TypeError("given KeyObject instance cannot be used for this algorithm");return e?e[b]=c:d.set(a,{[b]:c}),c})(a,b)}catch(a){if(a instanceof TypeError)throw a}let c=a.export({format:"jwk"});return i(a,c,b)}if((0,e.ll)(a))return a.k?(0,f.D)(a.k):i(a,a,b,!0);throw Error("unreachable")}},84916:(a,b,c)=>{c.d(b,{g:()=>d});let d=(a,b="ms")=>new Date(Date.now()+("sec"===b?1e3*a:a))},85256:(a,b,c)=>{c.d(b,{c:()=>m,k:()=>l});var d=c(90009),e=c(81671);let f=a=>Math.floor(a.getTime()/1e3),g=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i,h=a=>{let b,c=g.exec(a);if(!c||c[4]&&c[1])throw TypeError("Invalid time period format");let d=parseFloat(c[2]);switch(c[3].toLowerCase()){case"sec":case"secs":case"second":case"seconds":case"s":b=Math.round(d);break;case"minute":case"minutes":case"min":case"mins":case"m":b=Math.round(60*d);break;case"hour":case"hours":case"hr":case"hrs":case"h":b=Math.round(3600*d);break;case"day":case"days":case"d":b=Math.round(86400*d);break;case"week":case"weeks":case"w":b=Math.round(604800*d);break;default:b=Math.round(0x1e187e0*d)}return"-"===c[1]||"ago"===c[4]?-b:b};var i=c(65145);function j(a,b){if(!Number.isFinite(b))throw TypeError(`Invalid ${a} input`);return b}let k=a=>a.includes("/")?a.toLowerCase():`application/${a.toLowerCase()}`;function l(a,b,c={}){var g,j;let m,n;try{m=JSON.parse(e.D0.decode(b))}catch{}if(!(0,i.A)(m))throw new d.Dp("JWT Claims Set must be a top-level JSON object");let{typ:o}=c;if(o&&("string"!=typeof a.typ||k(a.typ)!==k(o)))throw new d.ie('unexpected "typ" JWT header value',m,"typ","check_failed");let{requiredClaims:p=[],issuer:q,subject:r,audience:s,maxTokenAge:t}=c,u=[...p];for(let a of(void 0!==t&&u.push("iat"),void 0!==s&&u.push("aud"),void 0!==r&&u.push("sub"),void 0!==q&&u.push("iss"),new Set(u.reverse())))if(!(a in m))throw new d.ie(`missing required "${a}" claim`,m,a,"missing");if(q&&!(Array.isArray(q)?q:[q]).includes(m.iss))throw new d.ie('unexpected "iss" claim value',m,"iss","check_failed");if(r&&m.sub!==r)throw new d.ie('unexpected "sub" claim value',m,"sub","check_failed");if(s&&(g=m.aud,j="string"==typeof s?[s]:s,"string"==typeof g?!j.includes(g):!(Array.isArray(g)&&j.some(Set.prototype.has.bind(new Set(g))))))throw new d.ie('unexpected "aud" claim value',m,"aud","check_failed");switch(typeof c.clockTolerance){case"string":n=h(c.clockTolerance);break;case"number":n=c.clockTolerance;break;case"undefined":n=0;break;default:throw TypeError("Invalid clockTolerance option type")}let{currentDate:v}=c,w=f(v||new Date);if((void 0!==m.iat||t)&&"number"!=typeof m.iat)throw new d.ie('"iat" claim must be a number',m,"iat","invalid");if(void 0!==m.nbf){if("number"!=typeof m.nbf)throw new d.ie('"nbf" claim must be a number',m,"nbf","invalid");if(m.nbf>w+n)throw new d.ie('"nbf" claim timestamp check failed',m,"nbf","check_failed")}if(void 0!==m.exp){if("number"!=typeof m.exp)throw new d.ie('"exp" claim must be a number',m,"exp","invalid");if(m.exp<=w-n)throw new d.n('"exp" claim timestamp check failed',m,"exp","check_failed")}if(t){let a=w-m.iat;if(a-n>("number"==typeof t?t:h(t)))throw new d.n('"iat" claim timestamp check failed (too far in the past)',m,"iat","check_failed");if(a<0-n)throw new d.ie('"iat" claim timestamp check failed (it should be in the past)',m,"iat","check_failed")}return m}class m{#aM;constructor(a){if(!(0,i.A)(a))throw TypeError("JWT Claims Set MUST be an object");this.#aM=structuredClone(a)}data(){return e.Rd.encode(JSON.stringify(this.#aM))}get iss(){return this.#aM.iss}set iss(a){this.#aM.iss=a}get sub(){return this.#aM.sub}set sub(a){this.#aM.sub=a}get aud(){return this.#aM.aud}set aud(a){this.#aM.aud=a}set jti(a){this.#aM.jti=a}set nbf(a){"number"==typeof a?this.#aM.nbf=j("setNotBefore",a):a instanceof Date?this.#aM.nbf=j("setNotBefore",f(a)):this.#aM.nbf=f(new Date)+h(a)}set exp(a){"number"==typeof a?this.#aM.exp=j("setExpirationTime",a):a instanceof Date?this.#aM.exp=j("setExpirationTime",f(a)):this.#aM.exp=f(new Date)+h(a)}set iat(a){void 0===a?this.#aM.iat=f(new Date):a instanceof Date?this.#aM.iat=j("setIssuedAt",f(a)):"string"==typeof a?this.#aM.iat=j("setIssuedAt",f(new Date)+h(a)):this.#aM.iat=j("setIssuedAt",a)}}},88487:(a,b,c)=>{c.d(b,{Y:()=>f});var d=c(60353),e=c(36923);let f=(0,d.CN)({is:a=>"CreateViewNode"===a.kind,create:a=>(0,d.CN)({kind:"CreateViewNode",name:e.y.create(a)}),cloneWith:(a,b)=>(0,d.CN)({...a,...b})})},89961:(a,b,c)=>{c.d(b,{A:()=>e});var d=c(90009);let e=(a,b)=>{let c=`SHA-${a.slice(-3)}`;switch(a){case"HS256":case"HS384":case"HS512":return{hash:c,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:c,name:"RSA-PSS",saltLength:parseInt(a.slice(-3),10)>>3};case"RS256":case"RS384":case"RS512":return{hash:c,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:c,name:"ECDSA",namedCurve:b.namedCurve};case"Ed25519":case"EdDSA":return{name:"Ed25519"};case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":return{name:a};default:throw new d.T0(`alg ${a} is not supported either by JOSE or your javascript runtime`)}}},90009:(a,b,c)=>{c.d(b,{$4:()=>m,BT:()=>l,Dm:()=>k,Dp:()=>j,Rb:()=>g,T0:()=>h,Ye:()=>i,h2:()=>o,i4:()=>d,ie:()=>e,n:()=>f,xb:()=>n});class d extends Error{static code="ERR_JOSE_GENERIC";code="ERR_JOSE_GENERIC";constructor(a,b){super(a,b),this.name=this.constructor.name,Error.captureStackTrace?.(this,this.constructor)}}class e extends d{static code="ERR_JWT_CLAIM_VALIDATION_FAILED";code="ERR_JWT_CLAIM_VALIDATION_FAILED";claim;reason;payload;constructor(a,b,c="unspecified",d="unspecified"){super(a,{cause:{claim:c,reason:d,payload:b}}),this.claim=c,this.reason=d,this.payload=b}}class f extends d{static code="ERR_JWT_EXPIRED";code="ERR_JWT_EXPIRED";claim;reason;payload;constructor(a,b,c="unspecified",d="unspecified"){super(a,{cause:{claim:c,reason:d,payload:b}}),this.claim=c,this.reason=d,this.payload=b}}class g extends d{static code="ERR_JOSE_ALG_NOT_ALLOWED";code="ERR_JOSE_ALG_NOT_ALLOWED"}class h extends d{static code="ERR_JOSE_NOT_SUPPORTED";code="ERR_JOSE_NOT_SUPPORTED"}class i extends d{static code="ERR_JWS_INVALID";code="ERR_JWS_INVALID"}class j extends d{static code="ERR_JWT_INVALID";code="ERR_JWT_INVALID"}class k extends d{static code="ERR_JWKS_INVALID";code="ERR_JWKS_INVALID"}class l extends d{static code="ERR_JWKS_NO_MATCHING_KEY";code="ERR_JWKS_NO_MATCHING_KEY";constructor(a="no applicable key found in the JSON Web Key Set",b){super(a,b)}}class m extends d{[Symbol.asyncIterator];static code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";constructor(a="multiple matching keys found in the JSON Web Key Set",b){super(a,b)}}class n extends d{static code="ERR_JWKS_TIMEOUT";code="ERR_JWKS_TIMEOUT";constructor(a="request timed out",b){super(a,b)}}class o extends d{static code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED";code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED";constructor(a="signature verification failed",b){super(a,b)}}},90350:(a,b,c)=>{c.d(b,{q:()=>e});var d=c(60353);let e=(0,d.CN)({is:a=>"ValueNode"===a.kind,create:a=>(0,d.CN)({kind:"ValueNode",value:a}),createImmediate:a=>(0,d.CN)({kind:"ValueNode",value:a,immediate:!0})})},90409:(a,b,c)=>{c.d(b,{i:()=>e});var d=c(60353);let e=(0,d.CN)({is:a=>"SetOperationNode"===a.kind,create:(a,b,c)=>(0,d.CN)({kind:"SetOperationNode",operator:a,expression:b,all:c})})},90423:(a,b,c)=>{c.d(b,{c:()=>D});var d=c(44625),e=c(60353);let f=(0,e.CN)({is:a=>"SelectModifierNode"===a.kind,create:(a,b)=>(0,e.CN)({kind:"SelectModifierNode",modifier:a,of:b}),createWithExpression:a=>(0,e.CN)({kind:"SelectModifierNode",rawModifier:a})});var g=c(51591),h=c(19795),i=c(65582),j=c(2952),k=c(18804),l=c(4315),m=c(68019),n=c(70020);let o=(0,e.CN)({is:a=>"OffsetNode"===a.kind,create:a=>(0,e.CN)({kind:"OffsetNode",offset:a})}),p=(0,e.CN)({is:a=>"GroupByItemNode"===a.kind,create:a=>(0,e.CN)({kind:"GroupByItemNode",groupBy:a})});var q=c(39281),r=c(10106),s=c(81266),t=c(90409),u=c(57105);function v(a,b,c){return(0,e.Tn)(b)&&(b=b((0,q.O)())),(0,e.MH)(b)||(b=[b]),b.map(b=>t.i.create(a,(0,u.YK)(b),c))}var w=c(53284),x=c(77688),y=c(82324),z=c(90350);let A={create:(a,b)=>({kind:"FetchNode",rowCount:z.q.create(a),modifier:b})};var B=c(36903);class C{#G;constructor(a){this.#G=(0,e.CN)(a)}get expressionType(){}get isSelectQueryBuilder(){return!0}where(...a){return new C({...this.#G,queryNode:l.L.cloneWithWhere(this.#G.queryNode,(0,w.GB)(a))})}whereRef(a,b,c){return new C({...this.#G,queryNode:l.L.cloneWithWhere(this.#G.queryNode,(0,w.vC)(a,b,c))})}having(...a){return new C({...this.#G,queryNode:k.L.cloneWithHaving(this.#G.queryNode,(0,w.GB)(a))})}havingRef(a,b,c){return new C({...this.#G,queryNode:k.L.cloneWithHaving(this.#G.queryNode,(0,w.vC)(a,b,c))})}select(a){return new C({...this.#G,queryNode:k.L.cloneWithSelections(this.#G.queryNode,(0,i.G)(a))})}distinctOn(a){return new C({...this.#G,queryNode:k.L.cloneWithDistinctOn(this.#G.queryNode,(0,j.kU)(a))})}modifyFront(a){return new C({...this.#G,queryNode:k.L.cloneWithFrontModifier(this.#G.queryNode,f.createWithExpression(a.toOperationNode()))})}modifyEnd(a){return new C({...this.#G,queryNode:l.L.cloneWithEndModifier(this.#G.queryNode,f.createWithExpression(a.toOperationNode()))})}distinct(){return new C({...this.#G,queryNode:k.L.cloneWithFrontModifier(this.#G.queryNode,f.create("Distinct"))})}forUpdate(a){return new C({...this.#G,queryNode:l.L.cloneWithEndModifier(this.#G.queryNode,f.create("ForUpdate",a?(0,e._j)(a).map(h.M$):void 0))})}forShare(a){return new C({...this.#G,queryNode:l.L.cloneWithEndModifier(this.#G.queryNode,f.create("ForShare",a?(0,e._j)(a).map(h.M$):void 0))})}forKeyShare(a){return new C({...this.#G,queryNode:l.L.cloneWithEndModifier(this.#G.queryNode,f.create("ForKeyShare",a?(0,e._j)(a).map(h.M$):void 0))})}forNoKeyUpdate(a){return new C({...this.#G,queryNode:l.L.cloneWithEndModifier(this.#G.queryNode,f.create("ForNoKeyUpdate",a?(0,e._j)(a).map(h.M$):void 0))})}skipLocked(){return new C({...this.#G,queryNode:l.L.cloneWithEndModifier(this.#G.queryNode,f.create("SkipLocked"))})}noWait(){return new C({...this.#G,queryNode:l.L.cloneWithEndModifier(this.#G.queryNode,f.create("NoWait"))})}selectAll(a){return new C({...this.#G,queryNode:k.L.cloneWithSelections(this.#G.queryNode,(0,i.J)(a))})}innerJoin(...a){return this.#aR("InnerJoin",a)}leftJoin(...a){return this.#aR("LeftJoin",a)}rightJoin(...a){return this.#aR("RightJoin",a)}fullJoin(...a){return this.#aR("FullJoin",a)}crossJoin(...a){return this.#aR("CrossJoin",a)}innerJoinLateral(...a){return this.#aR("LateralInnerJoin",a)}leftJoinLateral(...a){return this.#aR("LateralLeftJoin",a)}crossJoinLateral(...a){return this.#aR("LateralCrossJoin",a)}crossApply(...a){return this.#aR("CrossApply",a)}outerApply(...a){return this.#aR("OuterApply",a)}#aR(a,b){return new C({...this.#G,queryNode:l.L.cloneWithJoin(this.#G.queryNode,(0,g.a)(a,b))})}orderBy(...a){return new C({...this.#G,queryNode:l.L.cloneWithOrderByItems(this.#G.queryNode,(0,m.xk)(a))})}groupBy(a){var b;return new C({...this.#G,queryNode:k.L.cloneWithGroupByItems(this.#G.queryNode,(b=a,b=(0,e.Tn)(b)?b((0,q.A)()):b,(0,j.kU)(b).map(p.create)))})}limit(a){return new C({...this.#G,queryNode:k.L.cloneWithLimit(this.#G.queryNode,n.a.create((0,y.$s)(a)))})}offset(a){return new C({...this.#G,queryNode:k.L.cloneWithOffset(this.#G.queryNode,o.create((0,y.$s)(a)))})}fetch(a,b="only"){return new C({...this.#G,queryNode:k.L.cloneWithFetch(this.#G.queryNode,function(a,b){var c;if(!(0,e.Et)(a)&&!(0,e.sI)(a))throw Error(`Invalid fetch row count: ${a}`);if("only"!==(c=b)&&"with ties"!==c)throw Error(`Invalid fetch modifier: ${b}`);return A.create(a,b)}(a,b))})}top(a,b){return new C({...this.#G,queryNode:l.L.cloneWithTop(this.#G.queryNode,(0,B.f)(a,b))})}union(a){return new C({...this.#G,queryNode:k.L.cloneWithSetOperations(this.#G.queryNode,v("union",a,!1))})}unionAll(a){return new C({...this.#G,queryNode:k.L.cloneWithSetOperations(this.#G.queryNode,v("union",a,!0))})}intersect(a){return new C({...this.#G,queryNode:k.L.cloneWithSetOperations(this.#G.queryNode,v("intersect",a,!1))})}intersectAll(a){return new C({...this.#G,queryNode:k.L.cloneWithSetOperations(this.#G.queryNode,v("intersect",a,!0))})}except(a){return new C({...this.#G,queryNode:k.L.cloneWithSetOperations(this.#G.queryNode,v("except",a,!1))})}exceptAll(a){return new C({...this.#G,queryNode:k.L.cloneWithSetOperations(this.#G.queryNode,v("except",a,!0))})}as(a){return new E(this,a)}clearSelect(){return new C({...this.#G,queryNode:k.L.cloneWithoutSelections(this.#G.queryNode)})}clearWhere(){return new C({...this.#G,queryNode:l.L.cloneWithoutWhere(this.#G.queryNode)})}clearLimit(){return new C({...this.#G,queryNode:k.L.cloneWithoutLimit(this.#G.queryNode)})}clearOffset(){return new C({...this.#G,queryNode:k.L.cloneWithoutOffset(this.#G.queryNode)})}clearOrderBy(){return new C({...this.#G,queryNode:l.L.cloneWithoutOrderBy(this.#G.queryNode)})}clearGroupBy(){return new C({...this.#G,queryNode:k.L.cloneWithoutGroupBy(this.#G.queryNode)})}$call(a){return a(this)}$if(a,b){return a?b(this):new C({...this.#G})}$castTo(){return new C(this.#G)}$narrowType(){return new C(this.#G)}$assertType(){return new C(this.#G)}$asTuple(){return new x.Is(this.toOperationNode())}$asScalar(){return new x.Is(this.toOperationNode())}withPlugin(a){return new C({...this.#G,executor:this.#G.executor.withPlugin(a)})}toOperationNode(){return this.#G.executor.transformQuery(this.#G.queryNode,this.#G.queryId)}compile(){return this.#G.executor.compileQuery(this.toOperationNode(),this.#G.queryId)}async execute(){let a=this.compile();return(await this.#G.executor.executeQuery(a)).rows}async executeTakeFirst(){let[a]=await this.execute();return a}async executeTakeFirstOrThrow(a=r.F){let b=await this.executeTakeFirst();if(void 0===b)throw(0,r.x)(a)?new a(this.toOperationNode()):a(this.toOperationNode());return b}async *stream(a=100){let b=this.compile();for await(let c of this.#G.executor.stream(b,a))yield*c.rows}async explain(a,b){let c=new C({...this.#G,queryNode:l.L.cloneWithExplain(this.#G.queryNode,a,b)});return await c.execute()}}function D(a){return new C(a)}class E{#aZ;#aA;constructor(a,b){this.#aZ=a,this.#aA=b}get expression(){return this.#aZ}get alias(){return this.#aA}get isAliasedSelectQueryBuilder(){return!0}toOperationNode(){return d.N.create(this.#aZ.toOperationNode(),s.O.create(this.#aA))}}},92769:(a,b,c)=>{c.d(b,{s:()=>e});var d=c(94324);function e(a){try{if("string"!=typeof a)return a;return JSON.parse(a,function(a,b){if("string"==typeof b&&/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(?:\.\d+)?Z$/.test(b)){let a=new Date(b);if(!isNaN(a.getTime()))return a}return b})}catch(a){return d.a.error("Error parsing JSON",{error:a}),null}}},93087:(a,b,c)=>{c.d(b,{U:()=>g});var d=c(60353),e=c(75227),f=c(97831);let g=(0,d.CN)({is:a=>"UpdateQueryNode"===a.kind,create:(a,b)=>(0,d.CN)({kind:"UpdateQueryNode",table:1===a.length?a[0]:f.v.create(a),...b&&{with:b}}),createWithoutTable:()=>(0,d.CN)({kind:"UpdateQueryNode"}),cloneWithFromItems:(a,b)=>(0,d.CN)({...a,from:a.from?e.N.cloneWithFroms(a.from,b):e.N.create(b)}),cloneWithUpdates:(a,b)=>(0,d.CN)({...a,updates:a.updates?(0,d.CN)([...a.updates,...b]):b}),cloneWithLimit:(a,b)=>(0,d.CN)({...a,limit:b})})},93092:(a,b,c)=>{c.d(b,{B:()=>f,o:()=>e});var d=c(60353);let e=["preserve rows","delete rows","drop"],f=(0,d.CN)({is:a=>"CreateTableNode"===a.kind,create:a=>(0,d.CN)({kind:"CreateTableNode",table:a,columns:(0,d.CN)([])}),cloneWithColumn:(a,b)=>(0,d.CN)({...a,columns:(0,d.CN)([...a.columns,b])}),cloneWithConstraint:(a,b)=>(0,d.CN)({...a,constraints:a.constraints?(0,d.CN)([...a.constraints,b]):(0,d.CN)([b])}),cloneWithFrontModifier:(a,b)=>(0,d.CN)({...a,frontModifiers:a.frontModifiers?(0,d.CN)([...a.frontModifiers,b]):(0,d.CN)([b])}),cloneWithEndModifier:(a,b)=>(0,d.CN)({...a,endModifiers:a.endModifiers?(0,d.CN)([...a.endModifiers,b]):(0,d.CN)([b])}),cloneWith:(a,b)=>(0,d.CN)({...a,...b})})},93159:(a,b,c)=>{c.d(b,{s:()=>e});var d=c(60353);let e=(0,d.CN)({is:a=>"ValueListNode"===a.kind,create:a=>(0,d.CN)({kind:"ValueListNode",values:(0,d.CN)(a)})})},93226:(a,b,c)=>{c.d(b,{A:()=>d});let d=(a,b)=>{if(a.startsWith("RS")||a.startsWith("PS")){let{modulusLength:c}=b.algorithm;if("number"!=typeof c||c<2048)throw TypeError(`${a} requires key modulusLength to be 2048 bits or larger`)}}},94285:(a,b,c)=>{function d(a){switch(a){case"a-z":return"abcdefghijklmnopqrstuvwxyz";case"A-Z":return"ABCDEFGHIJKLMNOPQRSTUVWXYZ";case"0-9":return"0123456789";case"-_":return"-_";default:throw Error(`Unsupported alphabet: ${a}`)}}function e(...a){let b=a.map(d).join("");if(0===b.length)throw Error("No valid characters provided for random string generation.");let c=b.length;return(a,...e)=>{let f;if(a<=0)throw Error("Length must be a positive integer.");let g=b,h=c;e.length>0&&(h=(g=e.map(d).join("")).length);let i=Math.floor(256/h)*h,j=new Uint8Array(2*a),k=j.length,l="",m=k;for(;l.length<a;)m>=k&&(crypto.getRandomValues(j),m=0),(f=j[m++])<i&&(l+=g[f%h]);return l}}c.d(b,{q:()=>e})},94296:(a,b,c)=>{c.d(b,{k:()=>e});var d=c(60353);let e=(0,d.CN)({is:a=>"ParensNode"===a.kind,create:a=>(0,d.CN)({kind:"ParensNode",node:a})})},94324:(a,b,c)=>{c.d(b,{a:()=>m,b:()=>h,c:()=>l,s:()=>j});var d=c(8897);let e={eterm:4,cons25:4,console:4,cygwin:4,dtterm:4,gnome:4,hurd:4,jfbterm:4,konsole:4,kterm:4,mlterm:4,mosh:24,putty:4,st:4,"rxvt-unicode-24bit":24,terminator:24,"xterm-kitty":24},f=new Map(Object.entries({APPVEYOR:8,BUILDKITE:8,CIRCLECI:24,DRONE:8,GITEA_ACTIONS:24,GITHUB_ACTIONS:24,GITLAB_CI:8,TRAVIS:8})),g=[/ansi/,/color/,/linux/,/direct/,/^con[0-9]*x[0-9]/,/^rxvt/,/^screen/,/^xterm/,/^vt100/,/^vt220/],h={reset:"\x1b[0m",bright:"\x1b[1m",dim:"\x1b[2m",fg:{red:"\x1b[31m",green:"\x1b[32m",yellow:"\x1b[33m",blue:"\x1b[34m",magenta:"\x1b[35m"},bg:{black:"\x1b[40m"}},i=["info","success","warn","error","debug"];function j(a,b){return i.indexOf(b)<=i.indexOf(a)}let k={info:h.fg.blue,success:h.fg.green,warn:h.fg.yellow,error:h.fg.red,debug:h.fg.magenta},l=a=>{let b=a?.disabled!==!0,c=a?.level??"error",l=a?.disableColors!==void 0?!a.disableColors:1!==function(){if(void 0!==(0,d.g)("FORCE_COLOR"))switch((0,d.g)("FORCE_COLOR")){case"":case"1":case"true":return 4;case"2":return 8;case"3":return 24;default:return 1}if(void 0!==(0,d.g)("NODE_DISABLE_COLORS")&&""!==(0,d.g)("NODE_DISABLE_COLORS")||void 0!==(0,d.g)("NO_COLOR")&&""!==(0,d.g)("NO_COLOR")||"dumb"===(0,d.g)("TERM"))return 1;if("undefined"!=typeof process&&"win32"===process.platform||(0,d.g)("TMUX"))return 24;if("TF_BUILD"in d.e&&"AGENT_NAME"in d.e)return 4;if("CI"in d.e){for(let{0:a,1:b}of f)if(a in d.e)return b;return"codeship"===(0,d.g)("CI_NAME")?8:1}if("TEAMCITY_VERSION"in d.e)return null!==/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.exec((0,d.g)("TEAMCITY_VERSION"))?4:1;switch((0,d.g)("TERM_PROGRAM")){case"iTerm.app":if(!(0,d.g)("TERM_PROGRAM_VERSION")||null!==/^[0-2]\./.exec((0,d.g)("TERM_PROGRAM_VERSION")))return 8;return 24;case"HyperTerm":case"MacTerm":return 24;case"Apple_Terminal":return 8}if("truecolor"===(0,d.g)("COLORTERM")||"24bit"===(0,d.g)("COLORTERM"))return 24;if((0,d.g)("TERM")){if(null!==/truecolor/.exec((0,d.g)("TERM")))return 24;if(null!==/^xterm-256/.exec((0,d.g)("TERM")))return 8;let a=(0,d.g)("TERM").toLowerCase();if(e[a])return e[a];if(g.some(b=>null!==b.exec(a)))return 4}return(0,d.g)("COLORTERM")?4:1}();return{...Object.fromEntries(i.map(d=>[d,(...[e,...f])=>((d,e,f=[])=>{if(!b||!j(c,d))return;let g=((a,b,c)=>{let d=new Date().toISOString();return c?`${h.dim}${d}${h.reset} ${k[a]}${a.toUpperCase()}${h.reset} ${h.bright}[Better Auth]:${h.reset} ${b}`:`${d} ${a.toUpperCase()} [Better Auth]: ${b}`})(d,e,l);if(!a||"function"!=typeof a.log)return void("error"===d?console.error(g,...f):"warn"===d?console.warn(g,...f):console.log(g,...f));a.log("success"===d?"info":d,e,...f)})(d,e,f)])),get level(){return c}}},m=l()},96370:(a,b,c)=>{c.d(b,{A:()=>d});let d=(...a)=>{let b,c=a.filter(Boolean);if(0===c.length||1===c.length)return!0;for(let a of c){let c=Object.keys(a);if(!b||0===b.size){b=new Set(c);continue}for(let a of c){if(b.has(a))return!1;b.add(a)}}return!0}},96843:(a,b,c)=>{c.d(b,{B:()=>o,a:()=>n,b:()=>q,c:()=>m,d:()=>x,e:()=>w,f:()=>u,g:()=>r,i:()=>t,l:()=>v,r:()=>y,s:()=>s});var d=c(23427),e=c(84916),f=c(5761),g=c(46762),h=c(92769),i=c(37305),j=c(5109),k=c(33679);let l=(0,d.Ny)(async()=>({})),m=d.Ny.create({use:[l,(0,d.Ny)(async()=>({}))]}),n=d.UD.create({use:[l]}),o={USER_NOT_FOUND:"User not found",FAILED_TO_CREATE_USER:"Failed to create user",FAILED_TO_CREATE_SESSION:"Failed to create session",FAILED_TO_UPDATE_USER:"Failed to update user",FAILED_TO_GET_SESSION:"Failed to get session",INVALID_PASSWORD:"Invalid password",INVALID_EMAIL:"Invalid email",INVALID_EMAIL_OR_PASSWORD:"Invalid email or password",SOCIAL_ACCOUNT_ALREADY_LINKED:"Social account already linked",PROVIDER_NOT_FOUND:"Provider not found",INVALID_TOKEN:"Invalid token",ID_TOKEN_NOT_SUPPORTED:"id_token not supported",FAILED_TO_GET_USER_INFO:"Failed to get user info",USER_EMAIL_NOT_FOUND:"User email not found",EMAIL_NOT_VERIFIED:"Email not verified",PASSWORD_TOO_SHORT:"Password too short",PASSWORD_TOO_LONG:"Password too long",USER_ALREADY_EXISTS:"User already exists.",USER_ALREADY_EXISTS_USE_ANOTHER_EMAIL:"User already exists. Use another email.",EMAIL_CAN_NOT_BE_UPDATED:"Email can not be updated",CREDENTIAL_ACCOUNT_NOT_FOUND:"Credential account not found",SESSION_EXPIRED:"Session expired. Re-authenticate to perform this action.",FAILED_TO_UNLINK_LAST_ACCOUNT:"You can't unlink your last account",ACCOUNT_NOT_FOUND:"Account not found",USER_ALREADY_HAS_PASSWORD:"User already has a password. Provide that to delete the account."},p=g.lqM(g.Ikc({disableCookieCache:g.auy.boolean().meta({description:"Disable cookie cache and fetch session from database"}).optional(),disableRefresh:g.auy.boolean().meta({description:"Disable session refresh. Useful for checking session status, without updating the session"}).optional()})),q=()=>n("/get-session",{method:"GET",query:p,requireHeaders:!0,metadata:{openapi:{description:"Get the current session",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{session:{$ref:"#/components/schemas/Session"},user:{$ref:"#/components/schemas/User"}},required:["session","user"]}}}}}}}},async a=>{try{let b=await a.getSignedCookie(a.context.authCookies.sessionToken.name,a.context.secret);if(!b)return null;let c=a.getCookie(a.context.authCookies.sessionData.name),d=c?(0,h.s)(k.a.decode(j.z.decode(c))):null;if(d&&!await (0,i.s)("SHA-256","base64urlnopad").verify(a.context.secret,JSON.stringify({...d.session,expiresAt:d.expiresAt}),d.signature)){let b=a.context.authCookies.sessionData.name;return a.setCookie(b,"",{maxAge:0}),a.json(null)}let g=await a.getSignedCookie(a.context.authCookies.dontRememberToken.name,a.context.secret);if(d?.session&&a.context.options.session?.cookieCache?.enabled&&!a.query?.disableCookieCache){let b=d.session;if(!(d.expiresAt<Date.now()||b.session.expiresAt<new Date))return a.context.session=b,a.json(b);{let b=a.context.authCookies.sessionData.name;a.setCookie(b,"",{maxAge:0})}}let l=await a.context.internalAdapter.findSession(b);if(a.context.session=l,!l||l.session.expiresAt<new Date)return(0,f.d)(a),l&&await a.context.internalAdapter.deleteSession(l.session.token),a.json(null);if(g||a.query?.disableRefresh)return a.json(l);let m=a.context.sessionConfig.expiresIn,n=a.context.sessionConfig.updateAge;if(l.session.expiresAt.valueOf()-1e3*m+1e3*n<=Date.now()&&(!a.query?.disableRefresh||!a.context.options.session?.disableSessionRefresh)){let b=await a.context.internalAdapter.updateSession(l.session.token,{expiresAt:(0,e.g)(a.context.sessionConfig.expiresIn,"sec"),updatedAt:new Date});if(!b)return(0,f.d)(a),a.json(null,{status:401});let c=(b.expiresAt.valueOf()-Date.now())/1e3;return await (0,f.s)(a,{session:b,user:l.user},!1,{maxAge:c}),a.json({session:b,user:l.user})}return await (0,f.b)(a,l,!!g),a.json(l)}catch(b){throw a.context.logger.error("INTERNAL_SERVER_ERROR",b),new d.LG("INTERNAL_SERVER_ERROR",{message:o.FAILED_TO_GET_SESSION})}}),r=async(a,b)=>{if(a.context.session)return a.context.session;let c=await q()({...a,asResponse:!1,headers:a.headers,returnHeaders:!1,query:{...b,...a.query}}).catch(a=>null);return a.context.session=c,c},s=m(async a=>{let b=await r(a);if(!b?.session)throw new d.LG("UNAUTHORIZED");return{session:b}}),t=m(async a=>{let b=await r(a,{disableCookieCache:!0});if(!b?.session)throw new d.LG("UNAUTHORIZED");return{session:b}});m(async a=>{let b=await r(a);if(!b?.session&&(a.request||a.headers))throw new d.LG("UNAUTHORIZED");return{session:b}});let u=m(async a=>{let b=await r(a);if(!b?.session)throw new d.LG("UNAUTHORIZED");if(0===a.context.sessionConfig.freshAge)return{session:b};let c=a.context.sessionConfig.freshAge,e=b.session.updatedAt?.valueOf()||b.session.createdAt.valueOf();if(!(Date.now()-e<1e3*c))throw new d.LG("FORBIDDEN",{message:"Session is not fresh"});return{session:b}}),v=()=>n("/list-sessions",{method:"GET",use:[s],requireHeaders:!0,metadata:{openapi:{description:"List all active sessions for the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"array",items:{$ref:"#/components/schemas/Session"}}}}}}}}},async a=>{try{let b=(await a.context.internalAdapter.listSessions(a.context.session.user.id)).filter(a=>a.expiresAt>new Date);return a.json(b)}catch(b){throw a.context.logger.error(b),a.error("INTERNAL_SERVER_ERROR")}}),w=n("/revoke-session",{method:"POST",body:g.Ikc({token:g.YjP().meta({description:"The token to revoke"})}),use:[t],requireHeaders:!0,metadata:{openapi:{description:"Revoke a single session",requestBody:{content:{"application/json":{schema:{type:"object",properties:{token:{type:"string",description:"The token to revoke"}},required:["token"]}}}},responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if the session was revoked successfully"}},required:["status"]}}}}}}}},async a=>{let b=a.body.token,c=await a.context.internalAdapter.findSession(b);if(!c)throw new d.LG("BAD_REQUEST",{message:"Session not found"});if(c.session.userId!==a.context.session.user.id)throw new d.LG("UNAUTHORIZED");try{await a.context.internalAdapter.deleteSession(b)}catch(b){throw a.context.logger.error(b&&"object"==typeof b&&"name"in b?b.name:"",b),new d.LG("INTERNAL_SERVER_ERROR")}return a.json({status:!0})}),x=n("/revoke-sessions",{method:"POST",use:[t],requireHeaders:!0,metadata:{openapi:{description:"Revoke all sessions for the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if all sessions were revoked successfully"}},required:["status"]}}}}}}}},async a=>{try{await a.context.internalAdapter.deleteSessions(a.context.session.user.id)}catch(b){throw a.context.logger.error(b&&"object"==typeof b&&"name"in b?b.name:"",b),new d.LG("INTERNAL_SERVER_ERROR")}return a.json({status:!0})}),y=n("/revoke-other-sessions",{method:"POST",requireHeaders:!0,use:[t],metadata:{openapi:{description:"Revoke all other sessions for the user except the current one",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if all other sessions were revoked successfully"}},required:["status"]}}}}}}}},async a=>{let b=a.context.session;if(!b.user)throw new d.LG("UNAUTHORIZED");let c=(await a.context.internalAdapter.listSessions(b.user.id)).filter(a=>a.expiresAt>new Date).filter(b=>b.token!==a.context.session.session.token);return await Promise.all(c.map(b=>a.context.internalAdapter.deleteSession(b.token))),a.json({status:!0})})},96931:(a,b,c)=>{c.d(b,{D:()=>e});let d=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9"];function e(a){let b="";for(let c=0;c<a;++c)b+=d[~~(Math.random()*d.length)];return b}},97831:(a,b,c)=>{c.d(b,{v:()=>e});var d=c(60353);let e=(0,d.CN)({is:a=>"ListNode"===a.kind,create:a=>(0,d.CN)({kind:"ListNode",items:(0,d.CN)(a)})})}};